function Gs(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var Rt,q,bn,be,tr,En,hi,Mi,ui,ci,We={},xn=[],Vs=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Ii=Array.isArray;function _e(t,e){for(var i in e)t[i]=e[i];return t}function Cn(t){var e=t.parentNode;e&&e.removeChild(t)}function Xs(t,e,i){var r,n,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?n=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?Rt.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return at(t,o,r,n,null)}function at(t,e,i,r,n){var s={type:t,props:e,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:n??++bn,__i:-1,__u:0};return n==null&&q.vnode!=null&&q.vnode(s),s}function we(t){return t.children}function lt(t,e){this.props=t,this.context=e}function Ce(t,e){if(e==null)return t.__?Ce(t.__,t.__i+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?Ce(t):null}function Rn(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return Rn(t)}}function ir(t){(!t.__d&&(t.__d=!0)&&be.push(t)&&!mt.__r++||tr!==q.debounceRendering)&&((tr=q.debounceRendering)||En)(mt)}function mt(){var t,e,i,r,n,s,o,a;for(be.sort(hi);t=be.shift();)t.__d&&(e=be.length,r=void 0,s=(n=(i=t).__v).__e,o=[],a=[],i.__P&&((r=_e({},n)).__v=n.__v+1,q.vnode&&q.vnode(r),ki(i.__P,r,n,i.__n,i.__P.ownerSVGElement!==void 0,32&n.__u?[s]:null,o,s??Ce(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,Tn(o,r,a),r.__e!=s&&Rn(r)),be.length>e&&be.sort(hi));mt.__r=0}function An(t,e,i,r,n,s,o,a,u,c,p){var d,_,m,w,b,E=r&&r.__k||xn,y=e.length;for(i.__d=u,Qs(i,e,E),u=i.__d,d=0;d<y;d++)(m=i.__k[d])!=null&&typeof m!="boolean"&&typeof m!="function"&&(_=m.__i===-1?We:E[m.__i]||We,m.__i=d,ki(t,m,_,n,s,o,a,u,c,p),w=m.__e,m.ref&&_.ref!=m.ref&&(_.ref&&Li(_.ref,null,m),p.push(m.ref,m.__c||w,m)),b==null&&w!=null&&(b=w),65536&m.__u||_.__k===m.__k?(u&&!u.isConnected&&(u=Ce(_)),u=Sn(m,u,t)):typeof m.type=="function"&&m.__d!==void 0?u=m.__d:w&&(u=w.nextSibling),m.__d=void 0,m.__u&=-196609);i.__d=u,i.__e=b}function Qs(t,e,i){var r,n,s,o,a,u=e.length,c=i.length,p=c,d=0;for(t.__k=[],r=0;r<u;r++)o=r+d,(n=t.__k[r]=(n=e[r])==null||typeof n=="boolean"||typeof n=="function"?null:typeof n=="string"||typeof n=="number"||typeof n=="bigint"||n.constructor==String?at(null,n,null,null,null):Ii(n)?at(we,{children:n},null,null,null):n.constructor===void 0&&n.__b>0?at(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n)!=null?(n.__=t,n.__b=t.__b+1,a=Ks(n,i,o,p),n.__i=a,s=null,a!==-1&&(p--,(s=i[a])&&(s.__u|=131072)),s==null||s.__v===null?(a==-1&&d--,typeof n.type!="function"&&(n.__u|=65536)):a!==o&&(a===o+1?d++:a>o?p>u-o?d+=a-o:d--:a<o?a==o-1&&(d=a-o):d=0,a!==r+d&&(n.__u|=65536))):(s=i[o])&&s.key==null&&s.__e&&!(131072&s.__u)&&(s.__e==t.__d&&(t.__d=Ce(s)),di(s,s,!1),i[o]=null,p--);if(p)for(r=0;r<c;r++)(s=i[r])!=null&&!(131072&s.__u)&&(s.__e==t.__d&&(t.__d=Ce(s)),di(s,s))}function Sn(t,e,i){var r,n;if(typeof t.type=="function"){for(r=t.__k,n=0;r&&n<r.length;n++)r[n]&&(r[n].__=t,e=Sn(r[n],e,i));return e}t.__e!=e&&(i.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function Ks(t,e,i,r){var n=t.key,s=t.type,o=i-1,a=i+1,u=e[i];if(u===null||u&&n==u.key&&s===u.type&&!(131072&u.__u))return i;if(r>(u!=null&&!(131072&u.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((u=e[o])&&!(131072&u.__u)&&n==u.key&&s===u.type)return o;o--}if(a<e.length){if((u=e[a])&&!(131072&u.__u)&&n==u.key&&s===u.type)return a;a++}}return-1}function rr(t,e,i){e[0]==="-"?t.setProperty(e,i??""):t[e]=i==null?"":typeof i!="number"||Vs.test(e)?i:i+"px"}function et(t,e,i,r,n){var s;e:if(e==="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)i&&e in i||rr(t.style,e,"");if(i)for(e in i)r&&i[e]===r[e]||rr(t.style,e,i[e])}else if(e[0]==="o"&&e[1]==="n")s=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=i,i?r?i.u=r.u:(i.u=Mi,t.addEventListener(e,s?ci:ui,s)):t.removeEventListener(e,s?ci:ui,s);else{if(n)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,i))}}function nr(t){return function(e){if(this.l){var i=this.l[e.type+t];if(e.t==null)e.t=Mi++;else if(e.t<i.u)return;return i(q.event?q.event(e):e)}}}function ki(t,e,i,r,n,s,o,a,u,c){var p,d,_,m,w,b,E,y,x,R,S,T,M,k,O,P=e.type;if(e.constructor!==void 0)return null;128&i.__u&&(u=!!(32&i.__u),s=[a=e.__e=i.__e]),(p=q.__b)&&p(e);e:if(typeof P=="function")try{if(y=e.props,x=(p=P.contextType)&&r[p.__c],R=p?x?x.props.value:p.__:r,i.__c?E=(d=e.__c=i.__c).__=d.__E:("prototype"in P&&P.prototype.render?e.__c=d=new P(y,R):(e.__c=d=new lt(y,R),d.constructor=P,d.render=Js),x&&x.sub(d),d.props=y,d.state||(d.state={}),d.context=R,d.__n=r,_=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),P.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=_e({},d.__s)),_e(d.__s,P.getDerivedStateFromProps(y,d.__s))),m=d.props,w=d.state,d.__v=e,_)P.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(P.getDerivedStateFromProps==null&&y!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(y,R),!d.__e&&(d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(y,d.__s,R)===!1||e.__v===i.__v)){for(e.__v!==i.__v&&(d.props=y,d.state=d.__s,d.__d=!1),e.__e=i.__e,e.__k=i.__k,e.__k.forEach(function(H){H&&(H.__=e)}),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(y,d.__s,R),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,w,b)})}if(d.context=R,d.props=y,d.__P=t,d.__e=!1,T=q.__r,M=0,"prototype"in P&&P.prototype.render){for(d.state=d.__s,d.__d=!1,T&&T(e),p=d.render(d.props,d.state,d.context),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[]}else do d.__d=!1,T&&T(e),p=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++M<25);d.state=d.__s,d.getChildContext!=null&&(r=_e(_e({},r),d.getChildContext())),_||d.getSnapshotBeforeUpdate==null||(b=d.getSnapshotBeforeUpdate(m,w)),An(t,Ii(O=p!=null&&p.type===we&&p.key==null?p.props.children:p)?O:[O],e,i,r,n,s,o,a,u,c),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),E&&(d.__E=d.__=null)}catch(H){e.__v=null,u||s!=null?(e.__e=a,e.__u|=u?160:32,s[s.indexOf(a)]=null):(e.__e=i.__e,e.__k=i.__k),q.__e(H,e,i)}else s==null&&e.__v===i.__v?(e.__k=i.__k,e.__e=i.__e):e.__e=Zs(i.__e,e,i,r,n,s,o,u,c);(p=q.diffed)&&p(e)}function Tn(t,e,i){e.__d=void 0;for(var r=0;r<i.length;r++)Li(i[r],i[++r],i[++r]);q.__c&&q.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(s){s.call(n)})}catch(s){q.__e(s,n.__v)}})}function Zs(t,e,i,r,n,s,o,a,u){var c,p,d,_,m,w,b,E=i.props,y=e.props,x=e.type;if(x==="svg"&&(n=!0),s!=null){for(c=0;c<s.length;c++)if((m=s[c])&&"setAttribute"in m==!!x&&(x?m.localName===x:m.nodeType===3)){t=m,s[c]=null;break}}if(t==null){if(x===null)return document.createTextNode(y);t=n?document.createElementNS("http://www.w3.org/2000/svg",x):document.createElement(x,y.is&&y),s=null,a=!1}if(x===null)E===y||a&&t.data===y||(t.data=y);else{if(s=s&&Rt.call(t.childNodes),E=i.props||We,!a&&s!=null)for(E={},c=0;c<t.attributes.length;c++)E[(m=t.attributes[c]).name]=m.value;for(c in E)m=E[c],c=="children"||(c=="dangerouslySetInnerHTML"?d=m:c==="key"||c in y||et(t,c,null,m,n));for(c in y)m=y[c],c=="children"?_=m:c=="dangerouslySetInnerHTML"?p=m:c=="value"?w=m:c=="checked"?b=m:c==="key"||a&&typeof m!="function"||E[c]===m||et(t,c,m,E[c],n);if(p)a||d&&(p.__html===d.__html||p.__html===t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(d&&(t.innerHTML=""),An(t,Ii(_)?_:[_],e,i,r,n&&x!=="foreignObject",s,o,s?s[0]:i.__k&&Ce(i,0),a,u),s!=null)for(c=s.length;c--;)s[c]!=null&&Cn(s[c]);a||(c="value",w!==void 0&&(w!==t[c]||x==="progress"&&!w||x==="option"&&w!==E[c])&&et(t,c,w,E[c],!1),c="checked",b!==void 0&&b!==t[c]&&et(t,c,b,E[c],!1))}return t}function Li(t,e,i){try{typeof t=="function"?t(e):t.current=e}catch(r){q.__e(r,i)}}function di(t,e,i){var r,n;if(q.unmount&&q.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||Li(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){q.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(n=0;n<r.length;n++)r[n]&&di(r[n],e,i||typeof t.type!="function");i||t.__e==null||Cn(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function Js(t,e,i){return this.constructor(t,i)}function eo(t,e,i){var r,n,s,o;q.__&&q.__(t,e),n=(r=typeof i=="function")?null:i&&i.__k||e.__k,s=[],o=[],ki(e,t=(!r&&i||e).__k=Xs(we,null,[t]),n||We,We,e.ownerSVGElement!==void 0,!r&&i?[i]:n?null:e.firstChild?Rt.call(e.childNodes):null,s,!r&&i?i:n?n.__e:e.firstChild,r,o),Tn(s,t,o)}Rt=xn.slice,q={__e:function(t,e,i,r){for(var n,s,o;e=e.__;)if((n=e.__c)&&!n.__)try{if((s=n.constructor)&&s.getDerivedStateFromError!=null&&(n.setState(s.getDerivedStateFromError(t)),o=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(t,r||{}),o=n.__d),o)return n.__E=n}catch(a){t=a}throw t}},bn=0,lt.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=_e({},this.state),typeof t=="function"&&(t=t(_e({},i),this.props)),t&&_e(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),ir(this))},lt.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ir(this))},lt.prototype.render=we,be=[],En=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,hi=function(t,e){return t.__v.__b-e.__v.__b},mt.__r=0,Mi=0,ui=nr(!1),ci=nr(!0);var je,V,Dt,sr,_t=0,Fn=[],ht=[],Q=q,or=Q.__b,ar=Q.__r,lr=Q.diffed,hr=Q.__c,ur=Q.unmount,cr=Q.__;function Ni(t,e){Q.__h&&Q.__h(V,t,_t||e),_t=0;var i=V.__H||(V.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({__V:ht}),i.__[t]}function Mn(t){return _t=1,to(kn,t)}function to(t,e,i){var r=Ni(je++,2);if(r.t=t,!r.__c&&(r.__=[i?i(e):kn(void 0,e),function(a){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,a);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=V,!V.u)){var n=function(a,u,c){if(!r.__c.__H)return!0;var p=r.__c.__H.__.filter(function(_){return!!_.__c});if(p.every(function(_){return!_.__N}))return!s||s.call(this,a,u,c);var d=!1;return p.forEach(function(_){if(_.__N){var m=_.__[0];_.__=_.__N,_.__N=void 0,m!==_.__[0]&&(d=!0)}}),!(!d&&r.__c.props===a)&&(!s||s.call(this,a,u,c))};V.u=!0;var s=V.shouldComponentUpdate,o=V.componentWillUpdate;V.componentWillUpdate=function(a,u,c){if(this.__e){var p=s;s=void 0,n(a,u,c),s=p}o&&o.call(this,a,u,c)},V.shouldComponentUpdate=n}return r.__N||r.__}function Bi(t,e){var i=Ni(je++,3);!Q.__s&&In(i.__H,e)&&(i.__=t,i.i=e,V.__H.__h.push(i))}function io(t){return _t=5,ro(function(){return{current:t}},[])}function ro(t,e){var i=Ni(je++,7);return In(i.__H,e)?(i.__V=t(),i.i=e,i.__h=t,i.__V):i.__}function no(){for(var t;t=Fn.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ut),t.__H.__h.forEach(fi),t.__H.__h=[]}catch(e){t.__H.__h=[],Q.__e(e,t.__v)}}Q.__b=function(t){V=null,or&&or(t)},Q.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),cr&&cr(t,e)},Q.__r=function(t){ar&&ar(t),je=0;var e=(V=t.__c).__H;e&&(Dt===V?(e.__h=[],V.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.__V=ht,i.__N=i.i=void 0})):(e.__h.forEach(ut),e.__h.forEach(fi),e.__h=[],je=0)),Dt=V},Q.diffed=function(t){lr&&lr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Fn.push(e)!==1&&sr===Q.requestAnimationFrame||((sr=Q.requestAnimationFrame)||so)(no)),e.__H.__.forEach(function(i){i.i&&(i.__H=i.i),i.__V!==ht&&(i.__=i.__V),i.i=void 0,i.__V=ht})),Dt=V=null},Q.__c=function(t,e){e.some(function(i){try{i.__h.forEach(ut),i.__h=i.__h.filter(function(r){return!r.__||fi(r)})}catch(r){e.some(function(n){n.__h&&(n.__h=[])}),e=[],Q.__e(r,i.__v)}}),hr&&hr(t,e)},Q.unmount=function(t){ur&&ur(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(r){try{ut(r)}catch(n){e=n}}),i.__H=void 0,e&&Q.__e(e,i.__v))};var dr=typeof requestAnimationFrame=="function";function so(t){var e,i=function(){clearTimeout(r),dr&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(i,100);dr&&(e=requestAnimationFrame(i))}function ut(t){var e=V,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),V=e}function fi(t){var e=V;t.__c=t.__(),V=e}function In(t,e){return!t||t.length!==e.length||e.some(function(i,r){return i!==t[r]})}function kn(t,e){return typeof e=="function"?e(t):e}var fr=Ln;function Ln(){var t=[].slice.call(arguments),e=!1;typeof t[0]=="boolean"&&(e=t.shift());var i=t[0];if(pr(i))throw new Error("extendee must be an object");for(var r=t.slice(1),n=r.length,s=0;s<n;s++){var o=r[s];for(var a in o)if(Object.prototype.hasOwnProperty.call(o,a)){var u=o[a];if(e&&oo(u)){var c=Array.isArray(u)?[]:{};i[a]=Ln(!0,Object.prototype.hasOwnProperty.call(i,a)&&!pr(i[a])?i[a]:c,u)}else i[a]=u}}return i}function oo(t){return Array.isArray(t)||{}.toString.call(t)=="[object Object]"}function pr(t){return!t||typeof t!="object"&&typeof t!="function"}function ao(t){return t&&t.__esModule?t.default:t}class gr{on(e,i){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i),this}emit(e,...i){this._callbacks=this._callbacks||{};let r=this._callbacks[e];if(r)for(let n of r)n.apply(this,i);return this.element&&this.element.dispatchEvent(this.makeEvent("dropzone:"+e,{args:i})),this}makeEvent(e,i){let r={bubbles:!0,cancelable:!0,detail:i};if(typeof window.CustomEvent=="function")return new CustomEvent(e,r);var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),n}off(e,i){if(!this._callbacks||arguments.length===0)return this._callbacks={},this;let r=this._callbacks[e];if(!r)return this;if(arguments.length===1)return delete this._callbacks[e],this;for(let n=0;n<r.length;n++)if(r[n]===i){r.splice(n,1);break}return this}}var Nn={};Nn=`<div class="dz-preview dz-file-preview">
  <div class="dz-image"><img data-dz-thumbnail=""></div>
  <div class="dz-details">
    <div class="dz-size"><span data-dz-size=""></span></div>
    <div class="dz-filename"><span data-dz-name=""></span></div>
  </div>
  <div class="dz-progress">
    <span class="dz-upload" data-dz-uploadprogress=""></span>
  </div>
  <div class="dz-error-message"><span data-dz-errormessage=""></span></div>
  <div class="dz-success-mark">
    <svg width="54" height="54" viewBox="0 0 54 54" fill="white" xmlns="http://www.w3.org/2000/svg">
      <path d="M10.2071 29.7929L14.2929 25.7071C14.6834 25.3166 15.3166 25.3166 15.7071 25.7071L21.2929 31.2929C21.6834 31.6834 22.3166 31.6834 22.7071 31.2929L38.2929 15.7071C38.6834 15.3166 39.3166 15.3166 39.7071 15.7071L43.7929 19.7929C44.1834 20.1834 44.1834 20.8166 43.7929 21.2071L22.7071 42.2929C22.3166 42.6834 21.6834 42.6834 21.2929 42.2929L10.2071 31.2071C9.81658 30.8166 9.81658 30.1834 10.2071 29.7929Z"></path>
    </svg>
  </div>
  <div class="dz-error-mark">
    <svg width="54" height="54" viewBox="0 0 54 54" fill="white" xmlns="http://www.w3.org/2000/svg">
      <path d="M26.2929 20.2929L19.2071 13.2071C18.8166 12.8166 18.1834 12.8166 17.7929 13.2071L13.2071 17.7929C12.8166 18.1834 12.8166 18.8166 13.2071 19.2071L20.2929 26.2929C20.6834 26.6834 20.6834 27.3166 20.2929 27.7071L13.2071 34.7929C12.8166 35.1834 12.8166 35.8166 13.2071 36.2071L17.7929 40.7929C18.1834 41.1834 18.8166 41.1834 19.2071 40.7929L26.2929 33.7071C26.6834 33.3166 27.3166 33.3166 27.7071 33.7071L34.7929 40.7929C35.1834 41.1834 35.8166 41.1834 36.2071 40.7929L40.7929 36.2071C41.1834 35.8166 41.1834 35.1834 40.7929 34.7929L33.7071 27.7071C33.3166 27.3166 33.3166 26.6834 33.7071 26.2929L40.7929 19.2071C41.1834 18.8166 41.1834 18.1834 40.7929 17.7929L36.2071 13.2071C35.8166 12.8166 35.1834 12.8166 34.7929 13.2071L27.7071 20.2929C27.3166 20.6834 26.6834 20.6834 26.2929 20.2929Z"></path>
    </svg>
  </div>
</div>
`;let lo={url:null,method:"post",withCredentials:!1,timeout:null,parallelUploads:2,uploadMultiple:!1,chunking:!1,forceChunking:!1,chunkSize:2097152,parallelChunkUploads:!1,retryChunks:!1,retryChunksLimit:3,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"crop",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:"contain",filesizeBase:1e3,maxFiles:null,headers:null,defaultHeaders:!0,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,disablePreviews:!1,hiddenInputContainer:"body",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictUploadCanceled:"Upload canceled.",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",dictFileSizeUnits:{tb:"TB",gb:"GB",mb:"MB",kb:"KB",b:"b"},init(){},params(t,e,i){if(i)return{dzuuid:i.file.upload.uuid,dzchunkindex:i.index,dztotalfilesize:i.file.size,dzchunksize:this.options.chunkSize,dztotalchunkcount:i.file.upload.totalChunkCount,dzchunkbyteoffset:i.index*this.options.chunkSize}},accept(t,e){return e()},chunksUploaded:function(t,e){e()},binaryBody:!1,fallback(){let t;this.element.className=`${this.element.className} dz-browser-not-supported`;for(let i of this.element.getElementsByTagName("div"))if(/(^| )dz-message($| )/.test(i.className)){t=i,i.className="dz-message";break}t||(t=F.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t));let e=t.getElementsByTagName("span")[0];return e&&(e.textContent!=null?e.textContent=this.options.dictFallbackMessage:e.innerText!=null&&(e.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize(t,e,i,r){let n={srcX:0,srcY:0,srcWidth:t.width,srcHeight:t.height},s=t.width/t.height;e==null&&i==null?(e=n.srcWidth,i=n.srcHeight):e==null?e=i*s:i==null&&(i=e/s),e=Math.min(e,n.srcWidth),i=Math.min(i,n.srcHeight);let o=e/i;if(n.srcWidth>e||n.srcHeight>i)if(r==="crop")s>o?(n.srcHeight=t.height,n.srcWidth=n.srcHeight*o):(n.srcWidth=t.width,n.srcHeight=n.srcWidth/o);else if(r==="contain")s>o?i=e/s:e=i*s;else throw new Error(`Unknown resizeMethod '${r}'`);return n.srcX=(t.width-n.srcWidth)/2,n.srcY=(t.height-n.srcHeight)/2,n.trgWidth=e,n.trgHeight=i,n},transformFile(t,e){return(this.options.resizeWidth||this.options.resizeHeight)&&t.type.match(/image.*/)?this.resizeImage(t,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,e):e(t)},previewTemplate:ao(Nn),drop(t){return this.element.classList.remove("dz-drag-hover")},dragstart(t){},dragend(t){return this.element.classList.remove("dz-drag-hover")},dragenter(t){return this.element.classList.add("dz-drag-hover")},dragover(t){return this.element.classList.add("dz-drag-hover")},dragleave(t){return this.element.classList.remove("dz-drag-hover")},paste(t){},reset(){return this.element.classList.remove("dz-started")},addedfile(t){if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer&&!this.options.disablePreviews){t.previewElement=F.createElement(this.options.previewTemplate.trim()),t.previewTemplate=t.previewElement,this.previewsContainer.appendChild(t.previewElement);for(var e of t.previewElement.querySelectorAll("[data-dz-name]"))e.textContent=t.name;for(e of t.previewElement.querySelectorAll("[data-dz-size]"))e.innerHTML=this.filesize(t.size);this.options.addRemoveLinks&&(t._removeLink=F.createElement(`<a class="dz-remove" href="javascript:undefined;" data-dz-remove>${this.options.dictRemoveFile}</a>`),t.previewElement.appendChild(t._removeLink));let i=r=>(r.preventDefault(),r.stopPropagation(),t.status===F.UPLOADING?F.confirm(this.options.dictCancelUploadConfirmation,()=>this.removeFile(t)):this.options.dictRemoveFileConfirmation?F.confirm(this.options.dictRemoveFileConfirmation,()=>this.removeFile(t)):this.removeFile(t));for(let r of t.previewElement.querySelectorAll("[data-dz-remove]"))r.addEventListener("click",i)}},removedfile(t){return t.previewElement!=null&&t.previewElement.parentNode!=null&&t.previewElement.parentNode.removeChild(t.previewElement),this._updateMaxFilesReachedClass()},thumbnail(t,e){if(t.previewElement){t.previewElement.classList.remove("dz-file-preview");for(let i of t.previewElement.querySelectorAll("[data-dz-thumbnail]"))i.alt=t.name,i.src=e;return setTimeout(()=>t.previewElement.classList.add("dz-image-preview"),1)}},error(t,e){if(t.previewElement){t.previewElement.classList.add("dz-error"),typeof e!="string"&&e.error&&(e=e.error);for(let i of t.previewElement.querySelectorAll("[data-dz-errormessage]"))i.textContent=e}},errormultiple(){},processing(t){if(t.previewElement&&(t.previewElement.classList.add("dz-processing"),t._removeLink))return t._removeLink.innerHTML=this.options.dictCancelUpload},processingmultiple(){},uploadprogress(t,e,i){if(t.previewElement)for(let r of t.previewElement.querySelectorAll("[data-dz-uploadprogress]"))r.nodeName==="PROGRESS"?r.value=e:r.style.width=`${e}%`},totaluploadprogress(){},sending(){},sendingmultiple(){},success(t){if(t.previewElement)return t.previewElement.classList.add("dz-success")},successmultiple(){},canceled(t){return this.emit("error",t,this.options.dictUploadCanceled)},canceledmultiple(){},complete(t){if(t._removeLink&&(t._removeLink.innerHTML=this.options.dictRemoveFile),t.previewElement)return t.previewElement.classList.add("dz-complete")},completemultiple(){},maxfilesexceeded(){},maxfilesreached(){},queuecomplete(){},addedfiles(){}};var ho=lo;class F extends gr{static initClass(){this.prototype.Emitter=gr,this.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],this.prototype._thumbnailQueue=[],this.prototype._processingThumbnail=!1}getAcceptedFiles(){return this.files.filter(e=>e.accepted).map(e=>e)}getRejectedFiles(){return this.files.filter(e=>!e.accepted).map(e=>e)}getFilesWithStatus(e){return this.files.filter(i=>i.status===e).map(i=>i)}getQueuedFiles(){return this.getFilesWithStatus(F.QUEUED)}getUploadingFiles(){return this.getFilesWithStatus(F.UPLOADING)}getAddedFiles(){return this.getFilesWithStatus(F.ADDED)}getActiveFiles(){return this.files.filter(e=>e.status===F.UPLOADING||e.status===F.QUEUED).map(e=>e)}init(){if(this.element.tagName==="form"&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(F.createElement(`<div class="dz-default dz-message"><button class="dz-button" type="button">${this.options.dictDefaultMessage}</button></div>`)),this.clickableElements.length){let r=()=>{this.hiddenFileInput&&this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=document.createElement("input"),this.hiddenFileInput.setAttribute("type","file"),(this.options.maxFiles===null||this.options.maxFiles>1)&&this.hiddenFileInput.setAttribute("multiple","multiple"),this.hiddenFileInput.className="dz-hidden-input",this.options.acceptedFiles!==null&&this.hiddenFileInput.setAttribute("accept",this.options.acceptedFiles),this.options.capture!==null&&this.hiddenFileInput.setAttribute("capture",this.options.capture),this.hiddenFileInput.setAttribute("tabindex","-1"),this.hiddenFileInput.style.visibility="hidden",this.hiddenFileInput.style.position="absolute",this.hiddenFileInput.style.top="0",this.hiddenFileInput.style.left="0",this.hiddenFileInput.style.height="0",this.hiddenFileInput.style.width="0",F.getElement(this.options.hiddenInputContainer,"hiddenInputContainer").appendChild(this.hiddenFileInput),this.hiddenFileInput.addEventListener("change",()=>{let{files:n}=this.hiddenFileInput;if(n.length)for(let s of n)this.addFile(s);this.emit("addedfiles",n),r()})};r()}this.URL=window.URL!==null?window.URL:window.webkitURL;for(let r of this.events)this.on(r,this.options[r]);this.on("uploadprogress",()=>this.updateTotalUploadProgress()),this.on("removedfile",()=>this.updateTotalUploadProgress()),this.on("canceled",r=>this.emit("complete",r)),this.on("complete",r=>{if(this.getAddedFiles().length===0&&this.getUploadingFiles().length===0&&this.getQueuedFiles().length===0)return setTimeout(()=>this.emit("queuecomplete"),0)});const e=function(r){if(r.dataTransfer.types){for(var n=0;n<r.dataTransfer.types.length;n++)if(r.dataTransfer.types[n]==="Files")return!0}return!1};let i=function(r){if(e(r))return r.stopPropagation(),r.preventDefault?r.preventDefault():r.returnValue=!1};return this.listeners=[{element:this.element,events:{dragstart:r=>this.emit("dragstart",r),dragenter:r=>(i(r),this.emit("dragenter",r)),dragover:r=>{let n;try{n=r.dataTransfer.effectAllowed}catch{}return r.dataTransfer.dropEffect=n==="move"||n==="linkMove"?"move":"copy",i(r),this.emit("dragover",r)},dragleave:r=>this.emit("dragleave",r),drop:r=>(i(r),this.drop(r)),dragend:r=>this.emit("dragend",r)}}],this.clickableElements.forEach(r=>this.listeners.push({element:r,events:{click:n=>((r!==this.element||n.target===this.element||F.elementInside(n.target,this.element.querySelector(".dz-message")))&&this.hiddenFileInput.click(),!0)}})),this.enable(),this.options.init.call(this)}destroy(){return this.disable(),this.removeAllFiles(!0),this.hiddenFileInput!=null&&this.hiddenFileInput.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,F.instances.splice(F.instances.indexOf(this),1)}updateTotalUploadProgress(){let e,i=0,r=0;if(this.getActiveFiles().length){for(let s of this.getActiveFiles())i+=s.upload.bytesSent,r+=s.upload.total;e=100*i/r}else e=100;return this.emit("totaluploadprogress",e,r,i)}_getParamName(e){return typeof this.options.paramName=="function"?this.options.paramName(e):`${this.options.paramName}${this.options.uploadMultiple?`[${e}]`:""}`}_renameFile(e){return typeof this.options.renameFile!="function"?e.name:this.options.renameFile(e)}getFallbackForm(){let e,i;if(e=this.getExistingFallback())return e;let r='<div class="dz-fallback">';this.options.dictFallbackText&&(r+=`<p>${this.options.dictFallbackText}</p>`),r+=`<input type="file" name="${this._getParamName(0)}" ${this.options.uploadMultiple?'multiple="multiple"':void 0} /><input type="submit" value="Upload!"></div>`;let n=F.createElement(r);return this.element.tagName!=="FORM"?(i=F.createElement(`<form action="${this.options.url}" enctype="multipart/form-data" method="${this.options.method}"></form>`),i.appendChild(n)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),i??n}getExistingFallback(){let e=function(r){for(let n of r)if(/(^| )fallback($| )/.test(n.className))return n};for(let r of["div","form"]){var i;if(i=e(this.element.getElementsByTagName(r)))return i}}setupEventListeners(){return this.listeners.map(e=>(()=>{let i=[];for(let r in e.events){let n=e.events[r];i.push(e.element.addEventListener(r,n,!1))}return i})())}removeEventListeners(){return this.listeners.map(e=>(()=>{let i=[];for(let r in e.events){let n=e.events[r];i.push(e.element.removeEventListener(r,n,!1))}return i})())}disable(){return this.clickableElements.forEach(e=>e.classList.remove("dz-clickable")),this.removeEventListeners(),this.disabled=!0,this.files.map(e=>this.cancelUpload(e))}enable(){return delete this.disabled,this.clickableElements.forEach(e=>e.classList.add("dz-clickable")),this.setupEventListeners()}filesize(e){let i=0,r="b";if(e>0){let n=["tb","gb","mb","kb","b"];for(let s=0;s<n.length;s++){let o=n[s],a=Math.pow(this.options.filesizeBase,4-s)/10;if(e>=a){i=e/Math.pow(this.options.filesizeBase,4-s),r=o;break}}i=Math.round(10*i)/10}return`<strong>${i}</strong> ${this.options.dictFileSizeUnits[r]}`}_updateMaxFilesReachedClass(){return this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")}drop(e){if(!e.dataTransfer)return;this.emit("drop",e);let i=[];for(let r=0;r<e.dataTransfer.files.length;r++)i[r]=e.dataTransfer.files[r];if(i.length){let{items:r}=e.dataTransfer;r&&r.length&&r[0].webkitGetAsEntry!=null?this._addFilesFromItems(r):this.handleFiles(i)}this.emit("addedfiles",i)}paste(e){if(go(e?.clipboardData,r=>r.items)==null)return;this.emit("paste",e);let{items:i}=e.clipboardData;if(i.length)return this._addFilesFromItems(i)}handleFiles(e){for(let i of e)this.addFile(i)}_addFilesFromItems(e){return(()=>{let i=[];for(let n of e){var r;n.webkitGetAsEntry!=null&&(r=n.webkitGetAsEntry())?r.isFile?i.push(this.addFile(n.getAsFile())):r.isDirectory?i.push(this._addFilesFromDirectory(r,r.name)):i.push(void 0):n.getAsFile!=null&&(n.kind==null||n.kind==="file")?i.push(this.addFile(n.getAsFile())):i.push(void 0)}return i})()}_addFilesFromDirectory(e,i){let r=e.createReader(),n=o=>mo(console,"log",a=>a.log(o));var s=()=>r.readEntries(o=>{if(o.length>0){for(let a of o)a.isFile?a.file(u=>{if(!(this.options.ignoreHiddenFiles&&u.name.substring(0,1)==="."))return u.fullPath=`${i}/${u.name}`,this.addFile(u)}):a.isDirectory&&this._addFilesFromDirectory(a,`${i}/${a.name}`);s()}return null},n);return s()}accept(e,i){this.options.maxFilesize&&e.size>this.options.maxFilesize*1048576?i(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):F.isValidFile(e,this.options.acceptedFiles)?this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles?(i(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,i):i(this.options.dictInvalidFileType)}addFile(e){e.upload={uuid:F.uuidv4(),progress:0,total:e.size,bytesSent:0,filename:this._renameFile(e)},this.files.push(e),e.status=F.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,i=>{i?(e.accepted=!1,this._errorProcessing([e],i)):(e.accepted=!0,this.options.autoQueue&&this.enqueueFile(e)),this._updateMaxFilesReachedClass()})}enqueueFiles(e){for(let i of e)this.enqueueFile(i);return null}enqueueFile(e){if(e.status===F.ADDED&&e.accepted===!0){if(e.status=F.QUEUED,this.options.autoProcessQueue)return setTimeout(()=>this.processQueue(),0)}else throw new Error("This file can't be queued because it has already been processed or was rejected.")}_enqueueThumbnail(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=this.options.maxThumbnailFilesize*1048576)return this._thumbnailQueue.push(e),setTimeout(()=>this._processThumbnailQueue(),0)}_processThumbnailQueue(){if(this._processingThumbnail||this._thumbnailQueue.length===0)return;this._processingThumbnail=!0;let e=this._thumbnailQueue.shift();return this.createThumbnail(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,i=>(this.emit("thumbnail",e,i),this._processingThumbnail=!1,this._processThumbnailQueue()))}removeFile(e){if(e.status===F.UPLOADING&&this.cancelUpload(e),this.files=uo(this.files,e),this.emit("removedfile",e),this.files.length===0)return this.emit("reset")}removeAllFiles(e){e==null&&(e=!1);for(let i of this.files.slice())(i.status!==F.UPLOADING||e)&&this.removeFile(i);return null}resizeImage(e,i,r,n,s){return this.createThumbnail(e,i,r,n,!0,(o,a)=>{if(a==null)return s(e);{let{resizeMimeType:u}=this.options;u==null&&(u=e.type);let c=a.toDataURL(u,this.options.resizeQuality);return(u==="image/jpeg"||u==="image/jpg")&&(c=Bn.restore(e.dataURL,c)),s(F.dataURItoBlob(c))}})}createThumbnail(e,i,r,n,s,o){let a=new FileReader;a.onload=()=>{if(e.dataURL=a.result,e.type==="image/svg+xml"){o?.(a.result);return}this.createThumbnailFromUrl(e,i,r,n,s,o)},a.readAsDataURL(e)}displayExistingFile(e,i,r,n,s=!0){if(this.emit("addedfile",e),this.emit("complete",e),!s)this.emit("thumbnail",e,i),r&&r();else{let o=a=>{this.emit("thumbnail",e,a),r&&r()};e.dataURL=i,this.createThumbnailFromUrl(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,this.options.fixOrientation,o,n)}}createThumbnailFromUrl(e,i,r,n,s,o,a){let u=document.createElement("img");return a&&(u.crossOrigin=a),s=getComputedStyle(document.body).imageOrientation=="from-image"?!1:s,u.onload=()=>{let c=p=>p(1);return typeof EXIF<"u"&&EXIF!==null&&s&&(c=p=>EXIF.getData(u,function(){return p(EXIF.getTag(this,"Orientation"))})),c(p=>{e.width=u.width,e.height=u.height;let d=this.options.resize.call(this,e,i,r,n),_=document.createElement("canvas"),m=_.getContext("2d");switch(_.width=d.trgWidth,_.height=d.trgHeight,p>4&&(_.width=d.trgHeight,_.height=d.trgWidth),p){case 2:m.translate(_.width,0),m.scale(-1,1);break;case 3:m.translate(_.width,_.height),m.rotate(Math.PI);break;case 4:m.translate(0,_.height),m.scale(1,-1);break;case 5:m.rotate(.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(.5*Math.PI),m.translate(0,-_.width);break;case 7:m.rotate(.5*Math.PI),m.translate(_.height,-_.width),m.scale(-1,1);break;case 8:m.rotate(-.5*Math.PI),m.translate(-_.height,0);break}po(m,u,d.srcX!=null?d.srcX:0,d.srcY!=null?d.srcY:0,d.srcWidth,d.srcHeight,d.trgX!=null?d.trgX:0,d.trgY!=null?d.trgY:0,d.trgWidth,d.trgHeight);let w=_.toDataURL("image/png");if(o!=null)return o(w,_)})},o!=null&&(u.onerror=o),u.src=e.dataURL}processQueue(){let{parallelUploads:e}=this.options,i=this.getUploadingFiles().length,r=i;if(i>=e)return;let n=this.getQueuedFiles();if(n.length>0){if(this.options.uploadMultiple)return this.processFiles(n.slice(0,e-i));for(;r<e;){if(!n.length)return;this.processFile(n.shift()),r++}}}processFile(e){return this.processFiles([e])}processFiles(e){for(let i of e)i.processing=!0,i.status=F.UPLOADING,this.emit("processing",i);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)}_getFilesWithXhr(e){return this.files.filter(i=>i.xhr===e).map(i=>i)}cancelUpload(e){if(e.status===F.UPLOADING){let i=this._getFilesWithXhr(e.xhr);for(let r of i)r.status=F.CANCELED;typeof e.xhr<"u"&&e.xhr.abort();for(let r of i)this.emit("canceled",r);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(e.status===F.ADDED||e.status===F.QUEUED)&&(e.status=F.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()}resolveOption(e,...i){return typeof e=="function"?e.apply(this,i):e}uploadFile(e){return this.uploadFiles([e])}uploadFiles(e){this._transformFiles(e,i=>{if(this.options.chunking){let r=i[0];e[0].upload.chunked=this.options.chunking&&(this.options.forceChunking||r.size>this.options.chunkSize),e[0].upload.totalChunkCount=Math.ceil(r.size/this.options.chunkSize)}if(e[0].upload.chunked){let r=e[0],n=i[0];r.upload.chunks=[];let s=()=>{let o=0;for(;r.upload.chunks[o]!==void 0;)o++;if(o>=r.upload.totalChunkCount)return;let a=o*this.options.chunkSize,u=Math.min(a+this.options.chunkSize,n.size),c={name:this._getParamName(0),data:n.webkitSlice?n.webkitSlice(a,u):n.slice(a,u),filename:r.upload.filename,chunkIndex:o};r.upload.chunks[o]={file:r,index:o,dataBlock:c,status:F.UPLOADING,progress:0,retries:0},this._uploadData(e,[c])};if(r.upload.finishedChunkUpload=(o,a)=>{let u=!0;o.status=F.SUCCESS,o.dataBlock=null,o.response=o.xhr.responseText,o.responseHeaders=o.xhr.getAllResponseHeaders(),o.xhr=null;for(let c=0;c<r.upload.totalChunkCount;c++){if(r.upload.chunks[c]===void 0)return s();r.upload.chunks[c].status!==F.SUCCESS&&(u=!1)}u&&this.options.chunksUploaded(r,()=>{this._finished(e,a,null)})},this.options.parallelChunkUploads)for(let o=0;o<r.upload.totalChunkCount;o++)s();else s()}else{let r=[];for(let n=0;n<e.length;n++)r[n]={name:this._getParamName(n),data:i[n],filename:e[n].upload.filename};this._uploadData(e,r)}})}_getChunk(e,i){for(let r=0;r<e.upload.totalChunkCount;r++)if(e.upload.chunks[r]!==void 0&&e.upload.chunks[r].xhr===i)return e.upload.chunks[r]}_uploadData(e,i){let r=new XMLHttpRequest;for(let c of e)c.xhr=r;e[0].upload.chunked&&(e[0].upload.chunks[i[0].chunkIndex].xhr=r);let n=this.resolveOption(this.options.method,e,i),s=this.resolveOption(this.options.url,e,i);r.open(n,s,!0),this.resolveOption(this.options.timeout,e)&&(r.timeout=this.resolveOption(this.options.timeout,e)),r.withCredentials=!!this.options.withCredentials,r.onload=c=>{this._finishedUploading(e,r,c)},r.ontimeout=()=>{this._handleUploadError(e,r,`Request timedout after ${this.options.timeout/1e3} seconds`)},r.onerror=()=>{this._handleUploadError(e,r)};let a=r.upload!=null?r.upload:r;a.onprogress=c=>this._updateFilesUploadProgress(e,r,c);let u=this.options.defaultHeaders?{Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"}:{};this.options.binaryBody&&(u["Content-Type"]=e[0].type),this.options.headers&&fr(u,this.options.headers);for(let c in u){let p=u[c];p&&r.setRequestHeader(c,p)}if(this.options.binaryBody){for(let c of e)this.emit("sending",c,r);this.options.uploadMultiple&&this.emit("sendingmultiple",e,r),this.submitRequest(r,null,e)}else{let c=new FormData;if(this.options.params){let p=this.options.params;typeof p=="function"&&(p=p.call(this,e,r,e[0].upload.chunked?this._getChunk(e[0],r):null));for(let d in p){let _=p[d];if(Array.isArray(_))for(let m=0;m<_.length;m++)c.append(d,_[m]);else c.append(d,_)}}for(let p of e)this.emit("sending",p,r,c);this.options.uploadMultiple&&this.emit("sendingmultiple",e,r,c),this._addFormElementData(c);for(let p=0;p<i.length;p++){let d=i[p];c.append(d.name,d.data,d.filename)}this.submitRequest(r,c,e)}}_transformFiles(e,i){let r=[],n=0;for(let s=0;s<e.length;s++)this.options.transformFile.call(this,e[s],o=>{r[s]=o,++n===e.length&&i(r)})}_addFormElementData(e){if(this.element.tagName==="FORM")for(let i of this.element.querySelectorAll("input, textarea, select, button")){let r=i.getAttribute("name"),n=i.getAttribute("type");if(n&&(n=n.toLowerCase()),!(typeof r>"u"||r===null))if(i.tagName==="SELECT"&&i.hasAttribute("multiple"))for(let s of i.options)s.selected&&e.append(r,s.value);else(!n||n!=="checkbox"&&n!=="radio"||i.checked)&&e.append(r,i.value)}}_updateFilesUploadProgress(e,i,r){if(e[0].upload.chunked){let n=e[0],s=this._getChunk(n,i);r?(s.progress=100*r.loaded/r.total,s.total=r.total,s.bytesSent=r.loaded):(s.progress=100,s.bytesSent=s.total),n.upload.progress=0,n.upload.total=0,n.upload.bytesSent=0;for(let o=0;o<n.upload.totalChunkCount;o++)n.upload.chunks[o]&&typeof n.upload.chunks[o].progress<"u"&&(n.upload.progress+=n.upload.chunks[o].progress,n.upload.total+=n.upload.chunks[o].total,n.upload.bytesSent+=n.upload.chunks[o].bytesSent);n.upload.progress=n.upload.progress/n.upload.totalChunkCount,this.emit("uploadprogress",n,n.upload.progress,n.upload.bytesSent)}else for(let n of e)n.upload.total&&n.upload.bytesSent&&n.upload.bytesSent==n.upload.total||(r?(n.upload.progress=100*r.loaded/r.total,n.upload.total=r.total,n.upload.bytesSent=r.loaded):(n.upload.progress=100,n.upload.bytesSent=n.upload.total),this.emit("uploadprogress",n,n.upload.progress,n.upload.bytesSent))}_finishedUploading(e,i,r){let n;if(e[0].status!==F.CANCELED&&i.readyState===4){if(i.responseType!=="arraybuffer"&&i.responseType!=="blob"&&(n=i.responseText,i.getResponseHeader("content-type")&&~i.getResponseHeader("content-type").indexOf("application/json")))try{n=JSON.parse(n)}catch(s){r=s,n="Invalid JSON response from server."}this._updateFilesUploadProgress(e,i),200<=i.status&&i.status<300?e[0].upload.chunked?e[0].upload.finishedChunkUpload(this._getChunk(e[0],i),n):this._finished(e,n,r):this._handleUploadError(e,i,n)}}_handleUploadError(e,i,r){if(e[0].status!==F.CANCELED){if(e[0].upload.chunked&&this.options.retryChunks){let n=this._getChunk(e[0],i);if(n.retries++<this.options.retryChunksLimit){this._uploadData(e,[n.dataBlock]);return}else console.warn("Retried this chunk too often. Giving up.")}this._errorProcessing(e,r||this.options.dictResponseError.replace("{{statusCode}}",i.status),i)}}submitRequest(e,i,r){if(e.readyState!=1){console.warn("Cannot send this request because the XMLHttpRequest.readyState is not OPENED.");return}if(this.options.binaryBody)if(r[0].upload.chunked){const n=this._getChunk(r[0],e);e.send(n.dataBlock.data)}else e.send(r[0]);else e.send(i)}_finished(e,i,r){for(let n of e)n.status=F.SUCCESS,this.emit("success",n,i,r),this.emit("complete",n);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,i,r),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}_errorProcessing(e,i,r){for(let n of e)n.status=F.ERROR,this.emit("error",n,i,r),this.emit("complete",n);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,i,r),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}static uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let i=Math.random()*16|0;return(e==="x"?i:i&3|8).toString(16)})}constructor(e,i){super();let r,n;if(this.element=e,this.clickableElements=[],this.listeners=[],this.files=[],typeof this.element=="string"&&(this.element=document.querySelector(this.element)),!this.element||this.element.nodeType==null)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");F.instances.push(this),this.element.dropzone=this;let s=(n=F.optionsForElement(this.element))!=null?n:{};if(this.options=fr(!0,{},ho,s,i??{}),this.options.previewTemplate=this.options.previewTemplate.replace(/\n*/g,""),this.options.forceFallback||!F.isBrowserSupported())return this.options.fallback.call(this);if(this.options.url==null&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(this.options.uploadMultiple&&this.options.chunking)throw new Error("You cannot set both: uploadMultiple and chunking.");if(this.options.binaryBody&&this.options.uploadMultiple)throw new Error("You cannot set both: binaryBody and uploadMultiple.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.renameFilename!=null&&(this.options.renameFile=o=>this.options.renameFilename.call(this,o.name,o)),typeof this.options.method=="string"&&(this.options.method=this.options.method.toUpperCase()),(r=this.getExistingFallback())&&r.parentNode&&r.parentNode.removeChild(r),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=F.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=F.getElements(this.options.clickable,"clickable")),this.init()}}F.initClass();F.options={};F.optionsForElement=function(t){if(t.getAttribute("id"))return F.options[co(t.getAttribute("id"))]};F.instances=[];F.forElement=function(t){if(typeof t=="string"&&(t=document.querySelector(t)),t?.dropzone==null)throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return t.dropzone};F.discover=function(){let t;if(document.querySelectorAll)t=document.querySelectorAll(".dropzone");else{t=[];let e=i=>(()=>{let r=[];for(let n of i)/(^| )dropzone($| )/.test(n.className)?r.push(t.push(n)):r.push(void 0);return r})();e(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))}return(()=>{let e=[];for(let i of t)F.optionsForElement(i)!==!1?e.push(new F(i)):e.push(void 0);return e})()};F.blockedBrowsers=[/opera.*(Macintosh|Windows Phone).*version\/12/i];F.isBrowserSupported=function(){let t=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if(!("classList"in document.createElement("a")))t=!1;else{F.blacklistedBrowsers!==void 0&&(F.blockedBrowsers=F.blacklistedBrowsers);for(let e of F.blockedBrowsers)if(e.test(navigator.userAgent)){t=!1;continue}}else t=!1;return t};F.dataURItoBlob=function(t){let e=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let s=0,o=e.length,a=0<=o;a?s<=o:s>=o;a?s++:s--)n[s]=e.charCodeAt(s);return new Blob([r],{type:i})};const uo=(t,e)=>t.filter(i=>i!==e).map(i=>i),co=t=>t.replace(/[\-_](\w)/g,e=>e.charAt(1).toUpperCase());F.createElement=function(t){let e=document.createElement("div");return e.innerHTML=t,e.childNodes[0]};F.elementInside=function(t,e){if(t===e)return!0;for(;t=t.parentNode;)if(t===e)return!0;return!1};F.getElement=function(t,e){let i;if(typeof t=="string"?i=document.querySelector(t):t.nodeType!=null&&(i=t),i==null)throw new Error(`Invalid \`${e}\` option provided. Please provide a CSS selector or a plain HTML element.`);return i};F.getElements=function(t,e){let i,r;if(t instanceof Array){r=[];try{for(i of t)r.push(this.getElement(i,e))}catch{r=null}}else if(typeof t=="string"){r=[];for(i of document.querySelectorAll(t))r.push(i)}else t.nodeType!=null&&(r=[t]);if(r==null||!r.length)throw new Error(`Invalid \`${e}\` option provided. Please provide a CSS selector, a plain HTML element or a list of those.`);return r};F.confirm=function(t,e,i){if(window.confirm(t))return e();if(i!=null)return i()};F.isValidFile=function(t,e){if(!e)return!0;e=e.split(",");let i=t.type,r=i.replace(/\/.*$/,"");for(let n of e)if(n=n.trim(),n.charAt(0)==="."){if(t.name.toLowerCase().indexOf(n.toLowerCase(),t.name.length-n.length)!==-1)return!0}else if(/\/\*$/.test(n)){if(r===n.replace(/\/.*$/,""))return!0}else if(i===n)return!0;return!1};typeof jQuery<"u"&&jQuery!==null&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new F(this,t)})});F.ADDED="added";F.QUEUED="queued";F.ACCEPTED=F.QUEUED;F.UPLOADING="uploading";F.PROCESSING=F.UPLOADING;F.CANCELED="canceled";F.ERROR="error";F.SUCCESS="success";let fo=function(t){t.naturalWidth;let e=t.naturalHeight,i=document.createElement("canvas");i.width=1,i.height=e;let r=i.getContext("2d");r.drawImage(t,0,0);let{data:n}=r.getImageData(1,0,1,e),s=0,o=e,a=e;for(;a>s;)n[(a-1)*4+3]===0?o=a:s=a,a=o+s>>1;let u=a/e;return u===0?1:u};var po=function(t,e,i,r,n,s,o,a,u,c){let p=fo(e);return t.drawImage(e,i,r,n,s,o,a,u,c/p)};class Bn{static initClass(){this.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}static encode64(e){let i="",r,n,s="",o,a,u,c="",p=0;for(;r=e[p++],n=e[p++],s=e[p++],o=r>>2,a=(r&3)<<4|n>>4,u=(n&15)<<2|s>>6,c=s&63,isNaN(n)?u=c=64:isNaN(s)&&(c=64),i=i+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(u)+this.KEY_STR.charAt(c),r=n=s="",o=a=u=c="",p<e.length;);return i}static restore(e,i){if(!e.match("data:image/jpeg;base64,"))return i;let r=this.decode64(e.replace("data:image/jpeg;base64,","")),n=this.slice2Segments(r),s=this.exifManipulation(i,n);return`data:image/jpeg;base64,${this.encode64(s)}`}static exifManipulation(e,i){let r=this.getExifArray(i),n=this.insertExif(e,r);return new Uint8Array(n)}static getExifArray(e){let i,r=0;for(;r<e.length;){if(i=e[r],i[0]===255&i[1]===225)return i;r++}return[]}static insertExif(e,i){let r=e.replace("data:image/jpeg;base64,",""),n=this.decode64(r),s=n.indexOf(255,3),o=n.slice(0,s),a=n.slice(s),u=o;return u=u.concat(i),u=u.concat(a),u}static slice2Segments(e){let i=0,r=[];for(;;){var n;if(e[i]===255&e[i+1]===218)break;if(e[i]===255&e[i+1]===216)i+=2;else{n=e[i+2]*256+e[i+3];let s=i+n+2,o=e.slice(i,s);r.push(o),i=s}if(i>e.length)break}return r}static decode64(e){let i,r,n="",s,o,a,u="",c=0,p=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&console.warn(`There were invalid base64 characters in the input text.
Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='
Expect errors in decoding.`),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s=this.KEY_STR.indexOf(e.charAt(c++)),o=this.KEY_STR.indexOf(e.charAt(c++)),a=this.KEY_STR.indexOf(e.charAt(c++)),u=this.KEY_STR.indexOf(e.charAt(c++)),i=s<<2|o>>4,r=(o&15)<<4|a>>2,n=(a&3)<<6|u,p.push(i),a!==64&&p.push(r),u!==64&&p.push(n),i=r=n="",s=o=a=u="",c<e.length;);return p}}Bn.initClass();function go(t,e){return typeof t<"u"&&t!==null?e(t):void 0}function mo(t,e,i){if(typeof t<"u"&&t!==null&&typeof t[e]=="function")return i(t,e)}var _o=0;function ie(t,e,i,r,n,s){var o,a,u={};for(a in e)a=="ref"?o=e[a]:u[a]=e[a];var c={type:t,props:u,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--_o,__i:-1,__u:0,__source:n,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)u[a]===void 0&&(u[a]=o[a]);return q.vnode&&q.vnode(c),c}const yo=()=>{const t=io(null);return Bi(()=>{F.autoDiscover=!1;const e=new F(t.current,{url:"/file/post",maxFilesize:200,maxFiles:10,autoProcessQueue:!1,addRemoveLinks:!0,init:function(){this.on("addedfile",i=>{console.log("Added file:",i)}),this.on("removedfile",i=>{console.log("Removed file:",i)})}});return()=>{e.destroy()}},[]),ie(we,{children:ie("div",{ref:t,className:"dropzone bg-gray-500 hover:bg-purple-200 opacity-70 hover:opacity-80 text-grey-200 bg-red cursor-not-allowed",children:ie("div",{class:"dz-message","data-dz-message":!0,children:ie("span",{children:"File uploading is currently disabled."})})})})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pn=Symbol("Comlink.proxy"),wo=Symbol("Comlink.endpoint"),vo=Symbol("Comlink.releaseProxy"),Ot=Symbol("Comlink.finalizer"),ct=Symbol("Comlink.thrown"),Dn=t=>typeof t=="object"&&t!==null||typeof t=="function",bo={canHandle:t=>Dn(t)&&t[Pn],serialize(t){const{port1:e,port2:i}=new MessageChannel;return On(t,e),[i,[i]]},deserialize(t){return t.start(),zn(t)}},Eo={canHandle:t=>Dn(t)&&ct in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},At=new Map([["proxy",bo],["throw",Eo]]);function xo(t,e){for(const i of t)if(e===i||i==="*"||i instanceof RegExp&&i.test(e))return!0;return!1}function On(t,e=globalThis,i=["*"]){e.addEventListener("message",function r(n){if(!n||!n.data)return;if(!xo(i,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:s,type:o,path:a}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(Ee);let c;try{const p=a.slice(0,-1).reduce((_,m)=>_[m],t),d=a.reduce((_,m)=>_[m],t);switch(o){case"GET":c=d;break;case"SET":p[a.slice(-1)[0]]=Ee(n.data.value),c=!0;break;case"APPLY":c=d.apply(p,u);break;case"CONSTRUCT":{const _=new d(...u);c=Wn(_)}break;case"ENDPOINT":{const{port1:_,port2:m}=new MessageChannel;On(t,m),c=To(_,[_])}break;case"RELEASE":c=void 0;break;default:return}}catch(p){c={value:p,[ct]:0}}Promise.resolve(c).catch(p=>({value:p,[ct]:0})).then(p=>{const[d,_]=vt(p);e.postMessage(Object.assign(Object.assign({},d),{id:s}),_),o==="RELEASE"&&(e.removeEventListener("message",r),Un(e),Ot in t&&typeof t[Ot]=="function"&&t[Ot]())}).catch(p=>{const[d,_]=vt({value:new TypeError("Unserializable return value"),[ct]:0});e.postMessage(Object.assign(Object.assign({},d),{id:s}),_)})}),e.start&&e.start()}function Co(t){return t.constructor.name==="MessagePort"}function Un(t){Co(t)&&t.close()}function zn(t,e){return pi(t,[],e)}function tt(t){if(t)throw new Error("Proxy has been released and is not useable")}function Hn(t){return ke(t,{type:"RELEASE"}).then(()=>{Un(t)})}const yt=new WeakMap,wt="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(yt.get(t)||0)-1;yt.set(t,e),e===0&&Hn(t)});function Ro(t,e){const i=(yt.get(e)||0)+1;yt.set(e,i),wt&&wt.register(t,e,t)}function Ao(t){wt&&wt.unregister(t)}function pi(t,e=[],i=function(){}){let r=!1;const n=new Proxy(i,{get(s,o){if(tt(r),o===vo)return()=>{Ao(n),Hn(t),r=!0};if(o==="then"){if(e.length===0)return{then:()=>n};const a=ke(t,{type:"GET",path:e.map(u=>u.toString())}).then(Ee);return a.then.bind(a)}return pi(t,[...e,o])},set(s,o,a){tt(r);const[u,c]=vt(a);return ke(t,{type:"SET",path:[...e,o].map(p=>p.toString()),value:u},c).then(Ee)},apply(s,o,a){tt(r);const u=e[e.length-1];if(u===wo)return ke(t,{type:"ENDPOINT"}).then(Ee);if(u==="bind")return pi(t,e.slice(0,-1));const[c,p]=mr(a);return ke(t,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:c},p).then(Ee)},construct(s,o){tt(r);const[a,u]=mr(o);return ke(t,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:a},u).then(Ee)}});return Ro(n,t),n}function So(t){return Array.prototype.concat.apply([],t)}function mr(t){const e=t.map(vt);return[e.map(i=>i[0]),So(e.map(i=>i[1]))]}const qn=new WeakMap;function To(t,e){return qn.set(t,e),t}function Wn(t){return Object.assign(t,{[Pn]:!0})}function vt(t){for(const[e,i]of At)if(i.canHandle(t)){const[r,n]=i.serialize(t);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:t},qn.get(t)||[]]}function Ee(t){switch(t.type){case"HANDLER":return At.get(t.name).deserialize(t.value);case"RAW":return t.value}}function ke(t,e,i){return new Promise(r=>{const n=Fo();t.addEventListener("message",function s(o){!o.data||!o.data.id||o.data.id!==n||(t.removeEventListener("message",s),r(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),i)})}function Fo(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Pi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Mo(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),i}var St={};St.byteLength=Lo;var jn=St.toByteArray=Bo,_r=St.fromByteArray=Oo,ue=[],se=[],Io=typeof Uint8Array<"u"?Uint8Array:Array,Ut="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Me=0,ko=Ut.length;Me<ko;++Me)ue[Me]=Ut[Me],se[Ut.charCodeAt(Me)]=Me;se[45]=62;se[95]=63;function $n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");i===-1&&(i=e);var r=i===e?0:4-i%4;return[i,r]}function Lo(t){var e=$n(t),i=e[0],r=e[1];return(i+r)*3/4-r}function No(t,e,i){return(e+i)*3/4-i}function Bo(t){var e,i=$n(t),r=i[0],n=i[1],s=new Io(No(t,r,n)),o=0,a=n>0?r-4:r,u;for(u=0;u<a;u+=4)e=se[t.charCodeAt(u)]<<18|se[t.charCodeAt(u+1)]<<12|se[t.charCodeAt(u+2)]<<6|se[t.charCodeAt(u+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=se[t.charCodeAt(u)]<<2|se[t.charCodeAt(u+1)]>>4,s[o++]=e&255),n===1&&(e=se[t.charCodeAt(u)]<<10|se[t.charCodeAt(u+1)]<<4|se[t.charCodeAt(u+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Po(t){return ue[t>>18&63]+ue[t>>12&63]+ue[t>>6&63]+ue[t&63]}function Do(t,e,i){for(var r,n=[],s=e;s<i;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),n.push(Po(r));return n.join("")}function Oo(t){for(var e,i=t.length,r=i%3,n=[],s=16383,o=0,a=i-r;o<a;o+=s)n.push(Do(t,o,o+s>a?a:o+s));return r===1?(e=t[i-1],n.push(ue[e>>2]+ue[e<<4&63]+"==")):r===2&&(e=(t[i-2]<<8)+t[i-1],n.push(ue[e>>10]+ue[e>>4&63]+ue[e<<2&63]+"=")),n.join("")}const Uo=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Ie={collect:["Kumulate","Kollekt","Kompile"],organize:["Kategorize","Katolog","Kurate"],communicate:["Kommunikate","Kaskade","Konvey"]},zo=()=>`${Ie.collect[Math.floor(Math.random()*(Ie.collect.length-1))]}, ${Ie.organize[Math.floor(Math.random()*(Ie.organize.length-1))]}, ${Ie.communicate[Math.floor(Math.random()*(Ie.communicate.length-1))]}`;async function Yn(){Gn(await navigator.storage.getDirectory())}async function Gn(t){if(await t.queryPermission({mode:"readwrite"})!=="granted"&&await t.requestPermission({mode:"readwrite"})!=="granted")throw new Error("Permission to read and write the directory was not granted");for await(const[e,i]of t.entries())i.kind==="file"?await t.removeEntry(e):i.kind==="directory"&&(i.removeRecursively?await i.removeRecursively():(await Gn(i),await t.removeEntry(e,{recursive:!0})))}const Ho=t=>new Promise(e=>setTimeout(e,t)),qo=new TextDecoder,Wo=new TextEncoder;function it(t,...e){if(e.length===0)return new Uint8Array([t]);let i=0;const r=e.map(o=>{let a;return typeof o=="string"?a=Wo.encode(o):typeof o=="number"?o<256&&o>=0?a=new Uint8Array([o]):a=jo(o):a=o instanceof Uint8Array?o:new Uint8Array(o),i+=a.length,a}),n=new Uint8Array(1+i);n[0]=t;let s=1;for(const o of r)n.set(o,s),s+=o.length;return n}function yr(t){return qo.decode(t)}function jo(t){const e=new Uint8Array(8);return new DataView(e.buffer).setBigUint64(0,BigInt(t),!0),e}async function $o(t){const e=jn(t);return await crypto.subtle.importKey("raw",e.buffer,{name:"AES-GCM"},!0,["encrypt","decrypt"])}function Yo(t){for(let e=t.length-1;e>=0;e--)if(t[e]<255){t[e]++;break}else t[e]=0}window.destroyDB=Yn;Yn();function Go(t){return new Worker("/assets/worker-z0tPGv89.js",{type:"module",name:t?.name})}var ze;typeof window<"u"?ze=window:typeof self<"u"||typeof self<"u"?ze=self:ze={};var Vo=ze;const Xo=Pi(Vo);var Vn={exports:{}},X=Vn.exports={},le,he;function gi(){throw new Error("setTimeout has not been defined")}function mi(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?le=setTimeout:le=gi}catch{le=gi}try{typeof clearTimeout=="function"?he=clearTimeout:he=mi}catch{he=mi}})();function Xn(t){if(le===setTimeout)return setTimeout(t,0);if((le===gi||!le)&&setTimeout)return le=setTimeout,setTimeout(t,0);try{return le(t,0)}catch{try{return le.call(null,t,0)}catch{return le.call(this,t,0)}}}function Qo(t){if(he===clearTimeout)return clearTimeout(t);if((he===mi||!he)&&clearTimeout)return he=clearTimeout,clearTimeout(t);try{return he(t)}catch{try{return he.call(null,t)}catch{return he.call(this,t)}}}var de=[],Le=!1,xe,dt=-1;function Ko(){!Le||!xe||(Le=!1,xe.length?de=xe.concat(de):dt=-1,de.length&&Qn())}function Qn(){if(!Le){var t=Xn(Ko);Le=!0;for(var e=de.length;e;){for(xe=de,de=[];++dt<e;)xe&&xe[dt].run();dt=-1,e=de.length}xe=null,Le=!1,Qo(t)}}X.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];de.push(new Kn(t,e)),de.length===1&&!Le&&Xn(Qn)};function Kn(t,e){this.fun=t,this.array=e}Kn.prototype.run=function(){this.fun.apply(null,this.array)};X.title="browser";X.browser=!0;X.env={};X.argv=[];X.version="";X.versions={};function pe(){}X.on=pe;X.addListener=pe;X.once=pe;X.off=pe;X.removeListener=pe;X.removeAllListeners=pe;X.emit=pe;X.prependListener=pe;X.prependOnceListener=pe;X.listeners=function(t){return[]};X.binding=function(t){throw new Error("process.binding is not supported")};X.cwd=function(){return"/"};X.chdir=function(t){throw new Error("process.chdir is not supported")};X.umask=function(){return 0};var Zn=Vn.exports;const Zo=Pi(Zn),Jo=Gs({__proto__:null,default:Zo},[Zn]);var _i={exports:{}},zt,wr;function ea(){if(wr)return zt;wr=1;var t=1e3,e=t*60,i=e*60,r=i*24,n=r*7,s=r*365.25;zt=function(p,d){d=d||{};var _=typeof p;if(_==="string"&&p.length>0)return o(p);if(_==="number"&&isFinite(p))return d.long?u(p):a(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function o(p){if(p=String(p),!(p.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(d){var _=parseFloat(d[1]),m=(d[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return _*s;case"weeks":case"week":case"w":return _*n;case"days":case"day":case"d":return _*r;case"hours":case"hour":case"hrs":case"hr":case"h":return _*i;case"minutes":case"minute":case"mins":case"min":case"m":return _*e;case"seconds":case"second":case"secs":case"sec":case"s":return _*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return _;default:return}}}}function a(p){var d=Math.abs(p);return d>=r?Math.round(p/r)+"d":d>=i?Math.round(p/i)+"h":d>=e?Math.round(p/e)+"m":d>=t?Math.round(p/t)+"s":p+"ms"}function u(p){var d=Math.abs(p);return d>=r?c(p,d,r,"day"):d>=i?c(p,d,i,"hour"):d>=e?c(p,d,e,"minute"):d>=t?c(p,d,t,"second"):p+" ms"}function c(p,d,_,m){var w=d>=_*1.5;return Math.round(p/_)+" "+m+(w?"s":"")}return zt}function ta(t){i.debug=i,i.default=i,i.coerce=u,i.disable=s,i.enable=n,i.enabled=o,i.humanize=ea(),i.destroy=c,Object.keys(t).forEach(p=>{i[p]=t[p]}),i.names=[],i.skips=[],i.formatters={};function e(p){let d=0;for(let _=0;_<p.length;_++)d=(d<<5)-d+p.charCodeAt(_),d|=0;return i.colors[Math.abs(d)%i.colors.length]}i.selectColor=e;function i(p){let d,_=null,m,w;function b(...E){if(!b.enabled)return;const y=b,x=Number(new Date),R=x-(d||x);y.diff=R,y.prev=d,y.curr=x,d=x,E[0]=i.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let S=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(M,k)=>{if(M==="%%")return"%";S++;const O=i.formatters[k];if(typeof O=="function"){const P=E[S];M=O.call(y,P),E.splice(S,1),S--}return M}),i.formatArgs.call(y,E),(y.log||i.log).apply(y,E)}return b.namespace=p,b.useColors=i.useColors(),b.color=i.selectColor(p),b.extend=r,b.destroy=i.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(m!==i.namespaces&&(m=i.namespaces,w=i.enabled(p)),w),set:E=>{_=E}}),typeof i.init=="function"&&i.init(b),b}function r(p,d){const _=i(this.namespace+(typeof d>"u"?":":d)+p);return _.log=this.log,_}function n(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];let d;const _=(typeof p=="string"?p:"").split(/[\s,]+/),m=_.length;for(d=0;d<m;d++)_[d]&&(p=_[d].replace(/\*/g,".*?"),p[0]==="-"?i.skips.push(new RegExp("^"+p.slice(1)+"$")):i.names.push(new RegExp("^"+p+"$")))}function s(){const p=[...i.names.map(a),...i.skips.map(a).map(d=>"-"+d)].join(",");return i.enable(""),p}function o(p){if(p[p.length-1]==="*")return!0;let d,_;for(d=0,_=i.skips.length;d<_;d++)if(i.skips[d].test(p))return!1;for(d=0,_=i.names.length;d<_;d++)if(i.names[d].test(p))return!0;return!1}function a(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function u(p){return p instanceof Error?p.stack||p.message:p}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}var ia=ta;(function(t,e){var i={};e.formatArgs=n,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;c.splice(1,0,p,"color: inherit");let d=0,_=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(d++,m==="%c"&&(_=d))}),c.splice(_,0,p)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=i.DEBUG),c}function a(){try{return localStorage}catch{}}t.exports=ia(e);const{formatters:u}=t.exports;u.j=function(c){try{return JSON.stringify(c)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(_i,_i.exports);var ra=_i.exports,na=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},yi={exports:{}},wi={exports:{}},Ae={},Di={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Di.read=function(t,e,i,r,n){var s,o,a=n*8-r-1,u=(1<<a)-1,c=u>>1,p=-7,d=i?n-1:0,_=i?-1:1,m=t[e+d];for(d+=_,s=m&(1<<-p)-1,m>>=-p,p+=a;p>0;s=s*256+t[e+d],d+=_,p-=8);for(o=s&(1<<-p)-1,s>>=-p,p+=r;p>0;o=o*256+t[e+d],d+=_,p-=8);if(s===0)s=1-c;else{if(s===u)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(m?-1:1)*o*Math.pow(2,s-r)};Di.write=function(t,e,i,r,n,s){var o,a,u,c=s*8-n-1,p=(1<<c)-1,d=p>>1,_=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:s-1,w=r?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+d>=1?e+=_/u:e+=_*Math.pow(2,1-d),e*u>=2&&(o++,u/=2),o+d>=p?(a=0,o=p):o+d>=1?(a=(e*u-1)*Math.pow(2,n),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,n),o=0));n>=8;t[i+m]=a&255,m+=w,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;t[i+m]=o&255,m+=w,o/=256,c-=8);t[i+m-w]|=b*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=St,i=Di,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const n=2147483647;t.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const f=new Uint8Array(1),l={foo:function(){return 42}};return Object.setPrototypeOf(l,Uint8Array.prototype),Object.setPrototypeOf(f,l),f.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(f){if(f>n)throw new RangeError('The value "'+f+'" is invalid for option "size"');const l=new Uint8Array(f);return Object.setPrototypeOf(l,a.prototype),l}function a(f,l,h){if(typeof f=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(f)}return u(f,l,h)}a.poolSize=8192;function u(f,l,h){if(typeof f=="string")return _(f,l);if(ArrayBuffer.isView(f))return w(f);if(f==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f);if(ae(f,ArrayBuffer)||f&&ae(f.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ae(f,SharedArrayBuffer)||f&&ae(f.buffer,SharedArrayBuffer)))return b(f,l,h);if(typeof f=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const g=f.valueOf&&f.valueOf();if(g!=null&&g!==f)return a.from(g,l,h);const v=E(f);if(v)return v;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof f[Symbol.toPrimitive]=="function")return a.from(f[Symbol.toPrimitive]("string"),l,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f)}a.from=function(f,l,h){return u(f,l,h)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function c(f){if(typeof f!="number")throw new TypeError('"size" argument must be of type number');if(f<0)throw new RangeError('The value "'+f+'" is invalid for option "size"')}function p(f,l,h){return c(f),f<=0?o(f):l!==void 0?typeof h=="string"?o(f).fill(l,h):o(f).fill(l):o(f)}a.alloc=function(f,l,h){return p(f,l,h)};function d(f){return c(f),o(f<0?0:y(f)|0)}a.allocUnsafe=function(f){return d(f)},a.allocUnsafeSlow=function(f){return d(f)};function _(f,l){if((typeof l!="string"||l==="")&&(l="utf8"),!a.isEncoding(l))throw new TypeError("Unknown encoding: "+l);const h=R(f,l)|0;let g=o(h);const v=g.write(f,l);return v!==h&&(g=g.slice(0,v)),g}function m(f){const l=f.length<0?0:y(f.length)|0,h=o(l);for(let g=0;g<l;g+=1)h[g]=f[g]&255;return h}function w(f){if(ae(f,Uint8Array)){const l=new Uint8Array(f);return b(l.buffer,l.byteOffset,l.byteLength)}return m(f)}function b(f,l,h){if(l<0||f.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(f.byteLength<l+(h||0))throw new RangeError('"length" is outside of buffer bounds');let g;return l===void 0&&h===void 0?g=new Uint8Array(f):h===void 0?g=new Uint8Array(f,l):g=new Uint8Array(f,l,h),Object.setPrototypeOf(g,a.prototype),g}function E(f){if(a.isBuffer(f)){const l=y(f.length)|0,h=o(l);return h.length===0||f.copy(h,0,0,l),h}if(f.length!==void 0)return typeof f.length!="number"||Pt(f.length)?o(0):m(f);if(f.type==="Buffer"&&Array.isArray(f.data))return m(f.data)}function y(f){if(f>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return f|0}function x(f){return+f!=f&&(f=0),a.alloc(+f)}a.isBuffer=function(l){return l!=null&&l._isBuffer===!0&&l!==a.prototype},a.compare=function(l,h){if(ae(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),ae(h,Uint8Array)&&(h=a.from(h,h.offset,h.byteLength)),!a.isBuffer(l)||!a.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===h)return 0;let g=l.length,v=h.length;for(let C=0,A=Math.min(g,v);C<A;++C)if(l[C]!==h[C]){g=l[C],v=h[C];break}return g<v?-1:v<g?1:0},a.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(l,h){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return a.alloc(0);let g;if(h===void 0)for(h=0,g=0;g<l.length;++g)h+=l[g].length;const v=a.allocUnsafe(h);let C=0;for(g=0;g<l.length;++g){let A=l[g];if(ae(A,Uint8Array))C+A.length>v.length?(a.isBuffer(A)||(A=a.from(A)),A.copy(v,C)):Uint8Array.prototype.set.call(v,A,C);else if(a.isBuffer(A))A.copy(v,C);else throw new TypeError('"list" argument must be an Array of Buffers');C+=A.length}return v};function R(f,l){if(a.isBuffer(f))return f.length;if(ArrayBuffer.isView(f)||ae(f,ArrayBuffer))return f.byteLength;if(typeof f!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof f);const h=f.length,g=arguments.length>2&&arguments[2]===!0;if(!g&&h===0)return 0;let v=!1;for(;;)switch(l){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return Bt(f).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return er(f).length;default:if(v)return g?-1:Bt(f).length;l=(""+l).toLowerCase(),v=!0}}a.byteLength=R;function S(f,l,h){let g=!1;if((l===void 0||l<0)&&(l=0),l>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,l>>>=0,h<=l))return"";for(f||(f="utf8");;)switch(f){case"hex":return Os(this,l,h);case"utf8":case"utf-8":return I(this,l,h);case"ascii":return Ps(this,l,h);case"latin1":case"binary":return Ds(this,l,h);case"base64":return J(this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Us(this,l,h);default:if(g)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),g=!0}}a.prototype._isBuffer=!0;function T(f,l,h){const g=f[l];f[l]=f[h],f[h]=g}a.prototype.swap16=function(){const l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<l;h+=2)T(this,h,h+1);return this},a.prototype.swap32=function(){const l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<l;h+=4)T(this,h,h+3),T(this,h+1,h+2);return this},a.prototype.swap64=function(){const l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<l;h+=8)T(this,h,h+7),T(this,h+1,h+6),T(this,h+2,h+5),T(this,h+3,h+4);return this},a.prototype.toString=function(){const l=this.length;return l===0?"":arguments.length===0?I(this,0,l):S.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(l){if(!a.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:a.compare(this,l)===0},a.prototype.inspect=function(){let l="";const h=t.INSPECT_MAX_BYTES;return l=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(l+=" ... "),"<Buffer "+l+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(l,h,g,v,C){if(ae(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),!a.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(h===void 0&&(h=0),g===void 0&&(g=l?l.length:0),v===void 0&&(v=0),C===void 0&&(C=this.length),h<0||g>l.length||v<0||C>this.length)throw new RangeError("out of range index");if(v>=C&&h>=g)return 0;if(v>=C)return-1;if(h>=g)return 1;if(h>>>=0,g>>>=0,v>>>=0,C>>>=0,this===l)return 0;let A=C-v,L=g-h;const j=Math.min(A,L),W=this.slice(v,C),$=l.slice(h,g);for(let z=0;z<j;++z)if(W[z]!==$[z]){A=W[z],L=$[z];break}return A<L?-1:L<A?1:0};function M(f,l,h,g,v){if(f.length===0)return-1;if(typeof h=="string"?(g=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,Pt(h)&&(h=v?0:f.length-1),h<0&&(h=f.length+h),h>=f.length){if(v)return-1;h=f.length-1}else if(h<0)if(v)h=0;else return-1;if(typeof l=="string"&&(l=a.from(l,g)),a.isBuffer(l))return l.length===0?-1:k(f,l,h,g,v);if(typeof l=="number")return l=l&255,typeof Uint8Array.prototype.indexOf=="function"?v?Uint8Array.prototype.indexOf.call(f,l,h):Uint8Array.prototype.lastIndexOf.call(f,l,h):k(f,[l],h,g,v);throw new TypeError("val must be string, number or Buffer")}function k(f,l,h,g,v){let C=1,A=f.length,L=l.length;if(g!==void 0&&(g=String(g).toLowerCase(),g==="ucs2"||g==="ucs-2"||g==="utf16le"||g==="utf-16le")){if(f.length<2||l.length<2)return-1;C=2,A/=2,L/=2,h/=2}function j($,z){return C===1?$[z]:$.readUInt16BE(z*C)}let W;if(v){let $=-1;for(W=h;W<A;W++)if(j(f,W)===j(l,$===-1?0:W-$)){if($===-1&&($=W),W-$+1===L)return $*C}else $!==-1&&(W-=W-$),$=-1}else for(h+L>A&&(h=A-L),W=h;W>=0;W--){let $=!0;for(let z=0;z<L;z++)if(j(f,W+z)!==j(l,z)){$=!1;break}if($)return W}return-1}a.prototype.includes=function(l,h,g){return this.indexOf(l,h,g)!==-1},a.prototype.indexOf=function(l,h,g){return M(this,l,h,g,!0)},a.prototype.lastIndexOf=function(l,h,g){return M(this,l,h,g,!1)};function O(f,l,h,g){h=Number(h)||0;const v=f.length-h;g?(g=Number(g),g>v&&(g=v)):g=v;const C=l.length;g>C/2&&(g=C/2);let A;for(A=0;A<g;++A){const L=parseInt(l.substr(A*2,2),16);if(Pt(L))return A;f[h+A]=L}return A}function P(f,l,h,g){return Je(Bt(l,f.length-h),f,h,g)}function H(f,l,h,g){return Je(Ws(l),f,h,g)}function Z(f,l,h,g){return Je(er(l),f,h,g)}function G(f,l,h,g){return Je(js(l,f.length-h),f,h,g)}a.prototype.write=function(l,h,g,v){if(h===void 0)v="utf8",g=this.length,h=0;else if(g===void 0&&typeof h=="string")v=h,g=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(g)?(g=g>>>0,v===void 0&&(v="utf8")):(v=g,g=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const C=this.length-h;if((g===void 0||g>C)&&(g=C),l.length>0&&(g<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");v||(v="utf8");let A=!1;for(;;)switch(v){case"hex":return O(this,l,h,g);case"utf8":case"utf-8":return P(this,l,h,g);case"ascii":case"latin1":case"binary":return H(this,l,h,g);case"base64":return Z(this,l,h,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,l,h,g);default:if(A)throw new TypeError("Unknown encoding: "+v);v=(""+v).toLowerCase(),A=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(f,l,h){return l===0&&h===f.length?e.fromByteArray(f):e.fromByteArray(f.slice(l,h))}function I(f,l,h){h=Math.min(f.length,h);const g=[];let v=l;for(;v<h;){const C=f[v];let A=null,L=C>239?4:C>223?3:C>191?2:1;if(v+L<=h){let j,W,$,z;switch(L){case 1:C<128&&(A=C);break;case 2:j=f[v+1],(j&192)===128&&(z=(C&31)<<6|j&63,z>127&&(A=z));break;case 3:j=f[v+1],W=f[v+2],(j&192)===128&&(W&192)===128&&(z=(C&15)<<12|(j&63)<<6|W&63,z>2047&&(z<55296||z>57343)&&(A=z));break;case 4:j=f[v+1],W=f[v+2],$=f[v+3],(j&192)===128&&(W&192)===128&&($&192)===128&&(z=(C&15)<<18|(j&63)<<12|(W&63)<<6|$&63,z>65535&&z<1114112&&(A=z))}}A===null?(A=65533,L=1):A>65535&&(A-=65536,g.push(A>>>10&1023|55296),A=56320|A&1023),g.push(A),v+=L}return Bs(g)}const ge=4096;function Bs(f){const l=f.length;if(l<=ge)return String.fromCharCode.apply(String,f);let h="",g=0;for(;g<l;)h+=String.fromCharCode.apply(String,f.slice(g,g+=ge));return h}function Ps(f,l,h){let g="";h=Math.min(f.length,h);for(let v=l;v<h;++v)g+=String.fromCharCode(f[v]&127);return g}function Ds(f,l,h){let g="";h=Math.min(f.length,h);for(let v=l;v<h;++v)g+=String.fromCharCode(f[v]);return g}function Os(f,l,h){const g=f.length;(!l||l<0)&&(l=0),(!h||h<0||h>g)&&(h=g);let v="";for(let C=l;C<h;++C)v+=$s[f[C]];return v}function Us(f,l,h){const g=f.slice(l,h);let v="";for(let C=0;C<g.length-1;C+=2)v+=String.fromCharCode(g[C]+g[C+1]*256);return v}a.prototype.slice=function(l,h){const g=this.length;l=~~l,h=h===void 0?g:~~h,l<0?(l+=g,l<0&&(l=0)):l>g&&(l=g),h<0?(h+=g,h<0&&(h=0)):h>g&&(h=g),h<l&&(h=l);const v=this.subarray(l,h);return Object.setPrototypeOf(v,a.prototype),v};function ee(f,l,h){if(f%1!==0||f<0)throw new RangeError("offset is not uint");if(f+l>h)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(l,h,g){l=l>>>0,h=h>>>0,g||ee(l,h,this.length);let v=this[l],C=1,A=0;for(;++A<h&&(C*=256);)v+=this[l+A]*C;return v},a.prototype.readUintBE=a.prototype.readUIntBE=function(l,h,g){l=l>>>0,h=h>>>0,g||ee(l,h,this.length);let v=this[l+--h],C=1;for(;h>0&&(C*=256);)v+=this[l+--h]*C;return v},a.prototype.readUint8=a.prototype.readUInt8=function(l,h){return l=l>>>0,h||ee(l,1,this.length),this[l]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(l,h){return l=l>>>0,h||ee(l,2,this.length),this[l]|this[l+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(l,h){return l=l>>>0,h||ee(l,2,this.length),this[l]<<8|this[l+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},a.prototype.readBigUInt64LE=me(function(l){l=l>>>0,Fe(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&Ue(l,this.length-8);const v=h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,C=this[++l]+this[++l]*2**8+this[++l]*2**16+g*2**24;return BigInt(v)+(BigInt(C)<<BigInt(32))}),a.prototype.readBigUInt64BE=me(function(l){l=l>>>0,Fe(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&Ue(l,this.length-8);const v=h*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],C=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+g;return(BigInt(v)<<BigInt(32))+BigInt(C)}),a.prototype.readIntLE=function(l,h,g){l=l>>>0,h=h>>>0,g||ee(l,h,this.length);let v=this[l],C=1,A=0;for(;++A<h&&(C*=256);)v+=this[l+A]*C;return C*=128,v>=C&&(v-=Math.pow(2,8*h)),v},a.prototype.readIntBE=function(l,h,g){l=l>>>0,h=h>>>0,g||ee(l,h,this.length);let v=h,C=1,A=this[l+--v];for(;v>0&&(C*=256);)A+=this[l+--v]*C;return C*=128,A>=C&&(A-=Math.pow(2,8*h)),A},a.prototype.readInt8=function(l,h){return l=l>>>0,h||ee(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},a.prototype.readInt16LE=function(l,h){l=l>>>0,h||ee(l,2,this.length);const g=this[l]|this[l+1]<<8;return g&32768?g|4294901760:g},a.prototype.readInt16BE=function(l,h){l=l>>>0,h||ee(l,2,this.length);const g=this[l+1]|this[l]<<8;return g&32768?g|4294901760:g},a.prototype.readInt32LE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},a.prototype.readInt32BE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},a.prototype.readBigInt64LE=me(function(l){l=l>>>0,Fe(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&Ue(l,this.length-8);const v=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(g<<24);return(BigInt(v)<<BigInt(32))+BigInt(h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24)}),a.prototype.readBigInt64BE=me(function(l){l=l>>>0,Fe(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&Ue(l,this.length-8);const v=(h<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(v)<<BigInt(32))+BigInt(this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+g)}),a.prototype.readFloatLE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),i.read(this,l,!0,23,4)},a.prototype.readFloatBE=function(l,h){return l=l>>>0,h||ee(l,4,this.length),i.read(this,l,!1,23,4)},a.prototype.readDoubleLE=function(l,h){return l=l>>>0,h||ee(l,8,this.length),i.read(this,l,!0,52,8)},a.prototype.readDoubleBE=function(l,h){return l=l>>>0,h||ee(l,8,this.length),i.read(this,l,!1,52,8)};function re(f,l,h,g,v,C){if(!a.isBuffer(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>v||l<C)throw new RangeError('"value" argument is out of bounds');if(h+g>f.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(l,h,g,v){if(l=+l,h=h>>>0,g=g>>>0,!v){const L=Math.pow(2,8*g)-1;re(this,l,h,g,L,0)}let C=1,A=0;for(this[h]=l&255;++A<g&&(C*=256);)this[h+A]=l/C&255;return h+g},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(l,h,g,v){if(l=+l,h=h>>>0,g=g>>>0,!v){const L=Math.pow(2,8*g)-1;re(this,l,h,g,L,0)}let C=g-1,A=1;for(this[h+C]=l&255;--C>=0&&(A*=256);)this[h+C]=l/A&255;return h+g},a.prototype.writeUint8=a.prototype.writeUInt8=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,1,255,0),this[h]=l&255,h+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,65535,0),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,65535,0),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,4294967295,0),this[h+3]=l>>>24,this[h+2]=l>>>16,this[h+1]=l>>>8,this[h]=l&255,h+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,4294967295,0),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4};function Gi(f,l,h,g,v){Ji(l,g,v,f,h,7);let C=Number(l&BigInt(4294967295));f[h++]=C,C=C>>8,f[h++]=C,C=C>>8,f[h++]=C,C=C>>8,f[h++]=C;let A=Number(l>>BigInt(32)&BigInt(4294967295));return f[h++]=A,A=A>>8,f[h++]=A,A=A>>8,f[h++]=A,A=A>>8,f[h++]=A,h}function Vi(f,l,h,g,v){Ji(l,g,v,f,h,7);let C=Number(l&BigInt(4294967295));f[h+7]=C,C=C>>8,f[h+6]=C,C=C>>8,f[h+5]=C,C=C>>8,f[h+4]=C;let A=Number(l>>BigInt(32)&BigInt(4294967295));return f[h+3]=A,A=A>>8,f[h+2]=A,A=A>>8,f[h+1]=A,A=A>>8,f[h]=A,h+8}a.prototype.writeBigUInt64LE=me(function(l,h=0){return Gi(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=me(function(l,h=0){return Vi(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(l,h,g,v){if(l=+l,h=h>>>0,!v){const j=Math.pow(2,8*g-1);re(this,l,h,g,j-1,-j)}let C=0,A=1,L=0;for(this[h]=l&255;++C<g&&(A*=256);)l<0&&L===0&&this[h+C-1]!==0&&(L=1),this[h+C]=(l/A>>0)-L&255;return h+g},a.prototype.writeIntBE=function(l,h,g,v){if(l=+l,h=h>>>0,!v){const j=Math.pow(2,8*g-1);re(this,l,h,g,j-1,-j)}let C=g-1,A=1,L=0;for(this[h+C]=l&255;--C>=0&&(A*=256);)l<0&&L===0&&this[h+C+1]!==0&&(L=1),this[h+C]=(l/A>>0)-L&255;return h+g},a.prototype.writeInt8=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,1,127,-128),l<0&&(l=255+l+1),this[h]=l&255,h+1},a.prototype.writeInt16LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,32767,-32768),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeInt16BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,32767,-32768),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeInt32LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,2147483647,-2147483648),this[h]=l&255,this[h+1]=l>>>8,this[h+2]=l>>>16,this[h+3]=l>>>24,h+4},a.prototype.writeInt32BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4},a.prototype.writeBigInt64LE=me(function(l,h=0){return Gi(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=me(function(l,h=0){return Vi(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Xi(f,l,h,g,v,C){if(h+g>f.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function Qi(f,l,h,g,v){return l=+l,h=h>>>0,v||Xi(f,l,h,4),i.write(f,l,h,g,23,4),h+4}a.prototype.writeFloatLE=function(l,h,g){return Qi(this,l,h,!0,g)},a.prototype.writeFloatBE=function(l,h,g){return Qi(this,l,h,!1,g)};function Ki(f,l,h,g,v){return l=+l,h=h>>>0,v||Xi(f,l,h,8),i.write(f,l,h,g,52,8),h+8}a.prototype.writeDoubleLE=function(l,h,g){return Ki(this,l,h,!0,g)},a.prototype.writeDoubleBE=function(l,h,g){return Ki(this,l,h,!1,g)},a.prototype.copy=function(l,h,g,v){if(!a.isBuffer(l))throw new TypeError("argument should be a Buffer");if(g||(g=0),!v&&v!==0&&(v=this.length),h>=l.length&&(h=l.length),h||(h=0),v>0&&v<g&&(v=g),v===g||l.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("sourceEnd out of bounds");v>this.length&&(v=this.length),l.length-h<v-g&&(v=l.length-h+g);const C=v-g;return this===l&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,g,v):Uint8Array.prototype.set.call(l,this.subarray(g,v),h),C},a.prototype.fill=function(l,h,g,v){if(typeof l=="string"){if(typeof h=="string"?(v=h,h=0,g=this.length):typeof g=="string"&&(v=g,g=this.length),v!==void 0&&typeof v!="string")throw new TypeError("encoding must be a string");if(typeof v=="string"&&!a.isEncoding(v))throw new TypeError("Unknown encoding: "+v);if(l.length===1){const A=l.charCodeAt(0);(v==="utf8"&&A<128||v==="latin1")&&(l=A)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(h<0||this.length<h||this.length<g)throw new RangeError("Out of range index");if(g<=h)return this;h=h>>>0,g=g===void 0?this.length:g>>>0,l||(l=0);let C;if(typeof l=="number")for(C=h;C<g;++C)this[C]=l;else{const A=a.isBuffer(l)?l:a.from(l,v),L=A.length;if(L===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(C=0;C<g-h;++C)this[C+h]=A[C%L]}return this};const Te={};function Nt(f,l,h){Te[f]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:l.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${f}]`,this.stack,delete this.name}get code(){return f}set code(v){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:v,writable:!0})}toString(){return`${this.name} [${f}]: ${this.message}`}}}Nt("ERR_BUFFER_OUT_OF_BOUNDS",function(f){return f?`${f} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Nt("ERR_INVALID_ARG_TYPE",function(f,l){return`The "${f}" argument must be of type number. Received type ${typeof l}`},TypeError),Nt("ERR_OUT_OF_RANGE",function(f,l,h){let g=`The value of "${f}" is out of range.`,v=h;return Number.isInteger(h)&&Math.abs(h)>2**32?v=Zi(String(h)):typeof h=="bigint"&&(v=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(v=Zi(v)),v+="n"),g+=` It must be ${l}. Received ${v}`,g},RangeError);function Zi(f){let l="",h=f.length;const g=f[0]==="-"?1:0;for(;h>=g+4;h-=3)l=`_${f.slice(h-3,h)}${l}`;return`${f.slice(0,h)}${l}`}function zs(f,l,h){Fe(l,"offset"),(f[l]===void 0||f[l+h]===void 0)&&Ue(l,f.length-(h+1))}function Ji(f,l,h,g,v,C){if(f>h||f<l){const A=typeof l=="bigint"?"n":"";let L;throw C>3?l===0||l===BigInt(0)?L=`>= 0${A} and < 2${A} ** ${(C+1)*8}${A}`:L=`>= -(2${A} ** ${(C+1)*8-1}${A}) and < 2 ** ${(C+1)*8-1}${A}`:L=`>= ${l}${A} and <= ${h}${A}`,new Te.ERR_OUT_OF_RANGE("value",L,f)}zs(g,v,C)}function Fe(f,l){if(typeof f!="number")throw new Te.ERR_INVALID_ARG_TYPE(l,"number",f)}function Ue(f,l,h){throw Math.floor(f)!==f?(Fe(f,h),new Te.ERR_OUT_OF_RANGE(h||"offset","an integer",f)):l<0?new Te.ERR_BUFFER_OUT_OF_BOUNDS:new Te.ERR_OUT_OF_RANGE(h||"offset",`>= ${h?1:0} and <= ${l}`,f)}const Hs=/[^+/0-9A-Za-z-_]/g;function qs(f){if(f=f.split("=")[0],f=f.trim().replace(Hs,""),f.length<2)return"";for(;f.length%4!==0;)f=f+"=";return f}function Bt(f,l){l=l||1/0;let h;const g=f.length;let v=null;const C=[];for(let A=0;A<g;++A){if(h=f.charCodeAt(A),h>55295&&h<57344){if(!v){if(h>56319){(l-=3)>-1&&C.push(239,191,189);continue}else if(A+1===g){(l-=3)>-1&&C.push(239,191,189);continue}v=h;continue}if(h<56320){(l-=3)>-1&&C.push(239,191,189),v=h;continue}h=(v-55296<<10|h-56320)+65536}else v&&(l-=3)>-1&&C.push(239,191,189);if(v=null,h<128){if((l-=1)<0)break;C.push(h)}else if(h<2048){if((l-=2)<0)break;C.push(h>>6|192,h&63|128)}else if(h<65536){if((l-=3)<0)break;C.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((l-=4)<0)break;C.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return C}function Ws(f){const l=[];for(let h=0;h<f.length;++h)l.push(f.charCodeAt(h)&255);return l}function js(f,l){let h,g,v;const C=[];for(let A=0;A<f.length&&!((l-=2)<0);++A)h=f.charCodeAt(A),g=h>>8,v=h%256,C.push(v),C.push(g);return C}function er(f){return e.toByteArray(qs(f))}function Je(f,l,h,g){let v;for(v=0;v<g&&!(v+h>=l.length||v>=f.length);++v)l[v+h]=f[v];return v}function ae(f,l){return f instanceof l||f!=null&&f.constructor!=null&&f.constructor.name!=null&&f.constructor.name===l.name}function Pt(f){return f!==f}const $s=function(){const f="0123456789abcdef",l=new Array(256);for(let h=0;h<16;++h){const g=h*16;for(let v=0;v<16;++v)l[g+v]=f[h]+f[v]}return l}();function me(f){return typeof BigInt>"u"?Ys:f}function Ys(){throw new Error("BigInt not supported")}})(Ae);(function(t,e){var i=Ae,r=i.Buffer;function n(o,a){for(var u in o)a[u]=o[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(n(i,e),e.Buffer=s);function s(o,a,u){return r(o,a,u)}n(r,s),s.from=function(o,a,u){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,u)},s.alloc=function(o,a,u){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=r(o);return a!==void 0?typeof u=="string"?c.fill(a,u):c.fill(a):c.fill(0),c},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i.SlowBuffer(o)}})(wi,wi.exports);var sa=wi.exports,Ht=65536,oa=4294967295;function aa(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var la=sa.Buffer,bt=self.crypto||self.msCrypto;bt&&bt.getRandomValues?yi.exports=ha:yi.exports=aa;function ha(t,e){if(t>oa)throw new RangeError("requested too many random bytes");var i=la.allocUnsafe(t);if(t>0)if(t>Ht)for(var r=0;r<t;r+=Ht)bt.getRandomValues(i.slice(r,r+Ht));else bt.getRandomValues(i);return typeof e=="function"?process.nextTick(function(){e(null,i)}):i}var ua=yi.exports,vi={exports:{}},Oe={},Oi={exports:{}},Ne=typeof Reflect=="object"?Reflect:null,vr=Ne&&typeof Ne.apply=="function"?Ne.apply:function(e,i,r){return Function.prototype.apply.call(e,i,r)},ft;Ne&&typeof Ne.ownKeys=="function"?ft=Ne.ownKeys:Object.getOwnPropertySymbols?ft=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ft=function(e){return Object.getOwnPropertyNames(e)};function ca(t){console&&console.warn&&console.warn(t)}var Jn=Number.isNaN||function(e){return e!==e};function U(){U.init.call(this)}Oi.exports=U;Oi.exports.once=ga;U.EventEmitter=U;U.prototype._events=void 0;U.prototype._eventsCount=0;U.prototype._maxListeners=void 0;var br=10;function Tt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return br},set:function(t){if(typeof t!="number"||t<0||Jn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");br=t}});U.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};U.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Jn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function es(t){return t._maxListeners===void 0?U.defaultMaxListeners:t._maxListeners}U.prototype.getMaxListeners=function(){return es(this)};U.prototype.emit=function(e){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")vr(u,this,i);else for(var c=u.length,p=ss(u,c),r=0;r<c;++r)vr(p[r],this,i);return!0};function ts(t,e,i,r){var n,s,o;if(Tt(i),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),o=s[e]),o===void 0)o=s[e]=i,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),n=es(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,ca(a)}return t}U.prototype.addListener=function(e,i){return ts(this,e,i,!1)};U.prototype.on=U.prototype.addListener;U.prototype.prependListener=function(e,i){return ts(this,e,i,!0)};function da(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function is(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=da.bind(r);return n.listener=i,r.wrapFn=n,n}U.prototype.once=function(e,i){return Tt(i),this.on(e,is(this,e,i)),this};U.prototype.prependOnceListener=function(e,i){return Tt(i),this.prependListener(e,is(this,e,i)),this};U.prototype.removeListener=function(e,i){var r,n,s,o,a;if(Tt(i),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===i||r.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||i));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===i||r[o].listener===i){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():fa(r,s),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};U.prototype.off=U.prototype.removeListener;U.prototype.removeAllListeners=function(e){var i,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=r[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(e,i[n]);return this};function rs(t,e,i){var r=t._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?pa(n):ss(n,n.length)}U.prototype.listeners=function(e){return rs(this,e,!0)};U.prototype.rawListeners=function(e){return rs(this,e,!1)};U.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ns.call(t,e)};U.prototype.listenerCount=ns;function ns(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}U.prototype.eventNames=function(){return this._eventsCount>0?ft(this._events):[]};function ss(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function fa(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function pa(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function ga(t,e){return new Promise(function(i,r){function n(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),i([].slice.call(arguments))}os(t,e,s,{once:!0}),e!=="error"&&ma(t,n,{once:!0})})}function ma(t,e,i){typeof t.on=="function"&&os(t,"error",e,i)}function os(t,e,i,r){if(typeof t.on=="function")r.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){r.once&&t.removeEventListener(e,n),i(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var as=Oi.exports,ls=as.EventEmitter;const _a={},ya=Object.freeze(Object.defineProperty({__proto__:null,default:_a},Symbol.toStringTag,{value:"Module"})),hs=Mo(ya);var qt,Er;function wa(){if(Er)return qt;Er=1;function t(_,m){var w=Object.keys(_);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(_);m&&(b=b.filter(function(E){return Object.getOwnPropertyDescriptor(_,E).enumerable})),w.push.apply(w,b)}return w}function e(_){for(var m=1;m<arguments.length;m++){var w=arguments[m]!=null?arguments[m]:{};m%2?t(Object(w),!0).forEach(function(b){i(_,b,w[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(w)):t(Object(w)).forEach(function(b){Object.defineProperty(_,b,Object.getOwnPropertyDescriptor(w,b))})}return _}function i(_,m,w){return m in _?Object.defineProperty(_,m,{value:w,enumerable:!0,configurable:!0,writable:!0}):_[m]=w,_}function r(_,m){if(!(_ instanceof m))throw new TypeError("Cannot call a class as a function")}function n(_,m){for(var w=0;w<m.length;w++){var b=m[w];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(_,b.key,b)}}function s(_,m,w){return m&&n(_.prototype,m),w&&n(_,w),_}var o=Ae,a=o.Buffer,u=hs,c=u.inspect,p=c&&c.custom||"inspect";function d(_,m,w){a.prototype.copy.call(_,m,w)}return qt=function(){function _(){r(this,_),this.head=null,this.tail=null,this.length=0}return s(_,[{key:"push",value:function(w){var b={data:w,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length}},{key:"unshift",value:function(w){var b={data:w,next:this.head};this.length===0&&(this.tail=b),this.head=b,++this.length}},{key:"shift",value:function(){if(this.length!==0){var w=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,w}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(w){if(this.length===0)return"";for(var b=this.head,E=""+b.data;b=b.next;)E+=w+b.data;return E}},{key:"concat",value:function(w){if(this.length===0)return a.alloc(0);for(var b=a.allocUnsafe(w>>>0),E=this.head,y=0;E;)d(E.data,b,y),y+=E.data.length,E=E.next;return b}},{key:"consume",value:function(w,b){var E;return w<this.head.data.length?(E=this.head.data.slice(0,w),this.head.data=this.head.data.slice(w)):w===this.head.data.length?E=this.shift():E=b?this._getString(w):this._getBuffer(w),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(w){var b=this.head,E=1,y=b.data;for(w-=y.length;b=b.next;){var x=b.data,R=w>x.length?x.length:w;if(R===x.length?y+=x:y+=x.slice(0,w),w-=R,w===0){R===x.length?(++E,b.next?this.head=b.next:this.head=this.tail=null):(this.head=b,b.data=x.slice(R));break}++E}return this.length-=E,y}},{key:"_getBuffer",value:function(w){var b=a.allocUnsafe(w),E=this.head,y=1;for(E.data.copy(b),w-=E.data.length;E=E.next;){var x=E.data,R=w>x.length?x.length:w;if(x.copy(b,b.length-w,0,R),w-=R,w===0){R===x.length?(++y,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=x.slice(R));break}++y}return this.length-=y,b}},{key:p,value:function(w,b){return c(this,e({},b,{depth:0,customInspect:!1}))}}]),_}(),qt}function va(t,e){var i=this,r=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return r||n?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(bi,this,t)):process.nextTick(bi,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?i._writableState?i._writableState.errorEmitted?process.nextTick(pt,i):(i._writableState.errorEmitted=!0,process.nextTick(xr,i,s)):process.nextTick(xr,i,s):e?(process.nextTick(pt,i),e(s)):process.nextTick(pt,i)}),this)}function xr(t,e){bi(t,e),pt(t)}function pt(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function ba(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function bi(t,e){t.emit("error",e)}function Ea(t,e){var i=t._readableState,r=t._writableState;i&&i.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var us={destroy:va,undestroy:ba,errorOrDestroy:Ea},Se={};function xa(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var cs={};function oe(t,e,i){i||(i=Error);function r(s,o,a){return typeof e=="string"?e:e(s,o,a)}var n=function(s){xa(o,s);function o(a,u,c){return s.call(this,r(a,u,c))||this}return o}(i);n.prototype.name=i.name,n.prototype.code=t,cs[t]=n}function Cr(t,e){if(Array.isArray(t)){var i=t.length;return t=t.map(function(r){return String(r)}),i>2?"one of ".concat(e," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:i===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Ca(t,e,i){return t.substr(!i||i<0?0:+i,e.length)===e}function Ra(t,e,i){return(i===void 0||i>t.length)&&(i=t.length),t.substring(i-e.length,i)===e}function Aa(t,e,i){return typeof i!="number"&&(i=0),i+e.length>t.length?!1:t.indexOf(e,i)!==-1}oe("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);oe("ERR_INVALID_ARG_TYPE",function(t,e,i){var r;typeof e=="string"&&Ca(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var n;if(Ra(t," argument"))n="The ".concat(t," ").concat(r," ").concat(Cr(e,"type"));else{var s=Aa(t,".")?"property":"argument";n='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(Cr(e,"type"))}return n+=". Received type ".concat(typeof i),n},TypeError);oe("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");oe("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});oe("ERR_STREAM_PREMATURE_CLOSE","Premature close");oe("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});oe("ERR_MULTIPLE_CALLBACK","Callback called multiple times");oe("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");oe("ERR_STREAM_WRITE_AFTER_END","write after end");oe("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);oe("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);oe("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Se.codes=cs;var Sa=Se.codes.ERR_INVALID_OPT_VALUE;function Ta(t,e,i){return t.highWaterMark!=null?t.highWaterMark:e?t[i]:null}function Fa(t,e,i,r){var n=Ta(e,r,i);if(n!=null){if(!(isFinite(n)&&Math.floor(n)===n)||n<0){var s=r?i:"highWaterMark";throw new Sa(s,n)}return Math.floor(n)}return t.objectMode?16:16*1024}var ds={getHighWaterMark:Fa},Ei={exports:{}};typeof Object.create=="function"?Ei.exports=function(e,i){i&&(e.super_=i,e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Ei.exports=function(e,i){if(i){e.super_=i;var r=function(){};r.prototype=i.prototype,e.prototype=new r,e.prototype.constructor=e}};var Xe=Ei.exports,Wt={},rt={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Rr;function Ma(){return Rr||(Rr=1,function(t,e){var i=Ae,r=i.Buffer;function n(o,a){for(var u in o)a[u]=o[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(n(i,e),e.Buffer=s);function s(o,a,u){return r(o,a,u)}s.prototype=Object.create(r.prototype),n(r,s),s.from=function(o,a,u){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,u)},s.alloc=function(o,a,u){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=r(o);return a!==void 0?typeof u=="string"?c.fill(a,u):c.fill(a):c.fill(0),c},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i.SlowBuffer(o)}}(rt,rt.exports)),rt.exports}var Ar;function fs(){if(Ar)return Wt;Ar=1;var t=Ma().Buffer,e=t.isEncoding||function(y){switch(y=""+y,y&&y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(y){if(!y)return"utf8";for(var x;;)switch(y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return y;default:if(x)return;y=(""+y).toLowerCase(),x=!0}}function r(y){var x=i(y);if(typeof x!="string"&&(t.isEncoding===e||!e(y)))throw new Error("Unknown encoding: "+y);return x||y}Wt.StringDecoder=n;function n(y){this.encoding=r(y);var x;switch(this.encoding){case"utf16le":this.text=d,this.end=_,x=4;break;case"utf8":this.fillLast=u,x=4;break;case"base64":this.text=m,this.end=w,x=3;break;default:this.write=b,this.end=E;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(x)}n.prototype.write=function(y){if(y.length===0)return"";var x,R;if(this.lastNeed){if(x=this.fillLast(y),x===void 0)return"";R=this.lastNeed,this.lastNeed=0}else R=0;return R<y.length?x?x+this.text(y,R):this.text(y,R):x||""},n.prototype.end=p,n.prototype.text=c,n.prototype.fillLast=function(y){if(this.lastNeed<=y.length)return y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,y.length),this.lastNeed-=y.length};function s(y){return y<=127?0:y>>5===6?2:y>>4===14?3:y>>3===30?4:y>>6===2?-1:-2}function o(y,x,R){var S=x.length-1;if(S<R)return 0;var T=s(x[S]);return T>=0?(T>0&&(y.lastNeed=T-1),T):--S<R||T===-2?0:(T=s(x[S]),T>=0?(T>0&&(y.lastNeed=T-2),T):--S<R||T===-2?0:(T=s(x[S]),T>=0?(T>0&&(T===2?T=0:y.lastNeed=T-3),T):0))}function a(y,x,R){if((x[0]&192)!==128)return y.lastNeed=0,"�";if(y.lastNeed>1&&x.length>1){if((x[1]&192)!==128)return y.lastNeed=1,"�";if(y.lastNeed>2&&x.length>2&&(x[2]&192)!==128)return y.lastNeed=2,"�"}}function u(y){var x=this.lastTotal-this.lastNeed,R=a(this,y);if(R!==void 0)return R;if(this.lastNeed<=y.length)return y.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);y.copy(this.lastChar,x,0,y.length),this.lastNeed-=y.length}function c(y,x){var R=o(this,y,x);if(!this.lastNeed)return y.toString("utf8",x);this.lastTotal=R;var S=y.length-(R-this.lastNeed);return y.copy(this.lastChar,0,S),y.toString("utf8",x,S)}function p(y){var x=y&&y.length?this.write(y):"";return this.lastNeed?x+"�":x}function d(y,x){if((y.length-x)%2===0){var R=y.toString("utf16le",x);if(R){var S=R.charCodeAt(R.length-1);if(S>=55296&&S<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1],R.slice(0,-1)}return R}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=y[y.length-1],y.toString("utf16le",x,y.length-1)}function _(y){var x=y&&y.length?this.write(y):"";if(this.lastNeed){var R=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,R)}return x}function m(y,x){var R=(y.length-x)%3;return R===0?y.toString("base64",x):(this.lastNeed=3-R,this.lastTotal=3,R===1?this.lastChar[0]=y[y.length-1]:(this.lastChar[0]=y[y.length-2],this.lastChar[1]=y[y.length-1]),y.toString("base64",x,y.length-R))}function w(y){var x=y&&y.length?this.write(y):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function b(y){return y.toString(this.encoding)}function E(y){return y&&y.length?this.write(y):""}return Wt}var Sr=Se.codes.ERR_STREAM_PREMATURE_CLOSE;function Ia(t){var e=!1;return function(){if(!e){e=!0;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];t.apply(this,r)}}}function ka(){}function La(t){return t.setHeader&&typeof t.abort=="function"}function ps(t,e,i){if(typeof e=="function")return ps(t,null,e);e||(e={}),i=Ia(i||ka);var r=e.readable||e.readable!==!1&&t.readable,n=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){n=!1,o=!0,r||i.call(t)},u=t._readableState&&t._readableState.endEmitted,c=function(){r=!1,u=!0,n||i.call(t)},p=function(w){i.call(t,w)},d=function(){var w;if(r&&!u)return(!t._readableState||!t._readableState.ended)&&(w=new Sr),i.call(t,w);if(n&&!o)return(!t._writableState||!t._writableState.ended)&&(w=new Sr),i.call(t,w)},_=function(){t.req.on("finish",a)};return La(t)?(t.on("complete",a),t.on("abort",d),t.req?_():t.on("request",_)):n&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",c),t.on("finish",a),e.error!==!1&&t.on("error",p),t.on("close",d),function(){t.removeListener("complete",a),t.removeListener("abort",d),t.removeListener("request",_),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",c),t.removeListener("error",p),t.removeListener("close",d)}}var Ui=ps,jt,Tr;function Na(){if(Tr)return jt;Tr=1;var t;function e(y,x,R){return x in y?Object.defineProperty(y,x,{value:R,enumerable:!0,configurable:!0,writable:!0}):y[x]=R,y}var i=Ui,r=Symbol("lastResolve"),n=Symbol("lastReject"),s=Symbol("error"),o=Symbol("ended"),a=Symbol("lastPromise"),u=Symbol("handlePromise"),c=Symbol("stream");function p(y,x){return{value:y,done:x}}function d(y){var x=y[r];if(x!==null){var R=y[c].read();R!==null&&(y[a]=null,y[r]=null,y[n]=null,x(p(R,!1)))}}function _(y){process.nextTick(d,y)}function m(y,x){return function(R,S){y.then(function(){if(x[o]){R(p(void 0,!0));return}x[u](R,S)},S)}}var w=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((t={get stream(){return this[c]},next:function(){var x=this,R=this[s];if(R!==null)return Promise.reject(R);if(this[o])return Promise.resolve(p(void 0,!0));if(this[c].destroyed)return new Promise(function(k,O){process.nextTick(function(){x[s]?O(x[s]):k(p(void 0,!0))})});var S=this[a],T;if(S)T=new Promise(m(S,this));else{var M=this[c].read();if(M!==null)return Promise.resolve(p(M,!1));T=new Promise(this[u])}return this[a]=T,T}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var x=this;return new Promise(function(R,S){x[c].destroy(null,function(T){if(T){S(T);return}R(p(void 0,!0))})})}),t),w),E=function(x){var R,S=Object.create(b,(R={},e(R,c,{value:x,writable:!0}),e(R,r,{value:null,writable:!0}),e(R,n,{value:null,writable:!0}),e(R,s,{value:null,writable:!0}),e(R,o,{value:x._readableState.endEmitted,writable:!0}),e(R,u,{value:function(M,k){var O=S[c].read();O?(S[a]=null,S[r]=null,S[n]=null,M(p(O,!1))):(S[r]=M,S[n]=k)},writable:!0}),R));return S[a]=null,i(x,function(T){if(T&&T.code!=="ERR_STREAM_PREMATURE_CLOSE"){var M=S[n];M!==null&&(S[a]=null,S[r]=null,S[n]=null,M(T)),S[s]=T;return}var k=S[r];k!==null&&(S[a]=null,S[r]=null,S[n]=null,k(p(void 0,!0))),S[o]=!0}),x.on("readable",_.bind(null,S)),S};return jt=E,jt}var $t,Fr;function Ba(){return Fr||(Fr=1,$t=function(){throw new Error("Readable.from is not available in the browser")}),$t}const zi=Oe;zi.Readable=D;D.ReadableState=ms;as.EventEmitter;var gs=function(e,i){return e.listeners(i).length},Qe=ls,Ft=Ae.Buffer,Pa=self.Uint8Array||function(){};function Da(t){return Ft.from(t)}function Oa(t){return Ft.isBuffer(t)||t instanceof Pa}var Yt=hs,N;Yt&&Yt.debuglog?N=Yt.debuglog("stream"):N=function(){};var Ua=wa(),Hi=us,za=ds,Ha=za.getHighWaterMark,Mt=Se.codes,qa=Mt.ERR_INVALID_ARG_TYPE,Wa=Mt.ERR_STREAM_PUSH_AFTER_EOF,ja=Mt.ERR_METHOD_NOT_IMPLEMENTED,$a=Mt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Be,Gt,Vt;Xe(D,Qe);var He=Hi.errorOrDestroy,Xt=["error","close","destroy","pause","resume"];function Ya(t,e,i){if(typeof t.prependListener=="function")return t.prependListener(e,i);!t._events||!t._events[e]?t.on(e,i):Array.isArray(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]}function ms(t,e,i){t=t||{},typeof i!="boolean"&&(i=e instanceof zi.Duplex),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=Ha(this,t,"readableHighWaterMark",i),this.buffer=new Ua,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(Be||(Be=fs().StringDecoder),this.decoder=new Be(t.encoding),this.encoding=t.encoding)}function D(t){if(!(this instanceof D))return new D(t);var e=this instanceof zi.Duplex;this._readableState=new ms(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),Qe.call(this)}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}});D.prototype.destroy=Hi.destroy;D.prototype._undestroy=Hi.undestroy;D.prototype._destroy=function(t,e){e(t)};D.prototype.push=function(t,e){var i=this._readableState,r;return i.objectMode?r=!0:typeof t=="string"&&(e=e||i.defaultEncoding,e!==i.encoding&&(t=Ft.from(t,e),e=""),r=!0),_s(this,t,e,!1,r)};D.prototype.unshift=function(t){return _s(this,t,null,!0,!1)};function _s(t,e,i,r,n){N("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,Xa(t,s);else{var o;if(n||(o=Ga(s,e)),o)He(t,o);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Ft.prototype&&(e=Da(e)),r)s.endEmitted?He(t,new $a):Qt(t,s,e,!0);else if(s.ended)He(t,new Wa);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!i?(e=s.decoder.write(e),s.objectMode||e.length!==0?Qt(t,s,e,!1):xi(t,s)):Qt(t,s,e,!1)}else r||(s.reading=!1,xi(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function Qt(t,e,i,r){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",i)):(e.length+=e.objectMode?1:i.length,r?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&It(t)),xi(t,e)}function Ga(t,e){var i;return!Oa(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(i=new qa("chunk",["string","Buffer","Uint8Array"],e)),i}D.prototype.isPaused=function(){return this._readableState.flowing===!1};D.prototype.setEncoding=function(t){Be||(Be=fs().StringDecoder);var e=new Be(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,r="";i!==null;)r+=e.write(i.data),i=i.next;return this._readableState.buffer.clear(),r!==""&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var Mr=1073741824;function Va(t){return t>=Mr?t=Mr:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function Ir(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=Va(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}D.prototype.read=function(t){N("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return N("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Kt(this):It(this),null;if(t=Ir(t,e),t===0&&e.ended)return e.length===0&&Kt(this),null;var r=e.needReadable;N("need readable",r),(e.length===0||e.length-t<e.highWaterMark)&&(r=!0,N("length less than watermark",r)),e.ended||e.reading?(r=!1,N("reading or ended",r)):r&&(N("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=Ir(i,e)));var n;return t>0?n=vs(t,e):n=null,n===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&Kt(this)),n!==null&&this.emit("data",n),n};function Xa(t,e){if(N("onEofChunk"),!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,e.sync?It(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,ys(t)))}}function It(t){var e=t._readableState;N("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(N("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(ys,t))}function ys(t){var e=t._readableState;N("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,qi(t)}function xi(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(Qa,t,e))}function Qa(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var i=e.length;if(N("maybeReadMore read 0"),t.read(0),i===e.length)break}e.readingMore=!1}D.prototype._read=function(t){He(this,new ja("_read()"))};D.prototype.pipe=function(t,e){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t);break}r.pipesCount+=1,N("pipe count=%d opts=%j",r.pipesCount,e);var n=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,s=n?a:b;r.endEmitted?process.nextTick(s):i.once("end",s),t.on("unpipe",o);function o(E,y){N("onunpipe"),E===i&&y&&y.hasUnpiped===!1&&(y.hasUnpiped=!0,p())}function a(){N("onend"),t.end()}var u=Ka(i);t.on("drain",u);var c=!1;function p(){N("cleanup"),t.removeListener("close",m),t.removeListener("finish",w),t.removeListener("drain",u),t.removeListener("error",_),t.removeListener("unpipe",o),i.removeListener("end",a),i.removeListener("end",b),i.removeListener("data",d),c=!0,r.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&u()}i.on("data",d);function d(E){N("ondata");var y=t.write(E);N("dest.write",y),y===!1&&((r.pipesCount===1&&r.pipes===t||r.pipesCount>1&&bs(r.pipes,t)!==-1)&&!c&&(N("false write response, pause",r.awaitDrain),r.awaitDrain++),i.pause())}function _(E){N("onerror",E),b(),t.removeListener("error",_),gs(t,"error")===0&&He(t,E)}Ya(t,"error",_);function m(){t.removeListener("finish",w),b()}t.once("close",m);function w(){N("onfinish"),t.removeListener("close",m),b()}t.once("finish",w);function b(){N("unpipe"),i.unpipe(t)}return t.emit("pipe",i),r.flowing||(N("pipe resume"),i.resume()),t};function Ka(t){return function(){var i=t._readableState;N("pipeOnDrain",i.awaitDrain),i.awaitDrain&&i.awaitDrain--,i.awaitDrain===0&&gs(t,"data")&&(i.flowing=!0,qi(t))}}D.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)r[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=bs(e.pipes,t);return o===-1?this:(e.pipes.splice(o,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)};D.prototype.on=function(t,e){var i=Qe.prototype.on.call(this,t,e),r=this._readableState;return t==="data"?(r.readableListening=this.listenerCount("readable")>0,r.flowing!==!1&&this.resume()):t==="readable"&&!r.endEmitted&&!r.readableListening&&(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,N("on readable",r.length,r.reading),r.length?It(this):r.reading||process.nextTick(Za,this)),i};D.prototype.addListener=D.prototype.on;D.prototype.removeListener=function(t,e){var i=Qe.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(ws,this),i};D.prototype.removeAllListeners=function(t){var e=Qe.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(ws,this),e};function ws(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function Za(t){N("readable nexttick read 0"),t.read(0)}D.prototype.resume=function(){var t=this._readableState;return t.flowing||(N("resume"),t.flowing=!t.readableListening,Ja(this,t)),t.paused=!1,this};function Ja(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(el,t,e))}function el(t,e){N("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),qi(t),e.flowing&&!e.reading&&t.read(0)}D.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function qi(t){var e=t._readableState;for(N("flow",e.flowing);e.flowing&&t.read()!==null;);}D.prototype.wrap=function(t){var e=this,i=this._readableState,r=!1;t.on("end",function(){if(N("wrapped end"),i.decoder&&!i.ended){var o=i.decoder.end();o&&o.length&&e.push(o)}e.push(null)}),t.on("data",function(o){if(N("wrapped data"),i.decoder&&(o=i.decoder.write(o)),!(i.objectMode&&o==null)&&!(!i.objectMode&&(!o||!o.length))){var a=e.push(o);a||(r=!0,t.pause())}});for(var n in t)this[n]===void 0&&typeof t[n]=="function"&&(this[n]=function(a){return function(){return t[a].apply(t,arguments)}}(n));for(var s=0;s<Xt.length;s++)t.on(Xt[s],this.emit.bind(this,Xt[s]));return this._read=function(o){N("wrapped _read",o),r&&(r=!1,t.resume())},this};typeof Symbol=="function"&&(D.prototype[Symbol.asyncIterator]=function(){return Gt===void 0&&(Gt=Na()),Gt(this)});Object.defineProperty(D.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(D.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(D.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});D._fromList=vs;Object.defineProperty(D.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function vs(t,e){if(e.length===0)return null;var i;return e.objectMode?i=e.buffer.shift():!t||t>=e.length?(e.decoder?i=e.buffer.join(""):e.buffer.length===1?i=e.buffer.first():i=e.buffer.concat(e.length),e.buffer.clear()):i=e.buffer.consume(t,e.decoder),i}function Kt(t){var e=t._readableState;N("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(tl,e,t))}function tl(t,e){if(N("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var i=e._writableState;(!i||i.autoDestroy&&i.finished)&&e.destroy()}}typeof Symbol=="function"&&(D.from=function(t,e){return Vt===void 0&&(Vt=Ba()),Vt(D,t,e)});function bs(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}var il=rl;function rl(t,e){if(Zt("noDeprecation"))return t;var i=!1;function r(){if(!i){if(Zt("throwDeprecation"))throw new Error(e);Zt("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}return r}function Zt(t){try{if(!self.localStorage)return!1}catch{return!1}var e=self.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}const Wi=Oe;Wi.Writable=Y;function Es(t){var e=this;this.next=null,this.entry=null,this.finish=function(){Ml(e,t)}}Y.WritableState=Ke;var nl={deprecate:il},xs=ls,kt=Ae.Buffer,sl=self.Uint8Array||function(){};function ol(t){return kt.from(t)}function al(t){return kt.isBuffer(t)||t instanceof sl}var ji=us,ll=ds,hl=ll.getHighWaterMark,ve=Se.codes,ul=ve.ERR_INVALID_ARG_TYPE,cl=ve.ERR_METHOD_NOT_IMPLEMENTED,dl=ve.ERR_MULTIPLE_CALLBACK,fl=ve.ERR_STREAM_CANNOT_PIPE,pl=ve.ERR_STREAM_DESTROYED,gl=ve.ERR_STREAM_NULL_VALUES,ml=ve.ERR_STREAM_WRITE_AFTER_END,_l=ve.ERR_UNKNOWN_ENCODING,Pe=ji.errorOrDestroy;Xe(Y,xs);function yl(){}function Ke(t,e,i){t=t||{},typeof i!="boolean"&&(i=e instanceof Wi.Duplex),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=hl(this,t,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var r=t.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(n){Rl(e,n)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Es(this)}Ke.prototype.getBuffer=function(){for(var e=this.bufferedRequest,i=[];e;)i.push(e),e=e.next;return i};(function(){try{Object.defineProperty(Ke.prototype,"buffer",{get:nl.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var gt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(gt=Function.prototype[Symbol.hasInstance],Object.defineProperty(Y,Symbol.hasInstance,{value:function(e){return gt.call(this,e)?!0:this!==Y?!1:e&&e._writableState instanceof Ke}})):gt=function(e){return e instanceof this};function Y(t){var e=this instanceof Wi.Duplex;if(!e&&!gt.call(Y,this))return new Y(t);this._writableState=new Ke(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),xs.call(this)}Y.prototype.pipe=function(){Pe(this,new fl)};function wl(t,e){var i=new ml;Pe(t,i),process.nextTick(e,i)}function vl(t,e,i,r){var n;return i===null?n=new gl:typeof i!="string"&&!e.objectMode&&(n=new ul("chunk",["string","Buffer"],i)),n?(Pe(t,n),process.nextTick(r,n),!1):!0}Y.prototype.write=function(t,e,i){var r=this._writableState,n=!1,s=!r.objectMode&&al(t);return s&&!kt.isBuffer(t)&&(t=ol(t)),typeof e=="function"&&(i=e,e=null),s?e="buffer":e||(e=r.defaultEncoding),typeof i!="function"&&(i=yl),r.ending?wl(this,i):(s||vl(this,r,t,i))&&(r.pendingcb++,n=El(this,r,s,t,e,i)),n};Y.prototype.cork=function(){this._writableState.corked++};Y.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&Cs(this,t))};Y.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _l(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(Y.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function bl(t,e,i){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=kt.from(e,i)),e}Object.defineProperty(Y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function El(t,e,i,r,n,s){if(!i){var o=bl(e,r,n);r!==o&&(i=!0,n="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var u=e.length<e.highWaterMark;if(u||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Ci(t,e,!1,a,r,n,s);return u}function Ci(t,e,i,r,n,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new pl("write")):i?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function xl(t,e,i,r,n){--e.pendingcb,i?(process.nextTick(n,r),process.nextTick($e,t,e),t._writableState.errorEmitted=!0,Pe(t,r)):(n(r),t._writableState.errorEmitted=!0,Pe(t,r),$e(t,e))}function Cl(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function Rl(t,e){var i=t._writableState,r=i.sync,n=i.writecb;if(typeof n!="function")throw new dl;if(Cl(i),e)xl(t,i,r,e,n);else{var s=Rs(i)||t.destroyed;!s&&!i.corked&&!i.bufferProcessing&&i.bufferedRequest&&Cs(t,i),r?process.nextTick(kr,t,i,s,n):kr(t,i,s,n)}}function kr(t,e,i,r){i||Al(t,e),e.pendingcb--,r(),$e(t,e)}function Al(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function Cs(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),s=e.corkedRequestsFree;s.entry=i;for(var o=0,a=!0;i;)n[o]=i,i.isBuf||(a=!1),i=i.next,o+=1;n.allBuffers=a,Ci(t,e,!0,e.length,n,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new Es(e),e.bufferedRequestCount=0}else{for(;i;){var u=i.chunk,c=i.encoding,p=i.callback,d=e.objectMode?1:u.length;if(Ci(t,e,!1,d,u,c,p),i=i.next,e.bufferedRequestCount--,e.writing)break}i===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}Y.prototype._write=function(t,e,i){i(new cl("_write()"))};Y.prototype._writev=null;Y.prototype.end=function(t,e,i){var r=this._writableState;return typeof t=="function"?(i=t,t=null,e=null):typeof e=="function"&&(i=e,e=null),t!=null&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||Fl(this,r,i),this};Object.defineProperty(Y.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Rs(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function Sl(t,e){t._final(function(i){e.pendingcb--,i&&Pe(t,i),e.prefinished=!0,t.emit("prefinish"),$e(t,e)})}function Tl(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(Sl,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function $e(t,e){var i=Rs(e);if(i&&(Tl(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var r=t._readableState;(!r||r.autoDestroy&&r.endEmitted)&&t.destroy()}return i}function Fl(t,e,i){e.ending=!0,$e(t,e),i&&(e.finished?process.nextTick(i):t.once("finish",i)),e.ended=!0,t.writable=!1}function Ml(t,e,i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree.next=t}Object.defineProperty(Y.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}});Y.prototype.destroy=ji.destroy;Y.prototype._undestroy=ji.undestroy;Y.prototype._destroy=function(t,e){e(t)};var Il=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};const De=Oe;De.Duplex=ce;Xe(ce,De.Readable);for(var Lr=Il(De.Writable.prototype),Jt=0;Jt<Lr.length;Jt++){var ei=Lr[Jt];ce.prototype[ei]||(ce.prototype[ei]=De.Writable.prototype[ei])}function ce(t){if(!(this instanceof ce))return new ce(t);De.Readable.call(this,t),De.Writable.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",kl)))}Object.defineProperty(ce.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(ce.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(ce.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function kl(){this._writableState.ended||process.nextTick(Ll,this)}function Ll(t){t.end()}Object.defineProperty(ce.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});const Ze=Oe;Ze.Transform=fe;var Lt=Se.codes,Nl=Lt.ERR_METHOD_NOT_IMPLEMENTED,Bl=Lt.ERR_MULTIPLE_CALLBACK,Pl=Lt.ERR_TRANSFORM_ALREADY_TRANSFORMING,Dl=Lt.ERR_TRANSFORM_WITH_LENGTH_0;Xe(fe,Ze.Duplex);function Ol(t,e){var i=this._transformState;i.transforming=!1;var r=i.writecb;if(r===null)return this.emit("error",new Bl);i.writechunk=null,i.writecb=null,e!=null&&this.push(e),r(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function fe(t){if(!(this instanceof fe))return new fe(t);Ze.Duplex.call(this,t),this._transformState={afterTransform:Ol.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Ul)}function Ul(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,i){Nr(t,e,i)}):Nr(this,null,null)}fe.prototype.push=function(t,e){return this._transformState.needTransform=!1,Ze.Duplex.prototype.push.call(this,t,e)};fe.prototype._transform=function(t,e,i){i(new Nl("_transform()"))};fe.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}};fe.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};fe.prototype._destroy=function(t,e){Ze.Duplex.prototype._destroy.call(this,t,function(i){e(i)})};function Nr(t,e,i){if(e)return t.emit("error",e);if(i!=null&&t.push(i),t._writableState.length)throw new Dl;if(t._transformState.transforming)throw new Pl;return t.push(null)}const As=Oe;As.PassThrough=Ye;Xe(Ye,As.Transform);function Ye(t){if(!(this instanceof Ye))return new Ye(t);Transform.call(this,t)}Ye.prototype._transform=function(t,e,i){i(null,t)};var ti;function zl(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Ss=Se.codes,Hl=Ss.ERR_MISSING_ARGS,ql=Ss.ERR_STREAM_DESTROYED;function Br(t){if(t)throw t}function Wl(t){return t.setHeader&&typeof t.abort=="function"}function jl(t,e,i,r){r=zl(r);var n=!1;t.on("close",function(){n=!0}),ti===void 0&&(ti=Ui),ti(t,{readable:e,writable:i},function(o){if(o)return r(o);n=!0,r()});var s=!1;return function(o){if(!n&&!s){if(s=!0,Wl(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(o||new ql("pipe"))}}}function Pr(t){t()}function $l(t,e){return t.pipe(e)}function Yl(t){return!t.length||typeof t[t.length-1]!="function"?Br:t.pop()}function Gl(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=Yl(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Hl("streams");var n,s=e.map(function(o,a){var u=a<e.length-1,c=a>0;return jl(o,u,c,function(p){n||(n=p),p&&s.forEach(Pr),!u&&(s.forEach(Pr),r(n))})});return e.reduce($l)}var Vl=Gl;(function(t,e){const i=Oe;e=t.exports=i.Readable,e.Stream=i.Readable,e.Readable=i.Readable,e.Writable=i.Writable,e.Duplex=i.Duplex,e.Transform=i.Transform,e.PassThrough=i.PassThrough,e.finished=Ui,e.pipeline=Vl})(vi,vi.exports);var Xl=vi.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Dr;var Ql=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:self):t=>(Dr||(Dr=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function Or(t,e){for(const i in e)Object.defineProperty(t,i,{value:e[i],enumerable:!0,configurable:!0});return t}function Kl(t,e,i){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");i||(i={}),typeof e=="object"&&(i=e,e=""),e&&(i.code=e);try{return Or(t,i)}catch{i.message=t.message,i.stack=t.stack;const n=function(){};return n.prototype=Object.create(Object.getPrototypeOf(t)),Or(new n,i)}}var Zl=Kl;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Jl=ra("simple-peer"),Ts=na,Ur=ua,eh=Xl,ii=Ql,B=Zl,{Buffer:th}=Ae,ri=64*1024,ih=5*1e3,rh=5*1e3;function zr(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function nh(t){console.warn(t)}class Re extends eh.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Ur(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Ur(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Re.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Re.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||ih,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Ts(),!this._wrtc)throw B(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(i){this.destroy(B(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.destroy(B(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this.streams&&this.streams.forEach(i=>{this.addStream(i)}),this._pc.ontrack=i=>{this._onTrack(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.destroy(B(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(B(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?nh("Ignoring unsupported ICE candidate."):this.destroy(B(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,i){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,i),this._needsNegotiation()}catch(r){this.destroy(B(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:i}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(i=>{this.addTrack(i,e)})}}addTrack(e,i){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let n=r.get(i);if(!n)n=this._pc.addTrack(e,i),r.set(i,n),this._senderMap.set(e,r),this._needsNegotiation();else throw n.removed?B(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):B(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,i,r){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const n=this._senderMap.get(e),s=n?n.get(r):null;if(!s)throw B(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");i&&this._senderMap.set(i,n),s.replaceTrack!=null?s.replaceTrack(i):this.destroy(B(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,i){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),n=r?r.get(i):null;if(!n)throw B(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(B(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(i=>{this.removeTrack(i,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,ii(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,i){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),ii(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),i()}))}_setupData(e){if(!e.channel)return this.destroy(B(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ri),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const n=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(B(n,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},rh)}_read(){}_write(e,i,r){if(this.destroyed)return r(B(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy(B(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ri?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=zr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=s=>{this.destroy(B(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=zr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=s=>{this.destroy(B(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(B(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(B(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(B(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const n=[];r.forEach(s=>{n.push(i(s))}),e(null,n)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const n=[];r.result().forEach(s=>{const o={};s.names().forEach(a=>{o[a]=s.stat(a)}),o.id=s.id,o.type=s.type,o.timestamp=s.timestamp,n.push(i(o))}),e(null,n)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((i,r)=>{if(this.destroyed)return;i&&(r=[]);const n={},s={},o={};let a=!1;r.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(n[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(s[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(o[c.id]=c)});const u=c=>{a=!0;let p=s[c.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof c.googLocalAddress=="string"&&(p=c.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=n[c.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof c.googRemoteAddress=="string"&&(d=c.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&u(o[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&u(c)}),!a&&(!Object.keys(o).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.destroy(B(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ri||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer&&(i=th.from(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(i=>{this._debug("on track"),this.emit("track",e.track,i),this._remoteTracks.push({track:e.track,stream:i}),!this._remoteStreams.some(r=>r.id===i.id)&&(this._remoteStreams.push(i),ii(()=>{this._debug("on stream"),this.emit("stream",i)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Jl.apply(null,e)}}Re.WEBRTC_SUPPORT=!!Ts();Re.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Re.channelConfig={};var sh=Re;const Hr=Pi(sh);var ne=(t=>(t[t.AHOY=0]="AHOY",t[t.CONNECTION_INITIATION=1]="CONNECTION_INITIATION",t[t.RELAY_SIGNAL=2]="RELAY_SIGNAL",t[t.SIGNAL=3]="SIGNAL",t[t.CONNECTION_COUNT_CHECK=4]="CONNECTION_COUNT_CHECK",t[t.UPLOAD=5]="UPLOAD",t[t.UPLOAD_RESPONSE=6]="UPLOAD_RESPONSE",t[t.DOWNLOAD=7]="DOWNLOAD",t[t.DOWNLOAD_RESPONSE=8]="DOWNLOAD_RESPONSE",t[t.REDIRECTION=9]="REDIRECTION",t[t.REPORT=10]="REPORT",t))(ne||{});let nt;const oh=new Uint8Array(16);function ah(){if(!nt&&(nt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!nt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return nt(oh)}const lh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Et(t){return typeof t=="string"&&lh.test(t)}const te=[];for(let t=0;t<256;++t)te.push((t+256).toString(16).slice(1));function Fs(t,e=0){return te[t[e+0]]+te[t[e+1]]+te[t[e+2]]+te[t[e+3]]+"-"+te[t[e+4]]+te[t[e+5]]+"-"+te[t[e+6]]+te[t[e+7]]+"-"+te[t[e+8]]+te[t[e+9]]+"-"+te[t[e+10]]+te[t[e+11]]+te[t[e+12]]+te[t[e+13]]+te[t[e+14]]+te[t[e+15]]}function qr(t,e=0){const i=Fs(t,e);if(!Et(i))throw TypeError("Stringified UUID is invalid");return i}function Wr(t){if(!Et(t))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}const hh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),jr={randomUUID:hh};function $r(t,e,i){if(jr.randomUUID&&!e&&!t)return jr.randomUUID();t=t||{};const r=t.random||(t.rng||ah)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){i=i||0;for(let n=0;n<16;++n)e[i+n]=r[n];return e}return Fs(r)}var Ms={};/**
 * @license MIT
 * @copyright 2020 Eyas Ranjous <eyas.ranjous@gmail.com>
 *
 * @class
 */let uh=class Ri{constructor(e){this._elements=Array.isArray(e)?e:[],this._offset=0}enqueue(e){return this._elements.push(e),this}push(e){return this.enqueue(e)}dequeue(){if(this.size()===0)return null;const e=this.front();return this._offset+=1,this._offset*2<this._elements.length||(this._elements=this._elements.slice(this._offset),this._offset=0),e}pop(){return this.dequeue()}front(){return this.size()>0?this._elements[this._offset]:null}back(){return this.size()>0?this._elements[this._elements.length-1]:null}size(){return this._elements.length-this._offset}isEmpty(){return this.size()===0}toArray(){return this._elements.slice(this._offset)}clear(){this._elements=[],this._offset=0}clone(){return new Ri(this._elements.slice(this._offset))}static fromArray(e){return new Ri(e)}};Ms.Queue=uh;const{Queue:ch}=Ms;var dh=ch;Xo.process=Jo;const Ai="wss://kollator.com";console.log({WS_URL:Ai});class fh{hub;ws;peers;signalingMap;signalingQueue;signalingInterval;id;bootstrapAttempts;uploadGaurdPromise;uploadGuardResolver;constructor(){this.peers=new Map,this.id=$r(),this.bootstrapAttempts=0,this.signalingQueue=new dh,this.signalingMap=new Map,this.signalingInterval=setInterval(()=>{let e=Date.now();for(;this.signalingQueue.size()&&e-this.signalingQueue.front().date>1e4;){const{id:i}=this.signalingQueue.pop();let r=this.signalingMap.get(i);r&&r.destroy(),this.signalingMap.delete(i)}},1e4)}validateSignalId(e,i){let r=qr(i);if(!Et(r))return console.warn(`signal initiator id ${r} is not valid relayer: ${e.id}`),!1;let n=qr(i,16);return Et(n)?r:(console.warn(`signal receiver id ${n} is not valid ${e.id}`),!1)}createPeer(e,i,r){console.log("createPeer");let n=this.validateSignalId(e,r);if(console.log({signalSenderId:n}),!n)return;let s=this.signalingMap.get(n);if(s){let a=JSON.parse(yr(r.slice(32)));console.log("peer exists, checking signal data",{signalData:a}),s.signal(a);return}i||console.log("initiating the connection with a signal answer"),s=new Hr({initiator:i,trickle:!0}),s.id=n,this.signalingMap.set(s.id,s),s.on("signal",a=>{console.log(`current peer id is ${this.id}, relaying through ${e.id} to signal ${n}`),e.send(it(ne.RELAY_SIGNAL,Wr(this.id),Wr(n),JSON.stringify(a)))}),s.on("error",a=>{console.error("there was an error creating this peer",a)}),s.on("finish",a=>{console.log("FINISHED",a)}),s.on("connect",()=>{console.log("peer connect, sending ahoy"),s.send(it(ne.AHOY)),console.log(`finished peering webrtc connection, greeting ${s.id}`),this.signalingMap.delete(s.id),this.peers.set(s.id,s)}),s.on("data",a=>{switch(console.log("received data",ne[a[0]]),a[0]){case ne.AHOY:console.log("received ahoy"),this.finishPeering(s);break;case ne.RELAY_SIGNAL:break;case ne.SIGNAL:console.log("received signal request"),this.createPeer(s,!1,a.slice(1));break;case ne.UPLOAD_RESPONSE:s.uploadResolver&&s.uploadResolver(a.slice(1));break;case ne.DOWNLOAD_RESPONSE:s.downloadResolver&&s.downloadResolver(a.slice(1));break;default:return}});const o=JSON.parse(yr(r.slice(32)));return s.signal(o),s}async finishPeering(e){this.peers.set(e.id,e),this.signalingMap.delete(e.id),console.log("finished peering",e.id)}async handleRegister(e){console.log("handleregister"),e.success===!0?(console.log("success",{data:e}),this.hub=new Hr({initiator:!0,trickle:!0}),this.hub.id=e.id,this.hub.on("signal",i=>{if(console.log("onsignal",i),!this.ws||this.ws.readyState>1){console.log("ws isn't ready from peer onsignal");return}this.ws.send(JSON.stringify({reason:"signal",iceData:i}))}),this.hub.on("connect",()=>{console.log("onconnect"),this.ws?.readyState===WebSocket.OPEN&&this.ws?.send(JSON.stringify({reason:"ahoy"}))}),this.hub.on("data",i=>{switch(console.log("data type",typeof i),i[0]){case ne.AHOY:console.log("data reason"),this.finishBootstrap();break;case ne.RELAY_SIGNAL:break;case ne.SIGNAL:console.log("received signal request"),this.createPeer(this.hub,!1,i.slice(1));break;default:return}}),console.log("created peer, ")):(await Ho(1e3+2e3*(this.bootstrapAttempts-1)),this.bootstrapAttempts<5&&(this.id=$r(),this.bootstrapAttempts++,(!this.ws||this.ws.CLOSED||this.ws.CLOSING)&&(this.ws=this.bootstrap()),this.ws.send(JSON.stringify({reason:"register",id:this.id}))))}bootstrap(){console.log("bootstrapping");let e=new WebSocket(Ai);return console.log("after ws instantiation",Ai,e),window.ws=e,e.onclose=()=>{console.log("websocket closed")},e.onopen=()=>{console.log("opened websocket connection"),e.send(JSON.stringify({reason:"register",id:this.id})),this.bootstrapAttempts++},e.onmessage=({data:i}=ev)=>{console.log({data:i});let r=JSON.parse(i);switch(r.reason){case"register":this.handleRegister(r);break;case"signal":this.handleSignal(r);break;default:return}},console.log("after creation of websocket in bootstrap"),e}async handleSignal(e){console.log("handleSignal",{data:e}),this.hub.signal(e.iceData)}finishBootstrap(){this.ws?.close(),console.log("finished bootstrapping webrtc connection, greeting")}test(){}setUploading(e){return this.uploadGaurdPromise=new Promise(i=>{this.uploadGuardResolver=i}),e.uploadPromise=new Promise(i=>{e.uploadResolver=i}).finally(()=>{this.uploadGuardResolver&&(this.uploadGuardResolver(null),this.uploadGuardResolver=void 0)}),e.uploadPromise}setDownloading(e){e.downloadPromise=new Promise(i=>{e.downloadResolver=i})}async upload(e,i){let r=this.peers.values().next()?.value;if(!r||r.destroyed)throw Error("No peers to upload to");let n=this.setUploading(r);return console.log("peer sending hash:",e),console.log("binary encoding of upload data:",it(ne.UPLOAD,i)),r.send(it(ne.UPLOAD,e,i)),n}}window.signalingData=[];let Ge=new fh;window.comms=Ge;const ph=["stagedFiles","importingFile","importedFile","deletedFile","uploadingFile","uploadedFile","remotelyDeletedFile","reportedFile","filererror"];class gh{events;db;initPromise;initResolver;worker;clock;constructor(){this.events=new Map,this.clock,ph.forEach(e=>this.events.set(e,new Event(e)))}async init(e){this.worker=e,this.initPromise=new Promise(o=>{this.initResolver=o});let r=await(await navigator.storage.getDirectory()).getFileHandle("kollatorDb",{create:!0}),s=await(await r.getFile()).text();try{this.db=JSON.parse(s);let o=this.db.files;this.db.files=new Map,o.forEach(([a,u])=>this.db.files.set(a,u))}catch{this.db={handle:r,files:new Map,name:"Anon",email:"anon@kollator.com",password:"password123lol",provider:"email"}}this.db||(this.db={handle:r,files:new Map,name:"Anon",email:"anon@kollator.com",password:"password123lol",provider:"email"}),this.db.handle=r,await this.save(),this.initResolver()}dispatch(e){window.dispatchEvent(this.events.get(e))}async load(){}async unload(){}async save(){const e=await this.db.handle.createWritable();await e.write(JSON.stringify({...this.db,files:Array.from(this.db.files.entries())})),await e.close()}async importFile(e,i){this.clock||(this.clock=Date.now());const r=await navigator.storage.getDirectory(),n=i?await r.getDirectoryHandle(i):r;let s=await this.worker.processFile(e,n),o=Date.now()-this.clock;console.log("elapsed time:",o,"bytes:",e.size),console.log({metaData:s}),this.db.files.set(s.hash,s),await this.save(),this.dispatch("importedFile"),await this.uploadFile(s.hash)}async uploadFile(e){console.log({fileHash:e});const i=await navigator.storage.getDirectory(),n=await(await i.getFileHandle(e+"torrent")).getFile(),o=await(await i.getFileHandle(e)).getFile(),a=5*1024**2;let u=new Uint8Array(await n.arrayBuffer()),c=await n.text();const p=JSON.parse(c);console.log("filestoreupload",{metadata:p,metadataBytes:u});let d=await crypto.subtle.digest("SHA-256",u),_=_r(new Uint8Array(d));const m=await $o(p.info.key),w=jn(p.info.iv);this.dispatch("uploadingFile");for await(const x of await this.worker.encryptFileForUpload(n,a,[_],m,w)){let R=await crypto.subtle.digest("SHA-256",x);if(console.log("uploading chunkHash:",_r(new Uint8Array(R)),R.byteLength),!(await Ge.upload(new Uint8Array(R),x))[0]){this.dispatch("error"),console.error("couldn't upload the metadata file");return}}let b=Object.values(p.info.layers)[0].hashes,E=0,y=w.slice();Yo(y);for await(const x of await this.worker.encryptFileForUpload(o,a,b,m,y)){let R=await crypto.subtle.digest("SHA-256",x);(await Ge.upload(new Uint8Array(R),x.length,x))[0]||console.error(`upload of file ${o.name} failed, chunk index: ${E}`)}this.dispatch("uploadedFile")}async exportFile(e){try{let i=await navigator.storage.getDirectory();const r=await this.db.files.get(e)?.hash??"";let s=await(await i.getFileHandle(r,{create:!1})).getFile(),o=this.db.files.get(e);console.log({file:s});const a=new Blob([await s.arrayBuffer()],{type:s.type}),u=URL.createObjectURL(a),c=document.createElement("a");c.href=u,c.download=o?.name,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(u)}catch(i){console.error(i),this.dispatch("error")}}}const Ve=new gh,mh=()=>{const[t,e]=Mn(Array.from(Ve.db.files.values()));return Bi(()=>{const i=()=>{e(Array.from(Ve.db.files.values()))};return window.addEventListener("importedFile",i),()=>{window.removeEventListener("importedFile",i)}},[]),t};window.filer=Ve;function qe(t){let e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function Si(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _h(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Yr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Gr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function yh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function wh(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function ni(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function vh(t,e){let i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function bh(t,e){let i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Vr(t){let e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Eh(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function xh(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ti(t,e){let i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Is(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xr(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],u=i[2];return t[0]=n*u-s*a,t[1]=s*o-r*u,t[2]=r*a-n*o,t}function Ch(t,e,i,r){let n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function Rh(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/o,t[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/o,t[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/o,t}function Ah(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*s)/o,t[1]=(i[1]*r+i[5]*n+i[9]*s)/o,t[2]=(i[2]*r+i[6]*n+i[10]*s)/o,t}function Sh(t,e,i){let r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function Th(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],u=i[2],c=i[3],p=a*s-u*n,d=u*r-o*s,_=o*n-a*r,m=a*_-u*d,w=u*p-o*_,b=o*d-a*p,E=c*2;return p*=E,d*=E,_*=E,m*=2,w*=2,b*=2,t[0]=r+p+m,t[1]=n+d+w,t[2]=s+_+b,t}const Fh=function(){const t=[0,0,0],e=[0,0,0];return function(i,r){Si(t,i),Si(e,r),Ti(t,t),Ti(e,e);let n=Is(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();function Mh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class K extends Array{constructor(e=0,i=e,r=e){return super(e,i,r),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,i=e,r=e){return e.length?this.copy(e):(_h(this,e,i,r),this)}copy(e){return Si(this,e),this}add(e,i){return i?Yr(this,e,i):Yr(this,this,e),this}sub(e,i){return i?Gr(this,e,i):Gr(this,this,e),this}multiply(e){return e.length?yh(this,this,e):ni(this,this,e),this}divide(e){return e.length?wh(this,this,e):ni(this,this,1/e),this}inverse(e=this){return xh(this,e),this}len(){return qe(this)}distance(e){return e?vh(this,e):qe(this)}squaredLen(){return Vr(this)}squaredDistance(e){return e?bh(this,e):Vr(this)}negate(e=this){return Eh(this,e),this}cross(e,i){return i?Xr(this,e,i):Xr(this,this,e),this}scale(e){return ni(this,this,e),this}normalize(){return Ti(this,this),this}dot(e){return Is(this,e)}equals(e){return Mh(this,e)}applyMatrix3(e){return Sh(this,this,e),this}applyMatrix4(e){return Rh(this,this,e),this}scaleRotateMatrix4(e){return Ah(this,this,e),this}applyQuaternion(e){return Th(this,this,e),this}angle(e){return Fh(this,e)}lerp(e,i){return Ch(this,this,e,i),this}clone(){return new K(this[0],this[1],this[2])}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this[2]=e[i+2],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e}transformDirection(e){const i=this[0],r=this[1],n=this[2];return this[0]=e[0]*i+e[4]*r+e[8]*n,this[1]=e[1]*i+e[5]*r+e[9]*n,this[2]=e[2]*i+e[6]*r+e[10]*n,this.normalize()}}const Qr=new K;let Ih=1,kh=1,Kr=!1;class Lh{constructor(e,i={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=i,this.id=Ih++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let r in i)this.addAttribute(r,i[r])}addAttribute(e,i){if(this.attributes[e]=i,i.id=kh++,i.size=i.size||1,i.type=i.type||(i.data.constructor===Float32Array?this.gl.FLOAT:i.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),i.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,i.normalized=i.normalized||!1,i.stride=i.stride||0,i.offset=i.offset||0,i.count=i.count||(i.stride?i.data.byteLength/i.stride:i.data.length/i.size),i.divisor=i.instanced||0,i.needsUpdate=!1,i.usage=i.usage||this.gl.STATIC_DRAW,i.buffer||this.updateAttribute(i),i.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==i.count*i.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,i.count*i.divisor);this.instancedCount=i.count*i.divisor}else e==="index"?this.drawRange.count=i.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,i.count))}updateAttribute(e){const i=!e.buffer;i&&(e.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),i?this.gl.bufferData(e.target,e.data,e.usage):this.gl.bufferSubData(e.target,0,e.data),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((i,{name:r,type:n})=>{if(!this.attributes[r]){console.warn(`active attribute ${r} not being supplied`);return}const s=this.attributes[r];this.gl.bindBuffer(s.target,s.buffer),this.glState.boundBuffer=s.buffer;let o=1;n===35674&&(o=2),n===35675&&(o=3),n===35676&&(o=4);const a=s.size/o,u=o===1?0:o*o*4,c=o===1?0:o*4;for(let p=0;p<o;p++)this.gl.vertexAttribPointer(i+p,a,s.type,s.normalized,s.stride+u,s.offset+p*c),this.gl.enableVertexAttribArray(i+p),this.gl.renderer.vertexAttribDivisor(i+p,s.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:i=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((n,{name:s})=>{const o=this.attributes[s];o.needsUpdate&&this.updateAttribute(o)});let r=2;this.attributes.index?.type===this.gl.UNSIGNED_INT&&(r=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r,this.instancedCount):this.gl.renderer.drawArraysInstanced(i,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r):this.gl.drawArrays(i,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;if(e.data)return e;if(!Kr)return console.warn("No position buffer data found to compute bounds"),Kr=!0}computeBoundingBox(e){e||(e=this.getPosition());const i=e.data,r=e.size;this.bounds||(this.bounds={min:new K,max:new K,center:new K,scale:new K,radius:1/0});const n=this.bounds.min,s=this.bounds.max,o=this.bounds.center,a=this.bounds.scale;n.set(1/0),s.set(-1/0);for(let u=0,c=i.length;u<c;u+=r){const p=i[u],d=i[u+1],_=i[u+2];n.x=Math.min(p,n.x),n.y=Math.min(d,n.y),n.z=Math.min(_,n.z),s.x=Math.max(p,s.x),s.y=Math.max(d,s.y),s.z=Math.max(_,s.z)}a.sub(s,n),o.add(n,s).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const i=e.data,r=e.size;this.bounds||this.computeBoundingBox(e);let n=0;for(let s=0,o=i.length;s<o;s+=r)Qr.fromArray(i,s),n=Math.max(n,this.bounds.center.squaredDistance(Qr));this.bounds.radius=Math.sqrt(n)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let Nh=1;const Zr={};class Bh{constructor(e,{vertex:i,fragment:r,uniforms:n={},transparent:s=!1,cullFace:o=e.BACK,frontFace:a=e.CCW,depthTest:u=!0,depthWrite:c=!0,depthFunc:p=e.LEQUAL}={}){e.canvas||console.error("gl not passed as first argument to Program"),this.gl=e,this.uniforms=n,this.id=Nh++,i||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=o,this.frontFace=a,this.depthTest=u,this.depthWrite=c,this.depthFunc=p,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=e.createShader(e.VERTEX_SHADER),this.fragmentShader=e.createShader(e.FRAGMENT_SHADER),this.program=e.createProgram(),e.attachShader(this.program,this.vertexShader),e.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:i,fragment:r})}setShaders({vertex:e,fragment:i}){if(e&&(this.gl.shaderSource(this.vertexShader,e),this.gl.compileShader(this.vertexShader),this.gl.getShaderInfoLog(this.vertexShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}
Vertex Shader
${Jr(e)}`)),i&&(this.gl.shaderSource(this.fragmentShader,i),this.gl.compileShader(this.fragmentShader),this.gl.getShaderInfoLog(this.fragmentShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}
Fragment Shader
${Jr(i)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let r=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){let a=this.gl.getActiveUniform(this.program,o);this.uniformLocations.set(a,this.gl.getUniformLocation(this.program,a.name));const u=a.name.match(/(\w+)/g);a.uniformName=u[0],a.nameComponents=u.slice(1)}this.attributeLocations=new Map;const n=[],s=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let o=0;o<s;o++){const a=this.gl.getActiveAttrib(this.program,o),u=this.gl.getAttribLocation(this.program,a.name);u!==-1&&(n[u]=a.name,this.attributeLocations.set(a,u))}this.attributeOrder=n.join("")}setBlendFunc(e,i,r,n){this.blendFunc.src=e,this.blendFunc.dst=i,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=n,e&&(this.transparent=!0)}setBlendEquation(e,i){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=i}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let i=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((n,s)=>{let o=this.uniforms[s.uniformName];for(const a of s.nameComponents){if(!o)break;if(a in o)o=o[a];else{if(Array.isArray(o.value))break;o=void 0;break}}if(!o)return en(`Active uniform ${s.name} has not been supplied`);if(o&&o.value===void 0)return en(`${s.name} uniform is missing a value parameter`);if(o.value.texture)return i=i+1,o.value.update(i),si(this.gl,s.type,n,i);if(o.value.length&&o.value[0].texture){const a=[];return o.value.forEach(u=>{i=i+1,u.update(i),a.push(i)}),si(this.gl,s.type,n,a)}si(this.gl,s.type,n,o.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function si(t,e,i,r){r=r.length?Ph(r):r;const n=t.renderer.state.uniformLocations.get(i);if(r.length)if(n===void 0||n.length!==r.length)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(Dh(n,r))return;n.set?n.set(r):Oh(n,r),t.renderer.state.uniformLocations.set(i,n)}else{if(n===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function Jr(t){let e=t.split(`
`);for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join(`
`)}function Ph(t){const e=t.length,i=t[0].length;if(i===void 0)return t;const r=e*i;let n=Zr[r];n||(Zr[r]=n=new Float32Array(r));for(let s=0;s<e;s++)n.set(t[s],s*i);return n}function Dh(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function Oh(t,e){for(let i=0,r=t.length;i<r;i++)t[i]=e[i]}let oi=0;function en(t){oi>100||(console.warn(t),oi++,oi>100&&console.warn("More than 100 program warnings - stopping logs."))}const ai=new K;let Uh=1;class zh{constructor({canvas:e=document.createElement("canvas"),width:i=300,height:r=150,dpr:n=1,alpha:s=!1,depth:o=!0,stencil:a=!1,antialias:u=!1,premultipliedAlpha:c=!1,preserveDrawingBuffer:p=!1,powerPreference:d="default",autoClear:_=!0,webgl:m=2}={}){const w={alpha:s,depth:o,stencil:a,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:p,powerPreference:d};this.dpr=n,this.alpha=s,this.color=!0,this.depth=o,this.stencil=a,this.premultipliedAlpha=c,this.autoClear=_,this.id=Uh++,m===2&&(this.gl=e.getContext("webgl2",w)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",w)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(i,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,i){this.width=e,this.height=i,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=i*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:e+"px",height:i+"px"})}setViewport(e,i,r=0,n=0){this.state.viewport.width===e&&this.state.viewport.height===i||(this.state.viewport.width=e,this.state.viewport.height=i,this.state.viewport.x=r,this.state.viewport.y=n,this.gl.viewport(r,n,e,i))}setScissor(e,i,r=0,n=0){this.gl.scissor(r,n,e,i)}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,i,r,n){this.state.blendFunc.src===e&&this.state.blendFunc.dst===i&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===n||(this.state.blendFunc.src=e,this.state.blendFunc.dst=i,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=n,r!==void 0?this.gl.blendFuncSeparate(e,i,r,n):this.gl.blendFunc(e,i))}setBlendEquation(e,i){e=e||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===i)&&(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=i,i!==void 0?this.gl.blendEquationSeparate(e,i):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:i=null}={}){this.state.framebuffer!==i&&(this.state.framebuffer=i,this.gl.bindFramebuffer(e,i))}getExtension(e,i,r){return i&&this.gl[i]?this.gl[i].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),i?this.extensions[e]?this.extensions[e][r].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.program.id!==i.program.id?e.program.id-i.program.id:e.zDepth!==i.zDepth?e.zDepth-i.zDepth:i.id-e.id}sortTransparent(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.zDepth!==i.zDepth?i.zDepth-e.zDepth:i.id-e.id}sortUI(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.program.id!==i.program.id?e.program.id-i.program.id:i.id-e.id}getRenderList({scene:e,camera:i,frustumCull:r,sort:n}){let s=[];if(i&&r&&i.updateFrustum(),e.traverse(o=>{if(!o.visible)return!0;o.draw&&(r&&o.frustumCulled&&i&&!i.frustumIntersectsMesh(o)||s.push(o))}),n){const o=[],a=[],u=[];s.forEach(c=>{c.program.transparent?c.program.depthTest?a.push(c):u.push(c):o.push(c),c.zDepth=0,!(c.renderOrder!==0||!c.program.depthTest||!i)&&(c.worldMatrix.getTranslation(ai),ai.applyMatrix4(i.projectionViewMatrix),c.zDepth=ai.z)}),o.sort(this.sortOpaque),a.sort(this.sortTransparent),u.sort(this.sortUI),s=o.concat(a,u)}return s}render({scene:e,camera:i,target:r=null,update:n=!0,sort:s=!0,frustumCull:o=!0,clear:a}){r===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&a!==!1)&&(this.depth&&(!r||r.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),n&&e.updateMatrixWorld(),i&&i.updateMatrixWorld(),this.getRenderList({scene:e,camera:i,frustumCull:o,sort:s}).forEach(c=>{c.draw({camera:i})})}}function Hh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function qh(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Wh(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o,t}function jh(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function $h(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Yh(t,e,i){i=i*.5;let r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function tn(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],u=i[1],c=i[2],p=i[3];return t[0]=r*p+o*a+n*c-s*u,t[1]=n*p+o*u+s*a-r*c,t[2]=s*p+o*c+r*u-n*a,t[3]=o*p-r*a-n*u-s*c,t}function Gh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*a,t[1]=n*u+s*a,t[2]=s*u-n*a,t[3]=o*u-r*a,t}function Vh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u-s*a,t[1]=n*u+o*a,t[2]=s*u+r*a,t[3]=o*u-n*a,t}function Xh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*a,t[1]=n*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function Qh(t,e,i,r){let n=e[0],s=e[1],o=e[2],a=e[3],u=i[0],c=i[1],p=i[2],d=i[3],_,m,w,b,E;return m=n*u+s*c+o*p+a*d,m<0&&(m=-m,u=-u,c=-c,p=-p,d=-d),1-m>1e-6?(_=Math.acos(m),w=Math.sin(_),b=Math.sin((1-r)*_)/w,E=Math.sin(r*_)/w):(b=1-r,E=r),t[0]=b*n+E*u,t[1]=b*s+E*c,t[2]=b*o+E*p,t[3]=b*a+E*d,t}function Kh(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function Zh(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Jh(t,e){let i=e[0]+e[4]+e[8],r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[s*3+s]-e[o*3+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[s*3+o]-e[o*3+s])*r,t[s]=(e[s*3+n]+e[n*3+s])*r,t[o]=(e[o*3+n]+e[n*3+o])*r}return t}function eu(t,e,i="YXZ"){let r=Math.sin(e[0]*.5),n=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),a=Math.sin(e[2]*.5),u=Math.cos(e[2]*.5);return i==="XYZ"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u-r*s*a):i==="YXZ"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u+r*s*a):i==="ZXY"?(t[0]=r*o*u-n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u-r*s*a):i==="ZYX"?(t[0]=r*o*u-n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u+r*s*a):i==="YZX"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u-r*s*a):i==="XZY"&&(t[0]=r*o*u-n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u+r*s*a),t}const tu=Hh,iu=qh,ru=jh,nu=Wh;class su extends Array{constructor(e=0,i=0,r=0,n=1){super(e,i,r,n),this.onChange=()=>{},this._target=this;const s=["0","1","2","3"];return new Proxy(this,{set(o,a){const u=Reflect.set(...arguments);return u&&s.includes(a)&&o.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set w(e){this._target[3]=e,this.onChange()}identity(){return $h(this._target),this.onChange(),this}set(e,i,r,n){return e.length?this.copy(e):(iu(this._target,e,i,r,n),this.onChange(),this)}rotateX(e){return Gh(this._target,this._target,e),this.onChange(),this}rotateY(e){return Vh(this._target,this._target,e),this.onChange(),this}rotateZ(e){return Xh(this._target,this._target,e),this.onChange(),this}inverse(e=this._target){return Kh(this._target,e),this.onChange(),this}conjugate(e=this._target){return Zh(this._target,e),this.onChange(),this}copy(e){return tu(this._target,e),this.onChange(),this}normalize(e=this._target){return nu(this._target,e),this.onChange(),this}multiply(e,i){return i?tn(this._target,e,i):tn(this._target,this._target,e),this.onChange(),this}dot(e){return ru(this._target,e)}fromMatrix3(e){return Jh(this._target,e),this.onChange(),this}fromEuler(e,i){return eu(this._target,e,e.order),i||this.onChange(),this}fromAxisAngle(e,i){return Yh(this._target,e,i),this.onChange(),this}slerp(e,i){return Qh(this._target,this._target,e,i),this.onChange(),this}fromArray(e,i=0){return this._target[0]=e[i],this._target[1]=e[i+1],this._target[2]=e[i+2],this._target[3]=e[i+3],this.onChange(),this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e[i+3]=this[3],e}}const ou=1e-6;function au(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lu(t,e,i,r,n,s,o,a,u,c,p,d,_,m,w,b,E){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t[9]=p,t[10]=d,t[11]=_,t[12]=m,t[13]=w,t[14]=b,t[15]=E,t}function hu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=e[9],_=e[10],m=e[11],w=e[12],b=e[13],E=e[14],y=e[15],x=i*a-r*o,R=i*u-n*o,S=i*c-s*o,T=r*u-n*a,M=r*c-s*a,k=n*c-s*u,O=p*b-d*w,P=p*E-_*w,H=p*y-m*w,Z=d*E-_*b,G=d*y-m*b,J=_*y-m*E,I=x*J-R*G+S*Z+T*H-M*P+k*O;return I?(I=1/I,t[0]=(a*J-u*G+c*Z)*I,t[1]=(n*G-r*J-s*Z)*I,t[2]=(b*k-E*M+y*T)*I,t[3]=(_*M-d*k-m*T)*I,t[4]=(u*H-o*J-c*P)*I,t[5]=(i*J-n*H+s*P)*I,t[6]=(E*S-w*k-y*R)*I,t[7]=(p*k-_*S+m*R)*I,t[8]=(o*G-a*H+c*O)*I,t[9]=(r*H-i*G-s*O)*I,t[10]=(w*M-b*S+y*x)*I,t[11]=(d*S-p*M-m*x)*I,t[12]=(a*P-o*Z-u*O)*I,t[13]=(i*Z-r*P+n*O)*I,t[14]=(b*R-w*T-E*x)*I,t[15]=(p*T-d*R+_*x)*I,t):null}function ks(t){let e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],p=t[9],d=t[10],_=t[11],m=t[12],w=t[13],b=t[14],E=t[15],y=e*o-i*s,x=e*a-r*s,R=e*u-n*s,S=i*a-r*o,T=i*u-n*o,M=r*u-n*a,k=c*w-p*m,O=c*b-d*m,P=c*E-_*m,H=p*b-d*w,Z=p*E-_*w,G=d*E-_*b;return y*G-x*Z+R*H+S*P-T*O+M*k}function rn(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],_=e[9],m=e[10],w=e[11],b=e[12],E=e[13],y=e[14],x=e[15],R=i[0],S=i[1],T=i[2],M=i[3];return t[0]=R*r+S*a+T*d+M*b,t[1]=R*n+S*u+T*_+M*E,t[2]=R*s+S*c+T*m+M*y,t[3]=R*o+S*p+T*w+M*x,R=i[4],S=i[5],T=i[6],M=i[7],t[4]=R*r+S*a+T*d+M*b,t[5]=R*n+S*u+T*_+M*E,t[6]=R*s+S*c+T*m+M*y,t[7]=R*o+S*p+T*w+M*x,R=i[8],S=i[9],T=i[10],M=i[11],t[8]=R*r+S*a+T*d+M*b,t[9]=R*n+S*u+T*_+M*E,t[10]=R*s+S*c+T*m+M*y,t[11]=R*o+S*p+T*w+M*x,R=i[12],S=i[13],T=i[14],M=i[15],t[12]=R*r+S*a+T*d+M*b,t[13]=R*n+S*u+T*_+M*E,t[14]=R*s+S*c+T*m+M*y,t[15]=R*o+S*p+T*w+M*x,t}function cu(t,e,i){let r=i[0],n=i[1],s=i[2],o,a,u,c,p,d,_,m,w,b,E,y;return e===t?(t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15]):(o=e[0],a=e[1],u=e[2],c=e[3],p=e[4],d=e[5],_=e[6],m=e[7],w=e[8],b=e[9],E=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=u,t[3]=c,t[4]=p,t[5]=d,t[6]=_,t[7]=m,t[8]=w,t[9]=b,t[10]=E,t[11]=y,t[12]=o*r+p*n+w*s+e[12],t[13]=a*r+d*n+b*s+e[13],t[14]=u*r+_*n+E*s+e[14],t[15]=c*r+m*n+y*s+e[15]),t}function du(t,e,i){let r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fu(t,e,i,r){let n=r[0],s=r[1],o=r[2],a=Math.hypot(n,s,o),u,c,p,d,_,m,w,b,E,y,x,R,S,T,M,k,O,P,H,Z,G,J,I,ge;return Math.abs(a)<ou?null:(a=1/a,n*=a,s*=a,o*=a,u=Math.sin(i),c=Math.cos(i),p=1-c,d=e[0],_=e[1],m=e[2],w=e[3],b=e[4],E=e[5],y=e[6],x=e[7],R=e[8],S=e[9],T=e[10],M=e[11],k=n*n*p+c,O=s*n*p+o*u,P=o*n*p-s*u,H=n*s*p-o*u,Z=s*s*p+c,G=o*s*p+n*u,J=n*o*p+s*u,I=s*o*p-n*u,ge=o*o*p+c,t[0]=d*k+b*O+R*P,t[1]=_*k+E*O+S*P,t[2]=m*k+y*O+T*P,t[3]=w*k+x*O+M*P,t[4]=d*H+b*Z+R*G,t[5]=_*H+E*Z+S*G,t[6]=m*H+y*Z+T*G,t[7]=w*H+x*Z+M*G,t[8]=d*J+b*I+R*ge,t[9]=_*J+E*I+S*ge,t[10]=m*J+y*I+T*ge,t[11]=w*J+x*I+M*ge,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function pu(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ls(t,e){let i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],p=e[10];return t[0]=Math.hypot(i,r,n),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,p),t}function gu(t){let e=t[0],i=t[1],r=t[2],n=t[4],s=t[5],o=t[6],a=t[8],u=t[9],c=t[10];const p=e*e+i*i+r*r,d=n*n+s*s+o*o,_=a*a+u*u+c*c;return Math.sqrt(Math.max(p,d,_))}const Ns=function(){const t=[1,1,1];return function(e,i){let r=t;Ls(r,i);let n=1/r[0],s=1/r[1],o=1/r[2],a=i[0]*n,u=i[1]*s,c=i[2]*o,p=i[4]*n,d=i[5]*s,_=i[6]*o,m=i[8]*n,w=i[9]*s,b=i[10]*o,E=a+d+b,y=0;return E>0?(y=Math.sqrt(E+1)*2,e[3]=.25*y,e[0]=(_-w)/y,e[1]=(m-c)/y,e[2]=(u-p)/y):a>d&&a>b?(y=Math.sqrt(1+a-d-b)*2,e[3]=(_-w)/y,e[0]=.25*y,e[1]=(u+p)/y,e[2]=(m+c)/y):d>b?(y=Math.sqrt(1+d-a-b)*2,e[3]=(m-c)/y,e[0]=(u+p)/y,e[1]=.25*y,e[2]=(_+w)/y):(y=Math.sqrt(1+b-a-d)*2,e[3]=(u-p)/y,e[0]=(m+c)/y,e[1]=(_+w)/y,e[2]=.25*y),e}}();function mu(t,e,i,r){let n=qe([t[0],t[1],t[2]]);const s=qe([t[4],t[5],t[6]]),o=qe([t[8],t[9],t[10]]);ks(t)<0&&(n=-n),i[0]=t[12],i[1]=t[13],i[2]=t[14];const u=t.slice(),c=1/n,p=1/s,d=1/o;u[0]*=c,u[1]*=c,u[2]*=c,u[4]*=p,u[5]*=p,u[6]*=p,u[8]*=d,u[9]*=d,u[10]*=d,Ns(e,u),r[0]=n,r[1]=s,r[2]=o}function _u(t,e,i,r){const n=t,s=e[0],o=e[1],a=e[2],u=e[3],c=s+s,p=o+o,d=a+a,_=s*c,m=s*p,w=s*d,b=o*p,E=o*d,y=a*d,x=u*c,R=u*p,S=u*d,T=r[0],M=r[1],k=r[2];return n[0]=(1-(b+y))*T,n[1]=(m+S)*T,n[2]=(w-R)*T,n[3]=0,n[4]=(m-S)*M,n[5]=(1-(_+y))*M,n[6]=(E+x)*M,n[7]=0,n[8]=(w+R)*k,n[9]=(E-x)*k,n[10]=(1-(_+b))*k,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function yu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,u=n+n,c=i*o,p=r*o,d=r*a,_=n*o,m=n*a,w=n*u,b=s*o,E=s*a,y=s*u;return t[0]=1-d-w,t[1]=p+y,t[2]=_-E,t[3]=0,t[4]=p-y,t[5]=1-c-w,t[6]=m+b,t[7]=0,t[8]=_+E,t[9]=m-b,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wu(t,e,i,r,n){let s=1/Math.tan(e/2),o=1/(r-n);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*o,t[15]=0,t}function vu(t,e,i,r,n,s,o){let a=1/(e-i),u=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*u,t[14]=(o+s)*c,t[15]=1,t}function bu(t,e,i,r){let n=e[0],s=e[1],o=e[2],a=r[0],u=r[1],c=r[2],p=n-i[0],d=s-i[1],_=o-i[2],m=p*p+d*d+_*_;m===0?_=1:(m=1/Math.sqrt(m),p*=m,d*=m,_*=m);let w=u*_-c*d,b=c*p-a*_,E=a*d-u*p;return m=w*w+b*b+E*E,m===0&&(c?a+=1e-6:u?c+=1e-6:u+=1e-6,w=u*_-c*d,b=c*p-a*_,E=a*d-u*p,m=w*w+b*b+E*E),m=1/Math.sqrt(m),w*=m,b*=m,E*=m,t[0]=w,t[1]=b,t[2]=E,t[3]=0,t[4]=d*E-_*b,t[5]=_*w-p*E,t[6]=p*b-d*w,t[7]=0,t[8]=p,t[9]=d,t[10]=_,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function nn(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function sn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function Eu(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}class ye extends Array{constructor(e=1,i=0,r=0,n=0,s=0,o=1,a=0,u=0,c=0,p=0,d=1,_=0,m=0,w=0,b=0,E=1){return super(e,i,r,n,s,o,a,u,c,p,d,_,m,w,b,E),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,i,r,n,s,o,a,u,c,p,d,_,m,w,b,E){return e.length?this.copy(e):(lu(this,e,i,r,n,s,o,a,u,c,p,d,_,m,w,b,E),this)}translate(e,i=this){return cu(this,i,e),this}rotate(e,i,r=this){return fu(this,r,e,i),this}scale(e,i=this){return du(this,i,typeof e=="number"?[e,e,e]:e),this}add(e,i){return i?nn(this,e,i):nn(this,this,e),this}sub(e,i){return i?sn(this,e,i):sn(this,this,e),this}multiply(e,i){return e.length?i?rn(this,e,i):rn(this,this,e):Eu(this,this,e),this}identity(){return hu(this),this}copy(e){return au(this,e),this}fromPerspective({fov:e,aspect:i,near:r,far:n}={}){return wu(this,e,i,r,n),this}fromOrthogonal({left:e,right:i,bottom:r,top:n,near:s,far:o}){return vu(this,e,i,r,n,s,o),this}fromQuaternion(e){return yu(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return uu(this,e),this}compose(e,i,r){return _u(this,e,i,r),this}decompose(e,i,r){return mu(this,e,i,r),this}getRotation(e){return Ns(e,this),this}getTranslation(e){return pu(e,this),this}getScaling(e){return Ls(e,this),this}getMaxScaleOnAxis(){return gu(this)}lookAt(e,i,r){return bu(this,e,i,r),this}determinant(){return ks(this)}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this[2]=e[i+2],this[3]=e[i+3],this[4]=e[i+4],this[5]=e[i+5],this[6]=e[i+6],this[7]=e[i+7],this[8]=e[i+8],this[9]=e[i+9],this[10]=e[i+10],this[11]=e[i+11],this[12]=e[i+12],this[13]=e[i+13],this[14]=e[i+14],this[15]=e[i+15],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e[i+3]=this[3],e[i+4]=this[4],e[i+5]=this[5],e[i+6]=this[6],e[i+7]=this[7],e[i+8]=this[8],e[i+9]=this[9],e[i+10]=this[10],e[i+11]=this[11],e[i+12]=this[12],e[i+13]=this[13],e[i+14]=this[14],e[i+15]=this[15],e}}function xu(t,e,i="YXZ"){return i==="XYZ"?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):i==="YXZ"?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):i==="ZXY"?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):i==="ZYX"?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):i==="YZX"?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):i==="XZY"&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}const on=new ye;class Cu extends Array{constructor(e=0,i=e,r=e,n="YXZ"){super(e,i,r),this.order=n,this.onChange=()=>{},this._target=this;const s=["0","1","2"];return new Proxy(this,{set(o,a){const u=Reflect.set(...arguments);return u&&s.includes(a)&&o.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set(e,i=e,r=e){return e.length?this.copy(e):(this._target[0]=e,this._target[1]=i,this._target[2]=r,this.onChange(),this)}copy(e){return this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.onChange(),this}reorder(e){return this._target.order=e,this.onChange(),this}fromRotationMatrix(e,i=this.order){return xu(this._target,e,i),this.onChange(),this}fromQuaternion(e,i=this.order,r){return on.fromQuaternion(e),this._target.fromRotationMatrix(on,i),r||this.onChange(),this}fromArray(e,i=0){return this._target[0]=e[i],this._target[1]=e[i+1],this._target[2]=e[i+2],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e}}let $i=class{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new ye,this.worldMatrix=new ye,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new K,this.quaternion=new su,this.scale=new K(1),this.rotation=new Cu,this.up=new K(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(e,i=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,i&&e&&e.addChild(this,!1)}addChild(e,i=!0){~this.children.indexOf(e)||this.children.push(e),i&&e.setParent(this,!1)}removeChild(e,i=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),i&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let i=0,r=this.children.length;i<r;i++)this.children[i].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let i=0,r=this.children.length;i<r;i++)this.children[i].traverse(e)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,i=!1){i?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}};const Ru=new ye,Au=new K,Su=new K;class Tu extends $i{constructor(e,{near:i=.1,far:r=100,fov:n=45,aspect:s=1,left:o,right:a,bottom:u,top:c,zoom:p=1}={}){super(),Object.assign(this,{near:i,far:r,fov:n,aspect:s,left:o,right:a,bottom:u,top:c,zoom:p}),this.projectionMatrix=new ye,this.viewMatrix=new ye,this.projectionViewMatrix=new ye,this.worldPosition=new K,this.type=o||a?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:e=this.near,far:i=this.far,fov:r=this.fov,aspect:n=this.aspect}={}){return Object.assign(this,{near:e,far:i,fov:r,aspect:n}),this.projectionMatrix.fromPerspective({fov:r*(Math.PI/180),aspect:n,near:e,far:i}),this.type="perspective",this}orthographic({near:e=this.near,far:i=this.far,left:r=this.left||-1,right:n=this.right||1,bottom:s=this.bottom||-1,top:o=this.top||1,zoom:a=this.zoom}={}){return Object.assign(this,{near:e,far:i,left:r,right:n,bottom:s,top:o,zoom:a}),r/=a,n/=a,s/=a,o/=a,this.projectionMatrix.fromOrthogonal({left:r,right:n,bottom:s,top:o,near:e,far:i}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(Ru.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new K,new K,new K,new K,new K,new K]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let i=0;i<6;i++){const r=1/this.frustum[i].distance();this.frustum[i].multiply(r),this.frustum[i].constant*=r}}frustumIntersectsMesh(e,i=e.worldMatrix){if(!e.geometry.attributes.position||((!e.geometry.bounds||e.geometry.bounds.radius===1/0)&&e.geometry.computeBoundingSphere(),!e.geometry.bounds))return!0;const r=Au;r.copy(e.geometry.bounds.center),r.applyMatrix4(i);const n=e.geometry.bounds.radius*i.getMaxScaleOnAxis();return this.frustumIntersectsSphere(r,n)}frustumIntersectsSphere(e,i){const r=Su;for(let n=0;n<6;n++){const s=this.frustum[n];if(r.copy(s).dot(e)+s.constant<-i)return!1}return!0}}function Fu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Mu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,u=n+n,c=i*o,p=r*o,d=r*a,_=n*o,m=n*a,w=n*u,b=s*o,E=s*a,y=s*u;return t[0]=1-d-w,t[3]=p-y,t[6]=_+E,t[1]=p+y,t[4]=1-c-w,t[7]=m-b,t[2]=_-E,t[5]=m+b,t[8]=1-c-d,t}function Iu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ku(t,e,i,r,n,s,o,a,u,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t}function Lu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Nu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=p*o-a*c,_=-p*s+a*u,m=c*s-o*u,w=i*d+r*_+n*m;return w?(w=1/w,t[0]=d*w,t[1]=(-p*r+n*c)*w,t[2]=(a*r-n*o)*w,t[3]=_*w,t[4]=(p*i-n*u)*w,t[5]=(-a*i+n*s)*w,t[6]=m*w,t[7]=(-c*i+r*u)*w,t[8]=(o*i-r*s)*w,t):null}function an(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],_=i[0],m=i[1],w=i[2],b=i[3],E=i[4],y=i[5],x=i[6],R=i[7],S=i[8];return t[0]=_*r+m*o+w*c,t[1]=_*n+m*a+w*p,t[2]=_*s+m*u+w*d,t[3]=b*r+E*o+y*c,t[4]=b*n+E*a+y*p,t[5]=b*s+E*u+y*d,t[6]=x*r+R*o+S*c,t[7]=x*n+R*a+S*p,t[8]=x*s+R*u+S*d,t}function Bu(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],_=i[0],m=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=_*r+m*o+c,t[7]=_*n+m*a+p,t[8]=_*s+m*u+d,t}function Pu(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],_=Math.sin(i),m=Math.cos(i);return t[0]=m*r+_*o,t[1]=m*n+_*a,t[2]=m*s+_*u,t[3]=m*o-_*r,t[4]=m*a-_*n,t[5]=m*u-_*s,t[6]=c,t[7]=p,t[8]=d,t}function Du(t,e,i){let r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ou(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=e[9],_=e[10],m=e[11],w=e[12],b=e[13],E=e[14],y=e[15],x=i*a-r*o,R=i*u-n*o,S=i*c-s*o,T=r*u-n*a,M=r*c-s*a,k=n*c-s*u,O=p*b-d*w,P=p*E-_*w,H=p*y-m*w,Z=d*E-_*b,G=d*y-m*b,J=_*y-m*E,I=x*J-R*G+S*Z+T*H-M*P+k*O;return I?(I=1/I,t[0]=(a*J-u*G+c*Z)*I,t[1]=(u*H-o*J-c*P)*I,t[2]=(o*G-a*H+c*O)*I,t[3]=(n*G-r*J-s*Z)*I,t[4]=(i*J-n*H+s*P)*I,t[5]=(r*H-i*G-s*O)*I,t[6]=(b*k-E*M+y*T)*I,t[7]=(E*S-w*k-y*R)*I,t[8]=(w*M-b*S+y*x)*I,t):null}class Uu extends Array{constructor(e=1,i=0,r=0,n=0,s=1,o=0,a=0,u=0,c=1){return super(e,i,r,n,s,o,a,u,c),this}set(e,i,r,n,s,o,a,u,c){return e.length?this.copy(e):(ku(this,e,i,r,n,s,o,a,u,c),this)}translate(e,i=this){return Bu(this,i,e),this}rotate(e,i=this){return Pu(this,i,e),this}scale(e,i=this){return Du(this,i,e),this}multiply(e,i){return i?an(this,e,i):an(this,this,e),this}identity(){return Lu(this),this}copy(e){return Iu(this,e),this}fromMatrix4(e){return Fu(this,e),this}fromQuaternion(e){return Mu(this,e),this}fromBasis(e,i,r){return this.set(e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2]),this}inverse(e=this){return Nu(this,e),this}getNormalMatrix(e){return Ou(this,e),this}}let zu=0;class ln extends $i{constructor(e,{geometry:i,program:r,mode:n=e.TRIANGLES,frustumCulled:s=!0,renderOrder:o=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=zu++,this.geometry=i,this.program=r,this.mode=n,this.frustumCulled=s,this.renderOrder=o,this.modelViewMatrix=new ye,this.normalMatrix=new Uu,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}));let i=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:i}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}))}}const hn=new Uint8Array(4);function un(t){return(t&t-1)===0}let Hu=1;class cn{constructor(e,{image:i,target:r=e.TEXTURE_2D,type:n=e.UNSIGNED_BYTE,format:s=e.RGBA,internalFormat:o=s,wrapS:a=e.CLAMP_TO_EDGE,wrapT:u=e.CLAMP_TO_EDGE,generateMipmaps:c=!0,minFilter:p=c?e.NEAREST_MIPMAP_LINEAR:e.LINEAR,magFilter:d=e.LINEAR,premultiplyAlpha:_=!1,unpackAlignment:m=4,flipY:w=r==e.TEXTURE_2D,anisotropy:b=0,level:E=0,width:y,height:x=y}={}){this.gl=e,this.id=Hu++,this.image=i,this.target=r,this.type=n,this.format=s,this.internalFormat=o,this.minFilter=p,this.magFilter=d,this.wrapS=a,this.wrapT=u,this.generateMipmaps=c,this.premultiplyAlpha=_,this.unpackAlignment=m,this.flipY=w,this.anisotropy=Math.min(b,this.gl.renderer.parameters.maxAnisotropy),this.level=E,this.width=y,this.height=x,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(e=0){const i=!(this.image===this.store.image&&!this.needsUpdate);if((i||this.glState.textureUnits[e]!==this.id)&&(this.gl.renderer.activeTexture(e),this.bind()),!!i){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let r=0;r<6;r++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+r,this.level,this.internalFormat,this.format,this.type,this.image[r]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let r=0;r<this.image.length;r++)this.gl.compressedTexImage2D(this.target,r,this.internalFormat,this.image[r].width,this.image[r].height,0,this.image[r].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!un(this.image.width)||!un(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let r=0;r<6;r++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,hn);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,hn);this.store.image=this.image}}}function qu(t,e){return t[0]=e[0],t[1]=e[1],t}function Wu(t,e,i){return t[0]=e,t[1]=i,t}function dn(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function fn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function ju(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function $u(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function li(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Yu(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function Gu(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function pn(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Vu(t){var e=t[0],i=t[1];return e*e+i*i}function Xu(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Qu(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Ku(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function Zu(t,e){return t[0]*e[0]+t[1]*e[1]}function gn(t,e){return t[0]*e[1]-t[1]*e[0]}function Ju(t,e,i,r){var n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function ec(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function tc(t,e,i){let r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function ic(t,e){return t[0]===e[0]&&t[1]===e[1]}class xt extends Array{constructor(e=0,i=e){return super(e,i),this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,i=e){return e.length?this.copy(e):(Wu(this,e,i),this)}copy(e){return qu(this,e),this}add(e,i){return i?dn(this,e,i):dn(this,this,e),this}sub(e,i){return i?fn(this,e,i):fn(this,this,e),this}multiply(e){return e.length?ju(this,this,e):li(this,this,e),this}divide(e){return e.length?$u(this,this,e):li(this,this,1/e),this}inverse(e=this){return Qu(this,e),this}len(){return pn(this)}distance(e){return e?Yu(this,e):pn(this)}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?Gu(this,e):Vu(this)}negate(e=this){return Xu(this,e),this}cross(e,i){return i?gn(e,i):gn(this,e)}scale(e){return li(this,this,e),this}normalize(){return Ku(this,this),this}dot(e){return Zu(this,e)}equals(e){return ic(this,e)}applyMatrix3(e){return ec(this,this,e),this}applyMatrix4(e){return tc(this,this,e),this}lerp(e,i){return Ju(this,this,e,i),this}clone(){return new xt(this[0],this[1])}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e}}const rc=`
precision mediump float;

varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,nc=`
attribute float vertexId;

uniform vec2 mouse;
uniform vec2 resolution;
uniform vec4 background;
uniform float time;
uniform float vertexCount;
uniform sampler2D volume;
uniform sampler2D sound;
// uniform sampler2D floatSound;
uniform sampler2D touch;
uniform vec2 soundRes;
uniform float _dontUseDirectly_pointSize;

varying vec4 v_color;
#define PI radians(180.)
#define NUM_SEGMENTS 2.0
#define NUM_POINTS (NUM_SEGMENTS * 2.0)
#define STEP 1.0

float radius = 0.05;
float amount = 800.;
float len = vertexCount/90. / amount;

float mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}

float noise(vec3 p){
  vec3 a = floor(p);
  vec3 d = p - a;
  d = d * d * (3.0 - 2.0 * d);

  vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
  vec4 k1 = perm(b.xyxy);
  vec4 k2 = perm(k1.xyxy + b.zzww);

  vec4 c = k2 + a.zzzz;
  vec4 k3 = perm(c);
  vec4 k4 = perm(c + 1.0);

  vec4 o1 = fract(k3 * (1.0 / 41.0));
  vec4 o2 = fract(k4 * (1.0 / 41.0));

  vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
  vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);

  return o4.y * d.y + o4.x * (1.0 - d.y);
}

void main() {gl_PointSize=1.0;
  float ratio = resolution.x / resolution.y;
  float seg = floor(vertexId/len/200.);
  float segId = mod(vertexId,len*100.);
  float mod3 = mod(segId, 3.0);
  float step0 = step(mod3, 0.5); // 1.0 if segId % 3 == 0, 0.0 otherwise
  float step1 = step(0.5, mod3) * step(mod3, 1.5); // 1.0 if segId % 3 == 1, 0.0 otherwise
  float step2 = step(1.5, mod3); // 1.0 if segId % 3 == 2, 0.0 otherwise

  float v = texture2D(volume, vec2(1., (1.+seg)/amount*240.)).a;
  float s = texture2D(sound, vec2(1., (1.+segId)/len*140.)).a;
  vec3 p = vec3(vertexId * 0.005, seg, time*0.05 - segId*0.0001);
  float n = noise(p);
  float x = (0. + cos(n * PI) * sin(segId * 0.00001) * s) * step2; // Applies when segId % 3 == 2, the smile
  float y = (.0 + sin(n * PI) * segId * 0.0000015 * s * ratio)*1./  cos(segId)*step2;
  
  
  x += cos(vertexId/vertexCount * PI * 2.)*(v*radius*2.+segId*0.002)*(step0+step1);
  y += sin(vertexId/vertexCount * PI * 2.)*ratio*(v*radius*2.+segId*0.00189)*(step0+step1);
  // float z = segId * 0.006;
  // float z = sin(segId * 0.006) * 0.5;
  float z = 0.7*step2-abs(cos(segId-.1)/0.9) *step2;
  z += 1./exp(-segId * 0.002) * 0.5*(step0+step1);

  // Calculate smileAngle for each vertex based on vertexId
  // float smileAngle = mix(-PI / 4.0, -3.0 * PI / 4.0, vertexId / vertexCount);

  // // Calculate the x and y position of the arc
  // float x = radius * cos(smileAngle);
  // float y = radius * sin(smileAngle) - 0.5; // Adjust the vertical position for a smile

  // Set the position of the point
  vec4 position = vec4(x, y, 0.0, 1.0);
  gl_Position = position;

  
  x += (.4 + cos(n * PI * 4.0) * segId * 0.000002 * s) * step0; // Applies when segId % 3 == 0
  x += (-.4 + sin(n * PI * 3.0) * segId * 0.000003 * s) * step1; // Applies when segId % 3 == 1
  y += (.3 + sin(n * PI*4.) * segId * 0.0000015 * s * ratio)*step0;
  y += (.3 + sin(n * PI*4.) * segId * 0.0000015 * s * ratio)*step1;

  z += cos(n * PI * 4.0) * segId * 0.000002 * s*(step0+step1);
  
  
  float angle = PI * mouse.x; // Rotates 180 degrees based on mouse.x from -1 to 1
  
  // Calculate rotation angles based on mouse positions
  float angleX = radians(-90.0) * mouse.y*.3; // Rotation around X-axis based on mouse y
  float angleY = radians(90.0) * mouse.x; // Rotation around Y-axis based on mouse x
  float angleZ = radians(0.0) * mouse.x; // Rotation around Z-axis based on mouse x

  // Rotation matrices operations
  // Rotate around X
  float newY = y * cos(angleX) - z * sin(angleX);
  float newZ = y * sin(angleX) + z * cos(angleX);
  y = newY;
  z = newZ;

  // Rotate around Y
  float newX = x * cos(angleY) + z * sin(angleY);
  newZ = z * cos(angleY) - x * sin(angleY);
  x = newX;
  z = newZ;

  // Rotate around Z
  newX = x * cos(angleZ) - y * sin(angleZ);
  newY = x * sin(angleZ) + y * cos(angleZ);
  x = newX;
  y = newY;

  // x += cos(n * PI*4.) * segId * 0.000002 * s*2.;
  // y += sin(n * PI*4.) * segId * 0.0000015 * s*2. * ratio;
  
  float b = 0.3 / mod(vertexId/len,1.);
  v_color = vec4(vec3(b), 1.0);

  // Set the new position
  gl_Position = vec4(x, y, z, 1.0);
 ;
gl_PointSize = max(0., gl_PointSize*_dontUseDirectly_pointSize);
}
`,sc={vertex:nc,fragment:rc};class oc{floatBuffer;mesh;points;gl;scene;count;uniforms;programOptions;geometryOptions;constructor({gl:e,scene:i,uniforms:r,points:n,count:s,programOptions:o,geometryOptions:a}){this.gl=e,this.points=n,this.scene=i,this.count=s??2e3,this.uniforms=r,this.programOptions=o??sc,this.geometryOptions=a??{position:{size:1,data:new Float32Array(this.count*3)}}}async init(){console.log("entity count",this.count);let e=new Float32Array(this.count*3.2);for(let n=0;n<e.length;++n)e[n]=n;console.log("vertexId count",e.length),console.log({geops:this.geometryOptions,uniforms:this.uniforms});let i=new Lh(this.gl,{...this.geometryOptions,vertexId:{size:1,data:e}});console.log("entityUniforms",this.uniforms);let r=new Bh(this.gl,{...this.programOptions,transparent:!1,depthTest:!0,uniforms:this.uniforms});r.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.points?this.mesh=new ln(this.gl,{mode:this.gl.POINTS,geometry:i,program:r}):this.mesh=new ln(this.gl,{geometry:i,program:r})}setParent(){this.mesh.setParent(this.scene)}pos(e){this.mesh.position.set(e)}rot(e){this.mesh.rotation.x=e.x,this.mesh.rotation.y=e.y,this.mesh.rotation.z=e.x}}class ac{camera;scene;renderer;devicePixelRatio;canvas;autoRender=!0;canHandleFloat=!0;soundSampleCount=128;entities=[];uniforms;volumeArray;soundArray;mutex;sharedData;sum;maxDif;maxSample;touchColumns=32;frameLagCount=0;frameCount=0;volumeTexture;soundTexture;pointer;constructor({canvas:e,width:i,height:r,pixelRatio:n,pointer:s}){this.canvas=e,this.devicePixelRatio=n,this.pointer=s;const o=e;this.renderer=new zh({canvas:o,width:i,height:r}),this.renderer.gl.clearColor(0,0,0,0),this.camera=new Tu(this.renderer.gl,{fov:15}),this.camera.position.z=15,this.camera.position.x=-3,this.scene=new $i,this.camera.perspective({aspect:this.canvas.width/this.canvas.height}),this.sharedData={mutex:new SharedArrayBuffer(4),volume:new SharedArrayBuffer(4)}}async init(){if(!this.sharedData.sound)throw"Sound must be set as a sharedArrayBuffer before scene can be initialized";this.soundSampleCount=Math.min(this.soundSampleCount,this.renderer.gl.getParameter(this.renderer.gl.MAX_TEXTURE_SIZE));const e=1e5;this.mutex=new Int32Array(this.sharedData.mutex);let i=this.renderer.gl;this.volumeArray=new Uint8Array(this.sharedData.volume),this.soundArray=new Float32Array(this.sharedData.sound),this.soundArray.fill(Math.random()*-400);let r=new cn(this.renderer.gl,{image:this.volumeArray,width:1,type:i.UNSIGNED_BYTE,format:i.RGBA,internalFormat:i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:i.NEAREST,magFilter:i.NEAREST,flipY:!1});this.volumeTexture=r;let n=new cn(this.renderer.gl,{image:this.soundArray,width:16,type:i.FLOAT,format:i.RGBA,internalFormat:i.renderer.isWebgl2?i.RGBA32F:i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:i.LINEAR,magFilter:i.LINEAR,flipY:!1});this.soundTexture=n,this.uniforms={mouse:{value:new xt(.2,.5)},resolution:{value:new xt(this.canvas.width,this.canvas.height)},time:{value:0},vertexCount:{value:e},volume:{value:this.volumeTexture},sound:{value:this.soundTexture},_dontUseDirectly_pointSize:{value:1}};let s=new oc({gl:this.renderer.gl,scene:this.scene,uniforms:this.uniforms,count:e,points:!0});s.init(),s.setParent(),this.entities.push(s),this.render()}render=(e=0)=>{this.autoRender&&requestAnimationFrame(this.render.bind(this));const i=this.renderer.gl;Atomics.load(this.mutex,0)===3&&(this.volumeTexture.needsUpdate=!0,this.soundTexture.needsUpdate=!0,Atomics.store(this.mutex,0,0)),this.frameCount++,this.uniforms.time.value=e*.001,this.uniforms.mouse.value.x=this.pointer.x,this.uniforms.mouse.value.y=this.pointer.y,i.lineWidth(1),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.clearColor.apply(i,[0,0,0,1]),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.renderer.render({scene:this.scene,camera:this.camera})}}class lc{renderer;scene;gl;mutexBuffer=new SharedArrayBuffer(4);mutex;autoRender={value:!0};mouse={baseX:-.1,x:0,baseY:0,y:0};maxTextureSize;canHandleFloat=!1;messagePort;connectedAudio=!1;audioCheckInterval;constructor(){}async init(e){console.log("glitzcontroller data",{data:e}),this.mutex=new Int32Array(this.mutexBuffer),Atomics.store(this.mutex,0,1);const i=e.innerWidth,r=e.innerHeight,n=e.devicePixelRatio;this.scene=new ac({canvas:e.canvas,width:i,height:r,pixelRatio:n,pointer:this.mouse}),console.log("init scene called",n),this.renderer=this.scene.renderer,this.gl=this.scene.renderer.gl,this.canHandleFloat=!0;const s=!0;return this.maxTextureSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),console.log({canHandleFloat:this.canHandleFloat,canRenderToFloat:s}),this.checkForAudioConnection(),{resize:this.resize.bind(this),autoRender:this.autoRender,mouse:this.mouse}}checkForAudioConnection(){this.connectedAudio||(this.audioCheckInterval=setInterval(()=>{if(this.connectedAudio){clearInterval(this.audioCheckInterval);return}this.connectToAudio()},200))}setPort(e){this.messagePort=e,this.messagePort.onmessage=this.handleMessage.bind(this)}handleMessage(e){console.log("glitzController handle Message",e),e.data.reason==="audioConnected"&&!this.connectedAudio&&(this.connectedAudio=!0,this.scene.canHandleFloat=this.canHandleFloat,console.log("bincount and maxtexturesize",{binCount:e.data.frequencyBinCount,maxtsize:this.maxTextureSize}),this.scene.sharedData.sound=new SharedArrayBuffer(Math.min(this.maxTextureSize,e.data.frequencyBinCount)*4),this.scene.init(),this.sendSharedBuffers())}connectToAudio(){this.messagePort.postMessage({reason:"audioConnectionRequest"})}sendSharedBuffers(){this.messagePort.postMessage({reason:"sharedBuffers",mutexBuffer:this.scene.sharedData.mutex,volumeBuffer:this.scene.sharedData.volume,soundBuffer:this.scene.sharedData.sound})}resize(){console.log("resizing")}}const hc=new lc;function mn(){}class uc{glitzern;width;height;canvas;left;top;constructor(e){this.glitzern=[],this.canvas=e}getBoundingClientRect(){return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}}mouseHandler(e){this.startRender();for(let i of this.glitzern)i.mouse.x=(-e.clientX*2+this.width)/this.width,i.mouse.y=(e.clientY*2-this.height)/this.height}sizeHandler(e){if(console.log("resizeHandler",this,e),console.log("worker size event wh",this.width,this.height,this.canvas?.width,this.canvas?.height),this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,this.canvas){this.canvas.width=e.width,this.canvas.height=e.height,console.log("worker size event wh",this,this.width,this.height,this.canvas?.width,this.canvas?.height);for(let i of this.glitzern)i.program.uniforms.uResolution.x=this.width,i.program.uniforms.uResolution.y=this.height,i.program.gl.renderer.setSize(this.width,this.height)}}wheelHandler(e){console.log("wheelHandler")}keyHandler(e){console.log("keyHandler",e)}stopRender(){for(let e of this.glitzern)e.autoRender.value=!1}startRender(){for(let e of this.glitzern)e.autoRender.value||(e.autoRender.value=!0,e.render())}handleEvent(e){if(e.type==="size"){this.sizeHandler(e);return}switch(e.preventDefault=mn,e.stopPropagation=mn,e.type){case"pointermove":this.mouseHandler(e);break;case"keydown":this.keyHandler(e);break}}focus(){}}function cc(t){return new Worker("/assets/glitzWorker-DJX9rjr5.js",{type:"module",name:t?.name})}const st=Yi(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]),dc=Yi(["deltaX","deltaY"]),fc=Yi(["ctrlKey","metaKey","shiftKey","keyCode"]);function pc(t,e){t.preventDefault(),dc(t,e)}function gc(t,e,i){for(const r of e)i[r]=t[r]}function Yi(t){return function(i,r){const n={type:i.type};gc(i,t,n),r(n)}}function mc(t,e){fc(t,e)}let _c=0;class yc{worker;id;constructor(e,i,r){this.id=_c++,this.worker=i;const n=o=>{this.worker.postMessage({type:"event",id:this.id,data:o})};i.postMessage({type:"makeProxy",id:this.id}),s();for(const[o,a]of Object.entries(r))e.addEventListener(o,function(u){a(u,n)});function s(){const o={top:0,left:0,width:window.innerWidth,height:window.innerHeight};n({type:"size",left:o.left,top:o.top,width:window.innerWidth,height:window.innerHeight})}window.addEventListener("resize",s),window.addEventListener("fullscreenchange",s)}sendEvent(e){this.worker.postMessage({type:"event",id:this.id,data:e})}}function wc(t,e){t.width=window.innerWidth,t.height=window.innerHeight,t.focus();const i=t.transferControlToOffscreen(),r=new cc;r.postMessage({reason:"initialize",port:e},[e]);const n={mousemove:st,pointerdown:st,pointermove:st,pointerup:st,wheel:pc,keydown:mc};console.log("startworker");const s=new yc(window,r,n),o={type:"start",canvas:i,canvasId:s.id,innerWidth:window.innerWidth,innerHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio};r.postMessage(o,[i])}async function vc(t,e){t.width=window.innerWidth,t.height=window.innerHeight,t.focus();const i=new uc;e.onmessage=n=>{console.log("worker received audio data",n.data)},i.width=t.width,i.height=t.height,i.glitzern.push(await hc.init({element:window,canvas:t,inputElement:t,innerWidth:window.innerWidth,innerHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio}));const r={pointerdown:i.mouseHandler,pointermove:i.mouseHandler,pointerup:i.mouseHandler,wheel:i.wheelHandler,keydown:i.keyHandler};for(const[n,s]of Object.entries(r))window.addEventListener(n,s.bind(i));window.addEventListener("resize",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),window.addEventListener("fullscreenchange",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),window.addEventListener("webkitfullscreenchange",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),console.log("using regular canvas")}const _n=At.get("proxy"),bc={canHandle(t){return t&&typeof t=="object"&&typeof t.next=="function"&&(typeof t[Symbol.iterator]=="function"||typeof t[Symbol.asyncIterator]=="function")},serialize(t){return _n.serialize(Wn(t))},async*deserialize(t){const e=_n.deserialize(t);for(;;){const{value:i,done:r}=await e.next();if(r)break;yield i}}},Ec="/js/noiseProcessor.js",xc="/audio/a_corp.ogg";class Cc{audioContext;audioBuffer=null;sourceNode=null;gainNode;analyserNode;workletNode;pausedAt=0;startTime;isPlaying=!1;messagePort;mutexBuffer;mutex;byteFreqs;volumeBuffer;soundBuffer;volumeArray;soundArray;soundArraySwapper;constructor(){this.audioContext=new AudioContext,this.analyserNode=this.audioContext.createAnalyser(),this.byteFreqs=new Uint8Array(this.analyserNode.frequencyBinCount)}async init(e=xc,i){await this.audioContext.audioWorklet.addModule(Ec),this.workletNode=new AudioWorkletNode(this.audioContext,"noise-processor"),this.messagePort=i,this.messagePort&&(this.messagePort.onmessage=this.handleWorkerMessage.bind(this),console.log("audiocontroller checking messageport",this.messagePort));const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch audio file: ${r.statusText}`);const n=await r.arrayBuffer();this.audioBuffer=await this.audioContext.decodeAudioData(n)}firstStart(){this.play(),window.removeEventListener("mousedown",Ct.firstStart.bind(this))}handleWorkerMessage(e){console.log("handleWorkerMessage",e),e.data.reason==="audioConnectionRequest"?this.messagePort.postMessage({reason:"audioConnected",frequencyBinCount:this.analyserNode.frequencyBinCount}):e.data.reason==="sharedBuffers"&&(this.mutexBuffer=e.data.mutexBuffer,this.mutex=new Int32Array(this.mutexBuffer),this.volumeBuffer=e.data.volumeBuffer,this.volumeArray=new Uint8Array(this.volumeBuffer),this.soundBuffer=e.data.soundBuffer,this.soundArray=new Float32Array(this.soundBuffer),this.workletNode.port.postMessage({reason:"initialize",mutexBuffer:this.mutexBuffer,volumeBuffer:this.volumeBuffer}),this.soundArraySwapper=new Float32Array(this.soundArray.length),console.log("sharedbuffer message received",this.messagePort))}async analyze(e){if(e&&(this.messagePort=e),this.isPlaying)return;if(this.isPlaying=!0,console.log("isPlaying",this.isPlaying),this.startTime=Date.now(),!this.audioBuffer){console.error("Audio not loaded");return}this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.messagePort&&(this.messagePort.onmessage=this.handleWorkerMessage.bind(this)),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.audioBuffer,this.analyserNode.fftSize=2048;const i=this.analyserNode.frequencyBinCount;console.log("BUFFERLENGTH",i),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.sourceNode.connect(this.analyserNode).connect(this.workletNode).connect(this.gainNode).connect(this.audioContext.destination),this.sourceNode.start(0,this.pausedAt),this.startTime=this.audioContext.currentTime-this.pausedAt,this.sourceNode.onended=r=>{this.isPlaying=!1},this.analyseAudio()}analyseAudio(){Atomics.load(this.mutex,0)&1||(this.analyserNode.getByteFrequencyData(this.byteFreqs),this.getVolumeMax(this.byteFreqs),this.analyserNode.getFloatFrequencyData(this.soundArraySwapper),this.soundArray.set(this.soundArraySwapper),Atomics.or(this.mutex,0,1)),this.isPlaying&&(this.analyserNode.getFloatFrequencyData(this.soundArraySwapper),requestAnimationFrame(this.analyseAudio.bind(this)))}getVolumeMax(e){this.volumeArray[3]=Math.floor(e.reduce((i,r)=>r>i?r:i,0)%256)}toggleMute(){this.gainNode&&(this.gainNode.gain.value=this.gainNode.gain.value===0?1:0)}async play(){this.audioBuffer&&!this.isPlaying&&this.analyze()}pause(){this.sourceNode&&this.isPlaying&&(console.log("PAUSING"),this.sourceNode.stop(),this.pausedAt=this.audioContext.currentTime-this.startTime,this.isPlaying=!1)}}const Ct=new Cc;window.addEventListener("mousedown",Ct.firstStart.bind(Ct));At.set("asyncGenerator",bc);let yn=!1,Rc=new Event("initialized"),Fi;const Ac=Uo?8:window.navigator.hardwareConcurrency>1?window.navigator.hardwareConcurrency:5;let wn=[],ot,vn;Ge.test();async function Sc(){for(let t=0;t<Ac;++t){ot&&await ot;let e=new Go,i=zn(e);wn.push(i),ot===void 0&&(ot=new Promise(r=>{vn=r})),e.onmessage=r=>{r.data==="ready"&&(yn||(yn=!0,vn()),i.init(t))}}Fi=new Tc(wn)}class Tc{workers;rrIndex;workerCount;constructor(e){this.workers=e,this.rrIndex=0,this.workerCount=e.length}async init(){(await this.workers[0].getProps()).filter(i=>typeof this.workers[0][i]=="function"&&i!=="constructor"&&i!=="init"&&i!=="getProp").forEach(i=>{this[i]||(this[i]=(...r)=>(this.rrIndex%=this.workerCount,this.workers[this.rrIndex++][i](r)))})}}async function Fc(t){const e=document.querySelector("#glitz");e.transferControlToOffscreen?wc(e,t):vc(e,t)}async function Mc(){const t=new MessageChannel;Fc(t.port1),await Ct.init(void 0,t.port2),await Sc(),await Fi.init(),await Ve.init(Fi),Ge.test(),window.dispatchEvent(Rc)}function Ic(){const[t,e]=Mn(!1);return Bi(()=>{const i=()=>{e(!0)};return window.addEventListener("initialized",i),()=>{window.removeEventListener("initialized",i)}},[]),t}function kc({title:t}){const e=mh();return ie(we,{children:[e.length!==0&&ie("p",{children:t}),ie("ul",{class:"list-none",children:e.map(i=>ie("li",{onClick:()=>Ve.exportFile(i.hash),children:i.name},i.hash))})]})}Mc();function Lc(){return Ic()?ie(we,{children:[ie("h1",{class:"select-none text-white",children:"KOLLATOR"}),ie("div",{class:"p-2 select-none",children:ie(yo,{})}),ie("p",{class:"read-the-docs select-none",children:zo()}),ie(kc,{title:"Cached Files"})]}):ie(we,{children:"ahoy"})}eo(ie(Lc,{}),document.getElementById("app"));
