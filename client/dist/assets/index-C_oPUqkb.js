function Ys(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var At,q,En,be,ir,xn,ui,Ii,ci,di,je={},Cn=[],Gs=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ki=Array.isArray;function ye(t,e){for(var i in e)t[i]=e[i];return t}function An(t){var e=t.parentNode;e&&e.removeChild(t)}function Vs(t,e,i){var r,n,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?n=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?At.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)o[s]===void 0&&(o[s]=t.defaultProps[s]);return lt(t,o,r,n,null)}function lt(t,e,i,r,n){var s={type:t,props:e,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:n??++En,__i:-1,__u:0};return n==null&&q.vnode!=null&&q.vnode(s),s}function we(t){return t.children}function ht(t,e){this.props=t,this.context=e}function Ae(t,e){if(e==null)return t.__?Ae(t.__,t.__i+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?Ae(t):null}function Rn(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return Rn(t)}}function rr(t){(!t.__d&&(t.__d=!0)&&be.push(t)&&!yt.__r++||ir!==q.debounceRendering)&&((ir=q.debounceRendering)||xn)(yt)}function yt(){var t,e,i,r,n,s,o,a;for(be.sort(ui);t=be.shift();)t.__d&&(e=be.length,r=void 0,s=(n=(i=t).__v).__e,o=[],a=[],i.__P&&((r=ye({},n)).__v=n.__v+1,q.vnode&&q.vnode(r),Li(i.__P,r,n,i.__n,i.__P.ownerSVGElement!==void 0,32&n.__u?[s]:null,o,s??Ae(n),!!(32&n.__u),a),r.__v=n.__v,r.__.__k[r.__i]=r,Fn(o,r,a),r.__e!=s&&Rn(r)),be.length>e&&be.sort(ui));yt.__r=0}function Tn(t,e,i,r,n,s,o,a,u,c,p){var d,y,m,w,b,E=r&&r.__k||Cn,_=e.length;for(i.__d=u,Xs(i,e,E),u=i.__d,d=0;d<_;d++)(m=i.__k[d])!=null&&typeof m!="boolean"&&typeof m!="function"&&(y=m.__i===-1?je:E[m.__i]||je,m.__i=d,Li(t,m,y,n,s,o,a,u,c,p),w=m.__e,m.ref&&y.ref!=m.ref&&(y.ref&&Ni(y.ref,null,m),p.push(m.ref,m.__c||w,m)),b==null&&w!=null&&(b=w),65536&m.__u||y.__k===m.__k?(u&&!u.isConnected&&(u=Ae(y)),u=Sn(m,u,t)):typeof m.type=="function"&&m.__d!==void 0?u=m.__d:w&&(u=w.nextSibling),m.__d=void 0,m.__u&=-196609);i.__d=u,i.__e=b}function Xs(t,e,i){var r,n,s,o,a,u=e.length,c=i.length,p=c,d=0;for(t.__k=[],r=0;r<u;r++)o=r+d,(n=t.__k[r]=(n=e[r])==null||typeof n=="boolean"||typeof n=="function"?null:typeof n=="string"||typeof n=="number"||typeof n=="bigint"||n.constructor==String?lt(null,n,null,null,null):ki(n)?lt(we,{children:n},null,null,null):n.constructor===void 0&&n.__b>0?lt(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n)!=null?(n.__=t,n.__b=t.__b+1,a=Qs(n,i,o,p),n.__i=a,s=null,a!==-1&&(p--,(s=i[a])&&(s.__u|=131072)),s==null||s.__v===null?(a==-1&&d--,typeof n.type!="function"&&(n.__u|=65536)):a!==o&&(a===o+1?d++:a>o?p>u-o?d+=a-o:d--:a<o?a==o-1&&(d=a-o):d=0,a!==r+d&&(n.__u|=65536))):(s=i[o])&&s.key==null&&s.__e&&!(131072&s.__u)&&(s.__e==t.__d&&(t.__d=Ae(s)),fi(s,s,!1),i[o]=null,p--);if(p)for(r=0;r<c;r++)(s=i[r])!=null&&!(131072&s.__u)&&(s.__e==t.__d&&(t.__d=Ae(s)),fi(s,s))}function Sn(t,e,i){var r,n;if(typeof t.type=="function"){for(r=t.__k,n=0;r&&n<r.length;n++)r[n]&&(r[n].__=t,e=Sn(r[n],e,i));return e}t.__e!=e&&(i.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function Qs(t,e,i,r){var n=t.key,s=t.type,o=i-1,a=i+1,u=e[i];if(u===null||u&&n==u.key&&s===u.type&&!(131072&u.__u))return i;if(r>(u!=null&&!(131072&u.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((u=e[o])&&!(131072&u.__u)&&n==u.key&&s===u.type)return o;o--}if(a<e.length){if((u=e[a])&&!(131072&u.__u)&&n==u.key&&s===u.type)return a;a++}}return-1}function nr(t,e,i){e[0]==="-"?t.setProperty(e,i??""):t[e]=i==null?"":typeof i!="number"||Gs.test(e)?i:i+"px"}function tt(t,e,i,r,n){var s;e:if(e==="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)i&&e in i||nr(t.style,e,"");if(i)for(e in i)r&&i[e]===r[e]||nr(t.style,e,i[e])}else if(e[0]==="o"&&e[1]==="n")s=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=i,i?r?i.u=r.u:(i.u=Ii,t.addEventListener(e,s?di:ci,s)):t.removeEventListener(e,s?di:ci,s);else{if(n)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,i))}}function sr(t){return function(e){if(this.l){var i=this.l[e.type+t];if(e.t==null)e.t=Ii++;else if(e.t<i.u)return;return i(q.event?q.event(e):e)}}}function Li(t,e,i,r,n,s,o,a,u,c){var p,d,y,m,w,b,E,_,x,A,T,S,M,k,O,P=e.type;if(e.constructor!==void 0)return null;128&i.__u&&(u=!!(32&i.__u),s=[a=e.__e=i.__e]),(p=q.__b)&&p(e);e:if(typeof P=="function")try{if(_=e.props,x=(p=P.contextType)&&r[p.__c],A=p?x?x.props.value:p.__:r,i.__c?E=(d=e.__c=i.__c).__=d.__E:("prototype"in P&&P.prototype.render?e.__c=d=new P(_,A):(e.__c=d=new ht(_,A),d.constructor=P,d.render=Zs),x&&x.sub(d),d.props=_,d.state||(d.state={}),d.context=A,d.__n=r,y=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),P.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=ye({},d.__s)),ye(d.__s,P.getDerivedStateFromProps(_,d.__s))),m=d.props,w=d.state,d.__v=e,y)P.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(P.getDerivedStateFromProps==null&&_!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(_,A),!d.__e&&(d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(_,d.__s,A)===!1||e.__v===i.__v)){for(e.__v!==i.__v&&(d.props=_,d.state=d.__s,d.__d=!1),e.__e=i.__e,e.__k=i.__k,e.__k.forEach(function(H){H&&(H.__=e)}),T=0;T<d._sb.length;T++)d.__h.push(d._sb[T]);d._sb=[],d.__h.length&&o.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(_,d.__s,A),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,w,b)})}if(d.context=A,d.props=_,d.__P=t,d.__e=!1,S=q.__r,M=0,"prototype"in P&&P.prototype.render){for(d.state=d.__s,d.__d=!1,S&&S(e),p=d.render(d.props,d.state,d.context),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[]}else do d.__d=!1,S&&S(e),p=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++M<25);d.state=d.__s,d.getChildContext!=null&&(r=ye(ye({},r),d.getChildContext())),y||d.getSnapshotBeforeUpdate==null||(b=d.getSnapshotBeforeUpdate(m,w)),Tn(t,ki(O=p!=null&&p.type===we&&p.key==null?p.props.children:p)?O:[O],e,i,r,n,s,o,a,u,c),d.base=e.__e,e.__u&=-161,d.__h.length&&o.push(d),E&&(d.__E=d.__=null)}catch(H){e.__v=null,u||s!=null?(e.__e=a,e.__u|=u?160:32,s[s.indexOf(a)]=null):(e.__e=i.__e,e.__k=i.__k),q.__e(H,e,i)}else s==null&&e.__v===i.__v?(e.__k=i.__k,e.__e=i.__e):e.__e=Ks(i.__e,e,i,r,n,s,o,u,c);(p=q.diffed)&&p(e)}function Fn(t,e,i){e.__d=void 0;for(var r=0;r<i.length;r++)Ni(i[r],i[++r],i[++r]);q.__c&&q.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(s){s.call(n)})}catch(s){q.__e(s,n.__v)}})}function Ks(t,e,i,r,n,s,o,a,u){var c,p,d,y,m,w,b,E=i.props,_=e.props,x=e.type;if(x==="svg"&&(n=!0),s!=null){for(c=0;c<s.length;c++)if((m=s[c])&&"setAttribute"in m==!!x&&(x?m.localName===x:m.nodeType===3)){t=m,s[c]=null;break}}if(t==null){if(x===null)return document.createTextNode(_);t=n?document.createElementNS("http://www.w3.org/2000/svg",x):document.createElement(x,_.is&&_),s=null,a=!1}if(x===null)E===_||a&&t.data===_||(t.data=_);else{if(s=s&&At.call(t.childNodes),E=i.props||je,!a&&s!=null)for(E={},c=0;c<t.attributes.length;c++)E[(m=t.attributes[c]).name]=m.value;for(c in E)m=E[c],c=="children"||(c=="dangerouslySetInnerHTML"?d=m:c==="key"||c in _||tt(t,c,null,m,n));for(c in _)m=_[c],c=="children"?y=m:c=="dangerouslySetInnerHTML"?p=m:c=="value"?w=m:c=="checked"?b=m:c==="key"||a&&typeof m!="function"||E[c]===m||tt(t,c,m,E[c],n);if(p)a||d&&(p.__html===d.__html||p.__html===t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(d&&(t.innerHTML=""),Tn(t,ki(y)?y:[y],e,i,r,n&&x!=="foreignObject",s,o,s?s[0]:i.__k&&Ae(i,0),a,u),s!=null)for(c=s.length;c--;)s[c]!=null&&An(s[c]);a||(c="value",w!==void 0&&(w!==t[c]||x==="progress"&&!w||x==="option"&&w!==E[c])&&tt(t,c,w,E[c],!1),c="checked",b!==void 0&&b!==t[c]&&tt(t,c,b,E[c],!1))}return t}function Ni(t,e,i){try{typeof t=="function"?t(e):t.current=e}catch(r){q.__e(r,i)}}function fi(t,e,i){var r,n;if(q.unmount&&q.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||Ni(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){q.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(n=0;n<r.length;n++)r[n]&&fi(r[n],e,i||typeof t.type!="function");i||t.__e==null||An(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function Zs(t,e,i){return this.constructor(t,i)}function Js(t,e,i){var r,n,s,o;q.__&&q.__(t,e),n=(r=typeof i=="function")?null:i&&i.__k||e.__k,s=[],o=[],Li(e,t=(!r&&i||e).__k=Vs(we,null,[t]),n||je,je,e.ownerSVGElement!==void 0,!r&&i?[i]:n?null:e.firstChild?At.call(e.childNodes):null,s,!r&&i?i:n?n.__e:e.firstChild,r,o),Fn(s,t,o)}At=Cn.slice,q={__e:function(t,e,i,r){for(var n,s,o;e=e.__;)if((n=e.__c)&&!n.__)try{if((s=n.constructor)&&s.getDerivedStateFromError!=null&&(n.setState(s.getDerivedStateFromError(t)),o=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(t,r||{}),o=n.__d),o)return n.__E=n}catch(a){t=a}throw t}},En=0,ht.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ye({},this.state),typeof t=="function"&&(t=t(ye({},i),this.props)),t&&ye(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),rr(this))},ht.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),rr(this))},ht.prototype.render=we,be=[],xn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ui=function(t,e){return t.__v.__b-e.__v.__b},yt.__r=0,Ii=0,ci=sr(!1),di=sr(!0);var $e,X,Ot,or,_t=0,Mn=[],ut=[],K=q,ar=K.__b,lr=K.__r,hr=K.diffed,ur=K.__c,cr=K.unmount,dr=K.__;function Bi(t,e){K.__h&&K.__h(X,t,_t||e),_t=0;var i=X.__H||(X.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({__V:ut}),i.__[t]}function Pi(t){return _t=1,eo(kn,t)}function eo(t,e,i){var r=Bi($e++,2);if(r.t=t,!r.__c&&(r.__=[i?i(e):kn(void 0,e),function(a){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,a);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=X,!X.u)){var n=function(a,u,c){if(!r.__c.__H)return!0;var p=r.__c.__H.__.filter(function(y){return!!y.__c});if(p.every(function(y){return!y.__N}))return!s||s.call(this,a,u,c);var d=!1;return p.forEach(function(y){if(y.__N){var m=y.__[0];y.__=y.__N,y.__N=void 0,m!==y.__[0]&&(d=!0)}}),!(!d&&r.__c.props===a)&&(!s||s.call(this,a,u,c))};X.u=!0;var s=X.shouldComponentUpdate,o=X.componentWillUpdate;X.componentWillUpdate=function(a,u,c){if(this.__e){var p=s;s=void 0,n(a,u,c),s=p}o&&o.call(this,a,u,c)},X.shouldComponentUpdate=n}return r.__N||r.__}function Rt(t,e){var i=Bi($e++,3);!K.__s&&In(i.__H,e)&&(i.__=t,i.i=e,X.__H.__h.push(i))}function to(t){return _t=5,io(function(){return{current:t}},[])}function io(t,e){var i=Bi($e++,7);return In(i.__H,e)?(i.__V=t(),i.i=e,i.__h=t,i.__V):i.__}function ro(){for(var t;t=Mn.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ct),t.__H.__h.forEach(pi),t.__H.__h=[]}catch(e){t.__H.__h=[],K.__e(e,t.__v)}}K.__b=function(t){X=null,ar&&ar(t)},K.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),dr&&dr(t,e)},K.__r=function(t){lr&&lr(t),$e=0;var e=(X=t.__c).__H;e&&(Ot===X?(e.__h=[],X.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.__V=ut,i.__N=i.i=void 0})):(e.__h.forEach(ct),e.__h.forEach(pi),e.__h=[],$e=0)),Ot=X},K.diffed=function(t){hr&&hr(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Mn.push(e)!==1&&or===K.requestAnimationFrame||((or=K.requestAnimationFrame)||no)(ro)),e.__H.__.forEach(function(i){i.i&&(i.__H=i.i),i.__V!==ut&&(i.__=i.__V),i.i=void 0,i.__V=ut})),Ot=X=null},K.__c=function(t,e){e.some(function(i){try{i.__h.forEach(ct),i.__h=i.__h.filter(function(r){return!r.__||pi(r)})}catch(r){e.some(function(n){n.__h&&(n.__h=[])}),e=[],K.__e(r,i.__v)}}),ur&&ur(t,e)},K.unmount=function(t){cr&&cr(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(r){try{ct(r)}catch(n){e=n}}),i.__H=void 0,e&&K.__e(e,i.__v))};var fr=typeof requestAnimationFrame=="function";function no(t){var e,i=function(){clearTimeout(r),fr&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(i,100);fr&&(e=requestAnimationFrame(i))}function ct(t){var e=X,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),X=e}function pi(t){var e=X;t.__c=t.__(),X=e}function In(t,e){return!t||t.length!==e.length||e.some(function(i,r){return i!==t[r]})}function kn(t,e){return typeof e=="function"?e(t):e}var pr=Ln;function Ln(){var t=[].slice.call(arguments),e=!1;typeof t[0]=="boolean"&&(e=t.shift());var i=t[0];if(gr(i))throw new Error("extendee must be an object");for(var r=t.slice(1),n=r.length,s=0;s<n;s++){var o=r[s];for(var a in o)if(Object.prototype.hasOwnProperty.call(o,a)){var u=o[a];if(e&&so(u)){var c=Array.isArray(u)?[]:{};i[a]=Ln(!0,Object.prototype.hasOwnProperty.call(i,a)&&!gr(i[a])?i[a]:c,u)}else i[a]=u}}return i}function so(t){return Array.isArray(t)||{}.toString.call(t)=="[object Object]"}function gr(t){return!t||typeof t!="object"&&typeof t!="function"}function oo(t){return t&&t.__esModule?t.default:t}class mr{on(e,i){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i),this}emit(e,...i){this._callbacks=this._callbacks||{};let r=this._callbacks[e];if(r)for(let n of r)n.apply(this,i);return this.element&&this.element.dispatchEvent(this.makeEvent("dropzone:"+e,{args:i})),this}makeEvent(e,i){let r={bubbles:!0,cancelable:!0,detail:i};if(typeof window.CustomEvent=="function")return new CustomEvent(e,r);var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),n}off(e,i){if(!this._callbacks||arguments.length===0)return this._callbacks={},this;let r=this._callbacks[e];if(!r)return this;if(arguments.length===1)return delete this._callbacks[e],this;for(let n=0;n<r.length;n++)if(r[n]===i){r.splice(n,1);break}return this}}var Nn={};Nn=`<div class="dz-preview dz-file-preview">
  <div class="dz-image"><img data-dz-thumbnail=""></div>
  <div class="dz-details">
    <div class="dz-size"><span data-dz-size=""></span></div>
    <div class="dz-filename"><span data-dz-name=""></span></div>
  </div>
  <div class="dz-progress">
    <span class="dz-upload" data-dz-uploadprogress=""></span>
  </div>
  <div class="dz-error-message"><span data-dz-errormessage=""></span></div>
  <div class="dz-success-mark">
    <svg width="54" height="54" viewBox="0 0 54 54" fill="white" xmlns="http://www.w3.org/2000/svg">
      <path d="M10.2071 29.7929L14.2929 25.7071C14.6834 25.3166 15.3166 25.3166 15.7071 25.7071L21.2929 31.2929C21.6834 31.6834 22.3166 31.6834 22.7071 31.2929L38.2929 15.7071C38.6834 15.3166 39.3166 15.3166 39.7071 15.7071L43.7929 19.7929C44.1834 20.1834 44.1834 20.8166 43.7929 21.2071L22.7071 42.2929C22.3166 42.6834 21.6834 42.6834 21.2929 42.2929L10.2071 31.2071C9.81658 30.8166 9.81658 30.1834 10.2071 29.7929Z"></path>
    </svg>
  </div>
  <div class="dz-error-mark">
    <svg width="54" height="54" viewBox="0 0 54 54" fill="white" xmlns="http://www.w3.org/2000/svg">
      <path d="M26.2929 20.2929L19.2071 13.2071C18.8166 12.8166 18.1834 12.8166 17.7929 13.2071L13.2071 17.7929C12.8166 18.1834 12.8166 18.8166 13.2071 19.2071L20.2929 26.2929C20.6834 26.6834 20.6834 27.3166 20.2929 27.7071L13.2071 34.7929C12.8166 35.1834 12.8166 35.8166 13.2071 36.2071L17.7929 40.7929C18.1834 41.1834 18.8166 41.1834 19.2071 40.7929L26.2929 33.7071C26.6834 33.3166 27.3166 33.3166 27.7071 33.7071L34.7929 40.7929C35.1834 41.1834 35.8166 41.1834 36.2071 40.7929L40.7929 36.2071C41.1834 35.8166 41.1834 35.1834 40.7929 34.7929L33.7071 27.7071C33.3166 27.3166 33.3166 26.6834 33.7071 26.2929L40.7929 19.2071C41.1834 18.8166 41.1834 18.1834 40.7929 17.7929L36.2071 13.2071C35.8166 12.8166 35.1834 12.8166 34.7929 13.2071L27.7071 20.2929C27.3166 20.6834 26.6834 20.6834 26.2929 20.2929Z"></path>
    </svg>
  </div>
</div>
`;let ao={url:null,method:"post",withCredentials:!1,timeout:null,parallelUploads:2,uploadMultiple:!1,chunking:!1,forceChunking:!1,chunkSize:2097152,parallelChunkUploads:!1,retryChunks:!1,retryChunksLimit:3,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"crop",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:"contain",filesizeBase:1e3,maxFiles:null,headers:null,defaultHeaders:!0,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,disablePreviews:!1,hiddenInputContainer:"body",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictUploadCanceled:"Upload canceled.",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",dictFileSizeUnits:{tb:"TB",gb:"GB",mb:"MB",kb:"KB",b:"b"},init(){},params(t,e,i){if(i)return{dzuuid:i.file.upload.uuid,dzchunkindex:i.index,dztotalfilesize:i.file.size,dzchunksize:this.options.chunkSize,dztotalchunkcount:i.file.upload.totalChunkCount,dzchunkbyteoffset:i.index*this.options.chunkSize}},accept(t,e){return e()},chunksUploaded:function(t,e){e()},binaryBody:!1,fallback(){let t;this.element.className=`${this.element.className} dz-browser-not-supported`;for(let i of this.element.getElementsByTagName("div"))if(/(^| )dz-message($| )/.test(i.className)){t=i,i.className="dz-message";break}t||(t=F.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t));let e=t.getElementsByTagName("span")[0];return e&&(e.textContent!=null?e.textContent=this.options.dictFallbackMessage:e.innerText!=null&&(e.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize(t,e,i,r){let n={srcX:0,srcY:0,srcWidth:t.width,srcHeight:t.height},s=t.width/t.height;e==null&&i==null?(e=n.srcWidth,i=n.srcHeight):e==null?e=i*s:i==null&&(i=e/s),e=Math.min(e,n.srcWidth),i=Math.min(i,n.srcHeight);let o=e/i;if(n.srcWidth>e||n.srcHeight>i)if(r==="crop")s>o?(n.srcHeight=t.height,n.srcWidth=n.srcHeight*o):(n.srcWidth=t.width,n.srcHeight=n.srcWidth/o);else if(r==="contain")s>o?i=e/s:e=i*s;else throw new Error(`Unknown resizeMethod '${r}'`);return n.srcX=(t.width-n.srcWidth)/2,n.srcY=(t.height-n.srcHeight)/2,n.trgWidth=e,n.trgHeight=i,n},transformFile(t,e){return(this.options.resizeWidth||this.options.resizeHeight)&&t.type.match(/image.*/)?this.resizeImage(t,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,e):e(t)},previewTemplate:oo(Nn),drop(t){return this.element.classList.remove("dz-drag-hover")},dragstart(t){},dragend(t){return this.element.classList.remove("dz-drag-hover")},dragenter(t){return this.element.classList.add("dz-drag-hover")},dragover(t){return this.element.classList.add("dz-drag-hover")},dragleave(t){return this.element.classList.remove("dz-drag-hover")},paste(t){},reset(){return this.element.classList.remove("dz-started")},addedfile(t){if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer&&!this.options.disablePreviews){t.previewElement=F.createElement(this.options.previewTemplate.trim()),t.previewTemplate=t.previewElement,this.previewsContainer.appendChild(t.previewElement);for(var e of t.previewElement.querySelectorAll("[data-dz-name]"))e.textContent=t.name;for(e of t.previewElement.querySelectorAll("[data-dz-size]"))e.innerHTML=this.filesize(t.size);this.options.addRemoveLinks&&(t._removeLink=F.createElement(`<a class="dz-remove" href="javascript:undefined;" data-dz-remove>${this.options.dictRemoveFile}</a>`),t.previewElement.appendChild(t._removeLink));let i=r=>(r.preventDefault(),r.stopPropagation(),t.status===F.UPLOADING?F.confirm(this.options.dictCancelUploadConfirmation,()=>this.removeFile(t)):this.options.dictRemoveFileConfirmation?F.confirm(this.options.dictRemoveFileConfirmation,()=>this.removeFile(t)):this.removeFile(t));for(let r of t.previewElement.querySelectorAll("[data-dz-remove]"))r.addEventListener("click",i)}},removedfile(t){return t.previewElement!=null&&t.previewElement.parentNode!=null&&t.previewElement.parentNode.removeChild(t.previewElement),this._updateMaxFilesReachedClass()},thumbnail(t,e){if(t.previewElement){t.previewElement.classList.remove("dz-file-preview");for(let i of t.previewElement.querySelectorAll("[data-dz-thumbnail]"))i.alt=t.name,i.src=e;return setTimeout(()=>t.previewElement.classList.add("dz-image-preview"),1)}},error(t,e){if(t.previewElement){t.previewElement.classList.add("dz-error"),typeof e!="string"&&e.error&&(e=e.error);for(let i of t.previewElement.querySelectorAll("[data-dz-errormessage]"))i.textContent=e}},errormultiple(){},processing(t){if(t.previewElement&&(t.previewElement.classList.add("dz-processing"),t._removeLink))return t._removeLink.innerHTML=this.options.dictCancelUpload},processingmultiple(){},uploadprogress(t,e,i){if(t.previewElement)for(let r of t.previewElement.querySelectorAll("[data-dz-uploadprogress]"))r.nodeName==="PROGRESS"?r.value=e:r.style.width=`${e}%`},totaluploadprogress(){},sending(){},sendingmultiple(){},success(t){if(t.previewElement)return t.previewElement.classList.add("dz-success")},successmultiple(){},canceled(t){return this.emit("error",t,this.options.dictUploadCanceled)},canceledmultiple(){},complete(t){if(t._removeLink&&(t._removeLink.innerHTML=this.options.dictRemoveFile),t.previewElement)return t.previewElement.classList.add("dz-complete")},completemultiple(){},maxfilesexceeded(){},maxfilesreached(){},queuecomplete(){},addedfiles(){}};var lo=ao;class F extends mr{static initClass(){this.prototype.Emitter=mr,this.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],this.prototype._thumbnailQueue=[],this.prototype._processingThumbnail=!1}getAcceptedFiles(){return this.files.filter(e=>e.accepted).map(e=>e)}getRejectedFiles(){return this.files.filter(e=>!e.accepted).map(e=>e)}getFilesWithStatus(e){return this.files.filter(i=>i.status===e).map(i=>i)}getQueuedFiles(){return this.getFilesWithStatus(F.QUEUED)}getUploadingFiles(){return this.getFilesWithStatus(F.UPLOADING)}getAddedFiles(){return this.getFilesWithStatus(F.ADDED)}getActiveFiles(){return this.files.filter(e=>e.status===F.UPLOADING||e.status===F.QUEUED).map(e=>e)}init(){if(this.element.tagName==="form"&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(F.createElement(`<div class="dz-default dz-message"><button class="dz-button" type="button">${this.options.dictDefaultMessage}</button></div>`)),this.clickableElements.length){let r=()=>{this.hiddenFileInput&&this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=document.createElement("input"),this.hiddenFileInput.setAttribute("type","file"),(this.options.maxFiles===null||this.options.maxFiles>1)&&this.hiddenFileInput.setAttribute("multiple","multiple"),this.hiddenFileInput.className="dz-hidden-input",this.options.acceptedFiles!==null&&this.hiddenFileInput.setAttribute("accept",this.options.acceptedFiles),this.options.capture!==null&&this.hiddenFileInput.setAttribute("capture",this.options.capture),this.hiddenFileInput.setAttribute("tabindex","-1"),this.hiddenFileInput.style.visibility="hidden",this.hiddenFileInput.style.position="absolute",this.hiddenFileInput.style.top="0",this.hiddenFileInput.style.left="0",this.hiddenFileInput.style.height="0",this.hiddenFileInput.style.width="0",F.getElement(this.options.hiddenInputContainer,"hiddenInputContainer").appendChild(this.hiddenFileInput),this.hiddenFileInput.addEventListener("change",()=>{let{files:n}=this.hiddenFileInput;if(n.length)for(let s of n)this.addFile(s);this.emit("addedfiles",n),r()})};r()}this.URL=window.URL!==null?window.URL:window.webkitURL;for(let r of this.events)this.on(r,this.options[r]);this.on("uploadprogress",()=>this.updateTotalUploadProgress()),this.on("removedfile",()=>this.updateTotalUploadProgress()),this.on("canceled",r=>this.emit("complete",r)),this.on("complete",r=>{if(this.getAddedFiles().length===0&&this.getUploadingFiles().length===0&&this.getQueuedFiles().length===0)return setTimeout(()=>this.emit("queuecomplete"),0)});const e=function(r){if(r.dataTransfer.types){for(var n=0;n<r.dataTransfer.types.length;n++)if(r.dataTransfer.types[n]==="Files")return!0}return!1};let i=function(r){if(e(r))return r.stopPropagation(),r.preventDefault?r.preventDefault():r.returnValue=!1};return this.listeners=[{element:this.element,events:{dragstart:r=>this.emit("dragstart",r),dragenter:r=>(i(r),this.emit("dragenter",r)),dragover:r=>{let n;try{n=r.dataTransfer.effectAllowed}catch{}return r.dataTransfer.dropEffect=n==="move"||n==="linkMove"?"move":"copy",i(r),this.emit("dragover",r)},dragleave:r=>this.emit("dragleave",r),drop:r=>(i(r),this.drop(r)),dragend:r=>this.emit("dragend",r)}}],this.clickableElements.forEach(r=>this.listeners.push({element:r,events:{click:n=>((r!==this.element||n.target===this.element||F.elementInside(n.target,this.element.querySelector(".dz-message")))&&this.hiddenFileInput.click(),!0)}})),this.enable(),this.options.init.call(this)}destroy(){return this.disable(),this.removeAllFiles(!0),this.hiddenFileInput!=null&&this.hiddenFileInput.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,F.instances.splice(F.instances.indexOf(this),1)}updateTotalUploadProgress(){let e,i=0,r=0;if(this.getActiveFiles().length){for(let s of this.getActiveFiles())i+=s.upload.bytesSent,r+=s.upload.total;e=100*i/r}else e=100;return this.emit("totaluploadprogress",e,r,i)}_getParamName(e){return typeof this.options.paramName=="function"?this.options.paramName(e):`${this.options.paramName}${this.options.uploadMultiple?`[${e}]`:""}`}_renameFile(e){return typeof this.options.renameFile!="function"?e.name:this.options.renameFile(e)}getFallbackForm(){let e,i;if(e=this.getExistingFallback())return e;let r='<div class="dz-fallback">';this.options.dictFallbackText&&(r+=`<p>${this.options.dictFallbackText}</p>`),r+=`<input type="file" name="${this._getParamName(0)}" ${this.options.uploadMultiple?'multiple="multiple"':void 0} /><input type="submit" value="Upload!"></div>`;let n=F.createElement(r);return this.element.tagName!=="FORM"?(i=F.createElement(`<form action="${this.options.url}" enctype="multipart/form-data" method="${this.options.method}"></form>`),i.appendChild(n)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),i??n}getExistingFallback(){let e=function(r){for(let n of r)if(/(^| )fallback($| )/.test(n.className))return n};for(let r of["div","form"]){var i;if(i=e(this.element.getElementsByTagName(r)))return i}}setupEventListeners(){return this.listeners.map(e=>(()=>{let i=[];for(let r in e.events){let n=e.events[r];i.push(e.element.addEventListener(r,n,!1))}return i})())}removeEventListeners(){return this.listeners.map(e=>(()=>{let i=[];for(let r in e.events){let n=e.events[r];i.push(e.element.removeEventListener(r,n,!1))}return i})())}disable(){return this.clickableElements.forEach(e=>e.classList.remove("dz-clickable")),this.removeEventListeners(),this.disabled=!0,this.files.map(e=>this.cancelUpload(e))}enable(){return delete this.disabled,this.clickableElements.forEach(e=>e.classList.add("dz-clickable")),this.setupEventListeners()}filesize(e){let i=0,r="b";if(e>0){let n=["tb","gb","mb","kb","b"];for(let s=0;s<n.length;s++){let o=n[s],a=Math.pow(this.options.filesizeBase,4-s)/10;if(e>=a){i=e/Math.pow(this.options.filesizeBase,4-s),r=o;break}}i=Math.round(10*i)/10}return`<strong>${i}</strong> ${this.options.dictFileSizeUnits[r]}`}_updateMaxFilesReachedClass(){return this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")}drop(e){if(!e.dataTransfer)return;this.emit("drop",e);let i=[];for(let r=0;r<e.dataTransfer.files.length;r++)i[r]=e.dataTransfer.files[r];if(i.length){let{items:r}=e.dataTransfer;r&&r.length&&r[0].webkitGetAsEntry!=null?this._addFilesFromItems(r):this.handleFiles(i)}this.emit("addedfiles",i)}paste(e){if(po(e?.clipboardData,r=>r.items)==null)return;this.emit("paste",e);let{items:i}=e.clipboardData;if(i.length)return this._addFilesFromItems(i)}handleFiles(e){for(let i of e)this.addFile(i)}_addFilesFromItems(e){return(()=>{let i=[];for(let n of e){var r;n.webkitGetAsEntry!=null&&(r=n.webkitGetAsEntry())?r.isFile?i.push(this.addFile(n.getAsFile())):r.isDirectory?i.push(this._addFilesFromDirectory(r,r.name)):i.push(void 0):n.getAsFile!=null&&(n.kind==null||n.kind==="file")?i.push(this.addFile(n.getAsFile())):i.push(void 0)}return i})()}_addFilesFromDirectory(e,i){let r=e.createReader(),n=o=>go(console,"log",a=>a.log(o));var s=()=>r.readEntries(o=>{if(o.length>0){for(let a of o)a.isFile?a.file(u=>{if(!(this.options.ignoreHiddenFiles&&u.name.substring(0,1)==="."))return u.fullPath=`${i}/${u.name}`,this.addFile(u)}):a.isDirectory&&this._addFilesFromDirectory(a,`${i}/${a.name}`);s()}return null},n);return s()}accept(e,i){this.options.maxFilesize&&e.size>this.options.maxFilesize*1048576?i(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):F.isValidFile(e,this.options.acceptedFiles)?this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles?(i(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,i):i(this.options.dictInvalidFileType)}addFile(e){e.upload={uuid:F.uuidv4(),progress:0,total:e.size,bytesSent:0,filename:this._renameFile(e)},this.files.push(e),e.status=F.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,i=>{i?(e.accepted=!1,this._errorProcessing([e],i)):(e.accepted=!0,this.options.autoQueue&&this.enqueueFile(e)),this._updateMaxFilesReachedClass()})}enqueueFiles(e){for(let i of e)this.enqueueFile(i);return null}enqueueFile(e){if(e.status===F.ADDED&&e.accepted===!0){if(e.status=F.QUEUED,this.options.autoProcessQueue)return setTimeout(()=>this.processQueue(),0)}else throw new Error("This file can't be queued because it has already been processed or was rejected.")}_enqueueThumbnail(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=this.options.maxThumbnailFilesize*1048576)return this._thumbnailQueue.push(e),setTimeout(()=>this._processThumbnailQueue(),0)}_processThumbnailQueue(){if(this._processingThumbnail||this._thumbnailQueue.length===0)return;this._processingThumbnail=!0;let e=this._thumbnailQueue.shift();return this.createThumbnail(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,i=>(this.emit("thumbnail",e,i),this._processingThumbnail=!1,this._processThumbnailQueue()))}removeFile(e){if(e.status===F.UPLOADING&&this.cancelUpload(e),this.files=ho(this.files,e),this.emit("removedfile",e),this.files.length===0)return this.emit("reset")}removeAllFiles(e){e==null&&(e=!1);for(let i of this.files.slice())(i.status!==F.UPLOADING||e)&&this.removeFile(i);return null}resizeImage(e,i,r,n,s){return this.createThumbnail(e,i,r,n,!0,(o,a)=>{if(a==null)return s(e);{let{resizeMimeType:u}=this.options;u==null&&(u=e.type);let c=a.toDataURL(u,this.options.resizeQuality);return(u==="image/jpeg"||u==="image/jpg")&&(c=Bn.restore(e.dataURL,c)),s(F.dataURItoBlob(c))}})}createThumbnail(e,i,r,n,s,o){let a=new FileReader;a.onload=()=>{if(e.dataURL=a.result,e.type==="image/svg+xml"){o?.(a.result);return}this.createThumbnailFromUrl(e,i,r,n,s,o)},a.readAsDataURL(e)}displayExistingFile(e,i,r,n,s=!0){if(this.emit("addedfile",e),this.emit("complete",e),!s)this.emit("thumbnail",e,i),r&&r();else{let o=a=>{this.emit("thumbnail",e,a),r&&r()};e.dataURL=i,this.createThumbnailFromUrl(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,this.options.fixOrientation,o,n)}}createThumbnailFromUrl(e,i,r,n,s,o,a){let u=document.createElement("img");return a&&(u.crossOrigin=a),s=getComputedStyle(document.body).imageOrientation=="from-image"?!1:s,u.onload=()=>{let c=p=>p(1);return typeof EXIF<"u"&&EXIF!==null&&s&&(c=p=>EXIF.getData(u,function(){return p(EXIF.getTag(this,"Orientation"))})),c(p=>{e.width=u.width,e.height=u.height;let d=this.options.resize.call(this,e,i,r,n),y=document.createElement("canvas"),m=y.getContext("2d");switch(y.width=d.trgWidth,y.height=d.trgHeight,p>4&&(y.width=d.trgHeight,y.height=d.trgWidth),p){case 2:m.translate(y.width,0),m.scale(-1,1);break;case 3:m.translate(y.width,y.height),m.rotate(Math.PI);break;case 4:m.translate(0,y.height),m.scale(1,-1);break;case 5:m.rotate(.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(.5*Math.PI),m.translate(0,-y.width);break;case 7:m.rotate(.5*Math.PI),m.translate(y.height,-y.width),m.scale(-1,1);break;case 8:m.rotate(-.5*Math.PI),m.translate(-y.height,0);break}fo(m,u,d.srcX!=null?d.srcX:0,d.srcY!=null?d.srcY:0,d.srcWidth,d.srcHeight,d.trgX!=null?d.trgX:0,d.trgY!=null?d.trgY:0,d.trgWidth,d.trgHeight);let w=y.toDataURL("image/png");if(o!=null)return o(w,y)})},o!=null&&(u.onerror=o),u.src=e.dataURL}processQueue(){let{parallelUploads:e}=this.options,i=this.getUploadingFiles().length,r=i;if(i>=e)return;let n=this.getQueuedFiles();if(n.length>0){if(this.options.uploadMultiple)return this.processFiles(n.slice(0,e-i));for(;r<e;){if(!n.length)return;this.processFile(n.shift()),r++}}}processFile(e){return this.processFiles([e])}processFiles(e){for(let i of e)i.processing=!0,i.status=F.UPLOADING,this.emit("processing",i);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)}_getFilesWithXhr(e){return this.files.filter(i=>i.xhr===e).map(i=>i)}cancelUpload(e){if(e.status===F.UPLOADING){let i=this._getFilesWithXhr(e.xhr);for(let r of i)r.status=F.CANCELED;typeof e.xhr<"u"&&e.xhr.abort();for(let r of i)this.emit("canceled",r);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(e.status===F.ADDED||e.status===F.QUEUED)&&(e.status=F.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()}resolveOption(e,...i){return typeof e=="function"?e.apply(this,i):e}uploadFile(e){return this.uploadFiles([e])}uploadFiles(e){this._transformFiles(e,i=>{if(this.options.chunking){let r=i[0];e[0].upload.chunked=this.options.chunking&&(this.options.forceChunking||r.size>this.options.chunkSize),e[0].upload.totalChunkCount=Math.ceil(r.size/this.options.chunkSize)}if(e[0].upload.chunked){let r=e[0],n=i[0];r.upload.chunks=[];let s=()=>{let o=0;for(;r.upload.chunks[o]!==void 0;)o++;if(o>=r.upload.totalChunkCount)return;let a=o*this.options.chunkSize,u=Math.min(a+this.options.chunkSize,n.size),c={name:this._getParamName(0),data:n.webkitSlice?n.webkitSlice(a,u):n.slice(a,u),filename:r.upload.filename,chunkIndex:o};r.upload.chunks[o]={file:r,index:o,dataBlock:c,status:F.UPLOADING,progress:0,retries:0},this._uploadData(e,[c])};if(r.upload.finishedChunkUpload=(o,a)=>{let u=!0;o.status=F.SUCCESS,o.dataBlock=null,o.response=o.xhr.responseText,o.responseHeaders=o.xhr.getAllResponseHeaders(),o.xhr=null;for(let c=0;c<r.upload.totalChunkCount;c++){if(r.upload.chunks[c]===void 0)return s();r.upload.chunks[c].status!==F.SUCCESS&&(u=!1)}u&&this.options.chunksUploaded(r,()=>{this._finished(e,a,null)})},this.options.parallelChunkUploads)for(let o=0;o<r.upload.totalChunkCount;o++)s();else s()}else{let r=[];for(let n=0;n<e.length;n++)r[n]={name:this._getParamName(n),data:i[n],filename:e[n].upload.filename};this._uploadData(e,r)}})}_getChunk(e,i){for(let r=0;r<e.upload.totalChunkCount;r++)if(e.upload.chunks[r]!==void 0&&e.upload.chunks[r].xhr===i)return e.upload.chunks[r]}_uploadData(e,i){let r=new XMLHttpRequest;for(let c of e)c.xhr=r;e[0].upload.chunked&&(e[0].upload.chunks[i[0].chunkIndex].xhr=r);let n=this.resolveOption(this.options.method,e,i),s=this.resolveOption(this.options.url,e,i);r.open(n,s,!0),this.resolveOption(this.options.timeout,e)&&(r.timeout=this.resolveOption(this.options.timeout,e)),r.withCredentials=!!this.options.withCredentials,r.onload=c=>{this._finishedUploading(e,r,c)},r.ontimeout=()=>{this._handleUploadError(e,r,`Request timedout after ${this.options.timeout/1e3} seconds`)},r.onerror=()=>{this._handleUploadError(e,r)};let a=r.upload!=null?r.upload:r;a.onprogress=c=>this._updateFilesUploadProgress(e,r,c);let u=this.options.defaultHeaders?{Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"}:{};this.options.binaryBody&&(u["Content-Type"]=e[0].type),this.options.headers&&pr(u,this.options.headers);for(let c in u){let p=u[c];p&&r.setRequestHeader(c,p)}if(this.options.binaryBody){for(let c of e)this.emit("sending",c,r);this.options.uploadMultiple&&this.emit("sendingmultiple",e,r),this.submitRequest(r,null,e)}else{let c=new FormData;if(this.options.params){let p=this.options.params;typeof p=="function"&&(p=p.call(this,e,r,e[0].upload.chunked?this._getChunk(e[0],r):null));for(let d in p){let y=p[d];if(Array.isArray(y))for(let m=0;m<y.length;m++)c.append(d,y[m]);else c.append(d,y)}}for(let p of e)this.emit("sending",p,r,c);this.options.uploadMultiple&&this.emit("sendingmultiple",e,r,c),this._addFormElementData(c);for(let p=0;p<i.length;p++){let d=i[p];c.append(d.name,d.data,d.filename)}this.submitRequest(r,c,e)}}_transformFiles(e,i){let r=[],n=0;for(let s=0;s<e.length;s++)this.options.transformFile.call(this,e[s],o=>{r[s]=o,++n===e.length&&i(r)})}_addFormElementData(e){if(this.element.tagName==="FORM")for(let i of this.element.querySelectorAll("input, textarea, select, button")){let r=i.getAttribute("name"),n=i.getAttribute("type");if(n&&(n=n.toLowerCase()),!(typeof r>"u"||r===null))if(i.tagName==="SELECT"&&i.hasAttribute("multiple"))for(let s of i.options)s.selected&&e.append(r,s.value);else(!n||n!=="checkbox"&&n!=="radio"||i.checked)&&e.append(r,i.value)}}_updateFilesUploadProgress(e,i,r){if(e[0].upload.chunked){let n=e[0],s=this._getChunk(n,i);r?(s.progress=100*r.loaded/r.total,s.total=r.total,s.bytesSent=r.loaded):(s.progress=100,s.bytesSent=s.total),n.upload.progress=0,n.upload.total=0,n.upload.bytesSent=0;for(let o=0;o<n.upload.totalChunkCount;o++)n.upload.chunks[o]&&typeof n.upload.chunks[o].progress<"u"&&(n.upload.progress+=n.upload.chunks[o].progress,n.upload.total+=n.upload.chunks[o].total,n.upload.bytesSent+=n.upload.chunks[o].bytesSent);n.upload.progress=n.upload.progress/n.upload.totalChunkCount,this.emit("uploadprogress",n,n.upload.progress,n.upload.bytesSent)}else for(let n of e)n.upload.total&&n.upload.bytesSent&&n.upload.bytesSent==n.upload.total||(r?(n.upload.progress=100*r.loaded/r.total,n.upload.total=r.total,n.upload.bytesSent=r.loaded):(n.upload.progress=100,n.upload.bytesSent=n.upload.total),this.emit("uploadprogress",n,n.upload.progress,n.upload.bytesSent))}_finishedUploading(e,i,r){let n;if(e[0].status!==F.CANCELED&&i.readyState===4){if(i.responseType!=="arraybuffer"&&i.responseType!=="blob"&&(n=i.responseText,i.getResponseHeader("content-type")&&~i.getResponseHeader("content-type").indexOf("application/json")))try{n=JSON.parse(n)}catch(s){r=s,n="Invalid JSON response from server."}this._updateFilesUploadProgress(e,i),200<=i.status&&i.status<300?e[0].upload.chunked?e[0].upload.finishedChunkUpload(this._getChunk(e[0],i),n):this._finished(e,n,r):this._handleUploadError(e,i,n)}}_handleUploadError(e,i,r){if(e[0].status!==F.CANCELED){if(e[0].upload.chunked&&this.options.retryChunks){let n=this._getChunk(e[0],i);if(n.retries++<this.options.retryChunksLimit){this._uploadData(e,[n.dataBlock]);return}else console.warn("Retried this chunk too often. Giving up.")}this._errorProcessing(e,r||this.options.dictResponseError.replace("{{statusCode}}",i.status),i)}}submitRequest(e,i,r){if(e.readyState!=1){console.warn("Cannot send this request because the XMLHttpRequest.readyState is not OPENED.");return}if(this.options.binaryBody)if(r[0].upload.chunked){const n=this._getChunk(r[0],e);e.send(n.dataBlock.data)}else e.send(r[0]);else e.send(i)}_finished(e,i,r){for(let n of e)n.status=F.SUCCESS,this.emit("success",n,i,r),this.emit("complete",n);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,i,r),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}_errorProcessing(e,i,r){for(let n of e)n.status=F.ERROR,this.emit("error",n,i,r),this.emit("complete",n);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,i,r),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}static uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let i=Math.random()*16|0;return(e==="x"?i:i&3|8).toString(16)})}constructor(e,i){super();let r,n;if(this.element=e,this.clickableElements=[],this.listeners=[],this.files=[],typeof this.element=="string"&&(this.element=document.querySelector(this.element)),!this.element||this.element.nodeType==null)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");F.instances.push(this),this.element.dropzone=this;let s=(n=F.optionsForElement(this.element))!=null?n:{};if(this.options=pr(!0,{},lo,s,i??{}),this.options.previewTemplate=this.options.previewTemplate.replace(/\n*/g,""),this.options.forceFallback||!F.isBrowserSupported())return this.options.fallback.call(this);if(this.options.url==null&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(this.options.uploadMultiple&&this.options.chunking)throw new Error("You cannot set both: uploadMultiple and chunking.");if(this.options.binaryBody&&this.options.uploadMultiple)throw new Error("You cannot set both: binaryBody and uploadMultiple.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.renameFilename!=null&&(this.options.renameFile=o=>this.options.renameFilename.call(this,o.name,o)),typeof this.options.method=="string"&&(this.options.method=this.options.method.toUpperCase()),(r=this.getExistingFallback())&&r.parentNode&&r.parentNode.removeChild(r),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=F.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=F.getElements(this.options.clickable,"clickable")),this.init()}}F.initClass();F.options={};F.optionsForElement=function(t){if(t.getAttribute("id"))return F.options[uo(t.getAttribute("id"))]};F.instances=[];F.forElement=function(t){if(typeof t=="string"&&(t=document.querySelector(t)),t?.dropzone==null)throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return t.dropzone};F.discover=function(){let t;if(document.querySelectorAll)t=document.querySelectorAll(".dropzone");else{t=[];let e=i=>(()=>{let r=[];for(let n of i)/(^| )dropzone($| )/.test(n.className)?r.push(t.push(n)):r.push(void 0);return r})();e(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))}return(()=>{let e=[];for(let i of t)F.optionsForElement(i)!==!1?e.push(new F(i)):e.push(void 0);return e})()};F.blockedBrowsers=[/opera.*(Macintosh|Windows Phone).*version\/12/i];F.isBrowserSupported=function(){let t=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if(!("classList"in document.createElement("a")))t=!1;else{F.blacklistedBrowsers!==void 0&&(F.blockedBrowsers=F.blacklistedBrowsers);for(let e of F.blockedBrowsers)if(e.test(navigator.userAgent)){t=!1;continue}}else t=!1;return t};F.dataURItoBlob=function(t){let e=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let s=0,o=e.length,a=0<=o;a?s<=o:s>=o;a?s++:s--)n[s]=e.charCodeAt(s);return new Blob([r],{type:i})};const ho=(t,e)=>t.filter(i=>i!==e).map(i=>i),uo=t=>t.replace(/[\-_](\w)/g,e=>e.charAt(1).toUpperCase());F.createElement=function(t){let e=document.createElement("div");return e.innerHTML=t,e.childNodes[0]};F.elementInside=function(t,e){if(t===e)return!0;for(;t=t.parentNode;)if(t===e)return!0;return!1};F.getElement=function(t,e){let i;if(typeof t=="string"?i=document.querySelector(t):t.nodeType!=null&&(i=t),i==null)throw new Error(`Invalid \`${e}\` option provided. Please provide a CSS selector or a plain HTML element.`);return i};F.getElements=function(t,e){let i,r;if(t instanceof Array){r=[];try{for(i of t)r.push(this.getElement(i,e))}catch{r=null}}else if(typeof t=="string"){r=[];for(i of document.querySelectorAll(t))r.push(i)}else t.nodeType!=null&&(r=[t]);if(r==null||!r.length)throw new Error(`Invalid \`${e}\` option provided. Please provide a CSS selector, a plain HTML element or a list of those.`);return r};F.confirm=function(t,e,i){if(window.confirm(t))return e();if(i!=null)return i()};F.isValidFile=function(t,e){if(!e)return!0;e=e.split(",");let i=t.type,r=i.replace(/\/.*$/,"");for(let n of e)if(n=n.trim(),n.charAt(0)==="."){if(t.name.toLowerCase().indexOf(n.toLowerCase(),t.name.length-n.length)!==-1)return!0}else if(/\/\*$/.test(n)){if(r===n.replace(/\/.*$/,""))return!0}else if(i===n)return!0;return!1};typeof jQuery<"u"&&jQuery!==null&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new F(this,t)})});F.ADDED="added";F.QUEUED="queued";F.ACCEPTED=F.QUEUED;F.UPLOADING="uploading";F.PROCESSING=F.UPLOADING;F.CANCELED="canceled";F.ERROR="error";F.SUCCESS="success";let co=function(t){t.naturalWidth;let e=t.naturalHeight,i=document.createElement("canvas");i.width=1,i.height=e;let r=i.getContext("2d");r.drawImage(t,0,0);let{data:n}=r.getImageData(1,0,1,e),s=0,o=e,a=e;for(;a>s;)n[(a-1)*4+3]===0?o=a:s=a,a=o+s>>1;let u=a/e;return u===0?1:u};var fo=function(t,e,i,r,n,s,o,a,u,c){let p=co(e);return t.drawImage(e,i,r,n,s,o,a,u,c/p)};class Bn{static initClass(){this.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}static encode64(e){let i="",r,n,s="",o,a,u,c="",p=0;for(;r=e[p++],n=e[p++],s=e[p++],o=r>>2,a=(r&3)<<4|n>>4,u=(n&15)<<2|s>>6,c=s&63,isNaN(n)?u=c=64:isNaN(s)&&(c=64),i=i+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(u)+this.KEY_STR.charAt(c),r=n=s="",o=a=u=c="",p<e.length;);return i}static restore(e,i){if(!e.match("data:image/jpeg;base64,"))return i;let r=this.decode64(e.replace("data:image/jpeg;base64,","")),n=this.slice2Segments(r),s=this.exifManipulation(i,n);return`data:image/jpeg;base64,${this.encode64(s)}`}static exifManipulation(e,i){let r=this.getExifArray(i),n=this.insertExif(e,r);return new Uint8Array(n)}static getExifArray(e){let i,r=0;for(;r<e.length;){if(i=e[r],i[0]===255&i[1]===225)return i;r++}return[]}static insertExif(e,i){let r=e.replace("data:image/jpeg;base64,",""),n=this.decode64(r),s=n.indexOf(255,3),o=n.slice(0,s),a=n.slice(s),u=o;return u=u.concat(i),u=u.concat(a),u}static slice2Segments(e){let i=0,r=[];for(;;){var n;if(e[i]===255&e[i+1]===218)break;if(e[i]===255&e[i+1]===216)i+=2;else{n=e[i+2]*256+e[i+3];let s=i+n+2,o=e.slice(i,s);r.push(o),i=s}if(i>e.length)break}return r}static decode64(e){let i,r,n="",s,o,a,u="",c=0,p=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&console.warn(`There were invalid base64 characters in the input text.
Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='
Expect errors in decoding.`),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s=this.KEY_STR.indexOf(e.charAt(c++)),o=this.KEY_STR.indexOf(e.charAt(c++)),a=this.KEY_STR.indexOf(e.charAt(c++)),u=this.KEY_STR.indexOf(e.charAt(c++)),i=s<<2|o>>4,r=(o&15)<<4|a>>2,n=(a&3)<<6|u,p.push(i),a!==64&&p.push(r),u!==64&&p.push(n),i=r=n="",s=o=a=u="",c<e.length;);return p}}Bn.initClass();function po(t,e){return typeof t<"u"&&t!==null?e(t):void 0}function go(t,e,i){if(typeof t<"u"&&t!==null&&typeof t[e]=="function")return i(t,e)}const mo="/js/noiseProcessor.js",yo="/audio/behold.mp3";class _o{audioContext;audioBuffer=null;sourceNode=null;gainNode;analyserNode;workletNode;pausedAt=0;startTime;isPlaying=!1;messagePort;mutexBuffer;mutex;byteFreqs;volumeBuffer;soundBuffer;volumeArray;soundArray;soundArraySwapper;audioReadyPromise;audioReadyResolver;audioReady=!1;analyzing=!1;defaultAudioBuffer;audioUploaded=!1;constructor(){this.audioContext=new AudioContext,this.analyserNode=this.audioContext.createAnalyser(),this.byteFreqs=new Uint8Array(this.analyserNode.frequencyBinCount),this.audioReadyPromise=new Promise(e=>{this.audioReadyResolver=e})}async init(e,i){if(console.log("initing"),this.audioContext?.state!=="closed"&&await this.audioContext.close(),console.log("1"),this.audioContext=new AudioContext,console.log("2"),this.analyserNode=this.audioContext.createAnalyser(),console.log("3"),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=void 0),console.log("4"),!this.defaultAudioBuffer){console.log("5");const r=await fetch(yo);if(!r.ok)throw new Error(`Failed to fetch audio file: ${r.statusText}`);console.log("6");const n=await r.arrayBuffer();console.log("7",n);try{this.defaultAudioBuffer=await this.audioContext.decodeAudioData(n)}catch{console.warn("couldn't decode the audio.")}}if(console.log("8"),e){console.log("music file exists"),this.audioUploaded=!0;try{this.audioBuffer=await this.audioContext.decodeAudioData(await e.arrayBuffer())}catch{console.warn("couldn't decode the audio.")}}else console.log("music file doesnt exist");await this.audioContext.audioWorklet.addModule(mo),this.workletNode||(this.workletNode=new AudioWorkletNode(this.audioContext,"noise-processor"),this.messagePort=i,this.messagePort&&(this.messagePort.onmessage=this.handleWorkerMessage.bind(this)),this.workletNode.port.postMessage({reason:"initialize",mutexBuffer:this.mutexBuffer,volumeBuffer:this.volumeBuffer})),this.audioReadyResolver()}firstStart(){this.play(),window.removeEventListener("mousedown",wo)}handleWorkerMessage(e){e.data.reason==="audioConnectionRequest"?this.messagePort.postMessage({reason:"audioConnected",frequencyBinCount:this.analyserNode.frequencyBinCount}):e.data.reason==="sharedBuffers"&&(this.mutexBuffer=e.data.mutexBuffer,this.mutex=new Int32Array(this.mutexBuffer),this.volumeBuffer=e.data.volumeBuffer,this.volumeArray=new Uint8Array(this.volumeBuffer),this.soundBuffer=e.data.soundBuffer,this.soundArray=new Float32Array(this.soundBuffer),this.workletNode.port.postMessage({reason:"initialize",mutexBuffer:this.mutexBuffer,volumeBuffer:this.volumeBuffer}),this.soundArraySwapper=new Float32Array(this.soundArray.length),console.log("sharedbuffer message received",this.messagePort))}async analyze(e){if(e&&(this.messagePort=e),this.isPlaying)return;if(this.isPlaying=!0,console.log("isPlaying",this.isPlaying),this.startTime=Date.now(),!this.audioBuffer&&!this.defaultAudioBuffer){console.error("Audio not loaded");return}if(this.audioContext.state==="suspended"&&(await this.audioContext.resume(),console.log("suspended, now resuming"),this.analyzing)){this.analyseAudio();return}this.messagePort&&(this.messagePort.onmessage=this.handleWorkerMessage.bind(this)),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.audioBuffer??this.defaultAudioBuffer,this.analyserNode.fftSize=2048;const i=this.analyserNode.frequencyBinCount;console.log("BUFFERLENGTH",i),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.sourceNode.connect(this.analyserNode).connect(this.workletNode).connect(this.gainNode).connect(this.audioContext.destination),this.pausedAt=0,this.sourceNode.start(0,this.pausedAt),this.startTime=this.audioContext.currentTime-this.pausedAt,this.sourceNode.onended=r=>{this.isPlaying=!1,this.analyzing=!1,window.dispatchEvent(new Event("audioPaused"))},this.analyzing=!0,this.analyseAudio()}async addMusic(e){await this.stop(),await this.init(e),await this.play()}analyseAudio(){Atomics.load(this.mutex,0)&1||(this.analyserNode.getByteFrequencyData(this.byteFreqs),this.getVolumeMax(this.byteFreqs),this.analyserNode.getFloatFrequencyData(this.soundArraySwapper),this.soundArray.set(this.soundArraySwapper),Atomics.or(this.mutex,0,1)),this.isPlaying&&(this.analyserNode.getFloatFrequencyData(this.soundArraySwapper),requestAnimationFrame(this.analyseAudio.bind(this)))}getVolumeMax(e){this.volumeArray[3]=Math.floor(e.reduce((i,r)=>r>i?r:i,0)%256)}toggleMute(){this.gainNode&&(this.gainNode.gain.value=this.gainNode.gain.value===0?1:0)}async play(){console.log("play",this.sourceNode,this.isPlaying,this.audioContext.state),this.audioReady||await this.audioReadyPromise,console.log("after audio ready",!!this.audioBuffer,this.isPlaying),this.audioReady=!0,(this.audioBuffer||this.defaultAudioBuffer)&&!this.isPlaying&&(console.log("should be playing"),await this.analyze(),window.dispatchEvent(new Event("audioPlaying")))}async playDefault(){this.isPlaying&&await this.stop(),await this.init(),await this.play()}async pause(){this.sourceNode&&this.isPlaying&&(console.log("PAUSING",this.sourceNode,this.isPlaying),await this.audioContext.suspend(),this.pausedAt=this.audioContext.currentTime-this.startTime,this.isPlaying=!1,window.dispatchEvent(new Event("audioPaused")))}async stop(){console.log("STOPPING"),this.sourceNode&&this.isPlaying&&(this.isPlaying=!1,this.analyzing=!1,this.analyzing=!1,await this.audioContext.suspend()),await this.audioContext.close(),this.audioBuffer=null}}const xe=new _o;function wo(){xe.firstStart()}var vo=0;function j(t,e,i,r,n,s){var o,a,u={};for(a in e)a=="ref"?o=e[a]:u[a]=e[a];var c={type:t,props:u,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--vo,__i:-1,__u:0,__source:n,__self:s};if(typeof t=="function"&&(o=t.defaultProps))for(a in o)u[a]===void 0&&(u[a]=o[a]);return q.vnode&&q.vnode(c),c}const bo=()=>{const t=to(null);return Rt(()=>{F.autoDiscover=!1;const e=new F(t.current,{url:"/file/post",maxFilesize:200,maxFiles:10,autoProcessQueue:!1,addRemoveLinks:!0,init:function(){this.on("addedfile",i=>{console.log("Added file:",i),xe.addMusic(i)}),this.on("removedfile",i=>{console.log("Removed file:",i)})}});return()=>{e.destroy()}},[]),j(we,{children:j("div",{ref:t,className:"dropzone bg-gray-500 hover:bg-purple-200 opacity-70 hover:opacity-80 text-grey-200 bg-red cursor-not-allowed",children:j("div",{class:"dz-message","data-dz-message":!0,children:j("span",{children:"Choose some music from your machine."})})})})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pn=Symbol("Comlink.proxy"),Eo=Symbol("Comlink.endpoint"),xo=Symbol("Comlink.releaseProxy"),Ut=Symbol("Comlink.finalizer"),dt=Symbol("Comlink.thrown"),Dn=t=>typeof t=="object"&&t!==null||typeof t=="function",Co={canHandle:t=>Dn(t)&&t[Pn],serialize(t){const{port1:e,port2:i}=new MessageChannel;return On(t,e),[i,[i]]},deserialize(t){return t.start(),zn(t)}},Ao={canHandle:t=>Dn(t)&&dt in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Tt=new Map([["proxy",Co],["throw",Ao]]);function Ro(t,e){for(const i of t)if(e===i||i==="*"||i instanceof RegExp&&i.test(e))return!0;return!1}function On(t,e=globalThis,i=["*"]){e.addEventListener("message",function r(n){if(!n||!n.data)return;if(!Ro(i,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:s,type:o,path:a}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(Ee);let c;try{const p=a.slice(0,-1).reduce((y,m)=>y[m],t),d=a.reduce((y,m)=>y[m],t);switch(o){case"GET":c=d;break;case"SET":p[a.slice(-1)[0]]=Ee(n.data.value),c=!0;break;case"APPLY":c=d.apply(p,u);break;case"CONSTRUCT":{const y=new d(...u);c=Wn(y)}break;case"ENDPOINT":{const{port1:y,port2:m}=new MessageChannel;On(t,m),c=Io(y,[y])}break;case"RELEASE":c=void 0;break;default:return}}catch(p){c={value:p,[dt]:0}}Promise.resolve(c).catch(p=>({value:p,[dt]:0})).then(p=>{const[d,y]=bt(p);e.postMessage(Object.assign(Object.assign({},d),{id:s}),y),o==="RELEASE"&&(e.removeEventListener("message",r),Un(e),Ut in t&&typeof t[Ut]=="function"&&t[Ut]())}).catch(p=>{const[d,y]=bt({value:new TypeError("Unserializable return value"),[dt]:0});e.postMessage(Object.assign(Object.assign({},d),{id:s}),y)})}),e.start&&e.start()}function To(t){return t.constructor.name==="MessagePort"}function Un(t){To(t)&&t.close()}function zn(t,e){return gi(t,[],e)}function it(t){if(t)throw new Error("Proxy has been released and is not useable")}function Hn(t){return Le(t,{type:"RELEASE"}).then(()=>{Un(t)})}const wt=new WeakMap,vt="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(wt.get(t)||0)-1;wt.set(t,e),e===0&&Hn(t)});function So(t,e){const i=(wt.get(e)||0)+1;wt.set(e,i),vt&&vt.register(t,e,t)}function Fo(t){vt&&vt.unregister(t)}function gi(t,e=[],i=function(){}){let r=!1;const n=new Proxy(i,{get(s,o){if(it(r),o===xo)return()=>{Fo(n),Hn(t),r=!0};if(o==="then"){if(e.length===0)return{then:()=>n};const a=Le(t,{type:"GET",path:e.map(u=>u.toString())}).then(Ee);return a.then.bind(a)}return gi(t,[...e,o])},set(s,o,a){it(r);const[u,c]=bt(a);return Le(t,{type:"SET",path:[...e,o].map(p=>p.toString()),value:u},c).then(Ee)},apply(s,o,a){it(r);const u=e[e.length-1];if(u===Eo)return Le(t,{type:"ENDPOINT"}).then(Ee);if(u==="bind")return gi(t,e.slice(0,-1));const[c,p]=yr(a);return Le(t,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:c},p).then(Ee)},construct(s,o){it(r);const[a,u]=yr(o);return Le(t,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:a},u).then(Ee)}});return So(n,t),n}function Mo(t){return Array.prototype.concat.apply([],t)}function yr(t){const e=t.map(bt);return[e.map(i=>i[0]),Mo(e.map(i=>i[1]))]}const qn=new WeakMap;function Io(t,e){return qn.set(t,e),t}function Wn(t){return Object.assign(t,{[Pn]:!0})}function bt(t){for(const[e,i]of Tt)if(i.canHandle(t)){const[r,n]=i.serialize(t);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:t},qn.get(t)||[]]}function Ee(t){switch(t.type){case"HANDLER":return Tt.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Le(t,e,i){return new Promise(r=>{const n=ko();t.addEventListener("message",function s(o){!o.data||!o.data.id||o.data.id!==n||(t.removeEventListener("message",s),r(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),i)})}function ko(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Di(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Lo(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),i}var St={};St.byteLength=Po;var jn=St.toByteArray=Oo,_r=St.fromByteArray=Ho,ue=[],se=[],No=typeof Uint8Array<"u"?Uint8Array:Array,zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ie=0,Bo=zt.length;Ie<Bo;++Ie)ue[Ie]=zt[Ie],se[zt.charCodeAt(Ie)]=Ie;se[45]=62;se[95]=63;function $n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");i===-1&&(i=e);var r=i===e?0:4-i%4;return[i,r]}function Po(t){var e=$n(t),i=e[0],r=e[1];return(i+r)*3/4-r}function Do(t,e,i){return(e+i)*3/4-i}function Oo(t){var e,i=$n(t),r=i[0],n=i[1],s=new No(Do(t,r,n)),o=0,a=n>0?r-4:r,u;for(u=0;u<a;u+=4)e=se[t.charCodeAt(u)]<<18|se[t.charCodeAt(u+1)]<<12|se[t.charCodeAt(u+2)]<<6|se[t.charCodeAt(u+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=se[t.charCodeAt(u)]<<2|se[t.charCodeAt(u+1)]>>4,s[o++]=e&255),n===1&&(e=se[t.charCodeAt(u)]<<10|se[t.charCodeAt(u+1)]<<4|se[t.charCodeAt(u+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Uo(t){return ue[t>>18&63]+ue[t>>12&63]+ue[t>>6&63]+ue[t&63]}function zo(t,e,i){for(var r,n=[],s=e;s<i;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),n.push(Uo(r));return n.join("")}function Ho(t){for(var e,i=t.length,r=i%3,n=[],s=16383,o=0,a=i-r;o<a;o+=s)n.push(zo(t,o,o+s>a?a:o+s));return r===1?(e=t[i-1],n.push(ue[e>>2]+ue[e<<4&63]+"==")):r===2&&(e=(t[i-2]<<8)+t[i-1],n.push(ue[e>>10]+ue[e>>4&63]+ue[e<<2&63]+"=")),n.join("")}const qo=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ke={collect:["Kumulate","Kollekt","Kompile"],organize:["Kategorize","Katolog","Kurate"],communicate:["Kommunikate","Kaskade","Konvey"]},Wo=()=>`${ke.collect[Math.floor(Math.random()*ke.collect.length)]}, ${ke.organize[Math.floor(Math.random()*ke.organize.length)]}, ${ke.communicate[Math.floor(Math.random()*ke.communicate.length)]}`;async function Yn(){jo(await navigator.storage.getDirectory())}async function jo(t){}const $o=t=>new Promise(e=>setTimeout(e,t)),Yo=new TextDecoder,Go=new TextEncoder;function rt(t,...e){if(e.length===0)return new Uint8Array([t]);let i=0;const r=e.map(o=>{let a;return typeof o=="string"?a=Go.encode(o):typeof o=="number"?o<256&&o>=0?a=new Uint8Array([o]):a=Vo(o):a=o instanceof Uint8Array?o:new Uint8Array(o),i+=a.length,a}),n=new Uint8Array(1+i);n[0]=t;let s=1;for(const o of r)n.set(o,s),s+=o.length;return n}function wr(t){return Yo.decode(t)}function Vo(t){const e=new Uint8Array(8);return new DataView(e.buffer).setBigUint64(0,BigInt(t),!0),e}async function Xo(t){const e=jn(t);return await crypto.subtle.importKey("raw",e.buffer,{name:"AES-GCM"},!0,["encrypt","decrypt"])}function Qo(t){for(let e=t.length-1;e>=0;e--)if(t[e]<255){t[e]++;break}else t[e]=0}window.destroyDB=Yn;Yn();function Ko(t){return new Worker("/assets/worker-z0tPGv89.js",{type:"module",name:t?.name})}var He;typeof window<"u"?He=window:typeof self<"u"||typeof self<"u"?He=self:He={};var Zo=He;const Jo=Di(Zo);var Gn={exports:{}},Q=Gn.exports={},le,he;function mi(){throw new Error("setTimeout has not been defined")}function yi(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?le=setTimeout:le=mi}catch{le=mi}try{typeof clearTimeout=="function"?he=clearTimeout:he=yi}catch{he=yi}})();function Vn(t){if(le===setTimeout)return setTimeout(t,0);if((le===mi||!le)&&setTimeout)return le=setTimeout,setTimeout(t,0);try{return le(t,0)}catch{try{return le.call(null,t,0)}catch{return le.call(this,t,0)}}}function ea(t){if(he===clearTimeout)return clearTimeout(t);if((he===yi||!he)&&clearTimeout)return he=clearTimeout,clearTimeout(t);try{return he(t)}catch{try{return he.call(null,t)}catch{return he.call(this,t)}}}var de=[],Ne=!1,Ce,ft=-1;function ta(){!Ne||!Ce||(Ne=!1,Ce.length?de=Ce.concat(de):ft=-1,de.length&&Xn())}function Xn(){if(!Ne){var t=Vn(ta);Ne=!0;for(var e=de.length;e;){for(Ce=de,de=[];++ft<e;)Ce&&Ce[ft].run();ft=-1,e=de.length}Ce=null,Ne=!1,ea(t)}}Q.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];de.push(new Qn(t,e)),de.length===1&&!Ne&&Vn(Xn)};function Qn(t,e){this.fun=t,this.array=e}Qn.prototype.run=function(){this.fun.apply(null,this.array)};Q.title="browser";Q.browser=!0;Q.env={};Q.argv=[];Q.version="";Q.versions={};function pe(){}Q.on=pe;Q.addListener=pe;Q.once=pe;Q.off=pe;Q.removeListener=pe;Q.removeAllListeners=pe;Q.emit=pe;Q.prependListener=pe;Q.prependOnceListener=pe;Q.listeners=function(t){return[]};Q.binding=function(t){throw new Error("process.binding is not supported")};Q.cwd=function(){return"/"};Q.chdir=function(t){throw new Error("process.chdir is not supported")};Q.umask=function(){return 0};var Kn=Gn.exports;const ia=Di(Kn),ra=Ys({__proto__:null,default:ia},[Kn]);var _i={exports:{}},Ht,vr;function na(){if(vr)return Ht;vr=1;var t=1e3,e=t*60,i=e*60,r=i*24,n=r*7,s=r*365.25;Ht=function(p,d){d=d||{};var y=typeof p;if(y==="string"&&p.length>0)return o(p);if(y==="number"&&isFinite(p))return d.long?u(p):a(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function o(p){if(p=String(p),!(p.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(d){var y=parseFloat(d[1]),m=(d[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return y*s;case"weeks":case"week":case"w":return y*n;case"days":case"day":case"d":return y*r;case"hours":case"hour":case"hrs":case"hr":case"h":return y*i;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function a(p){var d=Math.abs(p);return d>=r?Math.round(p/r)+"d":d>=i?Math.round(p/i)+"h":d>=e?Math.round(p/e)+"m":d>=t?Math.round(p/t)+"s":p+"ms"}function u(p){var d=Math.abs(p);return d>=r?c(p,d,r,"day"):d>=i?c(p,d,i,"hour"):d>=e?c(p,d,e,"minute"):d>=t?c(p,d,t,"second"):p+" ms"}function c(p,d,y,m){var w=d>=y*1.5;return Math.round(p/y)+" "+m+(w?"s":"")}return Ht}function sa(t){i.debug=i,i.default=i,i.coerce=u,i.disable=s,i.enable=n,i.enabled=o,i.humanize=na(),i.destroy=c,Object.keys(t).forEach(p=>{i[p]=t[p]}),i.names=[],i.skips=[],i.formatters={};function e(p){let d=0;for(let y=0;y<p.length;y++)d=(d<<5)-d+p.charCodeAt(y),d|=0;return i.colors[Math.abs(d)%i.colors.length]}i.selectColor=e;function i(p){let d,y=null,m,w;function b(...E){if(!b.enabled)return;const _=b,x=Number(new Date),A=x-(d||x);_.diff=A,_.prev=d,_.curr=x,d=x,E[0]=i.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let T=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(M,k)=>{if(M==="%%")return"%";T++;const O=i.formatters[k];if(typeof O=="function"){const P=E[T];M=O.call(_,P),E.splice(T,1),T--}return M}),i.formatArgs.call(_,E),(_.log||i.log).apply(_,E)}return b.namespace=p,b.useColors=i.useColors(),b.color=i.selectColor(p),b.extend=r,b.destroy=i.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(m!==i.namespaces&&(m=i.namespaces,w=i.enabled(p)),w),set:E=>{y=E}}),typeof i.init=="function"&&i.init(b),b}function r(p,d){const y=i(this.namespace+(typeof d>"u"?":":d)+p);return y.log=this.log,y}function n(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];let d;const y=(typeof p=="string"?p:"").split(/[\s,]+/),m=y.length;for(d=0;d<m;d++)y[d]&&(p=y[d].replace(/\*/g,".*?"),p[0]==="-"?i.skips.push(new RegExp("^"+p.slice(1)+"$")):i.names.push(new RegExp("^"+p+"$")))}function s(){const p=[...i.names.map(a),...i.skips.map(a).map(d=>"-"+d)].join(",");return i.enable(""),p}function o(p){if(p[p.length-1]==="*")return!0;let d,y;for(d=0,y=i.skips.length;d<y;d++)if(i.skips[d].test(p))return!1;for(d=0,y=i.names.length;d<y;d++)if(i.names[d].test(p))return!0;return!1}function a(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function u(p){return p instanceof Error?p.stack||p.message:p}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}var oa=sa;(function(t,e){var i={};e.formatArgs=n,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;c.splice(1,0,p,"color: inherit");let d=0,y=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(d++,m==="%c"&&(y=d))}),c.splice(y,0,p)}e.log=console.debug||console.log||(()=>{});function s(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=i.DEBUG),c}function a(){try{return localStorage}catch{}}t.exports=oa(e);const{formatters:u}=t.exports;u.j=function(c){try{return JSON.stringify(c)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(_i,_i.exports);var aa=_i.exports,la=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},wi={exports:{}},vi={exports:{}},Te={},Oi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Oi.read=function(t,e,i,r,n){var s,o,a=n*8-r-1,u=(1<<a)-1,c=u>>1,p=-7,d=i?n-1:0,y=i?-1:1,m=t[e+d];for(d+=y,s=m&(1<<-p)-1,m>>=-p,p+=a;p>0;s=s*256+t[e+d],d+=y,p-=8);for(o=s&(1<<-p)-1,s>>=-p,p+=r;p>0;o=o*256+t[e+d],d+=y,p-=8);if(s===0)s=1-c;else{if(s===u)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(m?-1:1)*o*Math.pow(2,s-r)};Oi.write=function(t,e,i,r,n,s){var o,a,u,c=s*8-n-1,p=(1<<c)-1,d=p>>1,y=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:s-1,w=r?1:-1,b=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+d>=1?e+=y/u:e+=y*Math.pow(2,1-d),e*u>=2&&(o++,u/=2),o+d>=p?(a=0,o=p):o+d>=1?(a=(e*u-1)*Math.pow(2,n),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,n),o=0));n>=8;t[i+m]=a&255,m+=w,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;t[i+m]=o&255,m+=w,o/=256,c-=8);t[i+m-w]|=b*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=St,i=Oi,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=x,t.INSPECT_MAX_BYTES=50;const n=2147483647;t.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const f=new Uint8Array(1),l={foo:function(){return 42}};return Object.setPrototypeOf(l,Uint8Array.prototype),Object.setPrototypeOf(f,l),f.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(f){if(f>n)throw new RangeError('The value "'+f+'" is invalid for option "size"');const l=new Uint8Array(f);return Object.setPrototypeOf(l,a.prototype),l}function a(f,l,h){if(typeof f=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(f)}return u(f,l,h)}a.poolSize=8192;function u(f,l,h){if(typeof f=="string")return y(f,l);if(ArrayBuffer.isView(f))return w(f);if(f==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f);if(ae(f,ArrayBuffer)||f&&ae(f.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ae(f,SharedArrayBuffer)||f&&ae(f.buffer,SharedArrayBuffer)))return b(f,l,h);if(typeof f=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const g=f.valueOf&&f.valueOf();if(g!=null&&g!==f)return a.from(g,l,h);const v=E(f);if(v)return v;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof f[Symbol.toPrimitive]=="function")return a.from(f[Symbol.toPrimitive]("string"),l,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f)}a.from=function(f,l,h){return u(f,l,h)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function c(f){if(typeof f!="number")throw new TypeError('"size" argument must be of type number');if(f<0)throw new RangeError('The value "'+f+'" is invalid for option "size"')}function p(f,l,h){return c(f),f<=0?o(f):l!==void 0?typeof h=="string"?o(f).fill(l,h):o(f).fill(l):o(f)}a.alloc=function(f,l,h){return p(f,l,h)};function d(f){return c(f),o(f<0?0:_(f)|0)}a.allocUnsafe=function(f){return d(f)},a.allocUnsafeSlow=function(f){return d(f)};function y(f,l){if((typeof l!="string"||l==="")&&(l="utf8"),!a.isEncoding(l))throw new TypeError("Unknown encoding: "+l);const h=A(f,l)|0;let g=o(h);const v=g.write(f,l);return v!==h&&(g=g.slice(0,v)),g}function m(f){const l=f.length<0?0:_(f.length)|0,h=o(l);for(let g=0;g<l;g+=1)h[g]=f[g]&255;return h}function w(f){if(ae(f,Uint8Array)){const l=new Uint8Array(f);return b(l.buffer,l.byteOffset,l.byteLength)}return m(f)}function b(f,l,h){if(l<0||f.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(f.byteLength<l+(h||0))throw new RangeError('"length" is outside of buffer bounds');let g;return l===void 0&&h===void 0?g=new Uint8Array(f):h===void 0?g=new Uint8Array(f,l):g=new Uint8Array(f,l,h),Object.setPrototypeOf(g,a.prototype),g}function E(f){if(a.isBuffer(f)){const l=_(f.length)|0,h=o(l);return h.length===0||f.copy(h,0,0,l),h}if(f.length!==void 0)return typeof f.length!="number"||Dt(f.length)?o(0):m(f);if(f.type==="Buffer"&&Array.isArray(f.data))return m(f.data)}function _(f){if(f>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return f|0}function x(f){return+f!=f&&(f=0),a.alloc(+f)}a.isBuffer=function(l){return l!=null&&l._isBuffer===!0&&l!==a.prototype},a.compare=function(l,h){if(ae(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),ae(h,Uint8Array)&&(h=a.from(h,h.offset,h.byteLength)),!a.isBuffer(l)||!a.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(l===h)return 0;let g=l.length,v=h.length;for(let C=0,R=Math.min(g,v);C<R;++C)if(l[C]!==h[C]){g=l[C],v=h[C];break}return g<v?-1:v<g?1:0},a.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(l,h){if(!Array.isArray(l))throw new TypeError('"list" argument must be an Array of Buffers');if(l.length===0)return a.alloc(0);let g;if(h===void 0)for(h=0,g=0;g<l.length;++g)h+=l[g].length;const v=a.allocUnsafe(h);let C=0;for(g=0;g<l.length;++g){let R=l[g];if(ae(R,Uint8Array))C+R.length>v.length?(a.isBuffer(R)||(R=a.from(R)),R.copy(v,C)):Uint8Array.prototype.set.call(v,R,C);else if(a.isBuffer(R))R.copy(v,C);else throw new TypeError('"list" argument must be an Array of Buffers');C+=R.length}return v};function A(f,l){if(a.isBuffer(f))return f.length;if(ArrayBuffer.isView(f)||ae(f,ArrayBuffer))return f.byteLength;if(typeof f!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof f);const h=f.length,g=arguments.length>2&&arguments[2]===!0;if(!g&&h===0)return 0;let v=!1;for(;;)switch(l){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return Pt(f).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return tr(f).length;default:if(v)return g?-1:Pt(f).length;l=(""+l).toLowerCase(),v=!0}}a.byteLength=A;function T(f,l,h){let g=!1;if((l===void 0||l<0)&&(l=0),l>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,l>>>=0,h<=l))return"";for(f||(f="utf8");;)switch(f){case"hex":return Ds(this,l,h);case"utf8":case"utf-8":return I(this,l,h);case"ascii":return Bs(this,l,h);case"latin1":case"binary":return Ps(this,l,h);case"base64":return ee(this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Os(this,l,h);default:if(g)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),g=!0}}a.prototype._isBuffer=!0;function S(f,l,h){const g=f[l];f[l]=f[h],f[h]=g}a.prototype.swap16=function(){const l=this.length;if(l%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<l;h+=2)S(this,h,h+1);return this},a.prototype.swap32=function(){const l=this.length;if(l%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<l;h+=4)S(this,h,h+3),S(this,h+1,h+2);return this},a.prototype.swap64=function(){const l=this.length;if(l%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<l;h+=8)S(this,h,h+7),S(this,h+1,h+6),S(this,h+2,h+5),S(this,h+3,h+4);return this},a.prototype.toString=function(){const l=this.length;return l===0?"":arguments.length===0?I(this,0,l):T.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(l){if(!a.isBuffer(l))throw new TypeError("Argument must be a Buffer");return this===l?!0:a.compare(this,l)===0},a.prototype.inspect=function(){let l="";const h=t.INSPECT_MAX_BYTES;return l=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(l+=" ... "),"<Buffer "+l+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(l,h,g,v,C){if(ae(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),!a.isBuffer(l))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof l);if(h===void 0&&(h=0),g===void 0&&(g=l?l.length:0),v===void 0&&(v=0),C===void 0&&(C=this.length),h<0||g>l.length||v<0||C>this.length)throw new RangeError("out of range index");if(v>=C&&h>=g)return 0;if(v>=C)return-1;if(h>=g)return 1;if(h>>>=0,g>>>=0,v>>>=0,C>>>=0,this===l)return 0;let R=C-v,L=g-h;const $=Math.min(R,L),W=this.slice(v,C),Y=l.slice(h,g);for(let z=0;z<$;++z)if(W[z]!==Y[z]){R=W[z],L=Y[z];break}return R<L?-1:L<R?1:0};function M(f,l,h,g,v){if(f.length===0)return-1;if(typeof h=="string"?(g=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,Dt(h)&&(h=v?0:f.length-1),h<0&&(h=f.length+h),h>=f.length){if(v)return-1;h=f.length-1}else if(h<0)if(v)h=0;else return-1;if(typeof l=="string"&&(l=a.from(l,g)),a.isBuffer(l))return l.length===0?-1:k(f,l,h,g,v);if(typeof l=="number")return l=l&255,typeof Uint8Array.prototype.indexOf=="function"?v?Uint8Array.prototype.indexOf.call(f,l,h):Uint8Array.prototype.lastIndexOf.call(f,l,h):k(f,[l],h,g,v);throw new TypeError("val must be string, number or Buffer")}function k(f,l,h,g,v){let C=1,R=f.length,L=l.length;if(g!==void 0&&(g=String(g).toLowerCase(),g==="ucs2"||g==="ucs-2"||g==="utf16le"||g==="utf-16le")){if(f.length<2||l.length<2)return-1;C=2,R/=2,L/=2,h/=2}function $(Y,z){return C===1?Y[z]:Y.readUInt16BE(z*C)}let W;if(v){let Y=-1;for(W=h;W<R;W++)if($(f,W)===$(l,Y===-1?0:W-Y)){if(Y===-1&&(Y=W),W-Y+1===L)return Y*C}else Y!==-1&&(W-=W-Y),Y=-1}else for(h+L>R&&(h=R-L),W=h;W>=0;W--){let Y=!0;for(let z=0;z<L;z++)if($(f,W+z)!==$(l,z)){Y=!1;break}if(Y)return W}return-1}a.prototype.includes=function(l,h,g){return this.indexOf(l,h,g)!==-1},a.prototype.indexOf=function(l,h,g){return M(this,l,h,g,!0)},a.prototype.lastIndexOf=function(l,h,g){return M(this,l,h,g,!1)};function O(f,l,h,g){h=Number(h)||0;const v=f.length-h;g?(g=Number(g),g>v&&(g=v)):g=v;const C=l.length;g>C/2&&(g=C/2);let R;for(R=0;R<g;++R){const L=parseInt(l.substr(R*2,2),16);if(Dt(L))return R;f[h+R]=L}return R}function P(f,l,h,g){return et(Pt(l,f.length-h),f,h,g)}function H(f,l,h,g){return et(qs(l),f,h,g)}function J(f,l,h,g){return et(tr(l),f,h,g)}function V(f,l,h,g){return et(Ws(l,f.length-h),f,h,g)}a.prototype.write=function(l,h,g,v){if(h===void 0)v="utf8",g=this.length,h=0;else if(g===void 0&&typeof h=="string")v=h,g=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(g)?(g=g>>>0,v===void 0&&(v="utf8")):(v=g,g=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const C=this.length-h;if((g===void 0||g>C)&&(g=C),l.length>0&&(g<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");v||(v="utf8");let R=!1;for(;;)switch(v){case"hex":return O(this,l,h,g);case"utf8":case"utf-8":return P(this,l,h,g);case"ascii":case"latin1":case"binary":return H(this,l,h,g);case"base64":return J(this,l,h,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,l,h,g);default:if(R)throw new TypeError("Unknown encoding: "+v);v=(""+v).toLowerCase(),R=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ee(f,l,h){return l===0&&h===f.length?e.fromByteArray(f):e.fromByteArray(f.slice(l,h))}function I(f,l,h){h=Math.min(f.length,h);const g=[];let v=l;for(;v<h;){const C=f[v];let R=null,L=C>239?4:C>223?3:C>191?2:1;if(v+L<=h){let $,W,Y,z;switch(L){case 1:C<128&&(R=C);break;case 2:$=f[v+1],($&192)===128&&(z=(C&31)<<6|$&63,z>127&&(R=z));break;case 3:$=f[v+1],W=f[v+2],($&192)===128&&(W&192)===128&&(z=(C&15)<<12|($&63)<<6|W&63,z>2047&&(z<55296||z>57343)&&(R=z));break;case 4:$=f[v+1],W=f[v+2],Y=f[v+3],($&192)===128&&(W&192)===128&&(Y&192)===128&&(z=(C&15)<<18|($&63)<<12|(W&63)<<6|Y&63,z>65535&&z<1114112&&(R=z))}}R===null?(R=65533,L=1):R>65535&&(R-=65536,g.push(R>>>10&1023|55296),R=56320|R&1023),g.push(R),v+=L}return Ns(g)}const ge=4096;function Ns(f){const l=f.length;if(l<=ge)return String.fromCharCode.apply(String,f);let h="",g=0;for(;g<l;)h+=String.fromCharCode.apply(String,f.slice(g,g+=ge));return h}function Bs(f,l,h){let g="";h=Math.min(f.length,h);for(let v=l;v<h;++v)g+=String.fromCharCode(f[v]&127);return g}function Ps(f,l,h){let g="";h=Math.min(f.length,h);for(let v=l;v<h;++v)g+=String.fromCharCode(f[v]);return g}function Ds(f,l,h){const g=f.length;(!l||l<0)&&(l=0),(!h||h<0||h>g)&&(h=g);let v="";for(let C=l;C<h;++C)v+=js[f[C]];return v}function Os(f,l,h){const g=f.slice(l,h);let v="";for(let C=0;C<g.length-1;C+=2)v+=String.fromCharCode(g[C]+g[C+1]*256);return v}a.prototype.slice=function(l,h){const g=this.length;l=~~l,h=h===void 0?g:~~h,l<0?(l+=g,l<0&&(l=0)):l>g&&(l=g),h<0?(h+=g,h<0&&(h=0)):h>g&&(h=g),h<l&&(h=l);const v=this.subarray(l,h);return Object.setPrototypeOf(v,a.prototype),v};function te(f,l,h){if(f%1!==0||f<0)throw new RangeError("offset is not uint");if(f+l>h)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(l,h,g){l=l>>>0,h=h>>>0,g||te(l,h,this.length);let v=this[l],C=1,R=0;for(;++R<h&&(C*=256);)v+=this[l+R]*C;return v},a.prototype.readUintBE=a.prototype.readUIntBE=function(l,h,g){l=l>>>0,h=h>>>0,g||te(l,h,this.length);let v=this[l+--h],C=1;for(;h>0&&(C*=256);)v+=this[l+--h]*C;return v},a.prototype.readUint8=a.prototype.readUInt8=function(l,h){return l=l>>>0,h||te(l,1,this.length),this[l]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(l,h){return l=l>>>0,h||te(l,2,this.length),this[l]|this[l+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(l,h){return l=l>>>0,h||te(l,2,this.length),this[l]<<8|this[l+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(l,h){return l=l>>>0,h||te(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+this[l+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(l,h){return l=l>>>0,h||te(l,4,this.length),this[l]*16777216+(this[l+1]<<16|this[l+2]<<8|this[l+3])},a.prototype.readBigUInt64LE=me(function(l){l=l>>>0,Me(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&ze(l,this.length-8);const v=h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24,C=this[++l]+this[++l]*2**8+this[++l]*2**16+g*2**24;return BigInt(v)+(BigInt(C)<<BigInt(32))}),a.prototype.readBigUInt64BE=me(function(l){l=l>>>0,Me(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&ze(l,this.length-8);const v=h*2**24+this[++l]*2**16+this[++l]*2**8+this[++l],C=this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+g;return(BigInt(v)<<BigInt(32))+BigInt(C)}),a.prototype.readIntLE=function(l,h,g){l=l>>>0,h=h>>>0,g||te(l,h,this.length);let v=this[l],C=1,R=0;for(;++R<h&&(C*=256);)v+=this[l+R]*C;return C*=128,v>=C&&(v-=Math.pow(2,8*h)),v},a.prototype.readIntBE=function(l,h,g){l=l>>>0,h=h>>>0,g||te(l,h,this.length);let v=h,C=1,R=this[l+--v];for(;v>0&&(C*=256);)R+=this[l+--v]*C;return C*=128,R>=C&&(R-=Math.pow(2,8*h)),R},a.prototype.readInt8=function(l,h){return l=l>>>0,h||te(l,1,this.length),this[l]&128?(255-this[l]+1)*-1:this[l]},a.prototype.readInt16LE=function(l,h){l=l>>>0,h||te(l,2,this.length);const g=this[l]|this[l+1]<<8;return g&32768?g|4294901760:g},a.prototype.readInt16BE=function(l,h){l=l>>>0,h||te(l,2,this.length);const g=this[l+1]|this[l]<<8;return g&32768?g|4294901760:g},a.prototype.readInt32LE=function(l,h){return l=l>>>0,h||te(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},a.prototype.readInt32BE=function(l,h){return l=l>>>0,h||te(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},a.prototype.readBigInt64LE=me(function(l){l=l>>>0,Me(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&ze(l,this.length-8);const v=this[l+4]+this[l+5]*2**8+this[l+6]*2**16+(g<<24);return(BigInt(v)<<BigInt(32))+BigInt(h+this[++l]*2**8+this[++l]*2**16+this[++l]*2**24)}),a.prototype.readBigInt64BE=me(function(l){l=l>>>0,Me(l,"offset");const h=this[l],g=this[l+7];(h===void 0||g===void 0)&&ze(l,this.length-8);const v=(h<<24)+this[++l]*2**16+this[++l]*2**8+this[++l];return(BigInt(v)<<BigInt(32))+BigInt(this[++l]*2**24+this[++l]*2**16+this[++l]*2**8+g)}),a.prototype.readFloatLE=function(l,h){return l=l>>>0,h||te(l,4,this.length),i.read(this,l,!0,23,4)},a.prototype.readFloatBE=function(l,h){return l=l>>>0,h||te(l,4,this.length),i.read(this,l,!1,23,4)},a.prototype.readDoubleLE=function(l,h){return l=l>>>0,h||te(l,8,this.length),i.read(this,l,!0,52,8)},a.prototype.readDoubleBE=function(l,h){return l=l>>>0,h||te(l,8,this.length),i.read(this,l,!1,52,8)};function re(f,l,h,g,v,C){if(!a.isBuffer(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>v||l<C)throw new RangeError('"value" argument is out of bounds');if(h+g>f.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(l,h,g,v){if(l=+l,h=h>>>0,g=g>>>0,!v){const L=Math.pow(2,8*g)-1;re(this,l,h,g,L,0)}let C=1,R=0;for(this[h]=l&255;++R<g&&(C*=256);)this[h+R]=l/C&255;return h+g},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(l,h,g,v){if(l=+l,h=h>>>0,g=g>>>0,!v){const L=Math.pow(2,8*g)-1;re(this,l,h,g,L,0)}let C=g-1,R=1;for(this[h+C]=l&255;--C>=0&&(R*=256);)this[h+C]=l/R&255;return h+g},a.prototype.writeUint8=a.prototype.writeUInt8=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,1,255,0),this[h]=l&255,h+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,65535,0),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,65535,0),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,4294967295,0),this[h+3]=l>>>24,this[h+2]=l>>>16,this[h+1]=l>>>8,this[h]=l&255,h+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,4294967295,0),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4};function Vi(f,l,h,g,v){er(l,g,v,f,h,7);let C=Number(l&BigInt(4294967295));f[h++]=C,C=C>>8,f[h++]=C,C=C>>8,f[h++]=C,C=C>>8,f[h++]=C;let R=Number(l>>BigInt(32)&BigInt(4294967295));return f[h++]=R,R=R>>8,f[h++]=R,R=R>>8,f[h++]=R,R=R>>8,f[h++]=R,h}function Xi(f,l,h,g,v){er(l,g,v,f,h,7);let C=Number(l&BigInt(4294967295));f[h+7]=C,C=C>>8,f[h+6]=C,C=C>>8,f[h+5]=C,C=C>>8,f[h+4]=C;let R=Number(l>>BigInt(32)&BigInt(4294967295));return f[h+3]=R,R=R>>8,f[h+2]=R,R=R>>8,f[h+1]=R,R=R>>8,f[h]=R,h+8}a.prototype.writeBigUInt64LE=me(function(l,h=0){return Vi(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=me(function(l,h=0){return Xi(this,l,h,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(l,h,g,v){if(l=+l,h=h>>>0,!v){const $=Math.pow(2,8*g-1);re(this,l,h,g,$-1,-$)}let C=0,R=1,L=0;for(this[h]=l&255;++C<g&&(R*=256);)l<0&&L===0&&this[h+C-1]!==0&&(L=1),this[h+C]=(l/R>>0)-L&255;return h+g},a.prototype.writeIntBE=function(l,h,g,v){if(l=+l,h=h>>>0,!v){const $=Math.pow(2,8*g-1);re(this,l,h,g,$-1,-$)}let C=g-1,R=1,L=0;for(this[h+C]=l&255;--C>=0&&(R*=256);)l<0&&L===0&&this[h+C+1]!==0&&(L=1),this[h+C]=(l/R>>0)-L&255;return h+g},a.prototype.writeInt8=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,1,127,-128),l<0&&(l=255+l+1),this[h]=l&255,h+1},a.prototype.writeInt16LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,32767,-32768),this[h]=l&255,this[h+1]=l>>>8,h+2},a.prototype.writeInt16BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,2,32767,-32768),this[h]=l>>>8,this[h+1]=l&255,h+2},a.prototype.writeInt32LE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,2147483647,-2147483648),this[h]=l&255,this[h+1]=l>>>8,this[h+2]=l>>>16,this[h+3]=l>>>24,h+4},a.prototype.writeInt32BE=function(l,h,g){return l=+l,h=h>>>0,g||re(this,l,h,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),this[h]=l>>>24,this[h+1]=l>>>16,this[h+2]=l>>>8,this[h+3]=l&255,h+4},a.prototype.writeBigInt64LE=me(function(l,h=0){return Vi(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=me(function(l,h=0){return Xi(this,l,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Qi(f,l,h,g,v,C){if(h+g>f.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function Ki(f,l,h,g,v){return l=+l,h=h>>>0,v||Qi(f,l,h,4),i.write(f,l,h,g,23,4),h+4}a.prototype.writeFloatLE=function(l,h,g){return Ki(this,l,h,!0,g)},a.prototype.writeFloatBE=function(l,h,g){return Ki(this,l,h,!1,g)};function Zi(f,l,h,g,v){return l=+l,h=h>>>0,v||Qi(f,l,h,8),i.write(f,l,h,g,52,8),h+8}a.prototype.writeDoubleLE=function(l,h,g){return Zi(this,l,h,!0,g)},a.prototype.writeDoubleBE=function(l,h,g){return Zi(this,l,h,!1,g)},a.prototype.copy=function(l,h,g,v){if(!a.isBuffer(l))throw new TypeError("argument should be a Buffer");if(g||(g=0),!v&&v!==0&&(v=this.length),h>=l.length&&(h=l.length),h||(h=0),v>0&&v<g&&(v=g),v===g||l.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("sourceEnd out of bounds");v>this.length&&(v=this.length),l.length-h<v-g&&(v=l.length-h+g);const C=v-g;return this===l&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,g,v):Uint8Array.prototype.set.call(l,this.subarray(g,v),h),C},a.prototype.fill=function(l,h,g,v){if(typeof l=="string"){if(typeof h=="string"?(v=h,h=0,g=this.length):typeof g=="string"&&(v=g,g=this.length),v!==void 0&&typeof v!="string")throw new TypeError("encoding must be a string");if(typeof v=="string"&&!a.isEncoding(v))throw new TypeError("Unknown encoding: "+v);if(l.length===1){const R=l.charCodeAt(0);(v==="utf8"&&R<128||v==="latin1")&&(l=R)}}else typeof l=="number"?l=l&255:typeof l=="boolean"&&(l=Number(l));if(h<0||this.length<h||this.length<g)throw new RangeError("Out of range index");if(g<=h)return this;h=h>>>0,g=g===void 0?this.length:g>>>0,l||(l=0);let C;if(typeof l=="number")for(C=h;C<g;++C)this[C]=l;else{const R=a.isBuffer(l)?l:a.from(l,v),L=R.length;if(L===0)throw new TypeError('The value "'+l+'" is invalid for argument "value"');for(C=0;C<g-h;++C)this[C+h]=R[C%L]}return this};const Fe={};function Bt(f,l,h){Fe[f]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:l.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${f}]`,this.stack,delete this.name}get code(){return f}set code(v){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:v,writable:!0})}toString(){return`${this.name} [${f}]: ${this.message}`}}}Bt("ERR_BUFFER_OUT_OF_BOUNDS",function(f){return f?`${f} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Bt("ERR_INVALID_ARG_TYPE",function(f,l){return`The "${f}" argument must be of type number. Received type ${typeof l}`},TypeError),Bt("ERR_OUT_OF_RANGE",function(f,l,h){let g=`The value of "${f}" is out of range.`,v=h;return Number.isInteger(h)&&Math.abs(h)>2**32?v=Ji(String(h)):typeof h=="bigint"&&(v=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(v=Ji(v)),v+="n"),g+=` It must be ${l}. Received ${v}`,g},RangeError);function Ji(f){let l="",h=f.length;const g=f[0]==="-"?1:0;for(;h>=g+4;h-=3)l=`_${f.slice(h-3,h)}${l}`;return`${f.slice(0,h)}${l}`}function Us(f,l,h){Me(l,"offset"),(f[l]===void 0||f[l+h]===void 0)&&ze(l,f.length-(h+1))}function er(f,l,h,g,v,C){if(f>h||f<l){const R=typeof l=="bigint"?"n":"";let L;throw C>3?l===0||l===BigInt(0)?L=`>= 0${R} and < 2${R} ** ${(C+1)*8}${R}`:L=`>= -(2${R} ** ${(C+1)*8-1}${R}) and < 2 ** ${(C+1)*8-1}${R}`:L=`>= ${l}${R} and <= ${h}${R}`,new Fe.ERR_OUT_OF_RANGE("value",L,f)}Us(g,v,C)}function Me(f,l){if(typeof f!="number")throw new Fe.ERR_INVALID_ARG_TYPE(l,"number",f)}function ze(f,l,h){throw Math.floor(f)!==f?(Me(f,h),new Fe.ERR_OUT_OF_RANGE(h||"offset","an integer",f)):l<0?new Fe.ERR_BUFFER_OUT_OF_BOUNDS:new Fe.ERR_OUT_OF_RANGE(h||"offset",`>= ${h?1:0} and <= ${l}`,f)}const zs=/[^+/0-9A-Za-z-_]/g;function Hs(f){if(f=f.split("=")[0],f=f.trim().replace(zs,""),f.length<2)return"";for(;f.length%4!==0;)f=f+"=";return f}function Pt(f,l){l=l||1/0;let h;const g=f.length;let v=null;const C=[];for(let R=0;R<g;++R){if(h=f.charCodeAt(R),h>55295&&h<57344){if(!v){if(h>56319){(l-=3)>-1&&C.push(239,191,189);continue}else if(R+1===g){(l-=3)>-1&&C.push(239,191,189);continue}v=h;continue}if(h<56320){(l-=3)>-1&&C.push(239,191,189),v=h;continue}h=(v-55296<<10|h-56320)+65536}else v&&(l-=3)>-1&&C.push(239,191,189);if(v=null,h<128){if((l-=1)<0)break;C.push(h)}else if(h<2048){if((l-=2)<0)break;C.push(h>>6|192,h&63|128)}else if(h<65536){if((l-=3)<0)break;C.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((l-=4)<0)break;C.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return C}function qs(f){const l=[];for(let h=0;h<f.length;++h)l.push(f.charCodeAt(h)&255);return l}function Ws(f,l){let h,g,v;const C=[];for(let R=0;R<f.length&&!((l-=2)<0);++R)h=f.charCodeAt(R),g=h>>8,v=h%256,C.push(v),C.push(g);return C}function tr(f){return e.toByteArray(Hs(f))}function et(f,l,h,g){let v;for(v=0;v<g&&!(v+h>=l.length||v>=f.length);++v)l[v+h]=f[v];return v}function ae(f,l){return f instanceof l||f!=null&&f.constructor!=null&&f.constructor.name!=null&&f.constructor.name===l.name}function Dt(f){return f!==f}const js=function(){const f="0123456789abcdef",l=new Array(256);for(let h=0;h<16;++h){const g=h*16;for(let v=0;v<16;++v)l[g+v]=f[h]+f[v]}return l}();function me(f){return typeof BigInt>"u"?$s:f}function $s(){throw new Error("BigInt not supported")}})(Te);(function(t,e){var i=Te,r=i.Buffer;function n(o,a){for(var u in o)a[u]=o[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(n(i,e),e.Buffer=s);function s(o,a,u){return r(o,a,u)}n(r,s),s.from=function(o,a,u){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,u)},s.alloc=function(o,a,u){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=r(o);return a!==void 0?typeof u=="string"?c.fill(a,u):c.fill(a):c.fill(0),c},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i.SlowBuffer(o)}})(vi,vi.exports);var ha=vi.exports,qt=65536,ua=4294967295;function ca(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var da=ha.Buffer,Et=self.crypto||self.msCrypto;Et&&Et.getRandomValues?wi.exports=fa:wi.exports=ca;function fa(t,e){if(t>ua)throw new RangeError("requested too many random bytes");var i=da.allocUnsafe(t);if(t>0)if(t>qt)for(var r=0;r<t;r+=qt)Et.getRandomValues(i.slice(r,r+qt));else Et.getRandomValues(i);return typeof e=="function"?process.nextTick(function(){e(null,i)}):i}var pa=wi.exports,bi={exports:{}},Ue={},Ui={exports:{}},Be=typeof Reflect=="object"?Reflect:null,br=Be&&typeof Be.apply=="function"?Be.apply:function(e,i,r){return Function.prototype.apply.call(e,i,r)},pt;Be&&typeof Be.ownKeys=="function"?pt=Be.ownKeys:Object.getOwnPropertySymbols?pt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:pt=function(e){return Object.getOwnPropertyNames(e)};function ga(t){console&&console.warn&&console.warn(t)}var Zn=Number.isNaN||function(e){return e!==e};function U(){U.init.call(this)}Ui.exports=U;Ui.exports.once=wa;U.EventEmitter=U;U.prototype._events=void 0;U.prototype._eventsCount=0;U.prototype._maxListeners=void 0;var Er=10;function Ft(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return Er},set:function(t){if(typeof t!="number"||t<0||Zn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Er=t}});U.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};U.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Zn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Jn(t){return t._maxListeners===void 0?U.defaultMaxListeners:t._maxListeners}U.prototype.getMaxListeners=function(){return Jn(this)};U.prototype.emit=function(e){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")br(u,this,i);else for(var c=u.length,p=ns(u,c),r=0;r<c;++r)br(p[r],this,i);return!0};function es(t,e,i,r){var n,s,o;if(Ft(i),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),o=s[e]),o===void 0)o=s[e]=i,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),n=Jn(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,ga(a)}return t}U.prototype.addListener=function(e,i){return es(this,e,i,!1)};U.prototype.on=U.prototype.addListener;U.prototype.prependListener=function(e,i){return es(this,e,i,!0)};function ma(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ts(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=ma.bind(r);return n.listener=i,r.wrapFn=n,n}U.prototype.once=function(e,i){return Ft(i),this.on(e,ts(this,e,i)),this};U.prototype.prependOnceListener=function(e,i){return Ft(i),this.prependListener(e,ts(this,e,i)),this};U.prototype.removeListener=function(e,i){var r,n,s,o,a;if(Ft(i),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===i||r.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||i));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===i||r[o].listener===i){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():ya(r,s),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};U.prototype.off=U.prototype.removeListener;U.prototype.removeAllListeners=function(e){var i,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=r[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(e,i[n]);return this};function is(t,e,i){var r=t._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?_a(n):ns(n,n.length)}U.prototype.listeners=function(e){return is(this,e,!0)};U.prototype.rawListeners=function(e){return is(this,e,!1)};U.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):rs.call(t,e)};U.prototype.listenerCount=rs;function rs(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}U.prototype.eventNames=function(){return this._eventsCount>0?pt(this._events):[]};function ns(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function ya(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function _a(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function wa(t,e){return new Promise(function(i,r){function n(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),i([].slice.call(arguments))}ss(t,e,s,{once:!0}),e!=="error"&&va(t,n,{once:!0})})}function va(t,e,i){typeof t.on=="function"&&ss(t,"error",e,i)}function ss(t,e,i,r){if(typeof t.on=="function")r.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){r.once&&t.removeEventListener(e,n),i(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var os=Ui.exports,as=os.EventEmitter;const ba={},Ea=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"})),ls=Lo(Ea);var Wt,xr;function xa(){if(xr)return Wt;xr=1;function t(y,m){var w=Object.keys(y);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(y);m&&(b=b.filter(function(E){return Object.getOwnPropertyDescriptor(y,E).enumerable})),w.push.apply(w,b)}return w}function e(y){for(var m=1;m<arguments.length;m++){var w=arguments[m]!=null?arguments[m]:{};m%2?t(Object(w),!0).forEach(function(b){i(y,b,w[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(w)):t(Object(w)).forEach(function(b){Object.defineProperty(y,b,Object.getOwnPropertyDescriptor(w,b))})}return y}function i(y,m,w){return m in y?Object.defineProperty(y,m,{value:w,enumerable:!0,configurable:!0,writable:!0}):y[m]=w,y}function r(y,m){if(!(y instanceof m))throw new TypeError("Cannot call a class as a function")}function n(y,m){for(var w=0;w<m.length;w++){var b=m[w];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}function s(y,m,w){return m&&n(y.prototype,m),w&&n(y,w),y}var o=Te,a=o.Buffer,u=ls,c=u.inspect,p=c&&c.custom||"inspect";function d(y,m,w){a.prototype.copy.call(y,m,w)}return Wt=function(){function y(){r(this,y),this.head=null,this.tail=null,this.length=0}return s(y,[{key:"push",value:function(w){var b={data:w,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length}},{key:"unshift",value:function(w){var b={data:w,next:this.head};this.length===0&&(this.tail=b),this.head=b,++this.length}},{key:"shift",value:function(){if(this.length!==0){var w=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,w}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(w){if(this.length===0)return"";for(var b=this.head,E=""+b.data;b=b.next;)E+=w+b.data;return E}},{key:"concat",value:function(w){if(this.length===0)return a.alloc(0);for(var b=a.allocUnsafe(w>>>0),E=this.head,_=0;E;)d(E.data,b,_),_+=E.data.length,E=E.next;return b}},{key:"consume",value:function(w,b){var E;return w<this.head.data.length?(E=this.head.data.slice(0,w),this.head.data=this.head.data.slice(w)):w===this.head.data.length?E=this.shift():E=b?this._getString(w):this._getBuffer(w),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(w){var b=this.head,E=1,_=b.data;for(w-=_.length;b=b.next;){var x=b.data,A=w>x.length?x.length:w;if(A===x.length?_+=x:_+=x.slice(0,w),w-=A,w===0){A===x.length?(++E,b.next?this.head=b.next:this.head=this.tail=null):(this.head=b,b.data=x.slice(A));break}++E}return this.length-=E,_}},{key:"_getBuffer",value:function(w){var b=a.allocUnsafe(w),E=this.head,_=1;for(E.data.copy(b),w-=E.data.length;E=E.next;){var x=E.data,A=w>x.length?x.length:w;if(x.copy(b,b.length-w,0,A),w-=A,w===0){A===x.length?(++_,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=x.slice(A));break}++_}return this.length-=_,b}},{key:p,value:function(w,b){return c(this,e({},b,{depth:0,customInspect:!1}))}}]),y}(),Wt}function Ca(t,e){var i=this,r=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return r||n?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Ei,this,t)):process.nextTick(Ei,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?i._writableState?i._writableState.errorEmitted?process.nextTick(gt,i):(i._writableState.errorEmitted=!0,process.nextTick(Cr,i,s)):process.nextTick(Cr,i,s):e?(process.nextTick(gt,i),e(s)):process.nextTick(gt,i)}),this)}function Cr(t,e){Ei(t,e),gt(t)}function gt(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function Aa(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function Ei(t,e){t.emit("error",e)}function Ra(t,e){var i=t._readableState,r=t._writableState;i&&i.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var hs={destroy:Ca,undestroy:Aa,errorOrDestroy:Ra},Se={};function Ta(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var us={};function oe(t,e,i){i||(i=Error);function r(s,o,a){return typeof e=="string"?e:e(s,o,a)}var n=function(s){Ta(o,s);function o(a,u,c){return s.call(this,r(a,u,c))||this}return o}(i);n.prototype.name=i.name,n.prototype.code=t,us[t]=n}function Ar(t,e){if(Array.isArray(t)){var i=t.length;return t=t.map(function(r){return String(r)}),i>2?"one of ".concat(e," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:i===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Sa(t,e,i){return t.substr(!i||i<0?0:+i,e.length)===e}function Fa(t,e,i){return(i===void 0||i>t.length)&&(i=t.length),t.substring(i-e.length,i)===e}function Ma(t,e,i){return typeof i!="number"&&(i=0),i+e.length>t.length?!1:t.indexOf(e,i)!==-1}oe("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);oe("ERR_INVALID_ARG_TYPE",function(t,e,i){var r;typeof e=="string"&&Sa(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var n;if(Fa(t," argument"))n="The ".concat(t," ").concat(r," ").concat(Ar(e,"type"));else{var s=Ma(t,".")?"property":"argument";n='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(Ar(e,"type"))}return n+=". Received type ".concat(typeof i),n},TypeError);oe("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");oe("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});oe("ERR_STREAM_PREMATURE_CLOSE","Premature close");oe("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});oe("ERR_MULTIPLE_CALLBACK","Callback called multiple times");oe("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");oe("ERR_STREAM_WRITE_AFTER_END","write after end");oe("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);oe("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);oe("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");Se.codes=us;var Ia=Se.codes.ERR_INVALID_OPT_VALUE;function ka(t,e,i){return t.highWaterMark!=null?t.highWaterMark:e?t[i]:null}function La(t,e,i,r){var n=ka(e,r,i);if(n!=null){if(!(isFinite(n)&&Math.floor(n)===n)||n<0){var s=r?i:"highWaterMark";throw new Ia(s,n)}return Math.floor(n)}return t.objectMode?16:16*1024}var cs={getHighWaterMark:La},xi={exports:{}};typeof Object.create=="function"?xi.exports=function(e,i){i&&(e.super_=i,e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:xi.exports=function(e,i){if(i){e.super_=i;var r=function(){};r.prototype=i.prototype,e.prototype=new r,e.prototype.constructor=e}};var Qe=xi.exports,jt={},nt={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var Rr;function Na(){return Rr||(Rr=1,function(t,e){var i=Te,r=i.Buffer;function n(o,a){for(var u in o)a[u]=o[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(n(i,e),e.Buffer=s);function s(o,a,u){return r(o,a,u)}s.prototype=Object.create(r.prototype),n(r,s),s.from=function(o,a,u){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,u)},s.alloc=function(o,a,u){if(typeof o!="number")throw new TypeError("Argument must be a number");var c=r(o);return a!==void 0?typeof u=="string"?c.fill(a,u):c.fill(a):c.fill(0),c},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return i.SlowBuffer(o)}}(nt,nt.exports)),nt.exports}var Tr;function ds(){if(Tr)return jt;Tr=1;var t=Na().Buffer,e=t.isEncoding||function(_){switch(_=""+_,_&&_.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(_){if(!_)return"utf8";for(var x;;)switch(_){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return _;default:if(x)return;_=(""+_).toLowerCase(),x=!0}}function r(_){var x=i(_);if(typeof x!="string"&&(t.isEncoding===e||!e(_)))throw new Error("Unknown encoding: "+_);return x||_}jt.StringDecoder=n;function n(_){this.encoding=r(_);var x;switch(this.encoding){case"utf16le":this.text=d,this.end=y,x=4;break;case"utf8":this.fillLast=u,x=4;break;case"base64":this.text=m,this.end=w,x=3;break;default:this.write=b,this.end=E;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(x)}n.prototype.write=function(_){if(_.length===0)return"";var x,A;if(this.lastNeed){if(x=this.fillLast(_),x===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<_.length?x?x+this.text(_,A):this.text(_,A):x||""},n.prototype.end=p,n.prototype.text=c,n.prototype.fillLast=function(_){if(this.lastNeed<=_.length)return _.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);_.copy(this.lastChar,this.lastTotal-this.lastNeed,0,_.length),this.lastNeed-=_.length};function s(_){return _<=127?0:_>>5===6?2:_>>4===14?3:_>>3===30?4:_>>6===2?-1:-2}function o(_,x,A){var T=x.length-1;if(T<A)return 0;var S=s(x[T]);return S>=0?(S>0&&(_.lastNeed=S-1),S):--T<A||S===-2?0:(S=s(x[T]),S>=0?(S>0&&(_.lastNeed=S-2),S):--T<A||S===-2?0:(S=s(x[T]),S>=0?(S>0&&(S===2?S=0:_.lastNeed=S-3),S):0))}function a(_,x,A){if((x[0]&192)!==128)return _.lastNeed=0,"";if(_.lastNeed>1&&x.length>1){if((x[1]&192)!==128)return _.lastNeed=1,"";if(_.lastNeed>2&&x.length>2&&(x[2]&192)!==128)return _.lastNeed=2,""}}function u(_){var x=this.lastTotal-this.lastNeed,A=a(this,_);if(A!==void 0)return A;if(this.lastNeed<=_.length)return _.copy(this.lastChar,x,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);_.copy(this.lastChar,x,0,_.length),this.lastNeed-=_.length}function c(_,x){var A=o(this,_,x);if(!this.lastNeed)return _.toString("utf8",x);this.lastTotal=A;var T=_.length-(A-this.lastNeed);return _.copy(this.lastChar,0,T),_.toString("utf8",x,T)}function p(_){var x=_&&_.length?this.write(_):"";return this.lastNeed?x+"":x}function d(_,x){if((_.length-x)%2===0){var A=_.toString("utf16le",x);if(A){var T=A.charCodeAt(A.length-1);if(T>=55296&&T<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=_[_.length-1],_.toString("utf16le",x,_.length-1)}function y(_){var x=_&&_.length?this.write(_):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return x+this.lastChar.toString("utf16le",0,A)}return x}function m(_,x){var A=(_.length-x)%3;return A===0?_.toString("base64",x):(this.lastNeed=3-A,this.lastTotal=3,A===1?this.lastChar[0]=_[_.length-1]:(this.lastChar[0]=_[_.length-2],this.lastChar[1]=_[_.length-1]),_.toString("base64",x,_.length-A))}function w(_){var x=_&&_.length?this.write(_):"";return this.lastNeed?x+this.lastChar.toString("base64",0,3-this.lastNeed):x}function b(_){return _.toString(this.encoding)}function E(_){return _&&_.length?this.write(_):""}return jt}var Sr=Se.codes.ERR_STREAM_PREMATURE_CLOSE;function Ba(t){var e=!1;return function(){if(!e){e=!0;for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];t.apply(this,r)}}}function Pa(){}function Da(t){return t.setHeader&&typeof t.abort=="function"}function fs(t,e,i){if(typeof e=="function")return fs(t,null,e);e||(e={}),i=Ba(i||Pa);var r=e.readable||e.readable!==!1&&t.readable,n=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){n=!1,o=!0,r||i.call(t)},u=t._readableState&&t._readableState.endEmitted,c=function(){r=!1,u=!0,n||i.call(t)},p=function(w){i.call(t,w)},d=function(){var w;if(r&&!u)return(!t._readableState||!t._readableState.ended)&&(w=new Sr),i.call(t,w);if(n&&!o)return(!t._writableState||!t._writableState.ended)&&(w=new Sr),i.call(t,w)},y=function(){t.req.on("finish",a)};return Da(t)?(t.on("complete",a),t.on("abort",d),t.req?y():t.on("request",y)):n&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",c),t.on("finish",a),e.error!==!1&&t.on("error",p),t.on("close",d),function(){t.removeListener("complete",a),t.removeListener("abort",d),t.removeListener("request",y),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",c),t.removeListener("error",p),t.removeListener("close",d)}}var zi=fs,$t,Fr;function Oa(){if(Fr)return $t;Fr=1;var t;function e(_,x,A){return x in _?Object.defineProperty(_,x,{value:A,enumerable:!0,configurable:!0,writable:!0}):_[x]=A,_}var i=zi,r=Symbol("lastResolve"),n=Symbol("lastReject"),s=Symbol("error"),o=Symbol("ended"),a=Symbol("lastPromise"),u=Symbol("handlePromise"),c=Symbol("stream");function p(_,x){return{value:_,done:x}}function d(_){var x=_[r];if(x!==null){var A=_[c].read();A!==null&&(_[a]=null,_[r]=null,_[n]=null,x(p(A,!1)))}}function y(_){process.nextTick(d,_)}function m(_,x){return function(A,T){_.then(function(){if(x[o]){A(p(void 0,!0));return}x[u](A,T)},T)}}var w=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((t={get stream(){return this[c]},next:function(){var x=this,A=this[s];if(A!==null)return Promise.reject(A);if(this[o])return Promise.resolve(p(void 0,!0));if(this[c].destroyed)return new Promise(function(k,O){process.nextTick(function(){x[s]?O(x[s]):k(p(void 0,!0))})});var T=this[a],S;if(T)S=new Promise(m(T,this));else{var M=this[c].read();if(M!==null)return Promise.resolve(p(M,!1));S=new Promise(this[u])}return this[a]=S,S}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var x=this;return new Promise(function(A,T){x[c].destroy(null,function(S){if(S){T(S);return}A(p(void 0,!0))})})}),t),w),E=function(x){var A,T=Object.create(b,(A={},e(A,c,{value:x,writable:!0}),e(A,r,{value:null,writable:!0}),e(A,n,{value:null,writable:!0}),e(A,s,{value:null,writable:!0}),e(A,o,{value:x._readableState.endEmitted,writable:!0}),e(A,u,{value:function(M,k){var O=T[c].read();O?(T[a]=null,T[r]=null,T[n]=null,M(p(O,!1))):(T[r]=M,T[n]=k)},writable:!0}),A));return T[a]=null,i(x,function(S){if(S&&S.code!=="ERR_STREAM_PREMATURE_CLOSE"){var M=T[n];M!==null&&(T[a]=null,T[r]=null,T[n]=null,M(S)),T[s]=S;return}var k=T[r];k!==null&&(T[a]=null,T[r]=null,T[n]=null,k(p(void 0,!0))),T[o]=!0}),x.on("readable",y.bind(null,T)),T};return $t=E,$t}var Yt,Mr;function Ua(){return Mr||(Mr=1,Yt=function(){throw new Error("Readable.from is not available in the browser")}),Yt}const Hi=Ue;Hi.Readable=D;D.ReadableState=gs;os.EventEmitter;var ps=function(e,i){return e.listeners(i).length},Ke=as,Mt=Te.Buffer,za=self.Uint8Array||function(){};function Ha(t){return Mt.from(t)}function qa(t){return Mt.isBuffer(t)||t instanceof za}var Gt=ls,N;Gt&&Gt.debuglog?N=Gt.debuglog("stream"):N=function(){};var Wa=xa(),qi=hs,ja=cs,$a=ja.getHighWaterMark,It=Se.codes,Ya=It.ERR_INVALID_ARG_TYPE,Ga=It.ERR_STREAM_PUSH_AFTER_EOF,Va=It.ERR_METHOD_NOT_IMPLEMENTED,Xa=It.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Pe,Vt,Xt;Qe(D,Ke);var qe=qi.errorOrDestroy,Qt=["error","close","destroy","pause","resume"];function Qa(t,e,i){if(typeof t.prependListener=="function")return t.prependListener(e,i);!t._events||!t._events[e]?t.on(e,i):Array.isArray(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]}function gs(t,e,i){t=t||{},typeof i!="boolean"&&(i=e instanceof Hi.Duplex),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=$a(this,t,"readableHighWaterMark",i),this.buffer=new Wa,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(Pe||(Pe=ds().StringDecoder),this.decoder=new Pe(t.encoding),this.encoding=t.encoding)}function D(t){if(!(this instanceof D))return new D(t);var e=this instanceof Hi.Duplex;this._readableState=new gs(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),Ke.call(this)}Object.defineProperty(D.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}});D.prototype.destroy=qi.destroy;D.prototype._undestroy=qi.undestroy;D.prototype._destroy=function(t,e){e(t)};D.prototype.push=function(t,e){var i=this._readableState,r;return i.objectMode?r=!0:typeof t=="string"&&(e=e||i.defaultEncoding,e!==i.encoding&&(t=Mt.from(t,e),e=""),r=!0),ms(this,t,e,!1,r)};D.prototype.unshift=function(t){return ms(this,t,null,!0,!1)};function ms(t,e,i,r,n){N("readableAddChunk",e);var s=t._readableState;if(e===null)s.reading=!1,Ja(t,s);else{var o;if(n||(o=Ka(s,e)),o)qe(t,o);else if(s.objectMode||e&&e.length>0)if(typeof e!="string"&&!s.objectMode&&Object.getPrototypeOf(e)!==Mt.prototype&&(e=Ha(e)),r)s.endEmitted?qe(t,new Xa):Kt(t,s,e,!0);else if(s.ended)qe(t,new Ga);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!i?(e=s.decoder.write(e),s.objectMode||e.length!==0?Kt(t,s,e,!1):Ci(t,s)):Kt(t,s,e,!1)}else r||(s.reading=!1,Ci(t,s))}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function Kt(t,e,i,r){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",i)):(e.length+=e.objectMode?1:i.length,r?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&kt(t)),Ci(t,e)}function Ka(t,e){var i;return!qa(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(i=new Ya("chunk",["string","Buffer","Uint8Array"],e)),i}D.prototype.isPaused=function(){return this._readableState.flowing===!1};D.prototype.setEncoding=function(t){Pe||(Pe=ds().StringDecoder);var e=new Pe(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,r="";i!==null;)r+=e.write(i.data),i=i.next;return this._readableState.buffer.clear(),r!==""&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var Ir=1073741824;function Za(t){return t>=Ir?t=Ir:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function kr(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=Za(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}D.prototype.read=function(t){N("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return N("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Zt(this):kt(this),null;if(t=kr(t,e),t===0&&e.ended)return e.length===0&&Zt(this),null;var r=e.needReadable;N("need readable",r),(e.length===0||e.length-t<e.highWaterMark)&&(r=!0,N("length less than watermark",r)),e.ended||e.reading?(r=!1,N("reading or ended",r)):r&&(N("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=kr(i,e)));var n;return t>0?n=ws(t,e):n=null,n===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&Zt(this)),n!==null&&this.emit("data",n),n};function Ja(t,e){if(N("onEofChunk"),!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,e.sync?kt(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,ys(t)))}}function kt(t){var e=t._readableState;N("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(N("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(ys,t))}function ys(t){var e=t._readableState;N("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Wi(t)}function Ci(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(el,t,e))}function el(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var i=e.length;if(N("maybeReadMore read 0"),t.read(0),i===e.length)break}e.readingMore=!1}D.prototype._read=function(t){qe(this,new Va("_read()"))};D.prototype.pipe=function(t,e){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t);break}r.pipesCount+=1,N("pipe count=%d opts=%j",r.pipesCount,e);var n=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,s=n?a:b;r.endEmitted?process.nextTick(s):i.once("end",s),t.on("unpipe",o);function o(E,_){N("onunpipe"),E===i&&_&&_.hasUnpiped===!1&&(_.hasUnpiped=!0,p())}function a(){N("onend"),t.end()}var u=tl(i);t.on("drain",u);var c=!1;function p(){N("cleanup"),t.removeListener("close",m),t.removeListener("finish",w),t.removeListener("drain",u),t.removeListener("error",y),t.removeListener("unpipe",o),i.removeListener("end",a),i.removeListener("end",b),i.removeListener("data",d),c=!0,r.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&u()}i.on("data",d);function d(E){N("ondata");var _=t.write(E);N("dest.write",_),_===!1&&((r.pipesCount===1&&r.pipes===t||r.pipesCount>1&&vs(r.pipes,t)!==-1)&&!c&&(N("false write response, pause",r.awaitDrain),r.awaitDrain++),i.pause())}function y(E){N("onerror",E),b(),t.removeListener("error",y),ps(t,"error")===0&&qe(t,E)}Qa(t,"error",y);function m(){t.removeListener("finish",w),b()}t.once("close",m);function w(){N("onfinish"),t.removeListener("close",m),b()}t.once("finish",w);function b(){N("unpipe"),i.unpipe(t)}return t.emit("pipe",i),r.flowing||(N("pipe resume"),i.resume()),t};function tl(t){return function(){var i=t._readableState;N("pipeOnDrain",i.awaitDrain),i.awaitDrain&&i.awaitDrain--,i.awaitDrain===0&&ps(t,"data")&&(i.flowing=!0,Wi(t))}}D.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var r=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)r[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=vs(e.pipes,t);return o===-1?this:(e.pipes.splice(o,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)};D.prototype.on=function(t,e){var i=Ke.prototype.on.call(this,t,e),r=this._readableState;return t==="data"?(r.readableListening=this.listenerCount("readable")>0,r.flowing!==!1&&this.resume()):t==="readable"&&!r.endEmitted&&!r.readableListening&&(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,N("on readable",r.length,r.reading),r.length?kt(this):r.reading||process.nextTick(il,this)),i};D.prototype.addListener=D.prototype.on;D.prototype.removeListener=function(t,e){var i=Ke.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(_s,this),i};D.prototype.removeAllListeners=function(t){var e=Ke.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(_s,this),e};function _s(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function il(t){N("readable nexttick read 0"),t.read(0)}D.prototype.resume=function(){var t=this._readableState;return t.flowing||(N("resume"),t.flowing=!t.readableListening,rl(this,t)),t.paused=!1,this};function rl(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(nl,t,e))}function nl(t,e){N("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Wi(t),e.flowing&&!e.reading&&t.read(0)}D.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Wi(t){var e=t._readableState;for(N("flow",e.flowing);e.flowing&&t.read()!==null;);}D.prototype.wrap=function(t){var e=this,i=this._readableState,r=!1;t.on("end",function(){if(N("wrapped end"),i.decoder&&!i.ended){var o=i.decoder.end();o&&o.length&&e.push(o)}e.push(null)}),t.on("data",function(o){if(N("wrapped data"),i.decoder&&(o=i.decoder.write(o)),!(i.objectMode&&o==null)&&!(!i.objectMode&&(!o||!o.length))){var a=e.push(o);a||(r=!0,t.pause())}});for(var n in t)this[n]===void 0&&typeof t[n]=="function"&&(this[n]=function(a){return function(){return t[a].apply(t,arguments)}}(n));for(var s=0;s<Qt.length;s++)t.on(Qt[s],this.emit.bind(this,Qt[s]));return this._read=function(o){N("wrapped _read",o),r&&(r=!1,t.resume())},this};typeof Symbol=="function"&&(D.prototype[Symbol.asyncIterator]=function(){return Vt===void 0&&(Vt=Oa()),Vt(this)});Object.defineProperty(D.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(D.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(D.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});D._fromList=ws;Object.defineProperty(D.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function ws(t,e){if(e.length===0)return null;var i;return e.objectMode?i=e.buffer.shift():!t||t>=e.length?(e.decoder?i=e.buffer.join(""):e.buffer.length===1?i=e.buffer.first():i=e.buffer.concat(e.length),e.buffer.clear()):i=e.buffer.consume(t,e.decoder),i}function Zt(t){var e=t._readableState;N("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(sl,e,t))}function sl(t,e){if(N("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var i=e._writableState;(!i||i.autoDestroy&&i.finished)&&e.destroy()}}typeof Symbol=="function"&&(D.from=function(t,e){return Xt===void 0&&(Xt=Ua()),Xt(D,t,e)});function vs(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}var ol=al;function al(t,e){if(Jt("noDeprecation"))return t;var i=!1;function r(){if(!i){if(Jt("throwDeprecation"))throw new Error(e);Jt("traceDeprecation")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}return r}function Jt(t){try{if(!self.localStorage)return!1}catch{return!1}var e=self.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}const ji=Ue;ji.Writable=G;function bs(t){var e=this;this.next=null,this.entry=null,this.finish=function(){Nl(e,t)}}G.WritableState=Ze;var ll={deprecate:ol},Es=as,Lt=Te.Buffer,hl=self.Uint8Array||function(){};function ul(t){return Lt.from(t)}function cl(t){return Lt.isBuffer(t)||t instanceof hl}var $i=hs,dl=cs,fl=dl.getHighWaterMark,ve=Se.codes,pl=ve.ERR_INVALID_ARG_TYPE,gl=ve.ERR_METHOD_NOT_IMPLEMENTED,ml=ve.ERR_MULTIPLE_CALLBACK,yl=ve.ERR_STREAM_CANNOT_PIPE,_l=ve.ERR_STREAM_DESTROYED,wl=ve.ERR_STREAM_NULL_VALUES,vl=ve.ERR_STREAM_WRITE_AFTER_END,bl=ve.ERR_UNKNOWN_ENCODING,De=$i.errorOrDestroy;Qe(G,Es);function El(){}function Ze(t,e,i){t=t||{},typeof i!="boolean"&&(i=e instanceof ji.Duplex),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=fl(this,t,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var r=t.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(n){Fl(e,n)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new bs(this)}Ze.prototype.getBuffer=function(){for(var e=this.bufferedRequest,i=[];e;)i.push(e),e=e.next;return i};(function(){try{Object.defineProperty(Ze.prototype,"buffer",{get:ll.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var mt;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(mt=Function.prototype[Symbol.hasInstance],Object.defineProperty(G,Symbol.hasInstance,{value:function(e){return mt.call(this,e)?!0:this!==G?!1:e&&e._writableState instanceof Ze}})):mt=function(e){return e instanceof this};function G(t){var e=this instanceof ji.Duplex;if(!e&&!mt.call(G,this))return new G(t);this._writableState=new Ze(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),Es.call(this)}G.prototype.pipe=function(){De(this,new yl)};function xl(t,e){var i=new vl;De(t,i),process.nextTick(e,i)}function Cl(t,e,i,r){var n;return i===null?n=new wl:typeof i!="string"&&!e.objectMode&&(n=new pl("chunk",["string","Buffer"],i)),n?(De(t,n),process.nextTick(r,n),!1):!0}G.prototype.write=function(t,e,i){var r=this._writableState,n=!1,s=!r.objectMode&&cl(t);return s&&!Lt.isBuffer(t)&&(t=ul(t)),typeof e=="function"&&(i=e,e=null),s?e="buffer":e||(e=r.defaultEncoding),typeof i!="function"&&(i=El),r.ending?xl(this,i):(s||Cl(this,r,t,i))&&(r.pendingcb++,n=Rl(this,r,s,t,e,i)),n};G.prototype.cork=function(){this._writableState.corked++};G.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&xs(this,t))};G.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new bl(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(G.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Al(t,e,i){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Lt.from(e,i)),e}Object.defineProperty(G.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Rl(t,e,i,r,n,s){if(!i){var o=Al(e,r,n);r!==o&&(i=!0,n="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var u=e.length<e.highWaterMark;if(u||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Ai(t,e,!1,a,r,n,s);return u}function Ai(t,e,i,r,n,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new _l("write")):i?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function Tl(t,e,i,r,n){--e.pendingcb,i?(process.nextTick(n,r),process.nextTick(Ye,t,e),t._writableState.errorEmitted=!0,De(t,r)):(n(r),t._writableState.errorEmitted=!0,De(t,r),Ye(t,e))}function Sl(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function Fl(t,e){var i=t._writableState,r=i.sync,n=i.writecb;if(typeof n!="function")throw new ml;if(Sl(i),e)Tl(t,i,r,e,n);else{var s=Cs(i)||t.destroyed;!s&&!i.corked&&!i.bufferProcessing&&i.bufferedRequest&&xs(t,i),r?process.nextTick(Lr,t,i,s,n):Lr(t,i,s,n)}}function Lr(t,e,i,r){i||Ml(t,e),e.pendingcb--,r(),Ye(t,e)}function Ml(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function xs(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),s=e.corkedRequestsFree;s.entry=i;for(var o=0,a=!0;i;)n[o]=i,i.isBuf||(a=!1),i=i.next,o+=1;n.allBuffers=a,Ai(t,e,!0,e.length,n,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new bs(e),e.bufferedRequestCount=0}else{for(;i;){var u=i.chunk,c=i.encoding,p=i.callback,d=e.objectMode?1:u.length;if(Ai(t,e,!1,d,u,c,p),i=i.next,e.bufferedRequestCount--,e.writing)break}i===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}G.prototype._write=function(t,e,i){i(new gl("_write()"))};G.prototype._writev=null;G.prototype.end=function(t,e,i){var r=this._writableState;return typeof t=="function"?(i=t,t=null,e=null):typeof e=="function"&&(i=e,e=null),t!=null&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||Ll(this,r,i),this};Object.defineProperty(G.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Cs(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function Il(t,e){t._final(function(i){e.pendingcb--,i&&De(t,i),e.prefinished=!0,t.emit("prefinish"),Ye(t,e)})}function kl(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(Il,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function Ye(t,e){var i=Cs(e);if(i&&(kl(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var r=t._readableState;(!r||r.autoDestroy&&r.endEmitted)&&t.destroy()}return i}function Ll(t,e,i){e.ending=!0,Ye(t,e),i&&(e.finished?process.nextTick(i):t.once("finish",i)),e.ended=!0,t.writable=!1}function Nl(t,e,i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree.next=t}Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}});G.prototype.destroy=$i.destroy;G.prototype._undestroy=$i.undestroy;G.prototype._destroy=function(t,e){e(t)};var Bl=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};const Oe=Ue;Oe.Duplex=ce;Qe(ce,Oe.Readable);for(var Nr=Bl(Oe.Writable.prototype),ei=0;ei<Nr.length;ei++){var ti=Nr[ei];ce.prototype[ti]||(ce.prototype[ti]=Oe.Writable.prototype[ti])}function ce(t){if(!(this instanceof ce))return new ce(t);Oe.Readable.call(this,t),Oe.Writable.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Pl)))}Object.defineProperty(ce.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(ce.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(ce.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Pl(){this._writableState.ended||process.nextTick(Dl,this)}function Dl(t){t.end()}Object.defineProperty(ce.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});const Je=Ue;Je.Transform=fe;var Nt=Se.codes,Ol=Nt.ERR_METHOD_NOT_IMPLEMENTED,Ul=Nt.ERR_MULTIPLE_CALLBACK,zl=Nt.ERR_TRANSFORM_ALREADY_TRANSFORMING,Hl=Nt.ERR_TRANSFORM_WITH_LENGTH_0;Qe(fe,Je.Duplex);function ql(t,e){var i=this._transformState;i.transforming=!1;var r=i.writecb;if(r===null)return this.emit("error",new Ul);i.writechunk=null,i.writecb=null,e!=null&&this.push(e),r(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function fe(t){if(!(this instanceof fe))return new fe(t);Je.Duplex.call(this,t),this._transformState={afterTransform:ql.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Wl)}function Wl(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,i){Br(t,e,i)}):Br(this,null,null)}fe.prototype.push=function(t,e){return this._transformState.needTransform=!1,Je.Duplex.prototype.push.call(this,t,e)};fe.prototype._transform=function(t,e,i){i(new Ol("_transform()"))};fe.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}};fe.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};fe.prototype._destroy=function(t,e){Je.Duplex.prototype._destroy.call(this,t,function(i){e(i)})};function Br(t,e,i){if(e)return t.emit("error",e);if(i!=null&&t.push(i),t._writableState.length)throw new Hl;if(t._transformState.transforming)throw new zl;return t.push(null)}const As=Ue;As.PassThrough=Ge;Qe(Ge,As.Transform);function Ge(t){if(!(this instanceof Ge))return new Ge(t);Transform.call(this,t)}Ge.prototype._transform=function(t,e,i){i(null,t)};var ii;function jl(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Rs=Se.codes,$l=Rs.ERR_MISSING_ARGS,Yl=Rs.ERR_STREAM_DESTROYED;function Pr(t){if(t)throw t}function Gl(t){return t.setHeader&&typeof t.abort=="function"}function Vl(t,e,i,r){r=jl(r);var n=!1;t.on("close",function(){n=!0}),ii===void 0&&(ii=zi),ii(t,{readable:e,writable:i},function(o){if(o)return r(o);n=!0,r()});var s=!1;return function(o){if(!n&&!s){if(s=!0,Gl(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(o||new Yl("pipe"))}}}function Dr(t){t()}function Xl(t,e){return t.pipe(e)}function Ql(t){return!t.length||typeof t[t.length-1]!="function"?Pr:t.pop()}function Kl(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=Ql(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new $l("streams");var n,s=e.map(function(o,a){var u=a<e.length-1,c=a>0;return Vl(o,u,c,function(p){n||(n=p),p&&s.forEach(Dr),!u&&(s.forEach(Dr),r(n))})});return e.reduce(Xl)}var Zl=Kl;(function(t,e){const i=Ue;e=t.exports=i.Readable,e.Stream=i.Readable,e.Readable=i.Readable,e.Writable=i.Writable,e.Duplex=i.Duplex,e.Transform=i.Transform,e.PassThrough=i.PassThrough,e.finished=zi,e.pipeline=Zl})(bi,bi.exports);var Jl=bi.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let Or;var eh=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:self):t=>(Or||(Or=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function Ur(t,e){for(const i in e)Object.defineProperty(t,i,{value:e[i],enumerable:!0,configurable:!0});return t}function th(t,e,i){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");i||(i={}),typeof e=="object"&&(i=e,e=""),e&&(i.code=e);try{return Ur(t,i)}catch{i.message=t.message,i.stack=t.stack;const n=function(){};return n.prototype=Object.create(Object.getPrototypeOf(t)),Ur(new n,i)}}var ih=th;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const rh=aa("simple-peer"),Ts=la,zr=pa,nh=Jl,ri=eh,B=ih,{Buffer:sh}=Te,ni=64*1024,oh=5*1e3,ah=5*1e3;function Hr(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function lh(t){console.warn(t)}class Re extends nh.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=zr(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||zr(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Re.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Re.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||oh,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Ts(),!this._wrtc)throw B(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(i){this.destroy(B(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.destroy(B(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this.streams&&this.streams.forEach(i=>{this.addStream(i)}),this._pc.ontrack=i=>{this._onTrack(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.destroy(B(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(B(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?lh("Ignoring unsupported ICE candidate."):this.destroy(B(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,i){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,i),this._needsNegotiation()}catch(r){this.destroy(B(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:i}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(i=>{this.addTrack(i,e)})}}addTrack(e,i){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let n=r.get(i);if(!n)n=this._pc.addTrack(e,i),r.set(i,n),this._senderMap.set(e,r),this._needsNegotiation();else throw n.removed?B(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):B(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,i,r){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const n=this._senderMap.get(e),s=n?n.get(r):null;if(!s)throw B(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");i&&this._senderMap.set(i,n),s.replaceTrack!=null?s.replaceTrack(i):this.destroy(B(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,i){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),n=r?r.get(i):null;if(!n)throw B(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(n):this.destroy(B(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(i=>{this.removeTrack(i,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,ri(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,i){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),ri(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),i()}))}_setupData(e){if(!e.channel)return this.destroy(B(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ni),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const n=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(B(n,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},ah)}_read(){}_write(e,i,r){if(this.destroyed)return r(B(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy(B(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ni?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Hr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=s=>{this.destroy(B(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Hr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},n=s=>{this.destroy(B(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(n)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(B(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(B(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(B(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(n=>{Object.assign(r,n)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const n=[];r.forEach(s=>{n.push(i(s))}),e(null,n)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const n=[];r.result().forEach(s=>{const o={};s.names().forEach(a=>{o[a]=s.stat(a)}),o.id=s.id,o.type=s.type,o.timestamp=s.timestamp,n.push(i(o))}),e(null,n)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((i,r)=>{if(this.destroyed)return;i&&(r=[]);const n={},s={},o={};let a=!1;r.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(n[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(s[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(o[c.id]=c)});const u=c=>{a=!0;let p=s[c.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof c.googLocalAddress=="string"&&(p=c.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=n[c.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof c.googRemoteAddress=="string"&&(d=c.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&u(o[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&u(c)}),!a&&(!Object.keys(o).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.destroy(B(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ni||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer&&(i=sh.from(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(i=>{this._debug("on track"),this.emit("track",e.track,i),this._remoteTracks.push({track:e.track,stream:i}),!this._remoteStreams.some(r=>r.id===i.id)&&(this._remoteStreams.push(i),ri(()=>{this._debug("on stream"),this.emit("stream",i)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],rh.apply(null,e)}}Re.WEBRTC_SUPPORT=!!Ts();Re.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Re.channelConfig={};var hh=Re;const qr=Di(hh);var ne=(t=>(t[t.AHOY=0]="AHOY",t[t.CONNECTION_INITIATION=1]="CONNECTION_INITIATION",t[t.RELAY_SIGNAL=2]="RELAY_SIGNAL",t[t.SIGNAL=3]="SIGNAL",t[t.CONNECTION_COUNT_CHECK=4]="CONNECTION_COUNT_CHECK",t[t.UPLOAD=5]="UPLOAD",t[t.UPLOAD_RESPONSE=6]="UPLOAD_RESPONSE",t[t.DOWNLOAD=7]="DOWNLOAD",t[t.DOWNLOAD_RESPONSE=8]="DOWNLOAD_RESPONSE",t[t.REDIRECTION=9]="REDIRECTION",t[t.REPORT=10]="REPORT",t))(ne||{});let st;const uh=new Uint8Array(16);function ch(){if(!st&&(st=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!st))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return st(uh)}const dh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xt(t){return typeof t=="string"&&dh.test(t)}const ie=[];for(let t=0;t<256;++t)ie.push((t+256).toString(16).slice(1));function Ss(t,e=0){return ie[t[e+0]]+ie[t[e+1]]+ie[t[e+2]]+ie[t[e+3]]+"-"+ie[t[e+4]]+ie[t[e+5]]+"-"+ie[t[e+6]]+ie[t[e+7]]+"-"+ie[t[e+8]]+ie[t[e+9]]+"-"+ie[t[e+10]]+ie[t[e+11]]+ie[t[e+12]]+ie[t[e+13]]+ie[t[e+14]]+ie[t[e+15]]}function Wr(t,e=0){const i=Ss(t,e);if(!xt(i))throw TypeError("Stringified UUID is invalid");return i}function jr(t){if(!xt(t))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}const fh=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$r={randomUUID:fh};function Yr(t,e,i){if($r.randomUUID&&!e&&!t)return $r.randomUUID();t=t||{};const r=t.random||(t.rng||ch)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){i=i||0;for(let n=0;n<16;++n)e[i+n]=r[n];return e}return Ss(r)}var Fs={};/**
 * @license MIT
 * @copyright 2020 Eyas Ranjous <eyas.ranjous@gmail.com>
 *
 * @class
 */let ph=class Ri{constructor(e){this._elements=Array.isArray(e)?e:[],this._offset=0}enqueue(e){return this._elements.push(e),this}push(e){return this.enqueue(e)}dequeue(){if(this.size()===0)return null;const e=this.front();return this._offset+=1,this._offset*2<this._elements.length||(this._elements=this._elements.slice(this._offset),this._offset=0),e}pop(){return this.dequeue()}front(){return this.size()>0?this._elements[this._offset]:null}back(){return this.size()>0?this._elements[this._elements.length-1]:null}size(){return this._elements.length-this._offset}isEmpty(){return this.size()===0}toArray(){return this._elements.slice(this._offset)}clear(){this._elements=[],this._offset=0}clone(){return new Ri(this._elements.slice(this._offset))}static fromArray(e){return new Ri(e)}};Fs.Queue=ph;const{Queue:gh}=Fs;var mh=gh;Jo.process=ra;const Ti="wss://kollator.com";console.log({WS_URL:Ti});class yh{hub;ws;peers;signalingMap;signalingQueue;signalingInterval;id;bootstrapAttempts;uploadGaurdPromise;uploadGuardResolver;constructor(){this.peers=new Map,this.id=Yr(),this.bootstrapAttempts=0,this.signalingQueue=new mh,this.signalingMap=new Map,this.signalingInterval=setInterval(()=>{let e=Date.now();for(;this.signalingQueue.size()&&e-this.signalingQueue.front().date>1e4;){const{id:i}=this.signalingQueue.pop();let r=this.signalingMap.get(i);r&&r.destroy(),this.signalingMap.delete(i)}},1e4)}validateSignalId(e,i){let r=Wr(i);if(!xt(r))return console.warn(`signal initiator id ${r} is not valid relayer: ${e.id}`),!1;let n=Wr(i,16);return xt(n)?r:(console.warn(`signal receiver id ${n} is not valid ${e.id}`),!1)}createPeer(e,i,r){console.log("createPeer");let n=this.validateSignalId(e,r);if(console.log({signalSenderId:n}),!n)return;let s=this.signalingMap.get(n);if(s){let a=JSON.parse(wr(r.slice(32)));console.log("peer exists, checking signal data",{signalData:a}),s.signal(a);return}i||console.log("initiating the connection with a signal answer"),s=new qr({initiator:i,trickle:!0}),s.id=n,this.signalingMap.set(s.id,s),s.on("signal",a=>{console.log(`current peer id is ${this.id}, relaying through ${e.id} to signal ${n}`),e.send(rt(ne.RELAY_SIGNAL,jr(this.id),jr(n),JSON.stringify(a)))}),s.on("error",a=>{console.error("there was an error creating this peer",a)}),s.on("finish",a=>{console.log("FINISHED",a)}),s.on("connect",()=>{console.log("peer connect, sending ahoy"),s.send(rt(ne.AHOY)),console.log(`finished peering webrtc connection, greeting ${s.id}`),this.signalingMap.delete(s.id),this.peers.set(s.id,s)}),s.on("data",a=>{switch(console.log("received data",ne[a[0]]),a[0]){case ne.AHOY:console.log("received ahoy"),this.finishPeering(s);break;case ne.RELAY_SIGNAL:break;case ne.SIGNAL:console.log("received signal request"),this.createPeer(s,!1,a.slice(1));break;case ne.UPLOAD_RESPONSE:s.uploadResolver&&s.uploadResolver(a.slice(1));break;case ne.DOWNLOAD_RESPONSE:s.downloadResolver&&s.downloadResolver(a.slice(1));break;default:return}});const o=JSON.parse(wr(r.slice(32)));return s.signal(o),s}async finishPeering(e){this.peers.set(e.id,e),this.signalingMap.delete(e.id),console.log("finished peering",e.id)}async handleRegister(e){console.log("handleregister"),e.success===!0?(console.log("success",{data:e}),this.hub=new qr({initiator:!0,trickle:!0}),this.hub.id=e.id,this.hub.on("signal",i=>{if(console.log("onsignal",i),!this.ws||this.ws.readyState>1){console.log("ws isn't ready from peer onsignal");return}this.ws.send(JSON.stringify({reason:"signal",iceData:i}))}),this.hub.on("connect",()=>{console.log("onconnect"),this.ws?.readyState===WebSocket.OPEN&&this.ws?.send(JSON.stringify({reason:"ahoy"}))}),this.hub.on("data",i=>{switch(console.log("data type",typeof i),i[0]){case ne.AHOY:console.log("data reason"),this.finishBootstrap();break;case ne.RELAY_SIGNAL:break;case ne.SIGNAL:console.log("received signal request"),this.createPeer(this.hub,!1,i.slice(1));break;default:return}}),console.log("created peer, ")):(await $o(1e3+2e3*(this.bootstrapAttempts-1)),this.bootstrapAttempts<5&&(this.id=Yr(),this.bootstrapAttempts++,(!this.ws||this.ws.CLOSED||this.ws.CLOSING)&&(this.ws=this.bootstrap()),this.ws.send(JSON.stringify({reason:"register",id:this.id}))))}bootstrap(){console.log("bootstrapping");let e=new WebSocket(Ti);return console.log("after ws instantiation",Ti,e),window.ws=e,e.onclose=()=>{console.log("websocket closed")},e.onopen=()=>{console.log("opened websocket connection"),e.send(JSON.stringify({reason:"register",id:this.id})),this.bootstrapAttempts++},e.onmessage=({data:i}=ev)=>{console.log({data:i});let r=JSON.parse(i);switch(r.reason){case"register":this.handleRegister(r);break;case"signal":this.handleSignal(r);break;default:return}},console.log("after creation of websocket in bootstrap"),e}async handleSignal(e){console.log("handleSignal",{data:e}),this.hub.signal(e.iceData)}finishBootstrap(){this.ws?.close(),console.log("finished bootstrapping webrtc connection, greeting")}test(){}setUploading(e){return this.uploadGaurdPromise=new Promise(i=>{this.uploadGuardResolver=i}),e.uploadPromise=new Promise(i=>{e.uploadResolver=i}).finally(()=>{this.uploadGuardResolver&&(this.uploadGuardResolver(null),this.uploadGuardResolver=void 0)}),e.uploadPromise}setDownloading(e){e.downloadPromise=new Promise(i=>{e.downloadResolver=i})}async upload(e,i){let r=this.peers.values().next()?.value;if(!r||r.destroyed)throw Error("No peers to upload to");let n=this.setUploading(r);return console.log("peer sending hash:",e),console.log("binary encoding of upload data:",rt(ne.UPLOAD,i)),r.send(rt(ne.UPLOAD,e,i)),n}}window.signalingData=[];let Ve=new yh;window.comms=Ve;const _h=["stagedFiles","importingFile","importedFile","deletedFile","uploadingFile","uploadedFile","remotelyDeletedFile","reportedFile","filererror"];class wh{events;db;initPromise;initResolver;worker;clock;constructor(){this.events=new Map,this.clock,_h.forEach(e=>this.events.set(e,new Event(e)))}async init(e){this.worker=e,this.initPromise=new Promise(o=>{this.initResolver=o});let r=await(await navigator.storage.getDirectory()).getFileHandle("kollatorDb",{create:!0});if(!r)return{handle:r,files:new Map,name:"Anon",email:"anon@kollator.com",password:"password123lol",provider:"email"};let s=await(await r.getFile()).text();try{this.db=JSON.parse(s);let o=this.db.files;this.db.files=new Map,o.forEach(([a,u])=>this.db.files.set(a,u))}catch{this.db={handle:r,files:new Map,name:"Anon",email:"anon@kollator.com",password:"password123lol",provider:"email"}}this.db||(this.db={handle:r,files:new Map,name:"Anon",email:"anon@kollator.com",password:"password123lol",provider:"email"}),this.db.handle=r,await this.save(),this.initResolver()}dispatch(e){window.dispatchEvent(this.events.get(e))}async load(){}async unload(){}async save(){if(!this.db.handle.createWritable)return;const e=await this.db.handle.createWritable();await e.write(JSON.stringify({...this.db,files:Array.from(this.db.files.entries())})),await e.close()}async importFile(e,i){this.clock||(this.clock=Date.now());const r=await navigator.storage.getDirectory(),n=i?await r.getDirectoryHandle(i):r;let s=await this.worker.processFile(e,n),o=Date.now()-this.clock;console.log("elapsed time:",o,"bytes:",e.size),console.log({metaData:s}),this.db.files.set(s.hash,s),await this.save(),this.dispatch("importedFile"),await this.uploadFile(s.hash)}async uploadFile(e){console.log({fileHash:e});const i=await navigator.storage.getDirectory(),n=await(await i.getFileHandle(e+"torrent")).getFile(),o=await(await i.getFileHandle(e)).getFile(),a=5*1024**2;let u=new Uint8Array(await n.arrayBuffer()),c=await n.text();const p=JSON.parse(c);console.log("filestoreupload",{metadata:p,metadataBytes:u});let d=await crypto.subtle.digest("SHA-256",u),y=_r(new Uint8Array(d));const m=await Xo(p.info.key),w=jn(p.info.iv);this.dispatch("uploadingFile");for await(const x of await this.worker.encryptFileForUpload(n,a,[y],m,w)){let A=await crypto.subtle.digest("SHA-256",x);if(console.log("uploading chunkHash:",_r(new Uint8Array(A)),A.byteLength),!(await Ve.upload(new Uint8Array(A),x))[0]){this.dispatch("error"),console.error("couldn't upload the metadata file");return}}let b=Object.values(p.info.layers)[0].hashes,E=0,_=w.slice();Qo(_);for await(const x of await this.worker.encryptFileForUpload(o,a,b,m,_)){let A=await crypto.subtle.digest("SHA-256",x);(await Ve.upload(new Uint8Array(A),x.length,x))[0]||console.error(`upload of file ${o.name} failed, chunk index: ${E}`)}this.dispatch("uploadedFile")}async exportFile(e){try{let i=await navigator.storage.getDirectory();const r=await this.db.files.get(e)?.hash??"";let s=await(await i.getFileHandle(r,{create:!1})).getFile(),o=this.db.files.get(e);console.log({file:s});const a=new Blob([await s.arrayBuffer()],{type:s.type}),u=URL.createObjectURL(a),c=document.createElement("a");c.href=u,c.download=o?.name,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(u)}catch(i){console.error(i),this.dispatch("error")}}}const Xe=new wh,vh=()=>{const[t,e]=Pi(Array.from(Xe.db.files.values()));return Rt(()=>{const i=()=>{e(Array.from(Xe.db.files.values()))};return window.addEventListener("importedFile",i),()=>{window.removeEventListener("importedFile",i)}},[]),t};window.filer=Xe;function We(t){let e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function Si(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function bh(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Gr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Vr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Eh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function xh(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function si(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Ch(t,e){let i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function Ah(t,e){let i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function Xr(t){let e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Rh(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Th(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Fi(t,e){let i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Ms(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Qr(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],u=i[2];return t[0]=n*u-s*a,t[1]=s*o-r*u,t[2]=r*a-n*o,t}function Sh(t,e,i,r){let n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function Fh(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/o,t[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/o,t[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/o,t}function Mh(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[3]*r+i[7]*n+i[11]*s+i[15];return o=o||1,t[0]=(i[0]*r+i[4]*n+i[8]*s)/o,t[1]=(i[1]*r+i[5]*n+i[9]*s)/o,t[2]=(i[2]*r+i[6]*n+i[10]*s)/o,t}function Ih(t,e,i){let r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function kh(t,e,i){let r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],u=i[2],c=i[3],p=a*s-u*n,d=u*r-o*s,y=o*n-a*r,m=a*y-u*d,w=u*p-o*y,b=o*d-a*p,E=c*2;return p*=E,d*=E,y*=E,m*=2,w*=2,b*=2,t[0]=r+p+m,t[1]=n+d+w,t[2]=s+y+b,t}const Lh=function(){const t=[0,0,0],e=[0,0,0];return function(i,r){Si(t,i),Si(e,r),Fi(t,t),Fi(e,e);let n=Ms(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();function Nh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class Z extends Array{constructor(e=0,i=e,r=e){return super(e,i,r),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,i=e,r=e){return e.length?this.copy(e):(bh(this,e,i,r),this)}copy(e){return Si(this,e),this}add(e,i){return i?Gr(this,e,i):Gr(this,this,e),this}sub(e,i){return i?Vr(this,e,i):Vr(this,this,e),this}multiply(e){return e.length?Eh(this,this,e):si(this,this,e),this}divide(e){return e.length?xh(this,this,e):si(this,this,1/e),this}inverse(e=this){return Th(this,e),this}len(){return We(this)}distance(e){return e?Ch(this,e):We(this)}squaredLen(){return Xr(this)}squaredDistance(e){return e?Ah(this,e):Xr(this)}negate(e=this){return Rh(this,e),this}cross(e,i){return i?Qr(this,e,i):Qr(this,this,e),this}scale(e){return si(this,this,e),this}normalize(){return Fi(this,this),this}dot(e){return Ms(this,e)}equals(e){return Nh(this,e)}applyMatrix3(e){return Ih(this,this,e),this}applyMatrix4(e){return Fh(this,this,e),this}scaleRotateMatrix4(e){return Mh(this,this,e),this}applyQuaternion(e){return kh(this,this,e),this}angle(e){return Lh(this,e)}lerp(e,i){return Sh(this,this,e,i),this}clone(){return new Z(this[0],this[1],this[2])}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this[2]=e[i+2],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e}transformDirection(e){const i=this[0],r=this[1],n=this[2];return this[0]=e[0]*i+e[4]*r+e[8]*n,this[1]=e[1]*i+e[5]*r+e[9]*n,this[2]=e[2]*i+e[6]*r+e[10]*n,this.normalize()}}const Kr=new Z;let Bh=1,Ph=1,Zr=!1;class Dh{constructor(e,i={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=i,this.id=Bh++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let r in i)this.addAttribute(r,i[r])}addAttribute(e,i){if(this.attributes[e]=i,i.id=Ph++,i.size=i.size||1,i.type=i.type||(i.data.constructor===Float32Array?this.gl.FLOAT:i.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),i.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,i.normalized=i.normalized||!1,i.stride=i.stride||0,i.offset=i.offset||0,i.count=i.count||(i.stride?i.data.byteLength/i.stride:i.data.length/i.size),i.divisor=i.instanced||0,i.needsUpdate=!1,i.usage=i.usage||this.gl.STATIC_DRAW,i.buffer||this.updateAttribute(i),i.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==i.count*i.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,i.count*i.divisor);this.instancedCount=i.count*i.divisor}else e==="index"?this.drawRange.count=i.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,i.count))}updateAttribute(e){const i=!e.buffer;i&&(e.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),i?this.gl.bufferData(e.target,e.data,e.usage):this.gl.bufferSubData(e.target,0,e.data),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((i,{name:r,type:n})=>{if(!this.attributes[r]){console.warn(`active attribute ${r} not being supplied`);return}const s=this.attributes[r];this.gl.bindBuffer(s.target,s.buffer),this.glState.boundBuffer=s.buffer;let o=1;n===35674&&(o=2),n===35675&&(o=3),n===35676&&(o=4);const a=s.size/o,u=o===1?0:o*o*4,c=o===1?0:o*4;for(let p=0;p<o;p++)this.gl.vertexAttribPointer(i+p,a,s.type,s.normalized,s.stride+u,s.offset+p*c),this.gl.enableVertexAttribArray(i+p),this.gl.renderer.vertexAttribDivisor(i+p,s.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:i=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((n,{name:s})=>{const o=this.attributes[s];o.needsUpdate&&this.updateAttribute(o)});let r=2;this.attributes.index?.type===this.gl.UNSIGNED_INT&&(r=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r,this.instancedCount):this.gl.renderer.drawArraysInstanced(i,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(i,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r):this.gl.drawArrays(i,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;if(e.data)return e;if(!Zr)return console.warn("No position buffer data found to compute bounds"),Zr=!0}computeBoundingBox(e){e||(e=this.getPosition());const i=e.data,r=e.size;this.bounds||(this.bounds={min:new Z,max:new Z,center:new Z,scale:new Z,radius:1/0});const n=this.bounds.min,s=this.bounds.max,o=this.bounds.center,a=this.bounds.scale;n.set(1/0),s.set(-1/0);for(let u=0,c=i.length;u<c;u+=r){const p=i[u],d=i[u+1],y=i[u+2];n.x=Math.min(p,n.x),n.y=Math.min(d,n.y),n.z=Math.min(y,n.z),s.x=Math.max(p,s.x),s.y=Math.max(d,s.y),s.z=Math.max(y,s.z)}a.sub(s,n),o.add(n,s).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const i=e.data,r=e.size;this.bounds||this.computeBoundingBox(e);let n=0;for(let s=0,o=i.length;s<o;s+=r)Kr.fromArray(i,s),n=Math.max(n,this.bounds.center.squaredDistance(Kr));this.bounds.radius=Math.sqrt(n)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let Oh=1;const Jr={};class Uh{constructor(e,{vertex:i,fragment:r,uniforms:n={},transparent:s=!1,cullFace:o=e.BACK,frontFace:a=e.CCW,depthTest:u=!0,depthWrite:c=!0,depthFunc:p=e.LEQUAL}={}){e.canvas||console.error("gl not passed as first argument to Program"),this.gl=e,this.uniforms=n,this.id=Oh++,i||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=o,this.frontFace=a,this.depthTest=u,this.depthWrite=c,this.depthFunc=p,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=e.createShader(e.VERTEX_SHADER),this.fragmentShader=e.createShader(e.FRAGMENT_SHADER),this.program=e.createProgram(),e.attachShader(this.program,this.vertexShader),e.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:i,fragment:r})}setShaders({vertex:e,fragment:i}){if(e&&(this.gl.shaderSource(this.vertexShader,e),this.gl.compileShader(this.vertexShader),this.gl.getShaderInfoLog(this.vertexShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}
Vertex Shader
${en(e)}`)),i&&(this.gl.shaderSource(this.fragmentShader,i),this.gl.compileShader(this.fragmentShader),this.gl.getShaderInfoLog(this.fragmentShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}
Fragment Shader
${en(i)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let r=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){let a=this.gl.getActiveUniform(this.program,o);this.uniformLocations.set(a,this.gl.getUniformLocation(this.program,a.name));const u=a.name.match(/(\w+)/g);a.uniformName=u[0],a.nameComponents=u.slice(1)}this.attributeLocations=new Map;const n=[],s=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let o=0;o<s;o++){const a=this.gl.getActiveAttrib(this.program,o),u=this.gl.getAttribLocation(this.program,a.name);u!==-1&&(n[u]=a.name,this.attributeLocations.set(a,u))}this.attributeOrder=n.join("")}setBlendFunc(e,i,r,n){this.blendFunc.src=e,this.blendFunc.dst=i,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=n,e&&(this.transparent=!0)}setBlendEquation(e,i){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=i}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let i=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((n,s)=>{let o=this.uniforms[s.uniformName];for(const a of s.nameComponents){if(!o)break;if(a in o)o=o[a];else{if(Array.isArray(o.value))break;o=void 0;break}}if(!o)return tn(`Active uniform ${s.name} has not been supplied`);if(o&&o.value===void 0)return tn(`${s.name} uniform is missing a value parameter`);if(o.value.texture)return i=i+1,o.value.update(i),oi(this.gl,s.type,n,i);if(o.value.length&&o.value[0].texture){const a=[];return o.value.forEach(u=>{i=i+1,u.update(i),a.push(i)}),oi(this.gl,s.type,n,a)}oi(this.gl,s.type,n,o.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function oi(t,e,i,r){r=r.length?zh(r):r;const n=t.renderer.state.uniformLocations.get(i);if(r.length)if(n===void 0||n.length!==r.length)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(Hh(n,r))return;n.set?n.set(r):qh(n,r),t.renderer.state.uniformLocations.set(i,n)}else{if(n===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function en(t){let e=t.split(`
`);for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join(`
`)}function zh(t){const e=t.length,i=t[0].length;if(i===void 0)return t;const r=e*i;let n=Jr[r];n||(Jr[r]=n=new Float32Array(r));for(let s=0;s<e;s++)n.set(t[s],s*i);return n}function Hh(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function qh(t,e){for(let i=0,r=t.length;i<r;i++)t[i]=e[i]}let ai=0;function tn(t){ai>100||(console.warn(t),ai++,ai>100&&console.warn("More than 100 program warnings - stopping logs."))}const li=new Z;let Wh=1;class jh{constructor({canvas:e=document.createElement("canvas"),width:i=300,height:r=150,dpr:n=1,alpha:s=!1,depth:o=!0,stencil:a=!1,antialias:u=!1,premultipliedAlpha:c=!1,preserveDrawingBuffer:p=!1,powerPreference:d="default",autoClear:y=!0,webgl:m=2}={}){const w={alpha:s,depth:o,stencil:a,antialias:u,premultipliedAlpha:c,preserveDrawingBuffer:p,powerPreference:d};this.dpr=n,this.alpha=s,this.color=!0,this.depth=o,this.stencil=a,this.premultipliedAlpha=c,this.autoClear=y,this.id=Wh++,m===2&&(this.gl=e.getContext("webgl2",w)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",w)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(i,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,i){this.width=e,this.height=i,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=i*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:e+"px",height:i+"px"})}setViewport(e,i,r=0,n=0){this.state.viewport.width===e&&this.state.viewport.height===i||(this.state.viewport.width=e,this.state.viewport.height=i,this.state.viewport.x=r,this.state.viewport.y=n,this.gl.viewport(r,n,e,i))}setScissor(e,i,r=0,n=0){this.gl.scissor(r,n,e,i)}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,i,r,n){this.state.blendFunc.src===e&&this.state.blendFunc.dst===i&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===n||(this.state.blendFunc.src=e,this.state.blendFunc.dst=i,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=n,r!==void 0?this.gl.blendFuncSeparate(e,i,r,n):this.gl.blendFunc(e,i))}setBlendEquation(e,i){e=e||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===i)&&(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=i,i!==void 0?this.gl.blendEquationSeparate(e,i):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:i=null}={}){this.state.framebuffer!==i&&(this.state.framebuffer=i,this.gl.bindFramebuffer(e,i))}getExtension(e,i,r){return i&&this.gl[i]?this.gl[i].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),i?this.extensions[e]?this.extensions[e][r].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.program.id!==i.program.id?e.program.id-i.program.id:e.zDepth!==i.zDepth?e.zDepth-i.zDepth:i.id-e.id}sortTransparent(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.zDepth!==i.zDepth?i.zDepth-e.zDepth:i.id-e.id}sortUI(e,i){return e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.program.id!==i.program.id?e.program.id-i.program.id:i.id-e.id}getRenderList({scene:e,camera:i,frustumCull:r,sort:n}){let s=[];if(i&&r&&i.updateFrustum(),e.traverse(o=>{if(!o.visible)return!0;o.draw&&(r&&o.frustumCulled&&i&&!i.frustumIntersectsMesh(o)||s.push(o))}),n){const o=[],a=[],u=[];s.forEach(c=>{c.program.transparent?c.program.depthTest?a.push(c):u.push(c):o.push(c),c.zDepth=0,!(c.renderOrder!==0||!c.program.depthTest||!i)&&(c.worldMatrix.getTranslation(li),li.applyMatrix4(i.projectionViewMatrix),c.zDepth=li.z)}),o.sort(this.sortOpaque),a.sort(this.sortTransparent),u.sort(this.sortUI),s=o.concat(a,u)}return s}render({scene:e,camera:i,target:r=null,update:n=!0,sort:s=!0,frustumCull:o=!0,clear:a}){r===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&a!==!1)&&(this.depth&&(!r||r.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),n&&e.updateMatrixWorld(),i&&i.updateMatrixWorld(),this.getRenderList({scene:e,camera:i,frustumCull:o,sort:s}).forEach(c=>{c.draw({camera:i})})}}function $h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Yh(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function Gh(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o,t}function Vh(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Xh(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Qh(t,e,i){i=i*.5;let r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function rn(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],u=i[1],c=i[2],p=i[3];return t[0]=r*p+o*a+n*c-s*u,t[1]=n*p+o*u+s*a-r*c,t[2]=s*p+o*c+r*u-n*a,t[3]=o*p-r*a-n*u-s*c,t}function Kh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*a,t[1]=n*u+s*a,t[2]=s*u-n*a,t[3]=o*u-r*a,t}function Zh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u-s*a,t[1]=n*u+o*a,t[2]=s*u+r*a,t[3]=o*u-n*a,t}function Jh(t,e,i){i*=.5;let r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*a,t[1]=n*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function eu(t,e,i,r){let n=e[0],s=e[1],o=e[2],a=e[3],u=i[0],c=i[1],p=i[2],d=i[3],y,m,w,b,E;return m=n*u+s*c+o*p+a*d,m<0&&(m=-m,u=-u,c=-c,p=-p,d=-d),1-m>1e-6?(y=Math.acos(m),w=Math.sin(y),b=Math.sin((1-r)*y)/w,E=Math.sin(r*y)/w):(b=1-r,E=r),t[0]=b*n+E*u,t[1]=b*s+E*c,t[2]=b*o+E*p,t[3]=b*a+E*d,t}function tu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function iu(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function ru(t,e){let i=e[0]+e[4]+e[8],r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[s*3+s]-e[o*3+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[s*3+o]-e[o*3+s])*r,t[s]=(e[s*3+n]+e[n*3+s])*r,t[o]=(e[o*3+n]+e[n*3+o])*r}return t}function nu(t,e,i="YXZ"){let r=Math.sin(e[0]*.5),n=Math.cos(e[0]*.5),s=Math.sin(e[1]*.5),o=Math.cos(e[1]*.5),a=Math.sin(e[2]*.5),u=Math.cos(e[2]*.5);return i==="XYZ"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u-r*s*a):i==="YXZ"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u+r*s*a):i==="ZXY"?(t[0]=r*o*u-n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u-r*s*a):i==="ZYX"?(t[0]=r*o*u-n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u+r*s*a):i==="YZX"?(t[0]=r*o*u+n*s*a,t[1]=n*s*u+r*o*a,t[2]=n*o*a-r*s*u,t[3]=n*o*u-r*s*a):i==="XZY"&&(t[0]=r*o*u-n*s*a,t[1]=n*s*u-r*o*a,t[2]=n*o*a+r*s*u,t[3]=n*o*u+r*s*a),t}const su=$h,ou=Yh,au=Vh,lu=Gh;class hu extends Array{constructor(e=0,i=0,r=0,n=1){super(e,i,r,n),this.onChange=()=>{},this._target=this;const s=["0","1","2","3"];return new Proxy(this,{set(o,a){const u=Reflect.set(...arguments);return u&&s.includes(a)&&o.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set w(e){this._target[3]=e,this.onChange()}identity(){return Xh(this._target),this.onChange(),this}set(e,i,r,n){return e.length?this.copy(e):(ou(this._target,e,i,r,n),this.onChange(),this)}rotateX(e){return Kh(this._target,this._target,e),this.onChange(),this}rotateY(e){return Zh(this._target,this._target,e),this.onChange(),this}rotateZ(e){return Jh(this._target,this._target,e),this.onChange(),this}inverse(e=this._target){return tu(this._target,e),this.onChange(),this}conjugate(e=this._target){return iu(this._target,e),this.onChange(),this}copy(e){return su(this._target,e),this.onChange(),this}normalize(e=this._target){return lu(this._target,e),this.onChange(),this}multiply(e,i){return i?rn(this._target,e,i):rn(this._target,this._target,e),this.onChange(),this}dot(e){return au(this._target,e)}fromMatrix3(e){return ru(this._target,e),this.onChange(),this}fromEuler(e,i){return nu(this._target,e,e.order),i||this.onChange(),this}fromAxisAngle(e,i){return Qh(this._target,e,i),this.onChange(),this}slerp(e,i){return eu(this._target,this._target,e,i),this.onChange(),this}fromArray(e,i=0){return this._target[0]=e[i],this._target[1]=e[i+1],this._target[2]=e[i+2],this._target[3]=e[i+3],this.onChange(),this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e[i+3]=this[3],e}}const uu=1e-6;function cu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function du(t,e,i,r,n,s,o,a,u,c,p,d,y,m,w,b,E){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t[9]=p,t[10]=d,t[11]=y,t[12]=m,t[13]=w,t[14]=b,t[15]=E,t}function fu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=e[9],y=e[10],m=e[11],w=e[12],b=e[13],E=e[14],_=e[15],x=i*a-r*o,A=i*u-n*o,T=i*c-s*o,S=r*u-n*a,M=r*c-s*a,k=n*c-s*u,O=p*b-d*w,P=p*E-y*w,H=p*_-m*w,J=d*E-y*b,V=d*_-m*b,ee=y*_-m*E,I=x*ee-A*V+T*J+S*H-M*P+k*O;return I?(I=1/I,t[0]=(a*ee-u*V+c*J)*I,t[1]=(n*V-r*ee-s*J)*I,t[2]=(b*k-E*M+_*S)*I,t[3]=(y*M-d*k-m*S)*I,t[4]=(u*H-o*ee-c*P)*I,t[5]=(i*ee-n*H+s*P)*I,t[6]=(E*T-w*k-_*A)*I,t[7]=(p*k-y*T+m*A)*I,t[8]=(o*V-a*H+c*O)*I,t[9]=(r*H-i*V-s*O)*I,t[10]=(w*M-b*T+_*x)*I,t[11]=(d*T-p*M-m*x)*I,t[12]=(a*P-o*J-u*O)*I,t[13]=(i*J-r*P+n*O)*I,t[14]=(b*A-w*S-E*x)*I,t[15]=(p*S-d*A+y*x)*I,t):null}function Is(t){let e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],p=t[9],d=t[10],y=t[11],m=t[12],w=t[13],b=t[14],E=t[15],_=e*o-i*s,x=e*a-r*s,A=e*u-n*s,T=i*a-r*o,S=i*u-n*o,M=r*u-n*a,k=c*w-p*m,O=c*b-d*m,P=c*E-y*m,H=p*b-d*w,J=p*E-y*w,V=d*E-y*b;return _*V-x*J+A*H+T*P-S*O+M*k}function nn(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],y=e[9],m=e[10],w=e[11],b=e[12],E=e[13],_=e[14],x=e[15],A=i[0],T=i[1],S=i[2],M=i[3];return t[0]=A*r+T*a+S*d+M*b,t[1]=A*n+T*u+S*y+M*E,t[2]=A*s+T*c+S*m+M*_,t[3]=A*o+T*p+S*w+M*x,A=i[4],T=i[5],S=i[6],M=i[7],t[4]=A*r+T*a+S*d+M*b,t[5]=A*n+T*u+S*y+M*E,t[6]=A*s+T*c+S*m+M*_,t[7]=A*o+T*p+S*w+M*x,A=i[8],T=i[9],S=i[10],M=i[11],t[8]=A*r+T*a+S*d+M*b,t[9]=A*n+T*u+S*y+M*E,t[10]=A*s+T*c+S*m+M*_,t[11]=A*o+T*p+S*w+M*x,A=i[12],T=i[13],S=i[14],M=i[15],t[12]=A*r+T*a+S*d+M*b,t[13]=A*n+T*u+S*y+M*E,t[14]=A*s+T*c+S*m+M*_,t[15]=A*o+T*p+S*w+M*x,t}function gu(t,e,i){let r=i[0],n=i[1],s=i[2],o,a,u,c,p,d,y,m,w,b,E,_;return e===t?(t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15]):(o=e[0],a=e[1],u=e[2],c=e[3],p=e[4],d=e[5],y=e[6],m=e[7],w=e[8],b=e[9],E=e[10],_=e[11],t[0]=o,t[1]=a,t[2]=u,t[3]=c,t[4]=p,t[5]=d,t[6]=y,t[7]=m,t[8]=w,t[9]=b,t[10]=E,t[11]=_,t[12]=o*r+p*n+w*s+e[12],t[13]=a*r+d*n+b*s+e[13],t[14]=u*r+y*n+E*s+e[14],t[15]=c*r+m*n+_*s+e[15]),t}function mu(t,e,i){let r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function yu(t,e,i,r){let n=r[0],s=r[1],o=r[2],a=Math.hypot(n,s,o),u,c,p,d,y,m,w,b,E,_,x,A,T,S,M,k,O,P,H,J,V,ee,I,ge;return Math.abs(a)<uu?null:(a=1/a,n*=a,s*=a,o*=a,u=Math.sin(i),c=Math.cos(i),p=1-c,d=e[0],y=e[1],m=e[2],w=e[3],b=e[4],E=e[5],_=e[6],x=e[7],A=e[8],T=e[9],S=e[10],M=e[11],k=n*n*p+c,O=s*n*p+o*u,P=o*n*p-s*u,H=n*s*p-o*u,J=s*s*p+c,V=o*s*p+n*u,ee=n*o*p+s*u,I=s*o*p-n*u,ge=o*o*p+c,t[0]=d*k+b*O+A*P,t[1]=y*k+E*O+T*P,t[2]=m*k+_*O+S*P,t[3]=w*k+x*O+M*P,t[4]=d*H+b*J+A*V,t[5]=y*H+E*J+T*V,t[6]=m*H+_*J+S*V,t[7]=w*H+x*J+M*V,t[8]=d*ee+b*I+A*ge,t[9]=y*ee+E*I+T*ge,t[10]=m*ee+_*I+S*ge,t[11]=w*ee+x*I+M*ge,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function _u(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ks(t,e){let i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],p=e[10];return t[0]=Math.hypot(i,r,n),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,p),t}function wu(t){let e=t[0],i=t[1],r=t[2],n=t[4],s=t[5],o=t[6],a=t[8],u=t[9],c=t[10];const p=e*e+i*i+r*r,d=n*n+s*s+o*o,y=a*a+u*u+c*c;return Math.sqrt(Math.max(p,d,y))}const Ls=function(){const t=[1,1,1];return function(e,i){let r=t;ks(r,i);let n=1/r[0],s=1/r[1],o=1/r[2],a=i[0]*n,u=i[1]*s,c=i[2]*o,p=i[4]*n,d=i[5]*s,y=i[6]*o,m=i[8]*n,w=i[9]*s,b=i[10]*o,E=a+d+b,_=0;return E>0?(_=Math.sqrt(E+1)*2,e[3]=.25*_,e[0]=(y-w)/_,e[1]=(m-c)/_,e[2]=(u-p)/_):a>d&&a>b?(_=Math.sqrt(1+a-d-b)*2,e[3]=(y-w)/_,e[0]=.25*_,e[1]=(u+p)/_,e[2]=(m+c)/_):d>b?(_=Math.sqrt(1+d-a-b)*2,e[3]=(m-c)/_,e[0]=(u+p)/_,e[1]=.25*_,e[2]=(y+w)/_):(_=Math.sqrt(1+b-a-d)*2,e[3]=(u-p)/_,e[0]=(m+c)/_,e[1]=(y+w)/_,e[2]=.25*_),e}}();function vu(t,e,i,r){let n=We([t[0],t[1],t[2]]);const s=We([t[4],t[5],t[6]]),o=We([t[8],t[9],t[10]]);Is(t)<0&&(n=-n),i[0]=t[12],i[1]=t[13],i[2]=t[14];const u=t.slice(),c=1/n,p=1/s,d=1/o;u[0]*=c,u[1]*=c,u[2]*=c,u[4]*=p,u[5]*=p,u[6]*=p,u[8]*=d,u[9]*=d,u[10]*=d,Ls(e,u),r[0]=n,r[1]=s,r[2]=o}function bu(t,e,i,r){const n=t,s=e[0],o=e[1],a=e[2],u=e[3],c=s+s,p=o+o,d=a+a,y=s*c,m=s*p,w=s*d,b=o*p,E=o*d,_=a*d,x=u*c,A=u*p,T=u*d,S=r[0],M=r[1],k=r[2];return n[0]=(1-(b+_))*S,n[1]=(m+T)*S,n[2]=(w-A)*S,n[3]=0,n[4]=(m-T)*M,n[5]=(1-(y+_))*M,n[6]=(E+x)*M,n[7]=0,n[8]=(w+A)*k,n[9]=(E-x)*k,n[10]=(1-(y+b))*k,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function Eu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,u=n+n,c=i*o,p=r*o,d=r*a,y=n*o,m=n*a,w=n*u,b=s*o,E=s*a,_=s*u;return t[0]=1-d-w,t[1]=p+_,t[2]=y-E,t[3]=0,t[4]=p-_,t[5]=1-c-w,t[6]=m+b,t[7]=0,t[8]=y+E,t[9]=m-b,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xu(t,e,i,r,n){let s=1/Math.tan(e/2),o=1/(r-n);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*o,t[15]=0,t}function Cu(t,e,i,r,n,s,o){let a=1/(e-i),u=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*u,t[14]=(o+s)*c,t[15]=1,t}function Au(t,e,i,r){let n=e[0],s=e[1],o=e[2],a=r[0],u=r[1],c=r[2],p=n-i[0],d=s-i[1],y=o-i[2],m=p*p+d*d+y*y;m===0?y=1:(m=1/Math.sqrt(m),p*=m,d*=m,y*=m);let w=u*y-c*d,b=c*p-a*y,E=a*d-u*p;return m=w*w+b*b+E*E,m===0&&(c?a+=1e-6:u?c+=1e-6:u+=1e-6,w=u*y-c*d,b=c*p-a*y,E=a*d-u*p,m=w*w+b*b+E*E),m=1/Math.sqrt(m),w*=m,b*=m,E*=m,t[0]=w,t[1]=b,t[2]=E,t[3]=0,t[4]=d*E-y*b,t[5]=y*w-p*E,t[6]=p*b-d*w,t[7]=0,t[8]=p,t[9]=d,t[10]=y,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function sn(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function on(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function Ru(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}class _e extends Array{constructor(e=1,i=0,r=0,n=0,s=0,o=1,a=0,u=0,c=0,p=0,d=1,y=0,m=0,w=0,b=0,E=1){return super(e,i,r,n,s,o,a,u,c,p,d,y,m,w,b,E),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,i,r,n,s,o,a,u,c,p,d,y,m,w,b,E){return e.length?this.copy(e):(du(this,e,i,r,n,s,o,a,u,c,p,d,y,m,w,b,E),this)}translate(e,i=this){return gu(this,i,e),this}rotate(e,i,r=this){return yu(this,r,e,i),this}scale(e,i=this){return mu(this,i,typeof e=="number"?[e,e,e]:e),this}add(e,i){return i?sn(this,e,i):sn(this,this,e),this}sub(e,i){return i?on(this,e,i):on(this,this,e),this}multiply(e,i){return e.length?i?nn(this,e,i):nn(this,this,e):Ru(this,this,e),this}identity(){return fu(this),this}copy(e){return cu(this,e),this}fromPerspective({fov:e,aspect:i,near:r,far:n}={}){return xu(this,e,i,r,n),this}fromOrthogonal({left:e,right:i,bottom:r,top:n,near:s,far:o}){return Cu(this,e,i,r,n,s,o),this}fromQuaternion(e){return Eu(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return pu(this,e),this}compose(e,i,r){return bu(this,e,i,r),this}decompose(e,i,r){return vu(this,e,i,r),this}getRotation(e){return Ls(e,this),this}getTranslation(e){return _u(e,this),this}getScaling(e){return ks(e,this),this}getMaxScaleOnAxis(){return wu(this)}lookAt(e,i,r){return Au(this,e,i,r),this}determinant(){return Is(this)}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this[2]=e[i+2],this[3]=e[i+3],this[4]=e[i+4],this[5]=e[i+5],this[6]=e[i+6],this[7]=e[i+7],this[8]=e[i+8],this[9]=e[i+9],this[10]=e[i+10],this[11]=e[i+11],this[12]=e[i+12],this[13]=e[i+13],this[14]=e[i+14],this[15]=e[i+15],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e[i+3]=this[3],e[i+4]=this[4],e[i+5]=this[5],e[i+6]=this[6],e[i+7]=this[7],e[i+8]=this[8],e[i+9]=this[9],e[i+10]=this[10],e[i+11]=this[11],e[i+12]=this[12],e[i+13]=this[13],e[i+14]=this[14],e[i+15]=this[15],e}}function Tu(t,e,i="YXZ"){return i==="XYZ"?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):i==="YXZ"?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):i==="ZXY"?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):i==="ZYX"?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):i==="YZX"?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):i==="XZY"&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}const an=new _e;class Su extends Array{constructor(e=0,i=e,r=e,n="YXZ"){super(e,i,r),this.order=n,this.onChange=()=>{},this._target=this;const s=["0","1","2"];return new Proxy(this,{set(o,a){const u=Reflect.set(...arguments);return u&&s.includes(a)&&o.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set(e,i=e,r=e){return e.length?this.copy(e):(this._target[0]=e,this._target[1]=i,this._target[2]=r,this.onChange(),this)}copy(e){return this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.onChange(),this}reorder(e){return this._target.order=e,this.onChange(),this}fromRotationMatrix(e,i=this.order){return Tu(this._target,e,i),this.onChange(),this}fromQuaternion(e,i=this.order,r){return an.fromQuaternion(e),this._target.fromRotationMatrix(an,i),r||this.onChange(),this}fromArray(e,i=0){return this._target[0]=e[i],this._target[1]=e[i+1],this._target[2]=e[i+2],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e[i+2]=this[2],e}}let Yi=class{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new _e,this.worldMatrix=new _e,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new Z,this.quaternion=new hu,this.scale=new Z(1),this.rotation=new Su,this.up=new Z(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(e,i=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,i&&e&&e.addChild(this,!1)}addChild(e,i=!0){~this.children.indexOf(e)||this.children.push(e),i&&e.setParent(this,!1)}removeChild(e,i=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),i&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let i=0,r=this.children.length;i<r;i++)this.children[i].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let i=0,r=this.children.length;i<r;i++)this.children[i].traverse(e)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,i=!1){i?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}};const Fu=new _e,Mu=new Z,Iu=new Z;class ku extends Yi{constructor(e,{near:i=.1,far:r=100,fov:n=45,aspect:s=1,left:o,right:a,bottom:u,top:c,zoom:p=1}={}){super(),Object.assign(this,{near:i,far:r,fov:n,aspect:s,left:o,right:a,bottom:u,top:c,zoom:p}),this.projectionMatrix=new _e,this.viewMatrix=new _e,this.projectionViewMatrix=new _e,this.worldPosition=new Z,this.type=o||a?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:e=this.near,far:i=this.far,fov:r=this.fov,aspect:n=this.aspect}={}){return Object.assign(this,{near:e,far:i,fov:r,aspect:n}),this.projectionMatrix.fromPerspective({fov:r*(Math.PI/180),aspect:n,near:e,far:i}),this.type="perspective",this}orthographic({near:e=this.near,far:i=this.far,left:r=this.left||-1,right:n=this.right||1,bottom:s=this.bottom||-1,top:o=this.top||1,zoom:a=this.zoom}={}){return Object.assign(this,{near:e,far:i,left:r,right:n,bottom:s,top:o,zoom:a}),r/=a,n/=a,s/=a,o/=a,this.projectionMatrix.fromOrthogonal({left:r,right:n,bottom:s,top:o,near:e,far:i}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(Fu.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new Z,new Z,new Z,new Z,new Z,new Z]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let i=0;i<6;i++){const r=1/this.frustum[i].distance();this.frustum[i].multiply(r),this.frustum[i].constant*=r}}frustumIntersectsMesh(e,i=e.worldMatrix){if(!e.geometry.attributes.position||((!e.geometry.bounds||e.geometry.bounds.radius===1/0)&&e.geometry.computeBoundingSphere(),!e.geometry.bounds))return!0;const r=Mu;r.copy(e.geometry.bounds.center),r.applyMatrix4(i);const n=e.geometry.bounds.radius*i.getMaxScaleOnAxis();return this.frustumIntersectsSphere(r,n)}frustumIntersectsSphere(e,i){const r=Iu;for(let n=0;n<6;n++){const s=this.frustum[n];if(r.copy(s).dot(e)+s.constant<-i)return!1}return!0}}function Lu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Nu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,u=n+n,c=i*o,p=r*o,d=r*a,y=n*o,m=n*a,w=n*u,b=s*o,E=s*a,_=s*u;return t[0]=1-d-w,t[3]=p-_,t[6]=y+E,t[1]=p+_,t[4]=1-c-w,t[7]=m-b,t[2]=y-E,t[5]=m+b,t[8]=1-c-d,t}function Bu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Pu(t,e,i,r,n,s,o,a,u,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=c,t}function Du(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ou(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=p*o-a*c,y=-p*s+a*u,m=c*s-o*u,w=i*d+r*y+n*m;return w?(w=1/w,t[0]=d*w,t[1]=(-p*r+n*c)*w,t[2]=(a*r-n*o)*w,t[3]=y*w,t[4]=(p*i-n*u)*w,t[5]=(-a*i+n*s)*w,t[6]=m*w,t[7]=(-c*i+r*u)*w,t[8]=(o*i-r*s)*w,t):null}function ln(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],y=i[0],m=i[1],w=i[2],b=i[3],E=i[4],_=i[5],x=i[6],A=i[7],T=i[8];return t[0]=y*r+m*o+w*c,t[1]=y*n+m*a+w*p,t[2]=y*s+m*u+w*d,t[3]=b*r+E*o+_*c,t[4]=b*n+E*a+_*p,t[5]=b*s+E*u+_*d,t[6]=x*r+A*o+T*c,t[7]=x*n+A*a+T*p,t[8]=x*s+A*u+T*d,t}function Uu(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],y=i[0],m=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=y*r+m*o+c,t[7]=y*n+m*a+p,t[8]=y*s+m*u+d,t}function zu(t,e,i){let r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],p=e[7],d=e[8],y=Math.sin(i),m=Math.cos(i);return t[0]=m*r+y*o,t[1]=m*n+y*a,t[2]=m*s+y*u,t[3]=m*o-y*r,t[4]=m*a-y*n,t[5]=m*u-y*s,t[6]=c,t[7]=p,t[8]=d,t}function Hu(t,e,i){let r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function qu(t,e){let i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],p=e[8],d=e[9],y=e[10],m=e[11],w=e[12],b=e[13],E=e[14],_=e[15],x=i*a-r*o,A=i*u-n*o,T=i*c-s*o,S=r*u-n*a,M=r*c-s*a,k=n*c-s*u,O=p*b-d*w,P=p*E-y*w,H=p*_-m*w,J=d*E-y*b,V=d*_-m*b,ee=y*_-m*E,I=x*ee-A*V+T*J+S*H-M*P+k*O;return I?(I=1/I,t[0]=(a*ee-u*V+c*J)*I,t[1]=(u*H-o*ee-c*P)*I,t[2]=(o*V-a*H+c*O)*I,t[3]=(n*V-r*ee-s*J)*I,t[4]=(i*ee-n*H+s*P)*I,t[5]=(r*H-i*V-s*O)*I,t[6]=(b*k-E*M+_*S)*I,t[7]=(E*T-w*k-_*A)*I,t[8]=(w*M-b*T+_*x)*I,t):null}class Wu extends Array{constructor(e=1,i=0,r=0,n=0,s=1,o=0,a=0,u=0,c=1){return super(e,i,r,n,s,o,a,u,c),this}set(e,i,r,n,s,o,a,u,c){return e.length?this.copy(e):(Pu(this,e,i,r,n,s,o,a,u,c),this)}translate(e,i=this){return Uu(this,i,e),this}rotate(e,i=this){return zu(this,i,e),this}scale(e,i=this){return Hu(this,i,e),this}multiply(e,i){return i?ln(this,e,i):ln(this,this,e),this}identity(){return Du(this),this}copy(e){return Bu(this,e),this}fromMatrix4(e){return Lu(this,e),this}fromQuaternion(e){return Nu(this,e),this}fromBasis(e,i,r){return this.set(e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2]),this}inverse(e=this){return Ou(this,e),this}getNormalMatrix(e){return qu(this,e),this}}let ju=0;class hn extends Yi{constructor(e,{geometry:i,program:r,mode:n=e.TRIANGLES,frustumCulled:s=!0,renderOrder:o=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=ju++,this.geometry=i,this.program=r,this.mode=n,this.frustumCulled=s,this.renderOrder=o,this.modelViewMatrix=new _e,this.normalMatrix=new Wu,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}));let i=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:i}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}))}}const un=new Uint8Array(4);function cn(t){return(t&t-1)===0}let $u=1;class dn{constructor(e,{image:i,target:r=e.TEXTURE_2D,type:n=e.UNSIGNED_BYTE,format:s=e.RGBA,internalFormat:o=s,wrapS:a=e.CLAMP_TO_EDGE,wrapT:u=e.CLAMP_TO_EDGE,generateMipmaps:c=!0,minFilter:p=c?e.NEAREST_MIPMAP_LINEAR:e.LINEAR,magFilter:d=e.LINEAR,premultiplyAlpha:y=!1,unpackAlignment:m=4,flipY:w=r==e.TEXTURE_2D,anisotropy:b=0,level:E=0,width:_,height:x=_}={}){this.gl=e,this.id=$u++,this.image=i,this.target=r,this.type=n,this.format=s,this.internalFormat=o,this.minFilter=p,this.magFilter=d,this.wrapS=a,this.wrapT=u,this.generateMipmaps=c,this.premultiplyAlpha=y,this.unpackAlignment=m,this.flipY=w,this.anisotropy=Math.min(b,this.gl.renderer.parameters.maxAnisotropy),this.level=E,this.width=_,this.height=x,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(e=0){const i=!(this.image===this.store.image&&!this.needsUpdate);if((i||this.glState.textureUnits[e]!==this.id)&&(this.gl.renderer.activeTexture(e),this.bind()),!!i){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let r=0;r<6;r++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+r,this.level,this.internalFormat,this.format,this.type,this.image[r]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let r=0;r<this.image.length;r++)this.gl.compressedTexImage2D(this.target,r,this.internalFormat,this.image[r].width,this.image[r].height,0,this.image[r].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!cn(this.image.width)||!cn(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let r=0;r<6;r++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,un);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,un);this.store.image=this.image}}}function Yu(t,e){return t[0]=e[0],t[1]=e[1],t}function Gu(t,e,i){return t[0]=e,t[1]=i,t}function fn(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function pn(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Vu(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Xu(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function hi(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Qu(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function Ku(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function gn(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Zu(t){var e=t[0],i=t[1];return e*e+i*i}function Ju(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ec(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function tc(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function ic(t,e){return t[0]*e[0]+t[1]*e[1]}function mn(t,e){return t[0]*e[1]-t[1]*e[0]}function rc(t,e,i,r){var n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function nc(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function sc(t,e,i){let r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function oc(t,e){return t[0]===e[0]&&t[1]===e[1]}class Ct extends Array{constructor(e=0,i=e){return super(e,i),this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,i=e){return e.length?this.copy(e):(Gu(this,e,i),this)}copy(e){return Yu(this,e),this}add(e,i){return i?fn(this,e,i):fn(this,this,e),this}sub(e,i){return i?pn(this,e,i):pn(this,this,e),this}multiply(e){return e.length?Vu(this,this,e):hi(this,this,e),this}divide(e){return e.length?Xu(this,this,e):hi(this,this,1/e),this}inverse(e=this){return ec(this,e),this}len(){return gn(this)}distance(e){return e?Qu(this,e):gn(this)}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?Ku(this,e):Zu(this)}negate(e=this){return Ju(this,e),this}cross(e,i){return i?mn(e,i):mn(this,e)}scale(e){return hi(this,this,e),this}normalize(){return tc(this,this),this}dot(e){return ic(this,e)}equals(e){return oc(this,e)}applyMatrix3(e){return nc(this,this,e),this}applyMatrix4(e){return sc(this,this,e),this}lerp(e,i){return rc(this,this,e,i),this}clone(){return new Ct(this[0],this[1])}fromArray(e,i=0){return this[0]=e[i],this[1]=e[i+1],this}toArray(e=[],i=0){return e[i]=this[0],e[i+1]=this[1],e}}const ac=`
precision mediump float;

varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,lc=`
attribute float vertexId;

uniform vec2 mouse;
uniform vec2 resolution;
uniform vec4 background;
uniform float time;
uniform float vertexCount;
uniform sampler2D volume;
uniform sampler2D sound;
// uniform sampler2D floatSound;
uniform sampler2D touch;
uniform vec2 soundRes;
uniform float _dontUseDirectly_pointSize;

varying vec4 v_color;
#define PI radians(180.)
#define NUM_SEGMENTS 2.0
#define NUM_POINTS (NUM_SEGMENTS * 2.0)
#define STEP 1.0

float radius = 0.05;
float amount = 800.;
float len = vertexCount/90. / amount;

float mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}

float noise(vec3 p){
  vec3 a = floor(p);
  vec3 d = p - a;
  d = d * d * (3.0 - 2.0 * d);

  vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
  vec4 k1 = perm(b.xyxy);
  vec4 k2 = perm(k1.xyxy + b.zzww);

  vec4 c = k2 + a.zzzz;
  vec4 k3 = perm(c);
  vec4 k4 = perm(c + 1.0);

  vec4 o1 = fract(k3 * (1.0 / 41.0));
  vec4 o2 = fract(k4 * (1.0 / 41.0));

  vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
  vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);

  return o4.y * d.y + o4.x * (1.0 - d.y);
}

void main() {gl_PointSize=1.0;
  float ratio = resolution.x / resolution.y;
  float seg = floor(vertexId/len/200.);
  float segId = mod(vertexId,len*100.);
  float mod3 = mod(segId, 3.0);
  float step0 = step(mod3, 0.5); // 1.0 if segId % 3 == 0, 0.0 otherwise
  float step1 = step(0.5, mod3) * step(mod3, 1.5); // 1.0 if segId % 3 == 1, 0.0 otherwise
  float step2 = step(1.5, mod3); // 1.0 if segId % 3 == 2, 0.0 otherwise

  float v = texture2D(volume, vec2(1., (1.+seg)/amount*240.)).a;
  float s = texture2D(sound, vec2(1., (1.+segId)/len*140.)).a;
  vec3 p = vec3(vertexId * 0.005, seg, time*0.05 - segId*0.0001);
  float n = noise(p);
  float x = (0. + cos(n * PI) * sin(segId * 0.00001) * s) * step2; // Applies when segId % 3 == 2, the smile
  float y = (.0 + sin(n * PI) * segId * 0.0000015 * s * ratio)*1./  cos(segId)*step2;
  
  
  x += cos(vertexId/vertexCount * PI * 2.)*(v*radius+segId*0.002)*(step0+step1);
  y += sin(vertexId/vertexCount * PI * 2.)*ratio*(v*radius+segId*0.00189)*(step0+step1);
  // float z = segId * 0.006;
  // float z = sin(segId * 0.006) * 0.5;
  float z = 0.7*step2-abs(cos(segId-.1)/0.9) *step2;
  z += 1./exp(-segId * 0.002) * 0.5*(step0+step1);

  // Calculate smileAngle for each vertex based on vertexId
  // float smileAngle = mix(-PI / 4.0, -3.0 * PI / 4.0, vertexId / vertexCount);

  // // Calculate the x and y position of the arc
  // float x = radius * cos(smileAngle);
  // float y = radius * sin(smileAngle) - 0.5; // Adjust the vertical position for a smile

  // Set the position of the point
  vec4 position = vec4(x, y, 0.0, 1.0);
  gl_Position = position;

  
  x += (.4 + cos(n * PI * 4.0) * segId * 0.000002 * s) * step0; // Applies when segId % 3 == 0
  x += (-.4 + sin(n * PI * 3.0) * segId * 0.000003 * s) * step1; // Applies when segId % 3 == 1
  y += (.3 + sin(n * PI*4.) * segId * 0.0000015 * s * ratio)*step0;
  y += (.3 + sin(n * PI*4.) * segId * 0.0000015 * s * ratio)*step1;

  z += cos(n * PI * 4.0) * segId * 0.000002 * s*(step0+step1);
  
  
  float angle = PI * mouse.x; // Rotates 180 degrees based on mouse.x from -1 to 1
  
  // Calculate rotation angles based on mouse positions
  float angleX = radians(-90.0) * mouse.y*.3; // Rotation around X-axis based on mouse y
  float angleY = radians(90.0) * mouse.x; // Rotation around Y-axis based on mouse x
  float angleZ = radians(0.0) * mouse.x; // Rotation around Z-axis based on mouse x

  // Rotation matrices operations
  // Rotate around X
  float newY = y * cos(angleX) - z * sin(angleX);
  float newZ = y * sin(angleX) + z * cos(angleX);
  y = newY;
  z = newZ;

  // Rotate around Y
  float newX = x * cos(angleY) + z * sin(angleY);
  newZ = z * cos(angleY) - x * sin(angleY);
  x = newX;
  z = newZ;

  // Rotate around Z
  newX = x * cos(angleZ) - y * sin(angleZ);
  newY = x * sin(angleZ) + y * cos(angleZ);
  x = newX;
  y = newY;

  // x += cos(n * PI*4.) * segId * 0.000002 * s*2.;
  // y += sin(n * PI*4.) * segId * 0.0000015 * s*2. * ratio;
  
  float b = 0.3 / mod(vertexId/len,1.);
  v_color = vec4(vec3(b), 1.0);

  // Set the new position
  gl_Position = vec4(x, y, z, 1.0);
 ;
gl_PointSize = max(0., gl_PointSize*_dontUseDirectly_pointSize);
}
`,hc={vertex:lc,fragment:ac};class uc{floatBuffer;mesh;points;gl;scene;count;uniforms;programOptions;geometryOptions;constructor({gl:e,scene:i,uniforms:r,points:n,count:s,programOptions:o,geometryOptions:a}){this.gl=e,this.points=n,this.scene=i,this.count=s??2e3,this.uniforms=r,this.programOptions=o??hc,this.geometryOptions=a??{position:{size:1,data:new Float32Array(this.count*3)}}}async init(){console.log("entity count",this.count);let e=new Float32Array(this.count*3.2);for(let n=0;n<e.length;++n)e[n]=n;console.log("vertexId count",e.length),console.log({geops:this.geometryOptions,uniforms:this.uniforms});let i=new Dh(this.gl,{...this.geometryOptions,vertexId:{size:1,data:e}});console.log("entityUniforms",this.uniforms);let r=new Uh(this.gl,{...this.programOptions,transparent:!1,depthTest:!0,uniforms:this.uniforms});r.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.points?this.mesh=new hn(this.gl,{mode:this.gl.POINTS,geometry:i,program:r}):this.mesh=new hn(this.gl,{geometry:i,program:r})}setParent(){this.mesh.setParent(this.scene)}pos(e){this.mesh.position.set(e)}rot(e){this.mesh.rotation.x=e.x,this.mesh.rotation.y=e.y,this.mesh.rotation.z=e.x}}class cc{camera;scene;renderer;devicePixelRatio;canvas;autoRender=!0;canHandleFloat=!0;soundSampleCount=128;entities=[];uniforms;volumeArray;soundArray;mutex;sharedData;sum;maxDif;maxSample;touchColumns=32;frameLagCount=0;frameCount=0;volumeTexture;soundTexture;pointer;constructor({canvas:e,width:i,height:r,pixelRatio:n,pointer:s}){this.canvas=e,this.devicePixelRatio=n,this.pointer=s;const o=e;this.renderer=new jh({canvas:o,width:i,height:r}),this.renderer.gl.clearColor(0,0,0,0),this.camera=new ku(this.renderer.gl,{fov:15}),this.camera.position.z=15,this.camera.position.x=-3,this.scene=new Yi,this.camera.perspective({aspect:this.canvas.width/this.canvas.height}),this.sharedData={mutex:new SharedArrayBuffer(4),volume:new SharedArrayBuffer(4)}}async init(){if(!this.sharedData.sound)throw"Sound must be set as a sharedArrayBuffer before scene can be initialized";this.soundSampleCount=Math.min(this.soundSampleCount,this.renderer.gl.getParameter(this.renderer.gl.MAX_TEXTURE_SIZE));const e=1e5;this.mutex=new Int32Array(this.sharedData.mutex);let i=this.renderer.gl;this.volumeArray=new Uint8Array(this.sharedData.volume),this.soundArray=new Float32Array(this.sharedData.sound),this.soundArray.fill(Math.random()*-400);let r=new dn(this.renderer.gl,{image:this.volumeArray,width:1,type:i.UNSIGNED_BYTE,format:i.RGBA,internalFormat:i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:i.NEAREST,magFilter:i.NEAREST,flipY:!1});this.volumeTexture=r;let n=new dn(this.renderer.gl,{image:this.soundArray,width:16,type:i.FLOAT,format:i.RGBA,internalFormat:i.renderer.isWebgl2?i.RGBA32F:i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:i.LINEAR,magFilter:i.LINEAR,flipY:!1});this.soundTexture=n,this.uniforms={mouse:{value:new Ct(.2,.5)},resolution:{value:new Ct(this.canvas.width,this.canvas.height)},time:{value:0},vertexCount:{value:e},volume:{value:this.volumeTexture},sound:{value:this.soundTexture},_dontUseDirectly_pointSize:{value:1}};let s=new uc({gl:this.renderer.gl,scene:this.scene,uniforms:this.uniforms,count:e,points:!0});s.init(),s.setParent(),this.entities.push(s),this.render()}render=(e=0)=>{this.autoRender&&requestAnimationFrame(this.render.bind(this));const i=this.renderer.gl;Atomics.load(this.mutex,0)===3?(this.volumeTexture.needsUpdate=!0,this.soundTexture.needsUpdate=!0,Atomics.store(this.mutex,0,0)):this.volumeArray[3]&&(this.volumeArray[0]=Math.max(0,this.volumeArray[0]-6),this.volumeArray[1]=Math.max(0,this.volumeArray[1]-6),this.volumeArray[2]=Math.max(0,this.volumeArray[2]-6),this.volumeArray[3]=Math.max(0,this.volumeArray[3]-6),this.volumeTexture.needsUpdate=!0),this.frameCount++,this.uniforms.time.value=e*.001,this.uniforms.mouse.value.x=this.pointer.x,this.uniforms.mouse.value.y=this.pointer.y,i.lineWidth(1),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.clearColor.apply(i,[0,0,0,1]),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.renderer.render({scene:this.scene,camera:this.camera})}}class dc{renderer;scene;gl;mutexBuffer=new SharedArrayBuffer(4);mutex;autoRender={value:!0};mouse={baseX:-.1,x:0,baseY:0,y:0};maxTextureSize;canHandleFloat=!1;messagePort;connectedAudio=!1;audioCheckInterval;constructor(){}async init(e){console.log("glitzcontroller data",{data:e}),this.mutex=new Int32Array(this.mutexBuffer),Atomics.store(this.mutex,0,1);const i=e.innerWidth,r=e.innerHeight,n=e.devicePixelRatio;this.scene=new cc({canvas:e.canvas,width:i,height:r,pixelRatio:n,pointer:this.mouse}),console.log("init scene called",n),this.renderer=this.scene.renderer,this.gl=this.scene.renderer.gl,this.canHandleFloat=!0;const s=!0;return this.maxTextureSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),console.log({canHandleFloat:this.canHandleFloat,canRenderToFloat:s}),this.checkForAudioConnection(),{resize:this.resize.bind(this),autoRender:this.autoRender,mouse:this.mouse}}checkForAudioConnection(){this.connectedAudio||(this.audioCheckInterval=setInterval(()=>{if(this.connectedAudio){clearInterval(this.audioCheckInterval);return}this.connectToAudio()},200))}setPort(e){this.messagePort=e,this.messagePort.onmessage=this.handleMessage.bind(this)}handleMessage(e){console.log("glitzController handle Message",e),e.data.reason==="audioConnected"&&!this.connectedAudio&&(this.connectedAudio=!0,this.scene.canHandleFloat=this.canHandleFloat,console.log("bincount and maxtexturesize",{binCount:e.data.frequencyBinCount,maxtsize:this.maxTextureSize}),this.scene.sharedData.sound=new SharedArrayBuffer(Math.min(this.maxTextureSize,e.data.frequencyBinCount)*4),this.scene.init(),this.sendSharedBuffers())}connectToAudio(){this.messagePort.postMessage({reason:"audioConnectionRequest"})}sendSharedBuffers(){this.messagePort.postMessage({reason:"sharedBuffers",mutexBuffer:this.scene.sharedData.mutex,volumeBuffer:this.scene.sharedData.volume,soundBuffer:this.scene.sharedData.sound})}resize(){console.log("resizing")}}const fc=new dc;function yn(){}class pc{glitzern;width;height;canvas;left;top;constructor(e){this.glitzern=[],this.canvas=e}getBoundingClientRect(){return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}}mouseHandler(e){this.startRender();for(let i of this.glitzern)i.mouse.x=(-e.clientX*2+this.width)/this.width,i.mouse.y=(e.clientY*2-this.height)/this.height}sizeHandler(e){if(console.log("resizeHandler",this,e),console.log("worker size event wh",this.width,this.height,this.canvas?.width,this.canvas?.height),this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,this.canvas){this.canvas.width=e.width,this.canvas.height=e.height,console.log("worker size event wh",this,this.width,this.height,this.canvas?.width,this.canvas?.height);for(let i of this.glitzern)i.program.uniforms.uResolution.x=this.width,i.program.uniforms.uResolution.y=this.height,i.program.gl.renderer.setSize(this.width,this.height)}}wheelHandler(e){console.log("wheelHandler")}keyHandler(e){console.log("keyHandler",e)}stopRender(){for(let e of this.glitzern)e.autoRender.value=!1}startRender(){for(let e of this.glitzern)e.autoRender.value||(e.autoRender.value=!0,e.render())}handleEvent(e){if(e.type==="size"){this.sizeHandler(e);return}switch(e.preventDefault=yn,e.stopPropagation=yn,e.type){case"pointermove":this.mouseHandler(e);break;case"keydown":this.keyHandler(e);break}}focus(){}}function gc(t){return new Worker("/assets/glitzWorker-W3QwtMuV.js",{type:"module",name:t?.name})}const ot=Gi(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]),mc=Gi(["deltaX","deltaY"]),yc=Gi(["ctrlKey","metaKey","shiftKey","keyCode"]);function _c(t,e){t.preventDefault(),mc(t,e)}function wc(t,e,i){for(const r of e)i[r]=t[r]}function Gi(t){return function(i,r){const n={type:i.type};wc(i,t,n),r(n)}}function vc(t,e){yc(t,e)}let bc=0;class Ec{worker;id;constructor(e,i,r){this.id=bc++,this.worker=i;const n=o=>{this.worker.postMessage({type:"event",id:this.id,data:o})};i.postMessage({type:"makeProxy",id:this.id}),s();for(const[o,a]of Object.entries(r))e.addEventListener(o,function(u){a(u,n)});function s(){const o={top:0,left:0,width:window.innerWidth,height:window.innerHeight};n({type:"size",left:o.left,top:o.top,width:window.innerWidth,height:window.innerHeight})}window.addEventListener("resize",s),window.addEventListener("fullscreenchange",s)}sendEvent(e){this.worker.postMessage({type:"event",id:this.id,data:e})}}function xc(t,e){t.width=window.innerWidth,t.height=window.innerHeight,t.focus();const i=t.transferControlToOffscreen(),r=new gc;r.postMessage({reason:"initialize",port:e},[e]);const n={mousemove:ot,pointerdown:ot,pointermove:ot,pointerup:ot,wheel:_c,keydown:vc};console.log("startworker");const s=new Ec(window,r,n),o={type:"start",canvas:i,canvasId:s.id,innerWidth:window.innerWidth,innerHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio};r.postMessage(o,[i])}async function Cc(t,e){t.width=window.innerWidth,t.height=window.innerHeight,t.focus();const i=new pc;e.onmessage=n=>{console.log("worker received audio data",n.data)},i.width=t.width,i.height=t.height,i.glitzern.push(await fc.init({element:window,canvas:t,inputElement:t,innerWidth:window.innerWidth,innerHeight:window.innerHeight,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio}));const r={pointerdown:i.mouseHandler,pointermove:i.mouseHandler,pointerup:i.mouseHandler,wheel:i.wheelHandler,keydown:i.keyHandler};for(const[n,s]of Object.entries(r))window.addEventListener(n,s.bind(i));window.addEventListener("resize",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),window.addEventListener("fullscreenchange",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),window.addEventListener("webkitfullscreenchange",n=>{const s={top:0,left:0,width:window.innerWidth,height:window.innerHeight};i.sizeHandler(s)}),console.log("using regular canvas")}const _n=Tt.get("proxy"),Ac={canHandle(t){return t&&typeof t=="object"&&typeof t.next=="function"&&(typeof t[Symbol.iterator]=="function"||typeof t[Symbol.asyncIterator]=="function")},serialize(t){return _n.serialize(Wn(t))},async*deserialize(t){const e=_n.deserialize(t);for(;;){const{value:i,done:r}=await e.next();if(r)break;yield i}}};Tt.set("asyncGenerator",Ac);let wn=!1,Rc=new Event("initialized"),Mi;const Tc=qo?8:window.navigator.hardwareConcurrency>1?window.navigator.hardwareConcurrency:5;let vn=[],at,bn;Ve.test();async function Sc(){for(let t=0;t<Tc;++t){at&&await at;let e=new Ko,i=zn(e);vn.push(i),at===void 0&&(at=new Promise(r=>{bn=r})),e.onmessage=r=>{r.data==="ready"&&(wn||(wn=!0,bn()),i.init(t))}}Mi=new Fc(vn)}class Fc{workers;rrIndex;workerCount;constructor(e){this.workers=e,this.rrIndex=0,this.workerCount=e.length}async init(){(await this.workers[0].getProps()).filter(i=>typeof this.workers[0][i]=="function"&&i!=="constructor"&&i!=="init"&&i!=="getProp").forEach(i=>{this[i]||(this[i]=(...r)=>(this.rrIndex%=this.workerCount,this.workers[this.rrIndex++][i](r)))})}}async function Mc(t){const e=document.querySelector("#glitz");e.transferControlToOffscreen?xc(e,t):Cc(e,t)}async function Ic(){const t=new MessageChannel;Mc(t.port1),await xe.init(void 0,t.port2),await Sc(),await Mi.init(),await Xe.init(Mi),Ve.test(),window.dispatchEvent(Rc)}function kc(){const[t,e]=Pi(!1);return Rt(()=>{const i=()=>{e(!0)};return window.addEventListener("initialized",i),()=>{window.removeEventListener("initialized",i)}},[]),t}function Lc({title:t}){const e=vh();return j(we,{children:[e.length!==0&&j("p",{children:t}),j("ul",{class:"list-none",children:e.map(i=>j("li",{onClick:()=>Xe.exportFile(i.hash),children:i.name},i.hash))})]})}Ic();const Nc=Wo();function Bc(){const t=kc(),[e,i]=Pi(xe.isPlaying);function r(){e?xe.pause():xe.play()}return Rt(()=>{const n=()=>{i(!0)},s=()=>{i(!1)};return window.addEventListener("audioPlaying",n),window.addEventListener("audioPaused",s),()=>{window.removeEventListener("audioPlaying",n),window.addEventListener("audioPaused",s)}},[]),t?j(we,{children:j("main",{class:"w-full h-full relative flex flex-col items-center flex-col justify-center",children:[j("div",{class:"fileArea",children:[j("h1",{class:"select-none text-white",children:"KOLLATOR"}),j("div",{class:"p-2 select-none",children:j(bo,{})}),j("p",{class:"read-the-docs select-none",children:Nc}),j(Lc,{title:"Cached Files"})]}),j("button",{class:"",onClick:()=>xe.playDefault(),children:"Default Music"}),j("button",{class:"absolute bottom-0 right-0 w-16 h-16 rounded-full",onClick:r,children:e?j("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:j("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})}):j("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:j("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"})})})]})}):j(we,{children:"ahoy"})}Js(j(Bc,{}),document.getElementById("app"));
